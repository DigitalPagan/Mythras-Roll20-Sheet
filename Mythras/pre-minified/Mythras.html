<!-- Sheet type at very top to influence the rest -->
<input class="sheet-typetoggle" type="hidden" name="attr_type" value="pc">
<input class="sheet-setting-control" type="hidden" name="attr_setting" value="default">
<input class="sheet-compact-control" type="hidden" name="attr_compact" value="0">
<div class="sheet-wrapper">
    <!-- Floating Option Bar -->
    <div class="sheet-option-bar">
    <!-- Options -->
    <div class="sheet-space-between sheet-gap">
        <!-- Option Bar Left -->
        <div class="sheet-flex sheet-gap">
            <!-- Whisper Toggle -->
            <div><input data-i18n-title="broadcast_rolls_to_everyone/whisper_rolls_to_gm" type='checkbox' name='attr_roll_display' value="/w gm"><span class="sheet-checkico-reverse">f</span></div>

            <!-- Skill Difficulty Option -->
            <div class="sheet-flex sheet-gap">
                <label class="sheet-left sheet-large-screen" data-i18n="difficulty">Difficulty</label>
                <label class="sheet-left sheet-small-screen" data-i18n-title="difficulty" data-i18n="difficulty-a">Diff</label>
                <select class="sheet-auto-width sheet-text-center sheet-inverted" name="attr_difficulty">
                    <option value="0" data-i18n="verbose" selected>verbose</option>
                    <option value="1" data-i18n="very_easy">Very Easy</option>
                    <option value="2" data-i18n="easy">Easy</option>
                    <option value="3" data-i18n="standard">Standard</option>
                    <option value="4" data-i18n="hard">Hard</option>
                    <option value="5" data-i18n="formidable">Formidable</option>
                    <option value="6" data-i18n="herculean">Herculean</option>
                </select>
            </div>

            <!-- Augment Option -->
            <div class="sheet-flex sheet-gap">
                <label class="sheet-left sheet-large-screen" data-i18n="augmentation">Augmentation</label>
                <label class="sheet-left sheet-small-screen sheet-pictos" data-i18n-title="augmentation">&</label>
                <select class="sheet-auto-width sheet-text-center sheet-inverted" title="@{augmentation}" name="attr_augmentation">
                    <option value="@{set_augmentation}" data-i18n="set" selected>Set</option>
                    <option value="?{Augmentation|0}" data-i18n="prompt">Prompt</option>
                </select>
                <input type="hidden" class="sheet-set-toggle-control" name="attr_augmentation" value="@{set_augmentation}">
                <input type="number" class="sheet-number-width-sm sheet-set-toggle" name="attr_set_augmentation" value="0">
                <button type="action" class="sheet-set-toggle sheet-checkbox-width sheet-link sheet-no-underline sheet-pictos" data-i18n-title="reset_augmentation" name="act_reset-augmentation">1</button>
            </div>

            <!-- 101+ Penalty Option -->
            <div class="sheet-flex sheet-gap">
                <label class="sheet-left sheet-large-screen" data-i18n="101+_penalty">101+ Penalty</label>
                <label class="sheet-left sheet-small-screen sheet-pictos" data-i18n-title="101+_penalty">_</label>
                <select class="sheet-auto-width sheet-text-center sheet-inverted" title="@{penalty}" name="attr_penalty">
                    <option value="@{set_penalty}" data-i18n="set" selected>Set</option>
                    <option value="?{101+ Penalty|0}" data-i18n="prompt">Prompt</option>
                </select>
                <input type="hidden" class="sheet-set-toggle-control" name="attr_penalty" value="@{set_penalty}">
                <input type="number" class="sheet-number-width-sm sheet-set-toggle" name="attr_set_penalty" value="0">
                <button type="action" class="sheet-set-toggle sheet-checkbox-width sheet-link sheet-no-underline sheet-pictos" data-i18n-title="reset_101+_penalty" name="act_reset-penalty">1</button>
            </div>
        </div>
        <!-- Option Bar Right -->
        <div class="sheet-flex sheet-gap">
            <div><input type='checkbox' data-i18n-title="compact_mode" name='attr_compact' value="1"><span class="sheet-checkico">J</span></div>
            <!--<div class="sheet-character"><input class="sheet-checkbtn" type="hidden" name="attr_compact" value="0"><button type="action" class="sheet-checkbtn" name="act_compact" data-i18n="compact">Compact</button></div>-->
            <a class="sheet-pictos" data-i18n-title="show_help_popup" href="#help">?</a>
            <a class="sheet-pictos" data-i18n-title="show_import_popup" href="#import">~</a>
            <a class="sheet-pictos" data-i18n-title="show_configuration_popup" href="#configuration">y</a>
        </div>
    </div>

    <!-- Sheet Tabs -->
    <div class="sheet-detailed">
    <div class="sheet-character sheet-space-around sheet-gap">
        <a href="#core">Core</a>
        <a href="#skills"><span data-i18n="skills">SKills</span>/<span data-i18n="passions">Passions</span></a>
        <a href="#abilities" data-i18n="abilities">Abilities</a>
        <a class="sheet-creature" href="#weapons" data-i18n="weapons">Weapons</a>
        <a class="sheet-creature" href="#armor" data-i18n="armor">Armor</a>
        <a class="sheet-creature" href="#gear"><span data-i18n="gear">Gear</span>/<span data-i18n="wealth">Wealth</span></a>
        <a class="sheet-major" href="#character-background" data-i18n="background">Background</a></span>
        <a href="#notes" data-i18n="notes">Notes</a>
    </div>
</div>
</div>

    <!-- Sheet Types -->
    
    
<div class="sheet-character">
    <!-- TODO: re-add SE which just shows the table use odd soot for simplified list-->
<div class="sheet-detailed">
    <input class="sheet-conflict-toggle" type="hidden" name="attr_conflict_mode" value="combat">
    <!-- Character Header -->
    <div id="core" class="sheet-flex sheet-gap sheet-anchor-adjust-x2">
        <!-- Info Section -->
        <div class="sheet-section sheet-grow">
            <!-- Info 1st Row -->
            <div class="sheet-flex sheet-gap">
                <div class="sheet-grow">
                    <input type="text" class="sheet-full-width" title="@{character_name}" name="attr_character_name">
                    <label data-i18n="name">Name</label>
                </div>
                <div class="sheet-grow">
                    <div class="sheet-setting-option sheet-ms sheet-os">
                        <div class="sheet-flex">
                            <input type="text" class="sheet-grow" title="@{species}" name="attr_species">/<input type="number" class="sheet-number-width-sm" value="0">
                        </div>
                    </div>
                    <div class="sheet-setting-option sheet-default sheet-atvw sheet-cf sheet-destined sheet-fioracitta sheet-la sheet-lyonesse sheet-mi sheet-mba sheet-mb sheet-mc sheet-mr sheet-imperative sheet-perceforest sheet-thennla sheet-wu">
                        <input type="text" class="sheet-full-width" title="@{species}" name="attr_species">
                    </div>
                    <div class="sheet-text-center">
                        <span class="sheet-bold" data-i18n="species">Species</span><span class="sheet-setting-option sheet-ms sheet-os">/<span class="sheet-bold" data-i18n="strangeness">Strangeness</span></span>
                    </div>
                </div>
                <div class="sheet-grow">
                    <input type="text" class="sheet-full-width" title="@{culture}" name="attr_culture">
                    <label data-i18n="culture">Culture</label>
                </div>
                <div class="sheet-grow">
                    <input type="text" class="sheet-full-width" title="@{career}" name="attr_career">
                    <span class="sheet-setting-option sheet-not-cf"><label data-i18n="career">Career</label></span>
                    <span class="sheet-setting-option sheet-cf"><label data-i18n="class">Class</label></span>
                </div>
                <div class="sheet-setting-option sheet-cf sheet-info-rank">
                    <input type="number" class="sheet-full-width" title="@{rank}" name="attr_rank" value="0">
                    <label data-i18n="rank">Rank</label>
                </div>
            </div>
            <!-- Info 2nd Row -->
            <div class="sheet-flex sheet-gap sheet-major">
                <div class="sheet-grow">
                    <input type="text" class="sheet-full-width" title="@{homeland}" name="attr_homeland">
                    <label data-i18n="homeland">Homeland</label>
                </div>
                <div class="sheet-grow">
                    <input type="text" class="sheet-full-width" title="@{social_class}" name="attr_social_class">
                    <label data-i18n="social_class">Name</label>
                </div>
                <div class="sheet-info-age">
                    <input type="number" class="sheet-full-width" title="@{age}" name="attr_age" value="0">
                    <label data-i18n="age">Age</label>
                </div>
                <div class="sheet-info-gender">
                    <input type="text" class="sheet-full-width" title="@{gender}" name="attr_gender">
                    <label data-i18n="gender">Gender</label>
                </div>
                <div class="sheet-info-frame">
                    <input type="text" class="sheet-full-width" title="@{frame}" name="attr_frame">
                    <label data-i18n="frame">Gender</label>
                </div>
                <div class="sheet-info-height">
                    <input type="number" style="padding-right: 25px" class="sheet-full-width" title="@{height}" name="attr_height" value="178">
                    <span class="sheet-input-unit" data-i18n="centimetres-a">cm</span>
                    <label data-i18n="height-bugfix">Height</label>
                </div>
                <div class="sheet-info-weight">
                    <input type="number" style="padding-right: 20px" class="sheet-full-width" title="@{weight}" name="attr_weight" value="88">
                    <span class="sheet-input-unit" data-i18n="kilograms-a">kg</span>
                    <label data-i18n="weight">Weight</label>
                </div>
                <!-- TODO make the soot rollable ? -->
                <div class="sheet-setting-option sheet-os sheet-info-the-soot">
                    <input type="number" class="sheet-full-width" title="@{the_soot}" name="attr_the_soot" value="0">
                    <label data-i18n="the_soot">The Soot</label>
                </div>
            </div>
        </div>

        <!-- Header 2nd Column -->
        <div class="sheet-logo sheet-major">
            <!-- Logo -->
            <div>
                <img class="sheet-setting-option sheet-default sheet-atvw sheet-cf sheet-destined sheet-fioracitta sheet-la sheet-lyonesse sheet-mi sheet-mba sheet-mb sheet-mc sheet-mr sheet-imperative sheet-perceforest sheet-thennla sheet-wu" src="https://i.imgur.com/EzQDmms.png" alt="Mythras">
                <img class="sheet-setting-option sheet-ms" src="https://i.imgur.com/5uPy3QU.jpg" alt="M-Space">
                <img class="sheet-setting-option sheet-os" src="https://i.imgur.com/35dOQix.jpg" alt="Odd Soot">
            </div>
            <!-- Experience Rolls -->
            <div class="sheet-flex sheet-gap">
                <label class="sheet-left" data-i18n="experience_rolls">Experience Rolls</label>
                <input type="number" class="sheet-grow" title="@{experience_rolls}" name="attr_experience_rolls" value="0">
            </div>
        </div>
    </div>

    <!-- Core Section -->
    <div class="sheet-flex sheet-gap sheet-anchor-adjust-x2">
        <!-- Characteristics -->
        <div class="sheet-section">
            <input type="hidden" class="sheet-wide-toggle sheet-deep-toggle" name="attr_extended_conflict_enabled" value="0">
            <h2 class="sheet-anti-toggle" data-i18n="characteristics">Characteristics</h2>
            <div class="sheet-toggle sheet-space-between sheet-gap">
                <h2 class="sheet-toggle sheet-help" data-i18n-title="characteristics" data-i18n="characteristics-a">Chars</h2>
                <button type="roll" class="sheet-die sheet-d6" title="%{extended_conflict_damage}" name="roll_extended_conflict_damage" value="@{roll_display}&{template:default} {{dmgstyle=1}} {{name=^{extended_conflict_damage}}} {{character=@{character_name}}} {{^{damage}=[[1d6]]}}">f</button>
            </div>


            <div class="sheet-table">
                <div class="sheet-tr">
                    <div class="sheet-th"></div>
                    <div class="sheet-th" data-i18n="base">Base</div>
                    <div class="sheet-th" data-i18n-title="current" data-i18n="current-a">Curr</div>
                </div>

                <!-- STR -->
                <div class="sheet-tr sheet-creature">
                    <div class="sheet-td sheet-char-label"><label class="sheet-left" data-i18n="str-u">STR</label></div>
                    <div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{str_base}" name="attr_str_base" value="11"></div>
                    <div class="sheet-td sheet-anti-toggle"><input type="number" class="sheet-impval sheet-number-width" title="@{str}" name="attr_str" value="11"></div>
                    <div class="sheet-td sheet-toggle">
                        <div class="sheet-number-width sheet-flex sheet-impval">
                            <input type="number" class="sheet-lval" title="@{str_pool}" name="attr_str_pool" value="11">
                            /<input type="number" class="sheet-rval" title="@{str}" name="attr_str" value="11">
                        </div>
                    </div>
                    <input type="hidden" name="attr_str_temp" value="0">
                </div>

                <!-- CON -->
                <div class="sheet-tr sheet-creature">
                    <div class="sheet-td sheet-char-label"><label class="sheet-left" data-i18n="con-u">CON</label></div>
                    <div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{con_base}" name="attr_con_base" value="11"></div>
                    <div class="sheet-td sheet-anti-toggle"><input type="number" class="sheet-impval sheet-number-width" title="@{con}" name="attr_con" value="11"></div>
                    <div class="sheet-td sheet-toggle">
                        <div class="sheet-number-width sheet-flex sheet-impval">
                            <input type="number" class="sheet-lval" title="@{con_pool}" name="attr_con_pool" value="11">
                            /<input type="number" class="sheet-rval" title="@{con}" name="attr_con" value="11">
                        </div>
                    </div>
                    <input type="hidden" name="attr_con_temp" value="0">
                </div>

                <!-- SIZ -->
                <div class="sheet-tr sheet-creature">
                    <div class="sheet-td sheet-char-label"><label class="sheet-left" data-i18n="siz-u">SIZ</label></div>
                    <div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{siz_base}" name="attr_siz_base" value="13"></div>
                    <div class="sheet-td sheet-anti-toggle"><input type="number" class="sheet-impval sheet-number-width" title="@{siz}" name="attr_siz" value="13"></div>
                    <div class="sheet-td sheet-toggle">
                        <div class="sheet-number-width sheet-flex sheet-impval">
                            <input type="number" class="sheet-lval" title="@{siz_pool}" name="attr_siz_pool" value="13">
                            /<input type="number" class="sheet-rval" title="@{siz}" name="attr_siz" value="13">
                        </div>
                    </div>
                    <input type="hidden" name="attr_siz_temp" value="0">
                </div>

                <!-- DEX -->
                <div class="sheet-tr sheet-creature">
                    <div class="sheet-td sheet-char-label"><label class="sheet-left" data-i18n="dex-u">DEX</label></div>
                    <div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{dex_base}" name="attr_dex_base" value="11"></div>
                    <div class="sheet-td sheet-anti-toggle"><input type="number" class="sheet-impval sheet-number-width" title="@{dex}" name="attr_dex" value="11"></div>
                    <div class="sheet-td sheet-toggle">
                        <div class="sheet-number-width sheet-flex sheet-impval">
                            <input type="number" class="sheet-lval" title="@{dex_pool}" name="attr_dex_pool" value="11">
                            /<input type="number" class="sheet-rval" title="@{dex}" name="attr_dex" value="11">
                        </div>
                    </div>
                    <input type="hidden" name="attr_dex_temp" value="0">
                </div>

                <!-- INT -->
                <div class="sheet-tr">
                    <div class="sheet-td sheet-char-label"><label class="sheet-left"><span name="attr_int_type" data-i18n-dynamic>INT</span></label></div>
                    <div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{int_base}" name="attr_int_base" value="13"></div>
                    <div class="sheet-td sheet-anti-toggle"><input type="number" class="sheet-impval sheet-number-width" title="@{int}" name="attr_int" value="13"></div>
                    <div class="sheet-td sheet-toggle">
                        <div class="sheet-number-width sheet-flex sheet-impval">
                            <input type="number" class="sheet-lval" title="@{int_pool}" name="attr_int_pool" value="13">
                            /<input type="number" class="sheet-rval" title="@{int}" name="attr_int" value="13">
                        </div>
                    </div>
                    <input type="hidden" name="attr_int_temp" value="0">
                </div>

                <!-- POW -->
                <div class="sheet-tr">
                    <div class="sheet-td sheet-char-label"><label class="sheet-left" data-i18n="pow-u">POW</label></div>
                    <div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{pow_base}" name="attr_pow_base" value="11"></div>
                    <div class="sheet-td sheet-anti-toggle"><input type="number" class="sheet-impval sheet-number-width" title="@{pow}" name="attr_pow" value="11"></div>
                    <div class="sheet-td sheet-toggle">
                        <div class="sheet-number-width sheet-flex sheet-impval">
                            <input type="number" class="sheet-lval" title="@{pow_pool}" name="attr_pow_pool" value="11">
                            /<input type="number" class="sheet-rval" title="@{pow}" name="attr_pow" value="11">
                        </div>
                    </div>
                    <input type="hidden" name="attr_pow_temp" value="0">
                </div>

                <!-- CHA -->
                <div class="sheet-tr">
                    <div class="sheet-td sheet-char-label"><label class="sheet-left" data-i18n="cha-u">CHA</label></div>
                    <div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{cha_base}" name="attr_cha_base" value="11"></div>
                    <div class="sheet-td sheet-anti-toggle"><input type="number" class="sheet-impval sheet-number-width" title="@{cha}" name="attr_cha" value="11"></div>
                    <div class="sheet-td sheet-toggle">
                        <div class="sheet-number-width sheet-flex sheet-impval">
                            <input type="number" class="sheet-lval" title="@{cha_pool}" name="attr_cha_pool" value="11">
                            /<input type="number" class="sheet-rval" title="@{cha}" name="attr_cha" value="11">
                        </div>
                    </div>
                    <input type="hidden" name="attr_cha_temp" value="0">
                </div>
            </div>

            <!-- Composite Pool -->
            <div class="sheet-toggle">
                <div class="sheet-space-between">
                    <div class="sheet-td"><label class="sheet-left sheet-help" data-i18n-title="composite_pool" data-i18n="composite">Composite</label></div>
                    <div class="sheet-td">
                        <div class="sheet-number-width sheet-flex sheet-impval">
                            <input type="number" class="sheet-lval sheet-grow" name="attr_conflict_pool" value="11">/<input type="number" class="sheet-rval sheet-grow" title="@{conflict_pool|max}" name="attr_conflict_pool_max" value="11">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Attributes -->
        <input type="hidden" class="sheet-attr-toggle" name="attr_attribute_mode" value="physical">
        <div class="sheet-section">
            <input type="hidden" class="sheet-social-conflict-toggle" name="attr_social_conflict_enabled" value="0">
            <input type="hidden" class="sheet-spirits-toggle" name="attr_spirits_enabled" value="1">
            <div class="sheet-space-between">
                <h2>
                    <span data-i18n="attributes">Attributes</span>
                    (<select class="sheet-auto-width sheet-text-center" name="attr_attribute_mode">
                        <option value="physical" class="sheet-creature" data-i18n="physical" selected>Physical</option>
                        <option value="social" class="sheet-social-conflict" data-i18n="social">Social</option>
                        <option value="spiritual" class="sheet-spirits" data-i18n="spiritual">Spiritual</option>
                    </select>)
                </h2>
                <div>
                    <input type='checkbox' name='attr_attribute_configs' value="1"><span class="sheet-checkico">y</span>
                </div>
            </div>

            <input type='hidden' class="sheet-details-toggle" name='attr_attribute_configs' value="0">
            <div class="sheet-flex">
                <div class="sheet-th sheet-grow" data-i18n="attribute">Attribute</div>
                <div class="sheet-th sheet-details-toggle"><div class="sheet-number-width" data-i18n="other">Other</div></div>
                <div class="sheet-th"><div class="sheet-number-width sheet-help" data-i18n-title="base-t"><span data-i18n="base">Base</span>*</div></div>
                <div class="sheet-th"><div class="sheet-number-width" data-i18n-title="current" data-i18n="current-a">Curr</div></div>
            </div>

            <!-- TODO check attribute-order when done -->
            <div data-i18n-list="attribute-order">
                <!-- Action Points -->
                <div class="sheet-flex sheet-hl" data-i18n-list-item="action_points">
                    <div class="sheet-td sheet-grow sheet-text-left"><label class="sheet-left" data-i18n="action_points">Action Points</label></div>
                    <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-dullval sheet-number-width sheet-not-social" title="@{action_points_other}" name="attr_action_points_other" value="0"></div>
                    <div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{action_points_base}" name="attr_action_points_base" value="2" readonly></div>
                    <div class="sheet-td">
                        <div class="sheet-impval sheet-number-width sheet-flex">
                            <input type="number" class="sheet-lval" title="@{action_points}" name="attr_action_points" value="2">/<input type="number" class="sheet-rval" title="@{action_points|max}" name="attr_action_points_max" value="2">
                        </div>
                    </div>
                    <input type="hidden" name="attr_action_points_temp" value="0" readonly>
                </div>

                <!-- Confidence -->
                <div data-i18n-list-item="confidence" class="sheet-flex sheet-hl sheet-social">
                    <div class="sheet-td sheet-grow sheet-text-left"><label class="sheet-left" data-i18n="confidence">Confidence</label></div>
                    <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-dullval sheet-number-width" title="@{confidence_other}" name="attr_confidence_other" value="0"></div>
                    <div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{confidence_base}" name="attr_confidence_base" value="1" readonly></div>
                    <div class="sheet-td"><input type="number" class="sheet-impval sheet-number-width" title="@{confidence}" name="attr_confidence" value="1"></div>
                </div>

                <!-- Social Damage -->
                <div data-i18n-list-item="social_damage" class="sheet-flex sheet-hl sheet-social">
                    <div class="sheet-td sheet-grow sheet-text-left">
                        <button type="roll" class="sheet-label-left" title="%{social_damage}" name="roll_social_damage" value="@{roll_display}&{template:default} {{dmgstyle=1}} {{character=@{character_name}}} {{name=^{social_damage} (@{social_damage})}} {{^{damage}=[[@{social_damage}]]}}" data-i18n="damage">Damage</button>
                    </div>
                    <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-dullval sheet-number-width" title="@{social_damage_other}" name="attr_social_damage_other" value="0"></div>
                    <div class="sheet-td">
                        <select class="sheet-dullval sheet-number-width sheet-text-center sheet-readonly" title="@{social_damage_base}" name="attr_social_damage_base">
                            <option value="1d2">1d2</option>
                            <option value="1d4" selected>1d4</option>
                            <option value="1d6">1d6</option>
                            <option value="1d8">1d8</option>
                            <option value="1d10">1d10</option>
                            <option value="2d6">2d6</option>
                            <option value="1d8+1d6">d8+d6</option>
                            <option value="2d8">2d8</option>
                            <option value="1d10+1d8">d10+d8</option>
                            <option value="2d10">2d10</option>
                            <option value="2d10+1d2">2d10+1d2</option>
                            <option value="2d10+1d4">2d10+1d4</option>
                            <option value="2d10+1d6">2d10+1d6</option>
                            <option value="2d10+1d8">2d10+1d8</option>
                            <option value="3d10">3d10</option>
                            <option value="3d10+1d2">3d10+1d2</option>
                            <option value="3d10+1d4">3d10+1d4</option>
                        </select>
                    </div>
                    <div class="sheet-td">
                        <select class="sheet-impval sheet-number-width sheet-text-center" title="@{social_damage}" name="attr_social_damage">
                            <option value="1d2">1d2</option>
                            <option value="1d4" selected>1d4</option>
                            <option value="1d6">1d6</option>
                            <option value="1d8">1d8</option>
                            <option value="1d10">1d10</option>
                            <option value="2d6">2d6</option>
                            <option value="1d8+1d6">d8+d6</option>
                            <option value="2d8">2d8</option>
                            <option value="1d10+1d8">d10+d8</option>
                            <option value="2d10">2d10</option>
                            <option value="2d10+1d2">2d10+1d2</option>
                            <option value="2d10+1d4">2d10+1d4</option>
                            <option value="2d10+1d6">2d10+1d6</option>
                            <option value="2d10+1d8">2d10+1d8</option>
                            <option value="3d10">3d10</option>
                            <option value="3d10+1d2">3d10+1d2</option>
                            <option value="3d10+1d4">3d10+1d4</option>
                        </select>
                    </div>
                </div>

                <!-- Spirit Damage -->
                <div data-i18n-list-item="social_damage" class="sheet-flex sheet-hl sheet-spiritual">
                    <div class="sheet-td sheet-grow sheet-text-left">
                        <button type="roll" class="sheet-label-left" title="%{spirit_damage}" name="roll_spirit_damage" value="@{roll_display}&{template:default} {{dmgstyle=1}} {{character=@{character_name}}} {{name=^{spirit_damage} (@{spirit_damage})}} {{^{damage}=[[@{spirit_damage}]]}}" data-i18n="damage">Damage</button>
                    </div>
                    <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-dullval sheet-number-width" title="@{spirit_damage_other}" name="attr_spirit_damage_other" value="0"></div>
                    <div class="sheet-td">
                        <select class="sheet-dullval sheet-number-width sheet-text-center sheet-readonly" title="@{spirit_damage_base}" name="attr_spirit_damage_base">
                            <option value="1d2" selected>1d2</option>
                            <option value="1d4">1d4</option>
                            <option value="1d6">1d6</option>
                            <option value="1d8">1d8</option>
                            <option value="1d10">1d10</option>
                            <option value="2d6">2d6</option>
                            <option value="1d8+1d6">d8+d6</option>
                            <option value="2d8">2d8</option>
                            <option value="1d10+1d8">d10+d8</option>
                            <option value="2d10">2d10</option>
                            <option value="2d10+1d2">2d10+1d2</option>
                            <option value="2d10+1d4">2d10+1d4</option>
                            <option value="2d10+1d6">2d10+1d6</option>
                            <option value="2d10+1d8">2d10+1d8</option>
                            <option value="3d10">3d10</option>
                            <option value="3d10+1d2">3d10+1d2</option>
                            <option value="3d10+1d4">3d10+1d4</option>
                        </select>
                    </div>
                    <div class="sheet-td">
                        <select class="sheet-impval sheet-number-width sheet-text-center" title="@{spirit_damage}" name="attr_spirit_damage">
                            <option value="1d2" selected>1d2</option>
                            <option value="1d4">1d4</option>
                            <option value="1d6">1d6</option>
                            <option value="1d8">1d8</option>
                            <option value="1d10">1d10</option>
                            <option value="2d6">2d6</option>
                            <option value="1d8+1d6">d8+d6</option>
                            <option value="2d8">2d8</option>
                            <option value="1d10+1d8">d10+d8</option>
                            <option value="2d10">2d10</option>
                            <option value="2d10+1d2">2d10+1d2</option>
                            <option value="2d10+1d4">2d10+1d4</option>
                            <option value="2d10+1d6">2d10+1d6</option>
                            <option value="2d10+1d8">2d10+1d8</option>
                            <option value="3d10">3d10</option>
                            <option value="3d10+1d2">3d10+1d2</option>
                            <option value="3d10+1d4">3d10+1d4</option>
                        </select>
                    </div>
                </div>

                <!-- Damage Modifier -->
                <div data-i18n-list-item="damage_modifier" class="sheet-physical sheet-hl">
                    <div class="sheet-flex">
                        <div class="sheet-td sheet-grow sheet-text-left">
                            <button type="roll" class="sheet-label-left" title="%{damage_modifier}" name="roll_damage_modifier" value="@{roll_display}&{template:default} {{dmgstyle=1}} {{character=@{character_name}}} {{name=^{damage_modifier} (@{damage_mod})}} {{^{damage}=[[@{damage_mod}]]}}" data-i18n="damage_modifier-a">Damage Mod</button>
                        </div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-dullval sheet-number-width" title="@{damage_mod_other}" name="attr_damage_mod_other" value="0"></div>
                        <div class="sheet-td">
                            <select class="sheet-dullval sheet-number-width sheet-text-center sheet-readonly" title="@{damage_mod_base}" name="attr_damage_mod_base">
                                <option value="-1d8">-1d8</option>
                                <option value="-1d6">-1d6</option>
                                <option value="-1d4">-1d4</option>
                                <option value="-1d2">-1d2</option>
                                <option value="0" selected>+0</option>
                                <option value="1d2">+1d2</option>
                                <option value="1d4">+1d4</option>
                                <option value="1d6">+1d6</option>
                                <option value="1d8">+1d8</option>
                                <option value="1d10">+1d10</option>
                                <option value="1d12">+1d12</option>
                                <option value="2d6">+2d6</option>
                                <option value="1d8+1d6">+d8+d6</option>
                                <option value="2d8">+2d8</option>
                                <option value="1d10+1d8">+d10+d8</option>
                                <option value="2d10">+2d10</option>
                                <option value="2d10+1d2">+2d10+1d2</option>
                                <option value="2d10+1d4">+2d10+1d4</option>
                                <option value="2d10+1d6">+2d10+1d6</option>
                                <option value="2d10+1d8">+2d10+1d8</option>
                                <option value="3d10">+3d10</option>
                                <option value="2d10+1d12">+2d10+1d12</option>
                                <option value="2d10+2d6">+2d10+2d6</option>
                            </select>
                        </div>
                        <div class="sheet-td">
                            <select class="sheet-impval sheet-number-width sheet-text-center" title="@{damage_mod}" name="attr_damage_mod">
                                <option value="-1d8">-1d8</option>
                                <option value="-1d6">-1d6</option>
                                <option value="-1d4">-1d4</option>
                                <option value="-1d2">-1d2</option>
                                <option value="0" selected>+0</option>
                                <option value="1d2">+1d2</option>
                                <option value="1d4">+1d4</option>
                                <option value="1d6">+1d6</option>
                                <option value="1d8">+1d8</option>
                                <option value="1d10">+1d10</option>
                                <option value="1d12">+1d12</option>
                                <option value="2d6">+2d6</option>
                                <option value="1d8+1d6">+d8+d6</option>
                                <option value="2d8">+2d8</option>
                                <option value="1d10+1d8">+d10+d8</option>
                                <option value="2d10">+2d10</option>
                                <option value="2d10+1d2">+2d10+1d2</option>
                                <option value="2d10+1d4">+2d10+1d4</option>
                                <option value="2d10+1d6">+2d10+1d6</option>
                                <option value="2d10+1d8">+2d10+1d8</option>
                                <option value="3d10">+3d10</option>
                                <option value="2d10+1d12">+2d10+1d12</option>
                                <option value="2d10+2d6">+2d10+2d6</option>
                            </select>
                        </div>
                    </div>
                    <div class="sheet-details-toggle sheet-lmargin-x3">
                        <span data-i18n="use">Use</span>:
                        <select class="sheet-auto-width sheet-text-center" name="attr_damage_mod_calc">
                            <option data-i18n="str+siz" value="0" selected>STR+SIZ</option>
                            <option data-i18n="str+siz+pow" value="1">STR+SIZ+POW</option>
                            <option data-i18n="str+siz+con" value="2">STR+SIZ+CON</option>
                        </select>
                    </div>
                </div>

                <!-- Experience Modifier -->
                <div data-i18n-list-item="experience_modifier" class="sheet-hl sheet-major">
                    <div class="sheet-flex">
                        <div class="sheet-td sheet-grow sheet-text-left"><label class="sheet-left" data-i18n-title="experience_modifier" data-i18n="experience-a_modifier">Exp Modifier</label></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-dullval sheet-number-width" title="@{experience_mod_other}" name="attr_experience_mod_other" value="0"></div>
                        <div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{experience_mod_base}" name="attr_experience_mod_base" value="0" readonly></div>
                        <div class="sheet-td"><input type="number" class="sheet-impval sheet-number-width" title="@{experience_mod}" name="attr_experience_mod" value="0"></div>
                    </div>
                    <div class="sheet-details-toggle sheet-lmargin-x3">
                        <span data-i18n="use">Use</span>:
                        <select class="sheet-auto-width sheet-text-center" name="attr_experience_mod_calc">
                            <option data-i18n="cha-u" value="0" selected>CHA</option>
                            <option data-i18n="int-u" value="1">INT</option>
                        </select>
                    </div>
                </div>

                <!-- Healing Rate -->
                <div data-i18n-list-item="healing_rate" class="sheet-hl sheet-physical">
                    <div class="sheet-flex">
                        <div class="sheet-td sheet-grow sheet-text-left"><label class="sheet-left" data-i18n="healing_rate">Healing Rate</label></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-dullval sheet-number-width" title="@{healing_rate_other}" name="attr_healing_rate_other" value="0"></div>
                        <div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{healing_rate_base}" name="attr_healing_rate_base" value="2" readonly></div>
                        <div class="sheet-td"><input type="number" class="sheet-impval sheet-number-width" title="@{healing_rate}" name="attr_healing_rate" value="2"></div>
                    </div>
                    <div class="sheet-details-toggle sheet-lmargin-x3">
                        <span data-i18n="use">Use</span>:
                        <select class="sheet-auto-width sheet-text-center" name="attr_healing_rate_calc">
                            <option data-i18n="con-u" value="0" selected>CON</option>
                            <option data-i18n="con+1/2_pow" value="1">CON + 1/2 POW</option>
                        </select>
                    </div>
                    <div class="sheet-details-toggle sheet-lmargin-x3">
                        <label class="sheet-checkbox">
                            <input type='checkbox' name='attr_healing_rate_double' value="1"/><span>3</span>
                            <span data-i18n="double_base_healing_rate">Double Base healing Rate</span>
                        </label>
                    </div>
                </div>


                <!-- Initiative -->
                <div data-i18n-list-item="initiative" class="sheet-hl">
                    <div class="sheet-flex">
                        <div class="sheet-td sheet-grow sheet-text-left">
                            <button type="roll" class="sheet-label-left" title="%{initiative}" name="roll_initiative" value="@{roll_display}&{template:default} {{initstyle=1}} {{character=@{character_name}}} {{name=^{initiative}}} {{^{roll}=[[@{init_dice} + @{initiative_bonus} &{tracker}]]}}" data-i18n="initiative">Initiative</button>
                        </div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-dullval sheet-number-width" title="@{initiative_bonus_other}" name="attr_initiative_bonus_other" value="0"></div>
                        <div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{initiative_bonus_base}" name="attr_initiative_bonus_base" value="12" readonly></div>
                        <div class="sheet-td"><input type="number" class="sheet-impval sheet-number-width" title="@{initiative_bonus}" name="attr_initiative_bonus" value="12"></div>
                    </div>
                    <div class="sheet-details-toggle sheet-lmargin-x3">
                        <span data-i18n="initiative_roll">Initiative Roll</span>:
                        <input type="text" class="sheet-number-width sheet-text-center" name="attr_init_dice" value="1d10">
                    </div>
                    <div class="sheet-details-toggle sheet-lmargin-x3">
                        <label class="sheet-checkbox">
                            <input type='checkbox' name='attr_initiative_add_one_tenth_athletics' value="1"/><span>3</span>
                            <span data-i18n="add_1/10_athletics">Add 1/10 Athletics</span>
                        </label>
                    </div>
                </div>

                <!-- Luck Points -->
                <div data-i18n-list-item="luck_points" class="sheet-hl sheet-major">
                    <div class="sheet-flex">
                        <div class="sheet-td sheet-grow sheet-text-left"><label class="sheet-left" data-i18n="luck_points">Luck Points</label></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-dullval sheet-number-width" title="@{luck_points_other}" name="attr_luck_points_other" value="0"></div>
                        <div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{luck_points_base}" name="attr_luck_points_base" value="2" readonly></div>
                        <div class="sheet-td"><div class="sheet-impval sheet-number-width sheet-flex"><input type="number" class="sheet-lval" title="@{luck_points}" name="attr_luck_points" value="2">/<input type="number" class="sheet-rval" title="@{luck_points|max}" name="attr_luck_points_max" value="2"></div></div>
                        <input type="hidden" name="attr_luck_points_temp" value="0">
                    </div>
                    <div class="sheet-details-toggle sheet-lmargin-x3">
                        <span data-i18n="use">Use</span>:
                        <select class="sheet-auto-width sheet-text-center" name="attr_luck_points_calc">
                            <option data-i18n="pow-u" value="0" selected>POW</option>
                            <option data-i18n="cha+1/2_pow" value="1">CHA + 1/2 POW</option>
                        </select>
                    </div>
                </div>

                <!-- Magic Points -->
                <!-- TODO switch magic points to a setting option -->
                <input type="hidden" class="sheet-toggle" name="attr_magic_points_enabled" value="1">
                <div data-i18n-list-item="magic_points" class="sheet-flex sheet-hl sheet-toggle">
                    <div class="sheet-td sheet-grow sheet-text-left"><label class="sheet-left" data-i18n="magic_points">Magic Points</label></div>
                    <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-dullval sheet-number-width" title="@{magic_points_other}" name="attr_magic_points_other" value="0"></div>
                    <div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{magic_points_base}" name="attr_magic_points_base" value="11" readonly></div>
                    <div class="sheet-td"><div class="sheet-impval sheet-number-width sheet-flex"><input type="number" class="sheet-lval" title="@{magic_points}" name="attr_magic_points" value="11">/<input type="number" class="sheet-rval" title="@{magic_points|max}" name="attr_magic_points_max" value="11"></div></div>
                    <input type="hidden" name="magic_points_temp" value="0">
                </div>

                <!-- Movement Rate -->
                <div data-i18n-list-item="movement" class="sheet-hl sheet-physical">
                    <input type="hidden" class="sheet-wide-toggle sheet-deep-toggle" name="attr_custom_movement_enabled" value="0">
                    <div class="sheet-flex sheet-anti-toggle">
                        <div class="sheet-td sheet-grow sheet-text-left"><a class="sheet-label-left" data-i18n-title="show_movement_popup" data-i18n="movement" href="#movement-details">Movement</a></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-dullval sheet-number-width" title="@{movement_rate_other}" name="attr_movement_rate_other" value="0"></div>
                        <div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{movement_rate_base}" name="attr_movement_rate_base" value="6" readonly></div>
                        <div class="sheet-td"><input type="number" class="sheet-impval sheet-number-width" title="@{movement_rate}" name="attr_movement_rate" value="6"></div>
                    </div>
                    <!-- Custom Movement Alternative -->
                    <div class="sheet-space-between sheet-toggle">
                        <div class="sheet-td sheet-text-left"><label class="sheet-left" data-i18n="movement">Movement</label></div>
                        <div class="sheet-td sheet-custom-movement"><input type="text" class="sheet-full-width sheet-text-right" title="@{custom_movement}" name="attr_custom_movement"></div>
                    </div>
                    <div class="sheet-details-toggle sheet-lmargin-x3">
                        <select class="sheet-text-center sheet-auto-width sheet-rmargin" name="attr_custom_movement_enabled">
                            <option data-i18n="standard" value="0" selected>Standard</option>
                            <option data-i18n="custom" value="1">Custom</option>
                        </select>
                        <span class="sheet-anti-toggle">
                            <span data-i18n="species">Species</span>:
                            <input type="number" class="sheet-dullval sheet-number-width-sm" title="@{movement_rate_species}" name="attr_movement_rate_species" value="6">
                        </span>
                    </div>
                </div>

                <!-- Prana Points -->
                <input type="hidden" class="sheet-toggle" name="attr_prana_points_enabled" value="0">
                <div data-i18n-list-item="prana_points" class="sheet-flex sheet-hl sheet-toggle">
                    <div class="sheet-td sheet-grow sheet-text-left"><label class="sheet-left" data-i18n="prana_points">Prana Points</label></div>
                    <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-dullval sheet-number-width" title="@{magic_points_other}" name="attr_magic_points_other" value="0"></div>
                    <div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{magic_points_base}" name="attr_magic_points_base" value="11" readonly></div>
                    <div class="sheet-td"><div class="sheet-impval sheet-number-width sheet-flex"><input type="number" class="sheet-lval" title="@{magic_points}" name="attr_magic_points" value="11">/<input type="number" class="sheet-rval" title="@{magic_points|max}" name="attr_magic_points_max" value="11"></div></div>
                    <input type="hidden" name="magic_points_temp" value="0">
                </div>

                <!-- Power Points -->
                <input type="hidden" class="sheet-toggle" name="attr_power_points_enabled" value="0">
                <div data-i18n-list-item="power_points" class="sheet-flex sheet-hl sheet-toggle">
                    <div class="sheet-td sheet-grow sheet-text-left"><label class="sheet-left" data-i18n="power_points">Power Points</label></div>
                    <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-dullval sheet-number-width" title="@{magic_points_other}" name="attr_magic_points_other" value="0"></div>
                    <div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{magic_points_base}" name="attr_magic_points_base" value="11" readonly></div>
                    <div class="sheet-td"><div class="sheet-impval sheet-number-width sheet-flex"><input type="number" class="sheet-lval" title="@{magic_points}" name="attr_magic_points" value="11">/<input type="number" class="sheet-rval" title="@{magic_points|max}" name="attr_magic_points_max" value="11"></div></div>
                    <input type="hidden" name="magic_points_temp" value="0">
                </div>

                <!-- Spirit intensity -->
                <div data-i18n-list-item="spirit_intensity" class="sheet-flex sheet-hl sheet-spirit">
                    <div class="sheet-td sheet-grow sheet-text-left"><label class="sheet-left" data-i18n="spirit_intensity">Spirit Intensity</label></div>
                    <div class="sheet-td sheet-details-toggle"></div>
                    <div class="sheet-td"></div>
                    <div class="sheet-td"><input type="number" class="sheet-impval sheet-number-width" title="@{confidence}" name="attr_spirit_intensity" value="1" readonly></div>
                </div>

                <!-- Tenacity -->
                <input type="hidden" class="sheet-toggle" name="attr_tenacity_enabled" value="0">
                <div data-i18n-list-item="tenacity" class="sheet-hl sheet-toggle">
                    <div class="sheet-flex">
                        <div class="sheet-td sheet-grow sheet-text-left"><label class="sheet-left" data-i18n="tenacity">Tenacity</label></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-dullval sheet-number-width" title="@{tenacity_other}" name="attr_tenacity_other" value="0"></div>
                        <div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{tenacity_base}" name="attr_tenacity_base" value="11" readonly></div>
                        <div class="sheet-td"><div class="sheet-impval sheet-number-width sheet-flex"><input type="number" class="sheet-lval" title="@{tenacity}" name="attr_tenacity" value="11">/<input type="number" class="sheet-rval" title="@{tenacity|max}" name="attr_tenacity_max" value="11"></div></div>
                        <input type="hidden" name="attr_tenacity_temp" value="0">
                    </div>
                    <div class="sheet-details-toggle sheet-lmargin-x3">
                        <input type="hidden" class="sheet-toggle" name="attr_dependencies_enabled" value="0">
                        <label class="sheet-checkbox sheet-toggle">
                            <input type='checkbox' name='attr_apply_dependencies_penalty' value="1" checked/><span>3</span>
                            <span data-i18n="apply_dependencies_penalty">Apply Dependencies Penalty</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hit Locations -->
        <div class="sheet-not-social sheet-bpad">
            <input type="hidden" class="sheet-hit-locations-spirit" name="attr_type" value="pc">
            <div class="sheet-section sheet-hit-locations-toggle sheet-full-height">
                <div class="sheet-space-between sheet-gap">
                    <h2 data-i18n="hit_locations">Hit Locations</h2>
                    <div class="sheet-flex sheet-gap">
                        <input type="hidden" class="sheet-toggle" name="attr_simplified_combat_enabled" value="0">
                        <select class="sheet-auto-width sheet-text-center sheet-anti-toggle" title="@{hit_locations}" name="attr_hit_locations" data-i18n-list="hit-location-order">
                            <option value="custom1" data-i18n="custom_1_location" data-i18n-list-item="custom_1_location">Custom(1 Location)</option>
                            <option value="custom7" data-i18n="custom_7_locations" data-i18n-list-item="custom_7_locations" selected >Custom(7 Locations)</option>
                            <option value="custom8" data-i18n="custom_8_locations" data-i18n-list-item="custom_8_locations">Custom(8 Locations)</option>
                            <option value="custom9" data-i18n="custom_9_locations" data-i18n-list-item="custom_9_locations">Custom(9 Locations)</option>
                            <option value="custom10" data-i18n="custom_10_locations" data-i18n-list-item="custom_10_locations">Custom(10 Locations)</option>
                            <option value="custom11" data-i18n="custom_11_locations" data-i18n-list-item="custom_11_locations">Custom(11 Locations)</option>
                            <option value="custom" data-i18n="custom_12_locations" data-i18n-list-item="custom_12_locations">Custom(12 Locations)</option>
                            <option value="rabble" data-i18n="rabble/underling" data-i18n-list-item="rabble">Rabble/Underling</option>
                            <option value="simplified" data-i18n="simplified-combat" hidden>Simplified Combat</option>
                            <option data-i18n-list-item="spacer" disabled></option>
                            <option value="arachnid" data-i18n="arachnid" data-i18n-list-item="arachnid">Arachnid</option>
                            <option value="humanoid" data-i18n="biped" data-i18n-list-item="biped">Biped</option>
                            <option value="centaurid" data-i18n="centaurid" data-i18n-list-item="centaurid">Centaurid</option>
                            <option value="decapoda" data-i18n="decapoda" data-i18n-list-item="decapoda">Decapoda</option>
                            <option value="decapodiform" data-i18n="decapodiform" data-i18n-list-item="decapodiform">Decapodiform</option>
                            <option value="dorsal_finned_aquatic" data-i18n="dorsal_finned_aquatic" data-i18n-list-item="dorsal_finned_aquatic">Dorsal Finned Aquatic</option>
                            <option value="draconic" data-i18n="draconic" data-i18n-list-item="draconic">Draconic</option>
                            <option value="insect" data-i18n="insect" data-i18n-list-item="insect">Insect</option>
                            <option value="octopodiform" data-i18n="octopodiform" data-i18n-list-item="octopodiform">Octopodiform</option>
                            <option value="pachyderm" data-i18n="pachyderm" data-i18n-list-item="pachyderm">Pachyderm</option>
                            <option value="quadruped" data-i18n="quadruped" data-i18n-list-item="quadruped">Quadruped</option>
                            <option value="serpentine" data-i18n="serpentine" data-i18n-list-item="serpentine">Serpentine</option>
                            <option value="tailed_arachnid" data-i18n="tailed_arachnid" data-i18n-list-item="tailed_arachnid">Tailed Arachnid</option>
                            <option value="tailed_biped" data-i18n="tailed_biped" data-i18n-list-item="tailed_biped">Tailed Biped</option>
                            <option value="tailed_quadruped" data-i18n="tailed_quadruped" data-i18n-list-item="tailed_quadruped">Tailed Quadruped</option>
                            <option value="winged_biped" data-i18n="winged_biped" data-i18n-list-item="winged_biped">Winged Biped</option>
                            <option value="winged_insect" data-i18n="winged_insect" data-i18n-list-item="winged_insect">Winged Insect</option>
                            <option value="winged_quadruped" data-i18n="winged_quadruped" data-i18n-list-item="winged_quadruped">Winged Quadruped</option>
                        </select>
                        <div>
                            <input type='checkbox' name='attr_hit_locations_configs' value="1"><span class="sheet-checkico">y</span>
                        </div>
                    </div>
                </div>

                <input type="hidden" class="sheet-details-toggle" name="attr_hit_locations_configs" value="0">
                <div class="sheet-details-toggle">
                    <label class="sheet-left" data-i18n="calculate_with">Calculate With</label>
                    <select class="sheet-auto-width sheet-text-center" name="attr_hp_calc">
                        <option data-i18n="con+siz" value="0" selected>CON+SIZ</option>
                        <option data-i18n="con+siz+pow" value="1">CON+SIZ+POW</option>
                        <option data-i18n="con+siz+str" value="2">CON+SIZ+STR</option>
                    </select>
                </div>

                <div class="sheet-table">
                    <div class="sheet-tr">
                        <!-- TODO setup the hit location button with sheet type switching -->
                        <div class="sheet-th"><button type="roll" class="sheet-link" title="%{hit_location}" name="roll_hit_location" value="@{roll_display}&{template:hit-location} {{name=^{hit_location} (d20)}} {{character=@{character_name}}} {{roll=[[1d20]]}} {{loc1_name=@{location1_name}}} {{loc1_start=[[@{location1_table_start}]]}} {{loc1_end=[[@{location1_table_end}]]}} {{loc1_block=@{location1_block}}} {{loc1_ap=@{location1_ap}}} {{loc1_hp=@{location1_hp}}} {{loc1_hp_max=@{location1_hp|max}}} {{loc2_name=@{location2_name}}} {{loc2_start=[[@{location2_table_start}]]}} {{loc2_end=[[@{location2_table_end}]]}} {{loc2_block=@{location2_block}}} {{loc2_ap=@{location2_ap}}} {{loc2_hp=@{location2_hp}}} {{loc2_hp_max=@{location2_hp|max}}} {{loc3_name=@{location3_name}}} {{loc3_start=[[@{location3_table_start}]]}} {{loc3_end=[[@{location3_table_end}]]}} {{loc3_block=@{location3_block}}} {{loc3_ap=@{location3_ap}}} {{loc3_hp=@{location3_hp}}} {{loc3_hp_max=@{location3_hp|max}}} {{loc4_name=@{location4_name}}} {{loc4_start=[[@{location4_table_start}]]}} {{loc4_end=[[@{location4_table_end}]]}} {{loc4_block=@{location4_block}}} {{loc4_ap=@{location4_ap}}} {{loc4_hp=@{location4_hp}}} {{loc4_hp_max=@{location4_hp|max}}} {{loc5_name=@{location5_name}}} {{loc5_start=[[@{location5_table_start}]]}} {{loc5_end=[[@{location5_table_end}]]}} {{loc5_block=@{location5_block}}} {{loc5_ap=@{location5_ap}}} {{loc5_hp=@{location5_hp}}} {{loc5_hp_max=@{location5_hp|max}}} {{loc6_name=@{location6_name}}} {{loc6_start=[[@{location6_table_start}]]}} {{loc6_end=[[@{location6_table_end}]]}} {{loc6_block=@{location6_block}}} {{loc6_ap=@{location6_ap}}} {{loc6_hp=@{location6_hp}}} {{loc6_hp_max=@{location6_hp|max}}} {{loc7_name=@{location7_name}}} {{loc7_start=[[@{location7_table_start}]]}} {{loc7_end=[[@{location7_table_end}]]}} {{loc7_block=@{location7_block}}} {{loc7_ap=@{location7_ap}}} {{loc7_hp=@{location7_hp}}} {{loc7_hp_max=@{location7_hp|max}}} {{loc8_name=@{location8_name}}} {{loc8_start=[[@{location8_table_start}]]}} {{loc8_end=[[@{location8_table_end}]]}} {{loc8_block=@{location8_block}}} {{loc8_ap=@{location8_ap}}} {{loc8_hp=@{location8_hp}}} {{loc8_hp_max=@{location8_hp|max}}} {{loc9_name=@{location9_name}}} {{loc9_start=[[@{location9_table_start}]]}} {{loc9_end=[[@{location9_table_end}]]}} {{loc9_block=@{location9_block}}} {{loc9_ap=@{location9_ap}}} {{loc9_hp=@{location9_hp}}} {{loc9_hp_max=@{location9_hp|max}}} {{loc10_name=@{location10_name}}} {{loc10_start=[[@{location10_table_start}]]}} {{loc10_end=[[@{location10_table_end}]]}} {{loc10_block=@{location10_block}}} {{loc10_ap=@{location10_ap}}} {{loc10_hp=@{location10_hp}}} {{loc10_hp_max=@{location10_hp|max}}} {{loc11_name=@{location11_name}}} {{loc11_start=[[@{location11_table_start}]]}} {{loc11_end=[[@{location11_table_end}]]}} {{loc11_block=@{location11_block}}} {{loc11_ap=@{location11_ap}}} {{loc11_hp=@{location11_hp}}} {{loc11_hp_max=@{location11_hp|max}}} {{loc12_name=@{location12_name}}} {{loc12_start=[[@{location12_table_start}]]}} {{loc12_end=[[@{location12_table_end}]]}} {{loc12_block=@{location12_block}}} {{loc12_ap=@{location12_ap}}} {{loc12_hp=@{location12_hp}}} {{loc12_hp_max=@{location12_hp|max}}}">d20</button></div>
                        <div class="sheet-th" data-i18n="hit_location">Hit Location</div>
                        <div hidden>
                            <button type="roll" name="roll_hit_location_low" value="@{roll_display}&{template:hit-location} {{name=^{hit_location} (d10)}} {{character=@{character_name}}} {{roll=[[1d10]]}} {{loc1_name=@{location1_name}}} {{loc1_start=[[@{location1_table_start}]]}} {{loc1_end=[[@{location1_table_end}]]}} {{loc1_block=@{location1_block}}} {{loc1_ap=@{location1_ap}}} {{loc1_hp=@{location1_hp}}} {{loc1_hp_max=@{location1_hp|max}}} {{loc2_name=@{location2_name}}} {{loc2_start=[[@{location2_table_start}]]}} {{loc2_end=[[@{location2_table_end}]]}} {{loc2_block=@{location2_block}}} {{loc2_ap=@{location2_ap}}} {{loc2_hp=@{location2_hp}}} {{loc2_hp_max=@{location2_hp|max}}} {{loc3_name=@{location3_name}}} {{loc3_start=[[@{location3_table_start}]]}} {{loc3_end=[[@{location3_table_end}]]}} {{loc3_block=@{location3_block}}} {{loc3_ap=@{location3_ap}}} {{loc3_hp=@{location3_hp}}} {{loc3_hp_max=@{location3_hp|max}}} {{loc4_name=@{location4_name}}} {{loc4_start=[[@{location4_table_start}]]}} {{loc4_end=[[@{location4_table_end}]]}} {{loc4_block=@{location4_block}}} {{loc4_ap=@{location4_ap}}} {{loc4_hp=@{location4_hp}}} {{loc4_hp_max=@{location4_hp|max}}} {{loc5_name=@{location5_name}}} {{loc5_start=[[@{location5_table_start}]]}} {{loc5_end=[[@{location5_table_end}]]}} {{loc5_block=@{location5_block}}} {{loc5_ap=@{location5_ap}}} {{loc5_hp=@{location5_hp}}} {{loc5_hp_max=@{location5_hp|max}}} {{loc6_name=@{location6_name}}} {{loc6_start=[[@{location6_table_start}]]}} {{loc6_end=[[@{location6_table_end}]]}} {{loc6_block=@{location6_block}}} {{loc6_ap=@{location6_ap}}} {{loc6_hp=@{location6_hp}}} {{loc6_hp_max=@{location6_hp|max}}} {{loc7_name=@{location7_name}}} {{loc7_start=[[@{location7_table_start}]]}} {{loc7_end=[[@{location7_table_end}]]}} {{loc7_block=@{location7_block}}} {{loc7_ap=@{location7_ap}}} {{loc7_hp=@{location7_hp}}} {{loc7_hp_max=@{location7_hp|max}}} {{loc8_name=@{location8_name}}} {{loc8_start=[[@{location8_table_start}]]}} {{loc8_end=[[@{location8_table_end}]]}} {{loc8_block=@{location8_block}}} {{loc8_ap=@{location8_ap}}} {{loc8_hp=@{location8_hp}}} {{loc8_hp_max=@{location8_hp|max}}} {{loc9_name=@{location9_name}}} {{loc9_start=[[@{location9_table_start}]]}} {{loc9_end=[[@{location9_table_end}]]}} {{loc9_block=@{location9_block}}} {{loc9_ap=@{location9_ap}}} {{loc9_hp=@{location9_hp}}} {{loc9_hp_max=@{location9_hp|max}}} {{loc10_name=@{location10_name}}} {{loc10_start=[[@{location10_table_start}]]}} {{loc10_end=[[@{location10_table_end}]]}} {{loc10_block=@{location10_block}}} {{loc10_ap=@{location10_ap}}} {{loc10_hp=@{location10_hp}}} {{loc10_hp_max=@{location10_hp|max}}} {{loc11_name=@{location11_name}}} {{loc11_start=[[@{location11_table_start}]]}} {{loc11_end=[[@{location11_table_end}]]}} {{loc11_block=@{location11_block}}} {{loc11_ap=@{location11_ap}}} {{loc11_hp=@{location11_hp}}} {{loc11_hp_max=@{location11_hp|max}}} {{loc12_name=@{location12_name}}} {{loc12_start=[[@{location12_table_start}]]}} {{loc12_end=[[@{location12_table_end}]]}} {{loc12_block=@{location12_block}}} {{loc12_ap=@{location12_ap}}} {{loc12_hp=@{location12_hp}}} {{loc12_hp_max=@{location12_hp|max}}}"></button>
                            <button type="roll" name="roll_hit_location_high" value="@{roll_display}&{template:hit-location} {{name=^{hit_location} (d10+10)}} {{character=@{character_name}}} {{roll=[[1d10+10]]}} {{loc1_name=@{location1_name}}} {{loc1_start=[[@{location1_table_start}]]}} {{loc1_end=[[@{location1_table_end}]]}} {{loc1_block=@{location1_block}}} {{loc1_ap=@{location1_ap}}} {{loc1_hp=@{location1_hp}}} {{loc1_hp_max=@{location1_hp|max}}} {{loc2_name=@{location2_name}}} {{loc2_start=[[@{location2_table_start}]]}} {{loc2_end=[[@{location2_table_end}]]}} {{loc2_block=@{location2_block}}} {{loc2_ap=@{location2_ap}}} {{loc2_hp=@{location2_hp}}} {{loc2_hp_max=@{location2_hp|max}}} {{loc3_name=@{location3_name}}} {{loc3_start=[[@{location3_table_start}]]}} {{loc3_end=[[@{location3_table_end}]]}} {{loc3_block=@{location3_block}}} {{loc3_ap=@{location3_ap}}} {{loc3_hp=@{location3_hp}}} {{loc3_hp_max=@{location3_hp|max}}} {{loc4_name=@{location4_name}}} {{loc4_start=[[@{location4_table_start}]]}} {{loc4_end=[[@{location4_table_end}]]}} {{loc4_block=@{location4_block}}} {{loc4_ap=@{location4_ap}}} {{loc4_hp=@{location4_hp}}} {{loc4_hp_max=@{location4_hp|max}}} {{loc5_name=@{location5_name}}} {{loc5_start=[[@{location5_table_start}]]}} {{loc5_end=[[@{location5_table_end}]]}} {{loc5_block=@{location5_block}}} {{loc5_ap=@{location5_ap}}} {{loc5_hp=@{location5_hp}}} {{loc5_hp_max=@{location5_hp|max}}} {{loc6_name=@{location6_name}}} {{loc6_start=[[@{location6_table_start}]]}} {{loc6_end=[[@{location6_table_end}]]}} {{loc6_block=@{location6_block}}} {{loc6_ap=@{location6_ap}}} {{loc6_hp=@{location6_hp}}} {{loc6_hp_max=@{location6_hp|max}}} {{loc7_name=@{location7_name}}} {{loc7_start=[[@{location7_table_start}]]}} {{loc7_end=[[@{location7_table_end}]]}} {{loc7_block=@{location7_block}}} {{loc7_ap=@{location7_ap}}} {{loc7_hp=@{location7_hp}}} {{loc7_hp_max=@{location7_hp|max}}} {{loc8_name=@{location8_name}}} {{loc8_start=[[@{location8_table_start}]]}} {{loc8_end=[[@{location8_table_end}]]}} {{loc8_block=@{location8_block}}} {{loc8_ap=@{location8_ap}}} {{loc8_hp=@{location8_hp}}} {{loc8_hp_max=@{location8_hp|max}}} {{loc9_name=@{location9_name}}} {{loc9_start=[[@{location9_table_start}]]}} {{loc9_end=[[@{location9_table_end}]]}} {{loc9_block=@{location9_block}}} {{loc9_ap=@{location9_ap}}} {{loc9_hp=@{location9_hp}}} {{loc9_hp_max=@{location9_hp|max}}} {{loc10_name=@{location10_name}}} {{loc10_start=[[@{location10_table_start}]]}} {{loc10_end=[[@{location10_table_end}]]}} {{loc10_block=@{location10_block}}} {{loc10_ap=@{location10_ap}}} {{loc10_hp=@{location10_hp}}} {{loc10_hp_max=@{location10_hp|max}}} {{loc11_name=@{location11_name}}} {{loc11_start=[[@{location11_table_start}]]}} {{loc11_end=[[@{location11_table_end}]]}} {{loc11_block=@{location11_block}}} {{loc11_ap=@{location11_ap}}} {{loc11_hp=@{location11_hp}}} {{loc11_hp_max=@{location11_hp|max}}} {{loc12_name=@{location12_name}}} {{loc12_start=[[@{location12_table_start}]]}} {{loc12_end=[[@{location12_table_end}]]}} {{loc12_block=@{location12_block}}} {{loc12_ap=@{location12_ap}}} {{loc12_hp=@{location12_hp}}} {{loc12_hp_max=@{location12_hp|max}}}"></button>
                        </div>
                        <div class="sheet-th sheet-help sheet-pictos-three" data-i18n-title="passive_block_size">b</div>
                        <div class="sheet-th sheet-help" data-i18n-title="armor_points" data-i18n="armor_points-a">AP</div>
                        <div class="sheet-th sheet-details-toggle sheet-help" data-i18n-title="modifier" data-i18n="modifier-a">Mod</div>
                        <div class="sheet-th sheet-details-toggle sheet-help" data-i18n-title="other" data-i18n="other-a">Oth</div>
                        <div class="sheet-th sheet-help" data-i18n-title="hit_points" data-i18n="hit_points-a">HP</div>
                    </div>
                    <div class="sheet-tr">
                        <div class="sheet-td"><input type="number" class="sheet-number-width-xs" title="@{location1_table_start}" name="attr_location1_table_start" value="1">-<input type="number" class="sheet-number-width-xs" title="@{location1_table_end}" name="attr_location1_table_end" value="3"></div>
                        <div class="sheet-td"><input type="text" class="sheet-location-name sheet-text-center" title="@{location1_name}" name="attr_location1_name" value="Right Leg"></div>
                        <div class="sheet-td"><input type="text" class="sheet-number-width-xs" title="@{location1_block}" name="attr_location1_block" value=""></div>
                        <div class="sheet-td"><input type="number" class="sheet-number-width-sm sheet-impval" title="@{location1_ap}" name="attr_location1_ap" step="1" min="0" value="0"></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width-sm sheet-dullval" title="@{location1_hp_max_base_mod}" name="attr_location1_hp_max_base_mod" value="0"></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width-sm sheet-dullval" title="@{location1_hp_max_other}" name="attr_location1_hp_max_other" value="0"></div>
                        <div class="sheet-td"><div class="sheet-impval sheet-number-width sheet-flex"><input type="number" class="sheet-lval" title="@{location1_hp}" name="attr_location1_hp" value="5">/<input type="number" class="sheet-rval" title="@{location1_hp|max}" name="attr_location1_hp_max" value="5" readonly></div></div>
                    </div>
                    <input type="hidden" class="sheet-toggle" name="attr_location2to7_display" value="1">
                    <div class="sheet-tr sheet-toggle">
                        <div class="sheet-td"><input type="number" class="sheet-number-width-xs" title="@{location2_table_start}" name="attr_location2_table_start" value="4">-<input type="number" class="sheet-number-width-xs" title="@{location2_table_end}" name="attr_location2_table_end" value="6"></div>
                        <div class="sheet-td"><input type="text" class="sheet-location-name sheet-text-center" title="@{location2_name}" name="attr_location2_name" value="Left Leg"></div>
                        <div class="sheet-td"><input type="text" class="sheet-number-width-xs" title="@{location2_block}" name="attr_location2_block" value=""></div>
                        <div class="sheet-td"><input type="number" class="sheet-number-width-sm sheet-impval" title="@{location2_ap}" name="attr_location2_ap" step="1" min="0" value="0"></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width-sm sheet-dullval" title="@{location2_hp_max_base_mod}" name="attr_location1_hp_max_base_mod" value="0"></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width-sm sheet-dullval" title="@{location2_hp_max_other}" name="attr_location1_hp_max_other" value="0"></div>
                        <div class="sheet-td"><div class="sheet-impval sheet-number-width sheet-flex"><input type="number" class="sheet-lval" title="@{location2_hp}" name="attr_location2_hp" value="5">/<input type="number" class="sheet-rval" title="@{location2_hp|max}" name="attr_location2_hp_max" value="5" readonly></div></div>
                    </div>
                    <input type="hidden" class="sheet-toggle" name="attr_location2to7_display" value="1">
                    <div class="sheet-tr sheet-toggle">
                        <div class="sheet-td"><input type="number" class="sheet-number-width-xs" title="@{location3_table_start}" name="attr_location3_table_start" value="7">-<input type="number" class="sheet-number-width-xs" title="@{location3_table_end}" name="attr_location3_table_end" value="9"></div>
                        <div class="sheet-td"><input type="text" class="sheet-location-name sheet-text-center" title="@{location3_name}" name="attr_location3_name" value="Abdomen"></div>
                        <div class="sheet-td"><input type="text" class="sheet-number-width-xs" title="@{location3_block}" name="attr_location3_block" value=""></div>
                        <div class="sheet-td"><input type="number" class="sheet-number-width-sm sheet-impval" title="@{location3_ap}" name="attr_location3_ap" step="1" min="0" value="0"></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width-sm sheet-dullval" title="@{location3_hp_max_base_mod}" name="attr_location1_hp_max_base_mod" value="1"></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width-sm sheet-dullval" title="@{location3_hp_max_other}" name="attr_location1_hp_max_other" value="0"></div>
                        <div class="sheet-td"><div class="sheet-impval sheet-number-width sheet-flex"><input type="number" class="sheet-lval" title="@{location3_hp}" name="attr_location3_hp" value="6">/<input type="number" class="sheet-rval" title="@{location3_hp|max}" name="attr_location3_hp_max" value="6" readonly></div></div>
                    </div>
                    <input type="hidden" class="sheet-toggle" name="attr_location2to7_display" value="1">
                    <div class="sheet-tr sheet-toggle">
                        <div class="sheet-td"><input type="number" class="sheet-number-width-xs" title="@{location4_table_start}" name="attr_location4_table_start" value="10">-<input type="number" class="sheet-number-width-xs" title="@{location4_table_end}" name="attr_location4_table_end" value="12"></div>
                        <div class="sheet-td"><input type="text" class="sheet-location-name sheet-text-center" title="@{location4_name}" name="attr_location4_name" value="Chest"></div>
                        <div class="sheet-td"><input type="text" class="sheet-number-width-xs" title="@{location4_block}" name="attr_location4_block" value=""></div>
                        <div class="sheet-td"><input type="number" class="sheet-number-width-sm sheet-impval" title="@{location4_ap}" name="attr_location4_ap" step="1" min="0" value="0"></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width-sm sheet-dullval" title="@{location4_hp_max_base_mod}" name="attr_location1_hp_max_base_mod" value="2"></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width-sm sheet-dullval" title="@{location4_hp_max_other}" name="attr_location1_hp_max_other" value="0"></div>
                        <div class="sheet-td"><div class="sheet-impval sheet-number-width sheet-flex"><input type="number" class="sheet-lval" title="@{location4_hp}" name="attr_location4_hp" value="7">/<input type="number" class="sheet-rval" title="@{location4_hp|max}" name="attr_location4_hp_max" value="7" readonly></div></div>
                    </div>
                    <input type="hidden" class="sheet-toggle" name="attr_location2to7_display" value="1">
                    <div class="sheet-tr sheet-toggle">
                        <div class="sheet-td"><input type="number" class="sheet-number-width-xs" title="@{location5_table_start}" name="attr_location5_table_start" value="13">-<input type="number" class="sheet-number-width-xs" title="@{location5_table_end}" name="attr_location5_table_end" value="15"></div>
                        <div class="sheet-td"><input type="text" class="sheet-location-name sheet-text-center" title="@{location5_name}" name="attr_location5_name" value="Right Arm"></div>
                        <div class="sheet-td"><input type="text" class="sheet-number-width-xs" title="@{location5_block}" name="attr_location5_block" value=""></div>
                        <div class="sheet-td"><input type="number" class="sheet-number-width-sm sheet-impval" title="@{location5_ap}" name="attr_location5_ap" step="1" min="0" value="0"></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width-sm sheet-dullval" title="@{location5_hp_max_base_mod}" name="attr_location1_hp_max_base_mod" value="-1"></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width-sm sheet-dullval" title="@{location5_hp_max_other}" name="attr_location1_hp_max_other" value="0"></div>
                        <div class="sheet-td"><div class="sheet-impval sheet-number-width sheet-flex"><input type="number" class="sheet-lval" title="@{location5_hp}" name="attr_location5_hp" value="4">/<input type="number" class="sheet-rval" title="@{location5_hp|max}" name="attr_location5_hp_max" value="4" readonly></div></div>
                    </div>
                    <input type="hidden" class="sheet-toggle" name="attr_location2to7_display" value="1">
                    <div class="sheet-tr sheet-toggle">
                        <div class="sheet-td"><input type="number" class="sheet-number-width-xs" title="@{location6_table_start}" name="attr_location6_table_start" value="16">-<input type="number" class="sheet-number-width-xs" title="@{location6_table_end}" name="attr_location6_table_end" value="18"></div>
                        <div class="sheet-td"><input type="text" class="sheet-location-name sheet-text-center" title="@{location6_name}" name="attr_location6_name" value="Left Arm"></div>
                        <div class="sheet-td"><input type="text" class="sheet-number-width-xs" title="@{location6_block}" name="attr_location6_block" value=""></div>
                        <div class="sheet-td"><input type="number" class="sheet-number-width-sm sheet-impval" title="@{location6_ap}" name="attr_location6_ap" step="1" min="0" value="0"></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width-sm sheet-dullval" title="@{location6_hp_max_base_mod}" name="attr_location1_hp_max_base_mod" value="-1"></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width-sm sheet-dullval" title="@{location6_hp_max_other}" name="attr_location1_hp_max_other" value="0"></div>
                        <div class="sheet-td"><div class="sheet-impval sheet-number-width sheet-flex"><input type="number" class="sheet-lval" title="@{location6_hp}" name="attr_location6_hp" value="4">/<input type="number" class="sheet-rval" title="@{location6_hp|max}" name="attr_location6_hp_max" value="4" readonly></div></div>
                    </div>
                    <input type="hidden" class="sheet-toggle" name="attr_location2to7_display" value="1">
                    <div class="sheet-tr sheet-toggle">
                        <div class="sheet-td"><input type="number" class="sheet-number-width-xs" title="@{location7_table_start}" name="attr_location7_table_start" value="19">-<input type="number" class="sheet-number-width-xs" title="@{location7_table_end}" name="attr_location7_table_end" value="20"></div>
                        <div class="sheet-td"><input type="text" class="sheet-location-name sheet-text-center" title="@{location7_name}" name="attr_location7_name" value="Head"></div>
                        <div class="sheet-td"><input type="text" class="sheet-number-width-xs" title="@{location7_block}" name="attr_location7_block" value=""></div>
                        <div class="sheet-td"><input type="number" class="sheet-number-width-sm sheet-impval" title="@{location7_ap}" name="attr_location7_ap" step="1" min="0" value="0"></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width-sm sheet-dullval" title="@{location7_hp_max_base_mod}" name="attr_location1_hp_max_base_mod" value="0"></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width-sm sheet-dullval" title="@{location7_hp_max_other}" name="attr_location1_hp_max_other" value="0"></div>
                        <div class="sheet-td"><div class="sheet-impval sheet-number-width sheet-flex"><input type="number" class="sheet-lval" title="@{location7_hp}" name="attr_location7_hp" value="5">/<input type="number" class="sheet-rval" title="@{location7_hp|max}" name="attr_location7_hp_max" value="5" readonly></div></div>
                    </div>
                    <input type="hidden" class="sheet-toggle" name="attr_location8_display" value="0">
                    <div class="sheet-tr sheet-toggle">
                        <div class="sheet-td"><input type="number" class="sheet-number-width-xs" title="@{location8_table_start}" name="attr_location8_table_start" value="0">-<input type="number" class="sheet-number-width-xs" title="@{location8_table_end}" name="attr_location8_table_end" value="0"></div>
                        <div class="sheet-td"><input type="text" class="sheet-location-name sheet-text-center" title="@{location8_name}" name="attr_location8_name" value=""></div>
                        <div class="sheet-td"><input type="text" class="sheet-number-width-xs" title="@{location8_block}" name="attr_location8_block" value=""></div>
                        <div class="sheet-td"><input type="number" class="sheet-number-width-sm sheet-impval" title="@{location8_ap}" name="attr_location8_ap" step="1" min="0" value="0"></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width-sm sheet-dullval" title="@{location8_hp_max_base_mod}" name="attr_location1_hp_max_base_mod" value="0"></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width-sm sheet-dullval" title="@{location8_hp_max_other}" name="attr_location1_hp_max_other" value="0"></div>
                        <div class="sheet-td"><div class="sheet-impval sheet-number-width sheet-flex"><input type="number" class="sheet-lval" title="@{location8_hp}" name="attr_location8_hp" value="5">/<input type="number" class="sheet-rval" title="@{location8_hp|max}" name="attr_location8_hp_max" value="5" readonly></div></div>
                    </div>
                    <input type="hidden" class="sheet-toggle" name="attr_location9_display" value="0">
                    <div class="sheet-tr sheet-toggle">
                        <div class="sheet-td"><input type="number" class="sheet-number-width-xs" title="@{location9_table_start}" name="attr_location9_table_start" value="0">-<input type="number" class="sheet-number-width-xs" title="@{location9_table_end}" name="attr_location9_table_end" value="0"></div>
                        <div class="sheet-td"><input type="text" class="sheet-location-name sheet-text-center" title="@{location9_name}" name="attr_location9_name" value=""></div>
                        <div class="sheet-td"><input type="text" class="sheet-number-width-xs" title="@{location9_block}" name="attr_location9_block" value=""></div>
                        <div class="sheet-td"><input type="number" class="sheet-number-width-sm sheet-impval" title="@{location9_ap}" name="attr_location9_ap" step="1" min="0" value="0"></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width-sm sheet-dullval" title="@{location9_hp_max_base_mod}" name="attr_location1_hp_max_base_mod" value="0"></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width-sm sheet-dullval" title="@{location9_hp_max_other}" name="attr_location1_hp_max_other" value="0"></div>
                        <div class="sheet-td"><div class="sheet-impval sheet-number-width sheet-flex"><input type="number" class="sheet-lval" title="@{location9_hp}" name="attr_location9_hp" value="5">/<input type="number" class="sheet-rval" title="@{location9_hp|max}" name="attr_location9_hp_max" value="5" readonly></div></div>
                    </div>
                    <input type="hidden" class="sheet-toggle" name="attr_location10_display" value="0">
                    <div class="sheet-tr sheet-toggle">
                        <div class="sheet-td"><input type="number" class="sheet-number-width-xs" title="@{location10_table_start}" name="attr_location10_table_start" value="0">-<input type="number" class="sheet-number-width-xs" title="@{location10_table_end}" name="attr_location10_table_end" value="0"></div>
                        <div class="sheet-td"><input type="text" class="sheet-location-name sheet-text-center" title="@{location10_name}" name="attr_location10_name" value=""></div>
                        <div class="sheet-td"><input type="text" class="sheet-number-width-xs" title="@{location10_block}" name="attr_location10_block" value=""></div>
                        <div class="sheet-td"><input type="number" class="sheet-number-width-sm sheet-impval" title="@{location10_ap}" name="attr_location10_ap" step="1" min="0" value="0"></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width-sm sheet-dullval" title="@{location10_hp_max_base_mod}" name="attr_location1_hp_max_base_mod" value="0"></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width-sm sheet-dullval" title="@{location10_hp_max_other}" name="attr_location1_hp_max_other" value="0"></div>
                        <div class="sheet-td"><div class="sheet-impval sheet-number-width sheet-flex"><input type="number" class="sheet-lval" title="@{location10_hp}" name="attr_location10_hp" value="5">/<input type="number" class="sheet-rval" title="@{location10_hp|max}" name="attr_location10_hp_max" value="5" readonly></div></div>
                    </div>
                    <input type="hidden" class="sheet-toggle" name="attr_location11_display" value="0">
                    <div class="sheet-tr sheet-toggle">
                        <div class="sheet-td"><input type="number" class="sheet-number-width-xs" title="@{location11_table_start}" name="attr_location11_table_start" value="0">-<input type="number" class="sheet-number-width-xs" title="@{location11_table_end}" name="attr_location11_table_end" value="0"></div>
                        <div class="sheet-td"><input type="text" class="sheet-location-name sheet-text-center" title="@{location11_name}" name="attr_location11_name" value=""></div>
                        <div class="sheet-td"><input type="text" class="sheet-number-width-xs" title="@{location11_block}" name="attr_location11_block" value=""></div>
                        <div class="sheet-td"><input type="number" class="sheet-number-width-sm sheet-impval" title="@{location11_ap}" name="attr_location11_ap" step="1" min="0" value="0"></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width-sm sheet-dullval" title="@{location11_hp_max_base_mod}" name="attr_location1_hp_max_base_mod" value="0"></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width-sm sheet-dullval" title="@{location11_hp_max_other}" name="attr_location1_hp_max_other" value="0"></div>
                        <div class="sheet-td"><div class="sheet-impval sheet-number-width sheet-flex"><input type="number" class="sheet-lval" title="@{location11_hp}" name="attr_location11_hp" value="5">/<input type="number" class="sheet-rval" title="@{location11_hp|max}" name="attr_location11_hp_max" value="5" readonly></div></div>
                    </div>
                    <input type="hidden" class="sheet-toggle" name="attr_location12_display" value="0">
                    <div class="sheet-tr sheet-toggle">
                        <div class="sheet-td"><input type="number" class="sheet-number-width-xs" title="@{location12_table_start}" name="attr_location12_table_start" value="0">-<input type="number" class="sheet-number-width-xs" title="@{location12_table_end}" name="attr_location12_table_end" value="0"></div>
                        <div class="sheet-td"><input type="text" class="sheet-location-name sheet-text-center" title="@{location12_name}" name="attr_location12_name" value=""></div>
                        <div class="sheet-td"><input type="text" class="sheet-number-width-xs" title="@{location12_block}" name="attr_location12_block" value=""></div>
                        <div class="sheet-td"><input type="number" class="sheet-number-width-sm sheet-impval" title="@{location12_ap}" name="attr_location12_ap" step="1" min="0" value="0"></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width-sm sheet-dullval" title="@{location11_hp_max_base_mod}" name="attr_location1_hp_max_base_mod" value="0"></div>
                        <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width-sm sheet-dullval" title="@{location11_hp_max_other}" name="attr_location1_hp_max_other" value="0"></div>
                        <div class="sheet-td"><div class="sheet-impval sheet-number-width sheet-flex"><input type="number" class="sheet-lval" title="@{location12_hp}" name="attr_location12_hp" value="5">/<input type="number" class="sheet-rval" title="@{location12_hp|max}" name="attr_location12_hp_max" value="5" readonly></div></div>
                    </div>
                </div>
                <!-- Wounds -->
                <div class="sheet-flex sheet-gap">
                    <div><label class="sheet-left" data-i18n="wounds">Wounds</label></div>
                    <div class="sheet-grow"><input type="text" class="sheet-full-width" name="attr_wounds"></div>
                </div>
            </div>
        </div>

        <!-- Social Conflict -->
        <div class="sheet-section sheet-social">
            <div class="sheet-space-between">
                <h2 data-i18n="social_conflict">Social Conflict</h2>
                <div><input type='checkbox' name='attr_social_conflict_configs' value="1"><span class="sheet-checkico">y</span></div>
            </div>

            <input type="hidden" class="sheet-details-toggle" name="attr_social_conflict_configs" value="0">
            <div class="sheet-table sheet-bmargin">
                <div class="sheet-tr">
                    <div class="sheet-th"><button type="roll" class="sheet-link" title="%{resolution_pool}" name="roll_resolution_pool" value="@{roll_display}&{template:resolution_pool} {{name=^{resolution_pool}}} {{character=@{character_name}}} {{roll=[[1d12]]}} {{confidence=@{confidence}}} {{composure=@{composure}}} {{composure_max=@{composure|max}}} {{integrity=@{integrity}}} {{integrity_max=@{integrity|max}}} {{resolve=@{resolve}}} {{resolve_max=@{resolve|max}}}">d12</button></div>
                    <div class="sheet-th sheet-full-width" data-i18n="resolution_pool">Resolution Pool</div>
                    <div class="sheet-th sheet-details-toggle" data-i18n="other">Other</div>
                    <div class="sheet-th" data-i18n-title="current" data-i18n="current-a">Curr</div>
                </div>
                <div class="sheet-tr">
                    <div class="sheet-td">1-4</div>
                    <div class="sheet-td sheet-full-width" data-i18n="composure">Composure</div>
                    <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width sheet-dullval" title="@{composure_other}" name="attr_composure_other" value="0"></div>
                    <div class="sheet-td">
                        <div class="sheet-impval sheet-number-width sheet-flex">
                            <input type="number" class="sheet-lval" title="@{composure}" name="attr_composure" value="4">/<input type="number" class="sheet-rval" title="@{composure|max}" name="attr_composure_max" value="4" readonly>
                        </div>
                    </div>
                </div>
                <div class="sheet-tr">
                    <div class="sheet-td">5-8</div>
                    <div class="sheet-td sheet-full-width" data-i18n="integrity">Integrity</div>
                    <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width sheet-dullval" title="@{integrity_other}" name="attr_integrity_other" value="0"></div>
                    <div class="sheet-td">
                        <div class="sheet-impval sheet-number-width sheet-flex">
                            <input type="number" class="sheet-lval" title="@{integrity}" name="attr_integrity" value="4">/<input type="number" class="sheet-rval" title="@{integrity|max}" name="attr_integrity_max" value="4" readonly>
                        </div>
                    </div>
                </div>
                <div class="sheet-tr">
                    <div class="sheet-td">9-12</div>
                    <div class="sheet-td sheet-full-width" data-i18n="resolve">Resolve</div>
                    <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width sheet-dullval" title="@{resolve_other}" name="attr_resolve_other" value="0"></div>
                    <div class="sheet-td">
                        <div class="sheet-impval sheet-number-width sheet-flex">
                            <input type="number" class="sheet-lval" title="@{resolve}" name="attr_resolve" value="5">/<input type="number" class="sheet-rval" title="@{resolve|max}" name="attr_resolve_max" value="5" readonly>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sheet-table">
                <div class="sheet-tr">
                    <div class="sheet-th" data-i18n="offense">Offense</div>
                    <div class="sheet-th">%</div>
                    <div class="sheet-th"></div>
                </div>
                <div class="sheet-tr">
                    <div class="sheet-td"><input type="text" class="sheet-full-width" name="attr_social_offense_name" value="Influence" readonly></div>
                    <div class="sheet-td"><input type="number" class="sheet-number-width" name="attr_social_offense_total" value="22" readonly></div>
                    <div class="sheet-td"><button type="roll" class="sheet-die sheet-d10" title="%{social_offense}" name="roll_social_offense" value="@{roll_display}&{template:skill} {{socialoffense=1}} {{character=@{character_name}}} {{character_id=@{character_id}}} {{name=@{social_offense_name}}} {{roll=[[1d100]]}} {{fatigue_skills=[[@{fatigue_skills}]]}} {{encumbered=[[0]]}} {{original=@{social_offense_total}}} {{difficulty=[[@{difficulty}]]}} {{augmentation=[[@{augmentation}]]}} {{penalty=[[@{penalty}]]}} {{very_easy=[[((@{social_offense_total}+@{augmentation})*2)+@{penalty}]]}} {{very_easy_crit=[[ceil(((@{social_offense_total}*2)+@{penalty})/10)]]}} {{very_easy_fumble=[[((@{social_offense_total}*2)+@{penalty})]]}} {{easy=[[ceil((@{social_offense_total}+@{augmentation})*1.5)+@{penalty}]]}} {{easy_crit=[[ceil(((@{social_offense_total}*1.5)+@{penalty})/10)]]}} {{easy_fumble=[[ceil((@{social_offense_total}*1.5)+@{penalty})]]}} {{standard=[[@{social_offense_total}+@{augmentation}+@{penalty}]]}} {{standard_crit=[[ceil((@{social_offense_total}+@{penalty})/10)]]}} {{standard_fumble=[[(@{social_offense_total}+@{penalty})]]}} {{hard=[[ceil((@{social_offense_total}+@{augmentation})*.67)+@{penalty}]]}} {{hard_crit=[[ceil(((@{social_offense_total}*.67)+@{penalty})/10)]]}} {{hard_fumble=[[ceil((@{social_offense_total}*.67)+@{penalty})]]}} {{formidable=[[ceil((@{social_offense_total}+@{augmentation})*.5)+@{penalty}]]}} {{formidable_crit=[[ceil(((@{social_offense_total}*.5)+@{penalty})/10)]]}} {{formidable_fumble=[[ceil((@{social_offense_total}*.5)+@{penalty})]]}} {{herculean=[[ceil((@{social_offense_total}+@{augmentation})*@{herculean_mod})+@{penalty}]]}} {{herculean_crit=[[ceil(((@{social_offense_total}*@{herculean_mod})+@{penalty})/10)]]}} {{herculean_fumble=[[ceil((@{social_offense_total}*@{herculean_mod})+@{penalty})]]}} {{notes=@{social_offense_notes}}}">t</button></div>
                    <input type="hidden" name="attr_social_offense_notes" value="">
                    <input type="hidden" name="attr_social_offense_id" value="influence">
                </div>
                <div class="sheet-tr">
                    <div class="sheet-th" data-i18n="defense">Defense</div>
                    <div class="sheet-th">%</div>
                    <div class="sheet-th"></div>
                </div>
                <div class="sheet-tr">
                    <div class="sheet-td"><input type="text" class="sheet-full-width" name="attr_social_defense_name" value="Deceit" readonly></div>
                    <div class="sheet-td"><input type="number" class="sheet-number-width" name="attr_social_defense_total" value="24" readonly></div>
                    <div class="sheet-td"><button type="roll" class="sheet-die sheet-d10" title="%{social_defense}" name="roll_social_defense" value="@{roll_display}&{template:skill} {{socialdefense=1}} {{character=@{character_name}}} {{character_id=@{character_id}}} {{name=@{social_defense_name}}} {{roll=[[1d100]]}} {{fatigue_skills=[[@{fatigue_skills}]]}} {{encumbered=[[0]]}} {{original=@{social_defense_total}}} {{difficulty=[[@{difficulty}]]}} {{augmentation=[[@{augmentation}]]}} {{penalty=[[@{penalty}]]}} {{very_easy=[[((@{social_defense_total}+@{augmentation})*2)+@{penalty}]]}} {{very_easy_crit=[[ceil(((@{social_defense_total}*2)+@{penalty})/10)]]}} {{very_easy_fumble=[[((@{social_defense_total}*2)+@{penalty})]]}} {{easy=[[ceil((@{social_defense_total}+@{augmentation})*1.5)+@{penalty}]]}} {{easy_crit=[[ceil(((@{social_defense_total}*1.5)+@{penalty})/10)]]}} {{easy_fumble=[[ceil((@{social_defense_total}*1.5)+@{penalty})]]}} {{standard=[[@{social_defense_total}+@{augmentation}+@{penalty}]]}} {{standard_crit=[[ceil((@{social_defense_total}+@{penalty})/10)]]}} {{standard_fumble=[[(@{social_defense_total}+@{penalty})]]}} {{hard=[[ceil((@{social_defense_total}+@{augmentation})*.67)+@{penalty}]]}} {{hard_crit=[[ceil(((@{social_defense_total}*.67)+@{penalty})/10)]]}} {{hard_fumble=[[ceil((@{social_defense_total}*.67)+@{penalty})]]}} {{formidable=[[ceil((@{social_defense_total}+@{augmentation})*.5)+@{penalty}]]}} {{formidable_crit=[[ceil(((@{social_defense_total}*.5)+@{penalty})/10)]]}} {{formidable_fumble=[[ceil((@{social_defense_total}*.5)+@{penalty})]]}} {{herculean=[[ceil((@{social_defense_total}+@{augmentation})*@{herculean_mod})+@{penalty}]]}} {{herculean_crit=[[ceil(((@{social_defense_total}*@{herculean_mod})+@{penalty})/10)]]}} {{herculean_fumble=[[ceil((@{social_defense_total}*@{herculean_mod})+@{penalty})]]}} {{notes=@{social_defense_notes}}}">t</button></div>
                    <input type="hidden" name="attr_social_defense_notes" value="">
                    <input type="hidden" name="attr_social_defense_id" value="deceit">
                </div>
            </div>
        </div>

        <!-- Conditions -->
        <div class="sheet-section sheet-flex-column sheet-grow">
            <h2 data-i18n="conditions">Conditions</h2>

            <div class="sheet-bmargin sheet-creature">
                <div class="sheet-flex sheet-gap sheet-hl">
                    <div><a class="sheet-label-left" data-i18n-title="show_fatigue_popup" data-i18n="fatigue" href="#fatigue-details">Fatigue</a></div>
                    <div class="sheet-grow">
                        <select class="sheet-full-width sheet-text-right" title="@{fatigue}" name="attr_fatigue">
                            <option value="9" data-i18n="fresh" selected>Fresh</option>
                            <option value="8" data-i18n="winded">Winded</option>
                            <option value="7" data-i18n="tired">Tired</option>
                            <option value="6" data-i18n="wearied">Wearied</option>
                            <option value="5" data-i18n="exhausted">Exhausted</option>
                            <option value="4" data-i18n="debilitated">Debilitated</option>
                            <option value="3" data-i18n="incapacitated">Incapacitated</option>
                            <option value="2" data-i18n="semi-conscious">Semi-Conscious</option>
                            <option value="1" data-i18n="comatose">Comatose</option>
                            <option value="0" data-i18n="dead">Dead</option>
                        </select>
                    </div>
                </div>

                <div class="sheet-flex sheet-gap sheet-hl">
                    <div><label class="sheet-left" data-i18n="load">Load</label></div>
                    <div><input type='checkbox' data-i18n-title="pack_equipped" name='attr_pack_equipped' value="1" checked><span class="sheet-checkico">O</span></div>
                    <div class="sheet-grow">
                        <select class="sheet-full-width sheet-text-right sheet-no-border sheet-readonly" title="@{encumbrance_load}" name="attr_encumbrance_load">
                            <option value="0" data-i18n="normal" selected>Normal</option>
                            <option value="1" data-i18n="medium">Medium</option>
                            <option value="2" data-i18n="strenuous">Strenuous</option>
                            <option value="3" data-i18n="impossible">Impossible</option>
                        </select>
                    </div>
                </div>

                <div class="sheet-flex sheet-gap sheet-hl">
                    <div><label class="sheet-left" data-i18n="armor_penalty">Armor Penalty</label></div>
                    <div class="sheet-grow sheet-text-right"><span name="attr_armor_penalty"></span></div>
                </div>

                <input type="hidden" class="sheet-toggle" name="attr_tenacity_enabled" value="0">
                <div class="sheet-toggle">
                    <input type="hidden" class="sheet-toggle" name="attr_dependencies_enabled" value="0">
                    <div class="sheet-toggle">
                        <input type="hidden" class="sheet-toggle" name="attr_apply_dependencies_penalty" value="1">
                        <div class="sheet-flex sheet-gap sheet-hl sheet-toggle">
                            <div><label class="sheet-left" data-i18n="tenacity_penalty">Tenacity Penalty</label></div>
                            <div class="sheet-grow sheet-text-right"><span name="attr_tenacity_dependencies"></span></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sheet-grow">
                <textarea style="height: 100%" name="attr_conditions"></textarea>
            </div>
        </div>
    </div>

    <!-- Skills & Passions -->
    <div id="skills" class="sheet-section sheet-anchor-adjust-x2">
        <input type="hidden" class="sheet-social-conflict-toggle" name="attr_social_conflict_enabled" value="0">
        <input type="hidden" class="sheet-spirits-toggle" name="attr_spirits_enabled" value="1">
        <div class="sheet-flex sheet-gap">
            <div class="sheet-grow"><h2><span data-i18n="skills">Skills</span> / <span data-i18n="passions">Passions</span></h2></div>
            <!-- Spirit Combat -->
            <div>
                <label class="sheet-left sheet-rmargin" data-i18n="spirit_combat_skill">Spirit Combat Skill</label>
                <button type="roll" title="%{spirit_combat_skill}" name="roll_spirit_combat_skill" value="@{roll_display}&{template:skill} {{spiritcombat=1}} {{character=@{character_name}}} {{character_id=@{character_id}}} {{name=@{spirit_combat_skill_name}}} {{roll=[[1d100]]}} {{fatigue_skills=[[@{fatigue_skills}]]}} {{encumbered=[[0]]}} {{original=@{spirit_combat_skill_total}}} {{difficulty=[[@{difficulty}]]}} {{augmentation=[[@{augmentation}]]}} {{penalty=[[@{penalty}]]}} {{very_easy=[[((@{spirit_combat_skill_total}+@{augmentation})*2)+@{penalty}]]}} {{very_easy_crit=[[ceil(((@{spirit_combat_skill_total}*2)+@{penalty})/10)]]}} {{very_easy_fumble=[[((@{spirit_combat_skill_total}*2)+@{penalty})]]}} {{easy=[[ceil((@{spirit_combat_skill_total}+@{augmentation})*1.5)+@{penalty}]]}} {{easy_crit=[[ceil(((@{spirit_combat_skill_total}*1.5)+@{penalty})/10)]]}} {{easy_fumble=[[ceil((@{spirit_combat_skill_total}*1.5)+@{penalty})]]}} {{standard=[[@{spirit_combat_skill_total}+@{augmentation}+@{penalty}]]}} {{standard_crit=[[ceil((@{spirit_combat_skill_total}+@{penalty})/10)]]}} {{standard_fumble=[[(@{spirit_combat_skill_total}+@{penalty})]]}} {{hard=[[ceil((@{spirit_combat_skill_total}+@{augmentation})*.67)+@{penalty}]]}} {{hard_crit=[[ceil(((@{spirit_combat_skill_total}*.67)+@{penalty})/10)]]}} {{hard_fumble=[[ceil((@{spirit_combat_skill_total}*.67)+@{penalty})]]}} {{formidable=[[ceil((@{spirit_combat_skill_total}+@{augmentation})*.5)+@{penalty}]]}} {{formidable_crit=[[ceil(((@{spirit_combat_skill_total}*.5)+@{penalty})/10)]]}} {{formidable_fumble=[[ceil((@{spirit_combat_skill_total}*.5)+@{penalty})]]}} {{herculean=[[ceil((@{spirit_combat_skill_total}+@{augmentation})*@{herculean_mod})+@{penalty}]]}} {{herculean_crit=[[ceil(((@{spirit_combat_skill_total}*@{herculean_mod})+@{penalty})/10)]]}} {{herculean_fumble=[[ceil((@{spirit_combat_skill_total}*@{herculean_mod})+@{penalty})]]}} {{notes=@{spirit_combat_skill_notes}}}"><span class="sheet-bold" name="attr_spirit_combat_skill_name"></span> <span name="attr_spirit_combat_skill_total"></span>%</button>
                <input type="hidden" name="attr_spirit_combat_skill_id" value="willpower" readonly>
                <input type="hidden" name="attr_spirit_combat_skill_name" value="Willpower" readonly>
                <input type="hidden" name="attr_spirit_combat_skill_total" value="22" readonly>
                <input type="hidden" name="attr_spirit_combat_skill_notes" value="" readonly>
            </div>
            <div><input type='checkbox' data-i18n-title="show_details" name='attr_skill_details' value="1" checked><span class="sheet-checkico">E</span></div>
        </div>

        <input type="hidden" class="sheet-details-toggle" name="attr_skill_details" value="1">

        <div class="sheet-flex sheet-gap">
            <!-- Column 1 -->
            <div class="sheet-half-width">
                <!-- Resistance Skills -->
                <div data-i18n-list="resistence_skills-order" class="sheet-bmargin">
                    <div class="sheet-flex">
                        <div class="sheet-th sheet-minor"><div class="sheet-help sheet-pictos sheet-checkbox-width" data-i18n-title="skill_possessed">S</div></div>
                        <div class="sheet-th sheet-grow"><div class="sheet-full-width" data-i18n="resistance_skill">Resistence Skill</div></div>
                        <div class="sheet-th"><div class="sheet-button-width"></div></div>
                        <div class="sheet-th"><div class="sheet-checkbox-width"></div></div>
                        <div class="sheet-th"><div class="sheet-help sheet-pictos sheet-checkbox-width" data-i18n-title="fumbled">!</div></div>
                        <div class="sheet-th"><div class="sheet-help sheet-pictos sheet-checkbox-width" data-i18n-title="trained">3</div></div>
                        <div class="sheet-th"><div class="sheet-number-width" data-i18n="base">Base</div></div>
                        <div class="sheet-th"><div class="sheet-number-width" data-i18n="base">Base</div></div>
                        <div class="sheet-th sheet-details-toggle"><div class="sheet-number-width" data-i18n="other">Other</div></div>
                        <div class="sheet-th"><div class="sheet-number-width">%</div></div>
                        <div class="sheet-th"><div class="sheet-help sheet-pictos sheet-checkbox-width" data-i18n-title="configuration">y</div></div>
                    </div>
                    <!-- Willpower -->
                    <div data-i18n-list-item="willpower">
                        <input type="hidden" class="sheet-opaque-toggle" name="attr_willpower_possessed" value="1">
                        <div class="sheet-opaque">
                            <div class="sheet-hl sheet-flex">
                                <div class="sheet-td sheet-minor"><input type="checkbox" title="@{willpower_possessed}" name="attr_willpower_possessed" value="1" checked><span class="sheet-checkico">S</span></div>
                                <div class="sheet-td sheet-grow">
                                    <div class="sheet-full-width sheet-hover-btn">
                                        <label class="sheet-skill" data-i18n="willpower">Willpower</label>
                                        <button type="roll" class="sheet-hover sheet-id" title="%{willpower_id}" name="roll_willpower_id" value="/w gm &{template:default} {{name=@{willpower_name}}} {{^{id}=willpower}}">i</button>
                                        <input type="hidden" name="attr_willpower_name" value="^{willpower}">
                                    </div>
                                </div>
                                <div class="sheet-td"><button type="action" class="sheet-pictos" name="act_willpower-augment">&</button></div>
                                <div class="sheet-td">
                                    <button type="roll" class="sheet-die sheet-d10 sheet-button-width" title="%{willpower}" name="roll_willpower" value="@{roll_display}&{template:skill} {{character=@{character_name}}} {{name=^{willpower}}} {{roll=[[1d100]]}} {{fatigue_skills=[[@{fatigue_skills}]]}} {{encumbered=[[0]]}} {{original=@{willpower}}} {{difficulty=[[@{difficulty}]]}} {{augmentation=[[@{augmentation}]]}} {{penalty=[[@{penalty}]]}} {{very_easy=[[((@{willpower}+@{augmentation})*2)+@{penalty}]]}} {{very_easy_crit=[[ceil(((@{willpower}*2)+@{penalty})/10)]]}} {{very_easy_fumble=[[((@{willpower}*2)+@{penalty})]]}} {{easy=[[ceil((@{willpower}+@{augmentation})*1.5)+@{penalty}]]}} {{easy_crit=[[ceil(((@{willpower}*1.5)+@{penalty})/10)]]}} {{easy_fumble=[[ceil((@{willpower}*1.5)+@{penalty})]]}} {{standard=[[@{willpower}+@{augmentation}+@{penalty}]]}} {{standard_crit=[[ceil((@{willpower}+@{penalty})/10)]]}} {{standard_fumble=[[(@{willpower}+@{penalty})]]}} {{hard=[[ceil((@{willpower}+@{augmentation})*.67)+@{penalty}]]}} {{hard_crit=[[ceil(((@{willpower}*.67)+@{penalty})/10)]]}} {{hard_fumble=[[ceil((@{willpower}*.67)+@{penalty})]]}} {{formidable=[[ceil((@{willpower}+@{augmentation})*.5)+@{penalty}]]}} {{formidable_crit=[[ceil(((@{willpower}*.5)+@{penalty})/10)]]}} {{formidable_fumble=[[ceil((@{willpower}*.5)+@{penalty})]]}} {{herculean=[[ceil((@{willpower}+@{augmentation})*@{herculean_mod})+@{penalty}]]}} {{herculean_crit=[[ceil(((@{willpower}*@{herculean_mod})+@{penalty})/10)]]}} {{herculean_fumble=[[ceil((@{willpower}*@{herculean_mod})+@{penalty})]]}} {{notes=@{willpower_notes}}}">t</button>
                                </div>
                                <div class="sheet-td"><input type="checkbox" title="@{willpower_fumbled}" name="attr_willpower_fumbled" value="1"><span class="sheet-checkico">!</span></div>
                                <div class="sheet-td"><input type="checkbox" title="@{willpower_trained}" name="attr_willpower_trained" value="1"><span class="sheet-checkico">3</span></div>
                                <div class="sheet-td"><div class="sheet-number-width" data-i18n="pow-u">POW</div></div>
                                <div class="sheet-td"><div class="sheet-number-width" data-i18n="pow-u">POW</div></div>
                                <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width sheet-dullval" title="@{willpower_other}" name="attr_willpower_other" value="0" readonly></div>
                                <div class="sheet-td"><input type="number" class="sheet-number-width sheet-impval" title="@{willpower}" name="attr_willpower" value="22" step="1"  min="0"></div>
                                <div class="sheet-td"><input type="checkbox" title="@{willpower_details}" name="attr_willpower_details" value="1"><span class="sheet-checkico">y</span></div>
                            </div>
                            <input type="hidden" class="sheet-wide-toggle" name="attr_willpower_details" value="0">
                            <div class="sheet-anti-toggle">
                                <span class="sheet-details-toggle" name="attr_willpower_notes"></span>
                            </div>
                            <div class="sheet-toggle">
                                <div class="sheet-flex sheet-flex-wrap sheet-gap">
                                    <button type="roll" title="%{willpower_improve}" name="roll_willpower_improve" value="@{roll_display}&{template:improvement} {{name=^{willpower}}} {{character=@{character_name}}} {{roll=[[1d100+@{int}]]}} {{improvement=[[1d4+1]]}} {{skill=[[@{willpower}]]}}" data-i18n="improve">Improve</button>
                                    <button type="action" class="sheet-social-conflict" name="act_willpower-set-social-offense" data-i18n="set_social_offense">Set Social Offense</button>
                                    <button type="action" class="sheet-social-conflict" name="act_willpower-set-social-defense" data-i18n="set_social_defense">Set Social Defense</button>
                                    <button type="action" class="sheet-spirits" name="act_willpower-set-spirit-combat" data-i18n="set_spirit_combat">Set Spirit Combat</button>
                                    <div class="sheet-grow sheet-flex">
                                        <div><label class="sheet-left sheet-rmargin" data-i18n="tags">Tags</label></div>
                                        <div class="sheet-grow"><input type="text" class="sheet-full-width" title="@{willpower_tags}" name="attr_willpower_tags"></div>
                                    </div>
                                </div>
                                <textarea class="sheet-skill-notes" title="@{willpower_notes}" name="attr_willpower_notes"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Standard SKills -->
                <div data-i18n-list="standard_skills-order">
                    <div class="sheet-flex">
                        <div class="sheet-th sheet-minor"><div class="sheet-help sheet-pictos sheet-checkbox-width" data-i18n-title="skill_possessed">S</div></div>
                        <div class="sheet-th sheet-grow"><div class="sheet-full-width" data-i18n="standard_skill">Standard Skill</div></div>
                        <div class="sheet-th"><div class="sheet-button-width"></div></div>
                        <div class="sheet-th"><div class="sheet-help sheet-pictos sheet-checkbox-width" data-i18n-title="fumbled">!</div></div>
                        <div class="sheet-th"><div class="sheet-help sheet-pictos sheet-checkbox-width" data-i18n-title="trained">3</div></div>
                        <div class="sheet-th"><div class="sheet-number-width" data-i18n="base">Base</div></div>
                        <div class="sheet-th"><div class="sheet-number-width" data-i18n="base">Base</div></div>
                        <div class="sheet-th sheet-skill-details"><div class="sheet-number-width" data-i18n="other">Other</div></div>
                        <div class="sheet-th"><div class="sheet-number-width">%</div></div>
                        <div class="sheet-th"><div class="sheet-help sheet-pictos sheet-checkbox-width" data-i18n-title="configuration">y</div></div>
                    </div>
                    <!-- Athletics -->
                    <div data-i18n-list-item="athletics">
                        <input type="hidden" class="sheet-opaque-toggle" name="attr_athletics_possessed" value="1">
                        <div class="sheet-opaque">
                            <div class="sheet-hl sheet-flex">
                                <div class="sheet-td sheet-minor"><input type="checkbox" title="@{athletics_possessed}" name="attr_athletics_possessed" value="1" checked><span class="sheet-checkico">S</span></div>
                                <div class="sheet-td sheet-grow">
                                    <div class="sheet-full-width sheet-hover-btn">
                                        <label class="sheet-skill" data-i18n="athletics">Athletics</label>
                                        <button type="action" class="sheet-hover sheet-augment" name="act_athletics-augment">&</button>
                                        <button type="action" class="sheet-hover sheet-penalty" name="act_athletics-penalty">_</button>
                                        <button type="roll" class="sheet-hover sheet-id" title="%{athletics_id}" name="roll_athletics_id" value="/w gm &{template:default} {{name=@{athletics_name}}} {{^{id}=athletics}}">i</button>
                                        <input type="hidden" name="attr_athletics_name" value="^{athletics}">
                                    </div>
                                </div>
                                <div class="sheet-td">
                                    <button type="roll" class="sheet-die sheet-d10 sheet-button-width" title="%{athletics}" name="roll_athletics" value="@{roll_display}&{template:skill} {{character=@{character_name}}} {{name=^{athletics}}} {{roll=[[1d100]]}} {{fatigue_skills=[[@{fatigue_skills}]]}} {{encumbered=[[1]]}} {{encumbrance_skills=[[@{encumbrance_skills}]]}} {{original=@{athletics}}} {{difficulty=[[@{difficulty}]]}} {{augmentation=[[@{augmentation}]]}} {{penalty=[[@{penalty}]]}} {{very_easy=[[((@{athletics}+@{augmentation})*2)+@{penalty}]]}} {{very_easy_crit=[[ceil(((@{athletics}*2)+@{penalty})/10)]]}} {{very_easy_fumble=[[((@{athletics}*2)+@{penalty})]]}} {{easy=[[ceil((@{athletics}+@{augmentation})*1.5)+@{penalty}]]}} {{easy_crit=[[ceil(((@{athletics}*1.5)+@{penalty})/10)]]}} {{easy_fumble=[[ceil((@{athletics}*1.5)+@{penalty})]]}} {{standard=[[@{athletics}+@{augmentation}+@{penalty}]]}} {{standard_crit=[[ceil((@{athletics}+@{penalty})/10)]]}} {{standard_fumble=[[(@{athletics}+@{penalty})]]}} {{hard=[[ceil((@{athletics}+@{augmentation})*.67)+@{penalty}]]}} {{hard_crit=[[ceil(((@{athletics}*.67)+@{penalty})/10)]]}} {{hard_fumble=[[ceil((@{athletics}*.67)+@{penalty})]]}} {{formidable=[[ceil((@{athletics}+@{augmentation})*.5)+@{penalty}]]}} {{formidable_crit=[[ceil(((@{athletics}*.5)+@{penalty})/10)]]}} {{formidable_fumble=[[ceil((@{athletics}*.5)+@{penalty})]]}} {{herculean=[[ceil((@{athletics}+@{augmentation})*@{herculean_mod})+@{penalty}]]}} {{herculean_crit=[[ceil(((@{athletics}*@{herculean_mod})+@{penalty})/10)]]}} {{herculean_fumble=[[ceil((@{athletics}*@{herculean_mod})+@{penalty})]]}} {{notes=@{athletics_notes}}}">t</button>
                                </div>
                                <div class="sheet-td"><input type="checkbox" title="@{athletics_fumbled}" name="attr_athletics_fumbled" value="1"><span class="sheet-checkico">!</span></div>
                                <div class="sheet-td"><input type="checkbox" title="@{athletics_trained}" name="attr_athletics_trained" value="1"><span class="sheet-checkico">3</span></div>
                                <div class="sheet-td"><div class="sheet-number-width" data-i18n="str-u">STR</div></div>
                                <div class="sheet-td"><div class="sheet-number-width" data-i18n="dex-u">DEX</div></div>
                                <div class="sheet-td sheet-skill-details"><input type="number" class="sheet-number-width sheet-dullval" title="@{athletics_other}" name="attr_athletics_other" value="0" readonly></div>
                                <div class="sheet-td"><input type="number" class="sheet-number-width sheet-impval" title="@{athletics}" name="attr_athletics" value="22" step="1"  min="0"></div>
                                <div class="sheet-td"><input type="checkbox" title="@{athletics_details}" name="attr_athletics_details" value="1"><span class="sheet-checkico">y</span></div>
                            </div>
                            <input type="hidden" class="sheet-toggle" name="attr_athletics_details" value="0">
                            <div class="sheet-toggle">
                                <div class="sheet-flex sheet-flex-wrap sheet-gap">
                                    <button type="roll" title="%{athletics_improve}" name="roll_athletics_improve" value="@{roll_display}&{template:improvement} {{name=^{athletics}}} {{character=@{character_name}}} {{roll=[[1d100+@{int}]]}} {{improvement=[[1d4+1]]}} {{skill=[[@{athletics}]]}}" data-i18n="improve">Improve</button>
                                    <button type="action" class="sheet-social-conflict" name="act_athletics-set-social-offense" data-i18n="set_social_offense">Set Social Offense</button>
                                    <button type="action" class="sheet-social-conflict" name="act_athletics-set-social-defense" data-i18n="set_social_defense">Set Social Defense</button>
                                    <div class="sheet-grow sheet-flex">
                                        <div><label class="sheet-left sheet-rmargin" data-i18n="tags">Tags</label></div>
                                        <div class="sheet-grow"><input type="text" class="sheet-full-width" title="@{athletics_tags}" name="attr_athletics_tags"></div>
                                    </div>
                                </div>
                                <textarea class="sheet-skill-notes" title="@{athletics_notes}" name="attr_athletics_notes"></textarea>
                            </div>
                        </div>
                    </div>

                    <div data-i18n-list-item="swim">
                        <div style="display: inline">Swim</div>
                    </div>
                </div>
            </div>

            <!-- Column 2 -->
            <div class="sheet-half-width sheet-flex-column sheet-gap">
                <!-- Combat Styles -->
                <div>
                    <div class="sheet-flex">
                        <div class="sheet-th sheet-grow"><div class="sheet-full-width" data-i18n="combat_style">Combat Style</div></div>
                        <div class="sheet-th"><div class="sheet-checkbox-width"></div></div>
                        <div class="sheet-th"><div class="sheet-button-width"></div></div>
                        <div class="sheet-th"><div class="sheet-help sheet-pictos sheet-checkbox-width" data-i18n-title="fumbled">!</div></div>
                        <div class="sheet-th"><div class="sheet-help sheet-pictos sheet-checkbox-width" data-i18n-title="trained">3</div></div>
                        <div class="sheet-th"><div class="sheet-number-width" data-i18n="base">Base</div></div>
                        <div class="sheet-th"><div class="sheet-number-width" data-i18n="base">Base</div></div>
                        <div class="sheet-th sheet-details-toggle"><div class="sheet-number-width" data-i18n="other">Other</div></div>
                        <div class="sheet-th"><div class="sheet-number-width">%</div></div>
                        <div class="sheet-th"><div class="sheet-help sheet-pictos sheet-checkbox-width" data-i18n-title="configuration">y</div></div>
                    </div>
                    <fieldset class="repeating_combatstyle">
                        <div class="sheet-flex">
                            <div class="sheet-td sheet-grow">
                                <div class="sheet-full-width sheet-hover-btn">
                                    <input type="text" class="sheet-full-width sheet-text-left" name="attr_name">
                                    <button type="roll" class="sheet-hover sheet-id" title="%{$ID_id}" name="roll_id" value="/w gm &{template:default} {{name=@{name}}} {{^{id}=@{id}}}">i</button>
                                    <input type="hidden" name="attr_id" value="unset">
                                </div>
                            </div>
                            <div class="sheet-td"><button type="action" class="sheet-pictos" data-i18n-title="set_augmentation" name="act_augment">&</button></div>
                            <div class="sheet-td">
                                <button type="roll" class="sheet-die sheet-d10 sheet-button-width" title="%{$ID_combatstyle}" name="roll_combatstyle" value="@{roll_display}&{template:skill} {{character=@{character_name}}} {{name=@{name}}} {{roll=[[1d100]]}} {{fatigue_skills=[[@{fatigue_skills}]]}} {{encumbered=[[@{encumbered}]]}} {{encumbrance_skills=[[@{encumbrance_skills}]]}} {{original=@{total}}} {{difficulty=[[@{difficulty}]]}} {{augmentation=[[@{augmentation}]]}} {{penalty=[[@{penalty}]]}} {{very_easy=[[((@{total}+@{augmentation})*2)+@{penalty}]]}} {{very_easy_crit=[[ceil(((@{total}*2)+@{penalty})/10)]]}} {{very_easy_fumble=[[((@{total}*2)+@{penalty})]]}} {{easy=[[ceil((@{total}+@{augmentation})*1.5)+@{penalty}]]}} {{easy_crit=[[ceil(((@{total}*1.5)+@{penalty})/10)]]}} {{easy_fumble=[[ceil((@{total}*1.5)+@{penalty})]]}} {{standard=[[@{total}+@{augmentation}+@{penalty}]]}} {{standard_crit=[[ceil((@{total}+@{penalty})/10)]]}} {{standard_fumble=[[(@{total}+@{penalty})]]}} {{hard=[[ceil((@{total}+@{augmentation})*.67)+@{penalty}]]}} {{hard_crit=[[ceil(((@{total}*.67)+@{penalty})/10)]]}} {{hard_fumble=[[ceil((@{total}*.67)+@{penalty})]]}} {{formidable=[[ceil((@{total}+@{augmentation})*.5)+@{penalty}]]}} {{formidable_crit=[[ceil(((@{total}*.5)+@{penalty})/10)]]}} {{formidable_fumble=[[ceil((@{total}*.5)+@{penalty})]]}} {{herculean=[[ceil((@{total}+@{augmentation})*@{herculean_mod})+@{penalty}]]}} {{herculean_crit=[[ceil(((@{total}*@{herculean_mod})+@{penalty})/10)]]}} {{herculean_fumble=[[ceil((@{total}*@{herculean_mod})+@{penalty})]]}} {{notes=@{notes}}}">t</button>
                            </div>
                            <div class="sheet-td"><input type="checkbox" title="@{$ID_fumbled}" name="attr_fumbled" value="1"><span class="sheet-checkico">!</span></div>
                            <div class="sheet-td"><input type="checkbox" title="@{$ID_trained}" name="attr_trained" value="1"><span class="sheet-checkico">3</span></div>
                            <div class="sheet-td">
                                <select class="sheet-number-width sheet-text-center" title="@{$ID_char1}" name="attr_char1">
                                    <option value="0">-</option>
                                    <option value="@{str}" data-i18n="str-u" selected>STR</option>
                                    <option value="@{con}" data-i18n="con-u">CON</option>
                                    <option value="@{siz}" data-i18n="siz-u">SIZ</option>
                                    <option value="@{dex}" data-i18n="dex-u">DEX</option>
                                    <option value="@{int}" data-i18n="int-u">INT</option>
                                    <option value="@{pow}" data-i18n="pow-u">POW</option>
                                    <option value="@{cha}" data-i18n="cha-u">CHA</option>
                                </select>
                            </div>
                            <div class="sheet-td">
                                <select class="sheet-number-width sheet-text-center" title="@{$ID_char2}" name="attr_char2">
                                    <option value="0">-</option>
                                    <option value="@{str}" data-i18n="str-u">STR</option>
                                    <option value="@{con}" data-i18n="con-u">CON</option>
                                    <option value="@{siz}" data-i18n="siz-u">SIZ</option>
                                    <option value="@{dex}" data-i18n="dex-u" selected>DEX</option>
                                    <option value="@{int}" data-i18n="int-u">INT</option>
                                    <option value="@{pow}" data-i18n="pow-u">POW</option>
                                    <option value="@{cha}" data-i18n="cha-u">CHA</option>
                                </select>
                            </div>
                            <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width sheet-dullval" title="@{$ID_other}" name="attr_other" value="0" readonly></div>
                            <div class="sheet-td"><input type="number" class="sheet-number-width sheet-impval" title="@{$ID_total}" name="attr_total" value="0" step="1"  min="0"></div>
                            <div class="sheet-td"><input type="checkbox" title="@{$ID_details}" name="attr_details" value="1"><span class="sheet-checkico">y</span></div>
                        </div>
                        <input type="hidden" class="sheet-wide-toggle" name="attr_details" value="0">
                        <div class="sheet-anti-toggle">
                            <span class="sheet-details-toggle" name="attr_notes"></span>
                        </div>
                        <div class="sheet-toggle">
                            <div class="sheet-flex sheet-flex-wrap sheet-gap">
                                <button type="roll" title="%{$ID_improve}" name="roll_improve" value="@{roll_display}&{template:improvement} {{name=@{name}}} {{character=@{character_name}}} {{roll=[[1d100+@{int}]]}} {{improvement=[[1d4+1]]}} {{skill=[[@{total}]]}}" data-i18n="improve">Improve</button>
                                <div class="sheet-grow sheet-flex">
                                    <div><label class="sheet-left sheet-rmargin" data-i18n="weapon_tags">Weapons Tags</label></div>
                                    <div class="sheet-grow"><input type="text" class="sheet-full-width" title="@{$ID_tags}" name="attr_tags" value="weapon"></div>
                                </div>
                            </div>
                            <textarea class="sheet-skill-notes" title="@{$ID_notes}" name="attr_notes"></textarea>
                            <input type="hidden" name="attr_encumbered" value="0">
                        </div>
                    </fieldset>
                </div>

                <!-- Professional Skills -->
                <div>
                    <div class="sheet-flex">
                        <div class="sheet-th sheet-grow"><div class="sheet-full-width" data-i18n="professional_skill">Professional Skill</div></div>
                        <div class="sheet-th"><div class="sheet-checkbox-width"></div></div>
                        <div class="sheet-th"><div class="sheet-button-width"></div></div>
                        <div class="sheet-th"><div class="sheet-help sheet-pictos sheet-checkbox-width" data-i18n-title="fumbled">!</div></div>
                        <div class="sheet-th"><div class="sheet-help sheet-pictos sheet-checkbox-width" data-i18n-title="trained">3</div></div>
                        <div class="sheet-th"><div class="sheet-number-width" data-i18n="base">Base</div></div>
                        <div class="sheet-th"><div class="sheet-number-width" data-i18n="base">Base</div></div>
                        <div class="sheet-th sheet-details-toggle"><div class="sheet-number-width" data-i18n="other">Other</div></div>
                        <div class="sheet-th"><div class="sheet-number-width">%</div></div>
                        <div class="sheet-th"><div class="sheet-help sheet-pictos sheet-checkbox-width" data-i18n-title="configuration">y</div></div>
                    </div>
                    <fieldset class="repeating_professionalskill">
                        <div class="sheet-flex">
                            <div class="sheet-td sheet-grow">
                                <div class="sheet-full-width sheet-hover-btn">
                                    <input type="text" class="sheet-full-width sheet-text-left" name="attr_name">
                                    <button type="roll" class="sheet-hover sheet-id" title="%{$ID_id}" name="roll_id" value="/w gm &{template:default} {{name=@{name}}} {{^{id}=@{id}}}">i</button>
                                    <input type="hidden" name="attr_id" value="unset">
                                </div>
                            </div>
                            <div class="sheet-td"><button type="action" class="sheet-pictos" data-i18n-title="set_augmentation" name="act_augment">&</button></div>
                            <div class="sheet-td">
                                <button type="roll" class="sheet-die sheet-d10 sheet-button-width" title="%{$ID_skill}" name="roll_skill" value="@{roll_display}&{template:skill} {{character=@{character_name}}} {{name=@{name}}} {{roll=[[1d100]]}} {{fatigue_skills=[[@{fatigue_skills}]]}} {{encumbered=[[@{encumbered}]]}} {{encumbrance_skills=[[@{encumbrance_skills}]]}} {{original=@{total}}} {{difficulty=[[@{difficulty}]]}} {{augmentation=[[@{augmentation}]]}} {{penalty=[[@{penalty}]]}} {{very_easy=[[((@{total}+@{augmentation})*2)+@{penalty}]]}} {{very_easy_crit=[[ceil(((@{total}*2)+@{penalty})/10)]]}} {{very_easy_fumble=[[((@{total}*2)+@{penalty})]]}} {{easy=[[ceil((@{total}+@{augmentation})*1.5)+@{penalty}]]}} {{easy_crit=[[ceil(((@{total}*1.5)+@{penalty})/10)]]}} {{easy_fumble=[[ceil((@{total}*1.5)+@{penalty})]]}} {{standard=[[@{total}+@{augmentation}+@{penalty}]]}} {{standard_crit=[[ceil((@{total}+@{penalty})/10)]]}} {{standard_fumble=[[(@{total}+@{penalty})]]}} {{hard=[[ceil((@{total}+@{augmentation})*.67)+@{penalty}]]}} {{hard_crit=[[ceil(((@{total}*.67)+@{penalty})/10)]]}} {{hard_fumble=[[ceil((@{total}*.67)+@{penalty})]]}} {{formidable=[[ceil((@{total}+@{augmentation})*.5)+@{penalty}]]}} {{formidable_crit=[[ceil(((@{total}*.5)+@{penalty})/10)]]}} {{formidable_fumble=[[ceil((@{total}*.5)+@{penalty})]]}} {{herculean=[[ceil((@{total}+@{augmentation})*@{herculean_mod})+@{penalty}]]}} {{herculean_crit=[[ceil(((@{total}*@{herculean_mod})+@{penalty})/10)]]}} {{herculean_fumble=[[ceil((@{total}*@{herculean_mod})+@{penalty})]]}} {{notes=@{notes}}}">t</button>
                            </div>
                            <div class="sheet-td"><input type="checkbox" title="@{$ID_fumbled}" name="attr_fumbled" value="1"><span class="sheet-checkico">!</span></div>
                            <div class="sheet-td"><input type="checkbox" title="@{$ID_trained}" name="attr_trained" value="1"><span class="sheet-checkico">3</span></div>
                            <div class="sheet-td">
                                <select class="sheet-number-width sheet-text-center" title="@{$ID_char1}" name="attr_char1">
                                    <option value="0" selected>-</option>
                                    <option value="@{str}" data-i18n="str-u">STR</option>
                                    <option value="@{con}" data-i18n="con-u">CON</option>
                                    <option value="@{siz}" data-i18n="siz-u">SIZ</option>
                                    <option value="@{dex}" data-i18n="dex-u">DEX</option>
                                    <option value="@{int}" data-i18n="int-u">INT</option>
                                    <option value="@{pow}" data-i18n="pow-u">POW</option>
                                    <option value="@{cha}" data-i18n="cha-u">CHA</option>
                                </select>
                            </div>
                            <div class="sheet-td">
                                <select class="sheet-number-width sheet-text-center" title="@{$ID_char2}" name="attr_char2">
                                    <option value="0" selected>-</option>
                                    <option value="@{str}" data-i18n="str-u">STR</option>
                                    <option value="@{con}" data-i18n="con-u">CON</option>
                                    <option value="@{siz}" data-i18n="siz-u">SIZ</option>
                                    <option value="@{dex}" data-i18n="dex-u">DEX</option>
                                    <option value="@{int}" data-i18n="int-u">INT</option>
                                    <option value="@{pow}" data-i18n="pow-u">POW</option>
                                    <option value="@{cha}" data-i18n="cha-u">CHA</option>
                                </select>
                            </div>
                            <div class="sheet-td sheet-details-toggle"><input type="number" class="sheet-number-width sheet-dullval" title="@{$ID_other}" name="attr_other" value="0" readonly></div>
                            <div class="sheet-td"><input type="number" class="sheet-number-width sheet-impval" title="@{$ID_total}" name="attr_total" value="0" step="1"  min="0"></div>
                            <div class="sheet-td"><input type="checkbox" title="@{$ID_details}" name="attr_details" value="1"><span class="sheet-checkico">y</span></div>
                        </div>
                        <input type="hidden" class="sheet-wide-toggle" name="attr_details" value="0">
                        <div class="sheet-anti-toggle">
                            <span class="sheet-details-toggle" name="attr_notes"></span>
                        </div>
                        <div class="sheet-toggle">
                            <div class="sheet-flex sheet-flex-wrap sheet-gap">
                                <button type="roll" title="%{$ID_improve}" name="roll_improve" value="@{roll_display}&{template:improvement} {{name=@{name}}} {{character=@{character_name}}} {{roll=[[1d100+@{int}]]}} {{improvement=[[1d4+1]]}} {{skill=[[@{total}]]}}" data-i18n="improve">Improve</button>
                                <button type="action" class="sheet-social-conflict" name="act_set-social-offense" data-i18n="set_social_offense">Set Social Offense</button>
                                <button type="action" class="sheet-social-conflict" name="act_set-social-defense" data-i18n="set_social_defense">Set Social Defense</button>
                                <button type="action" class="sheet-spirits" name="act_set-spirit-combat" data-i18n="set_spirit_combat">Set Spirit Combat</button>
                                <div class="sheet-grow sheet-flex">
                                    <div><label class="sheet-left sheet-rmargin" data-i18n="tags">Tags</label></div>
                                    <div class="sheet-grow"><input type="text" class="sheet-full-width" title="@{$ID_tags}" name="attr_tags"></div>
                                </div>
                            </div>
                            <textarea class="sheet-skill-notes" title="@{$ID_notes}" name="attr_notes"></textarea>
                            <input type="hidden" name="attr_encumbered" value="0">
                        </div>
                    </fieldset>
                </div>


                <!-- Passions -->
                <div>
                    <div class="sheet-flex">
                        <div class="sheet-th sheet-grow"><div class="sheet-full-width" data-i18n="passion">Passions</div></div>
                        <div class="sheet-th"><div class="sheet-checkbox-width"></div></div>
                        <div class="sheet-th"><div class="sheet-button-width"></div></div>
                        <div class="sheet-th"><div class="sheet-number-width">%</div></div>
                        <div class="sheet-th"><div class="sheet-help sheet-pictos sheet-checkbox-width" data-i18n-title="configuration">y</div></div>
                    </div>
                    <fieldset class="repeating_passion">
                        <div class="sheet-flex">
                            <div class="sheet-td sheet-grow">
                                <div class="sheet-full-width sheet-hover-btn">
                                    <input type="text" class="sheet-full-width sheet-text-left" name="attr_name">
                                    <button type="roll" class="sheet-hover sheet-id" title="%{$ID_id}" name="roll_id" value="/w gm &{template:default} {{name=@{name}}} {{^{id}=@{id}}}">i</button>
                                    <input type="hidden" name="attr_id" value="unset">
                                </div>
                            </div>
                            <div class="sheet-td"><button type="action" class="sheet-pictos" data-i18n-title="set_augmentation" name="act_augment">&</button></div>
                            <div class="sheet-td">
                                <button type="roll" class="sheet-die sheet-d10 sheet-button-width" title="%{$ID_passion}" name="roll_passion" value="@{roll_display}&{template:skill} {{character=@{character_name}}} {{name=@{name}}} {{roll=[[1d100]]}} {{fatigue_skills=[[0]]}} {{encumbered=[[0]]}} {{original=@{total}}} {{difficulty=[[@{difficulty}]]}} {{augmentation=[[@{augmentation}]]}} {{penalty=[[@{penalty}]]}} {{very_easy=[[((@{total}+@{augmentation})*2)+@{penalty}]]}} {{very_easy_crit=[[ceil(((@{total}*2)+@{penalty})/10)]]}} {{very_easy_fumble=[[((@{total}*2)+@{penalty})]]}} {{easy=[[ceil((@{total}+@{augmentation})*1.5)+@{penalty}]]}} {{easy_crit=[[ceil(((@{total}*1.5)+@{penalty})/10)]]}} {{easy_fumble=[[ceil((@{total}*1.5)+@{penalty})]]}} {{standard=[[@{total}+@{augmentation}+@{penalty}]]}} {{standard_crit=[[ceil((@{total}+@{penalty})/10)]]}} {{standard_fumble=[[(@{total}+@{penalty})]]}} {{hard=[[ceil((@{total}+@{augmentation})*.67)+@{penalty}]]}} {{hard_crit=[[ceil(((@{total}*.67)+@{penalty})/10)]]}} {{hard_fumble=[[ceil((@{total}*.67)+@{penalty})]]}} {{formidable=[[ceil((@{total}+@{augmentation})*.5)+@{penalty}]]}} {{formidable_crit=[[ceil(((@{total}*.5)+@{penalty})/10)]]}} {{formidable_fumble=[[ceil((@{total}*.5)+@{penalty})]]}} {{herculean=[[ceil((@{total}+@{augmentation})*@{herculean_mod})+@{penalty}]]}} {{herculean_crit=[[ceil(((@{total}*@{herculean_mod})+@{penalty})/10)]]}} {{herculean_fumble=[[ceil((@{total}*@{herculean_mod})+@{penalty})]]}} {{notes=@{notes}}}">t</button>
                            </div>
                            <div class="sheet-td"><input type="number" class="sheet-number-width sheet-impval" title="@{$ID_total}" name="attr_total" value="0" step="1"  min="0"></div>
                            <div class="sheet-td"><input type="checkbox" title="@{$ID_details}" name="attr_details" value="1"><span class="sheet-checkico">y</span></div>
                        </div>
                        <input type="hidden" class="sheet-wide-toggle" name="attr_details" value="0">
                        <div class="sheet-anti-toggle">
                            <span class="sheet-details-toggle" name="attr_notes"></span>
                        </div>
                        <div class="sheet-toggle">
                            <div class="sheet-flex sheet-flex-wrap sheet-gap">
                                <button type="roll" title="%{$ID_improve}" name="roll_improve" value="@{roll_display}&{template:improvement} {{name=@{name}}} {{character=@{character_name}}} {{roll=[[1d100+@{int}]]}} {{improvement=[[1d4+1]]}} {{skill=[[@{total}]]}}" data-i18n="improve">Improve</button>
                                <button type="roll" title="%{$ID_waxorwane}" name="roll_waxorwane" value="@{roll_display}&{template:default} {{improvestyle=1}} {{name=@{name}}} {{character=@{character_name}}} {{^{weak}=+/-[[1d10]]%}} {{^{moderate}=+/-[[1d10+5]]%}} {{^{strong}=+/-[[1d10+10]]%}}" data-i18n="wax_or_wane">Wax or Wane</button>
                                <button type="action" class="sheet-social-conflict" name="act_set-social-offense" data-i18n="set_social_offense">Set Social Offense</button>
                                <button type="action" class="sheet-social-conflict" name="act_set-social-defense" data-i18n="set_social_defense">Set Social Defense</button>
                                <button type="action" class="sheet-spirits" name="act_set-spirit-combat" data-i18n="set_spirit_combat">Set Spirit Combat</button>
                                <div class="sheet-grow sheet-flex">
                                    <div><label class="sheet-left sheet-rmargin" data-i18n="tags">Tags</label></div>
                                    <div class="sheet-grow"><input type="text" class="sheet-full-width" title="@{$ID_tags}" name="attr_tags"></div>
                                </div>
                            </div>
                            <textarea class="sheet-skill-notes" title="@{$ID_notes}" name="attr_notes"></textarea>
                        </div>
                    </fieldset>
                </div>

                <!-- Dependencies -->
                <input type="hidden" class="sheet-toggle" name="attr_dependencies_enabled" value="0">
                <div class="sheet-toggle">
                    <div class="sheet-flex">
                        <div class="sheet-th sheet-grow"><div class="sheet-full-width" data-i18n="dependency">Dependency</div></div>
                        <div class="sheet-th"><div class="sheet-checkbox-width"></div></div>
                        <div class="sheet-th"><div class="sheet-button-width"></div></div>
                        <div class="sheet-th"><div class="sheet-help sheet-pictos sheet-checkbox-width" data-i18n-title="increased_for_xp">3</div></div>
                        <div class="sheet-th"><div class="sheet-number-width">%</div></div>
                        <div class="sheet-th"><div class="sheet-help sheet-pictos sheet-checkbox-width" data-i18n-title="configuration">y</div></div>
                    </div>
                    <fieldset class="repeating_dependency">
                        <div class="sheet-flex">
                            <div class="sheet-td sheet-grow">
                                <div class="sheet-full-width sheet-hover-btn">
                                    <input type="text" class="sheet-full-width sheet-text-left" name="attr_name">
                                    <button type="roll" class="sheet-hover sheet-id" title="%{$ID_id}" name="roll_id" value="/w gm &{template:default} {{name=@{name}}} {{^{id}=@{id}}}">i</button>
                                    <input type="hidden" name="attr_id" value="unset">
                                </div>
                            </div>
                            <div class="sheet-td"><button type="action" class="sheet-pictos" data-i18n-title="set_augmentation" name="act_augment">&</button></div>
                            <div class="sheet-td">
                                <button type="roll" class="sheet-die sheet-d10 sheet-button-width" title="%{$ID_passion}" name="roll_dependency" value="@{roll_display}&{template:skill} {{character=@{character_name}}} {{name=@{name}}} {{roll=[[1d100]]}} {{fatigue_skills=[[0]]}} {{encumbered=[[0]]}} {{original=@{total}}} {{difficulty=[[@{difficulty}]]}} {{augmentation=[[@{augmentation}]]}} {{penalty=[[@{penalty}]]}} {{very_easy=[[((@{total}+@{augmentation})*2)+@{penalty}]]}} {{very_easy_crit=[[ceil(((@{total}*2)+@{penalty})/10)]]}} {{very_easy_fumble=[[((@{total}*2)+@{penalty})]]}} {{easy=[[ceil((@{total}+@{augmentation})*1.5)+@{penalty}]]}} {{easy_crit=[[ceil(((@{total}*1.5)+@{penalty})/10)]]}} {{easy_fumble=[[ceil((@{total}*1.5)+@{penalty})]]}} {{standard=[[@{total}+@{augmentation}+@{penalty}]]}} {{standard_crit=[[ceil((@{total}+@{penalty})/10)]]}} {{standard_fumble=[[(@{total}+@{penalty})]]}} {{hard=[[ceil((@{total}+@{augmentation})*.67)+@{penalty}]]}} {{hard_crit=[[ceil(((@{total}*.67)+@{penalty})/10)]]}} {{hard_fumble=[[ceil((@{total}*.67)+@{penalty})]]}} {{formidable=[[ceil((@{total}+@{augmentation})*.5)+@{penalty}]]}} {{formidable_crit=[[ceil(((@{total}*.5)+@{penalty})/10)]]}} {{formidable_fumble=[[ceil((@{total}*.5)+@{penalty})]]}} {{herculean=[[ceil((@{total}+@{augmentation})*@{herculean_mod})+@{penalty}]]}} {{herculean_crit=[[ceil(((@{total}*@{herculean_mod})+@{penalty})/10)]]}} {{herculean_fumble=[[ceil((@{total}*@{herculean_mod})+@{penalty})]]}} {{notes=@{notes}}}">t</button>
                            </div>
                            <div class="sheet-td"><input type="checkbox" title="@{$ID_trained}" name="attr_trained" value="1"><span class="sheet-checkico">3</span></div>
                            <div class="sheet-td"><input type="number" class="sheet-number-width sheet-impval" title="@{$ID_total}" name="attr_total" value="0" step="1"  min="0"></div>
                            <div class="sheet-td"><input type="checkbox" title="@{$ID_details}" name="attr_details" value="1"><span class="sheet-checkico">y</span></div>
                        </div>
                        <input type="hidden" class="sheet-wide-toggle" name="attr_details" value="0">
                        <div class="sheet-anti-toggle">
                            <span class="sheet-details-toggle" name="attr_notes"></span>
                        </div>
                        <div class="sheet-toggle">
                            <div class="sheet-flex sheet-flex-wrap sheet-gap">
                                <button type="roll" title="%{$ID_improve}" name="roll_improve" value="@{roll_display}&{template:improvement} {{name=@{name}}} {{character=@{character_name}}} {{roll=[[1d100+@{int}]]}} {{improvement=[[1d4+1]]}} {{skill=[[@{total}]]}}" data-i18n="improve">Improve</button>
                            </div>
                            <textarea class="sheet-skill-notes" title="@{$ID_notes}" name="attr_notes"></textarea>
                        </div>
                    </fieldset>
                    <input type="hidden" name="attr_tenacity_dependencies" value="0">
                </div>

                <!-- Peculiarities -->
                <div class="sheet-setting-option sheet-os">
                    <div class="sheet-flex">
                        <div class="sheet-th sheet-grow"><div class="sheet-full-width" data-i18n="peculiarities">Peculiarities</div></div>
                        <div class="sheet-th"><div class="sheet-checkbox-width"></div></div>
                        <div class="sheet-th"><div class="sheet-button-width"></div></div>
                        <div class="sheet-th"><div class="sheet-number-width">%</div></div>
                        <div class="sheet-th"><div class="sheet-help sheet-pictos sheet-checkbox-width" data-i18n-title="configuration">y</div></div>
                    </div>
                    <fieldset class="repeating_peculiarity">
                        <div class="sheet-flex">
                            <div class="sheet-td sheet-grow">
                                <div class="sheet-full-width sheet-hover-btn">
                                    <input type="text" class="sheet-full-width sheet-text-left" name="attr_name">
                                    <button type="roll" class="sheet-hover sheet-id" title="%{$ID_id}" name="roll_id" value="/w gm &{template:default} {{name=@{name}}} {{^{id}=@{id}}}">i</button>
                                    <input type="hidden" name="attr_id" value="unset">
                                </div>
                            </div>
                            <div class="sheet-td"><button type="action" class="sheet-pictos" data-i18n-title="set_augmentation" name="act_augment">&</button></div>
                            <div class="sheet-td">
                                <button type="roll" class="sheet-die sheet-d10 sheet-button-width" title="%{$ID_passion}" name="roll_peculiarity" value="@{roll_display}&{template:skill} {{character=@{character_name}}} {{name=@{name}}} {{roll=[[1d100]]}} {{fatigue_skills=[[0]]}} {{encumbered=[[0]]}} {{original=@{total}}} {{difficulty=[[@{difficulty}]]}} {{augmentation=[[@{augmentation}]]}} {{penalty=[[@{penalty}]]}} {{very_easy=[[((@{total}+@{augmentation})*2)+@{penalty}]]}} {{very_easy_crit=[[ceil(((@{total}*2)+@{penalty})/10)]]}} {{very_easy_fumble=[[((@{total}*2)+@{penalty})]]}} {{easy=[[ceil((@{total}+@{augmentation})*1.5)+@{penalty}]]}} {{easy_crit=[[ceil(((@{total}*1.5)+@{penalty})/10)]]}} {{easy_fumble=[[ceil((@{total}*1.5)+@{penalty})]]}} {{standard=[[@{total}+@{augmentation}+@{penalty}]]}} {{standard_crit=[[ceil((@{total}+@{penalty})/10)]]}} {{standard_fumble=[[(@{total}+@{penalty})]]}} {{hard=[[ceil((@{total}+@{augmentation})*.67)+@{penalty}]]}} {{hard_crit=[[ceil(((@{total}*.67)+@{penalty})/10)]]}} {{hard_fumble=[[ceil((@{total}*.67)+@{penalty})]]}} {{formidable=[[ceil((@{total}+@{augmentation})*.5)+@{penalty}]]}} {{formidable_crit=[[ceil(((@{total}*.5)+@{penalty})/10)]]}} {{formidable_fumble=[[ceil((@{total}*.5)+@{penalty})]]}} {{herculean=[[ceil((@{total}+@{augmentation})*@{herculean_mod})+@{penalty}]]}} {{herculean_crit=[[ceil(((@{total}*@{herculean_mod})+@{penalty})/10)]]}} {{herculean_fumble=[[ceil((@{total}*@{herculean_mod})+@{penalty})]]}} {{notes=@{notes}}}">t</button>
                            </div>
                            <div class="sheet-td"><input type="number" class="sheet-number-width sheet-impval" title="@{$ID_total}" name="attr_total" value="0" step="1"  min="0"></div>
                            <div class="sheet-td"><input type="checkbox" title="@{$ID_details}" name="attr_details" value="1"><span class="sheet-checkico">y</span></div>
                        </div>
                        <input type="hidden" class="sheet-wide-toggle" name="attr_details" value="0">
                        <div class="sheet-anti-toggle">
                            <span class="sheet-details-toggle" name="attr_notes"></span>
                        </div>
                        <div class="sheet-toggle">
                            <textarea class="sheet-skill-notes" title="@{$ID_notes}" name="attr_notes"></textarea>
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>
    </div>

    <!-- Weapons -->
    <div id="weapons" class="sheet-section sheet-anchor-adjust-x2 sheet-creature">
        <h2 data-i18n="weapons">Weapons</h2>

        <!-- TODO replace with tagging -->
        <input type="hidden" name="attr_weapon_buttons" value="">

        <!-- Melee Weapons -->
        <div class="sheet-bmargin">
            <input type='hidden' class="sheet-deep-toggle" name='attr_reach_enabled' value="1">
            <div class="sheet-flex">
                <div class="sheet-th"><div class="sheet-checkbox-width"><span class="sheet-pictos sheet-help" data-i18n-title="include_in_combat_rolls">S</span></div></div>
                <div class="sheet-th"><div class="sheet-weapon-name" data-i18n="melee_weapon">Melee Weapon</div></div>
                <div class="sheet-th"><div class="sheet-button-width"></div></div>
                <div class="sheet-th"><div class="sheet-weapon-damage" data-i18n="damage">Damage</div></div>
                <div class="sheet-th"><div class="sheet-checkbox-width sheet-pictos sheet-help" data-i18n-title="damage_modifier">+</div></div>
                <div class="sheet-th"><div class="sheet-weapon-size" data-i18n="size">Size</div></div>
                <div class="sheet-th"><div class="sheet-toggle sheet-weapon-reach" data-i18n="reach">Reach</div></div>
                <div class="sheet-th sheet-grow" data-i18n="notes">Notes</div>
                <div class="sheet-th"><div class="sheet-number-width-sm sheet-help" data-i18n-title="armor_points" data-i18n="armor_points-a">AP</div></div>
                <div class="sheet-th"><div class="sheet-number-width sheet-help" data-i18n-title="hit_points" data-i18n="hit_points-a">HP</div></div>
                <div class="sheet-th sheet-major"><div class="sheet-number-width-sm" data-i18n="enc">ENC</div></div>
                <div class="sheet-th sheet-major"><div class="sheet-equipment-location" data-i18n="location">Location</div></div>
            </div>
            <fieldset class="repeating_meleeweapon">
                <div class="sheet-flex">
                    <div class="sheet-td"><input type="checkbox" title="@{$ID_favored}" name="attr_favored" value="1"><span class="sheet-checkico">S</span></div>
                    <div class="sheet-td sheet-hover-btn">
                        <input type="text" class="sheet-weapon-name sheet-text-left" title="@{$ID_name}" name="attr_name">
                        <button type="roll" class="sheet-hover sheet-id" title="%{$ID_id}" name="roll_id" value="/w gm &{template:default} {{character=@{character_name}}} {{name=@{name}}} {{^{id}=@{id}}}">i</button>
                        <input type="hidden" name="attr_id" value="unset, please change any value in this weapon" readonly>
                    </div>
                    <div class="sheet-td"><button type="roll" class="sheet-die sheet-d8" title="%{$ID_damage}" name="roll_damage" value="@{roll_display}&{template:weapon} {{name=@{name}}} {{character=@{character_name}}} {{damage=[[@{damage}+@{damage_mod_toggle}]]}} {{size=@{size}}} {{reach=@{reach}}} {{notes=@{notes}}}">h</button></div>
                    <div class="sheet-td"><input type="text" class="sheet-weapon-damage" title="@{$ID_damage}" name="attr_damage"></div>
                    <div class="sheet-td"><input type="checkbox" name="attr_damage_mod_toggle" title="@{$ID_damage_mod_toggle}" value="@{damage_mod}" checked><span class="sheet-checkico">+</span></div>
                    <div class="sheet-td"><input type="text" class="sheet-weapon-size" title="@{$ID_size}" name="attr_size"></div>
                    <div class="sheet-td sheet-toggle"><input type="text" class="sheet-weapon-reach" title="@{$ID_reach}" name="attr_reach"></div>
                    <div class="sheet-td sheet-grow"><input type="text" class="sheet-full-width" title="@{$ID_notes}" name="attr_notes"></div>
                    <div class="sheet-td"><input type="number" class="sheet-number-width-sm" title="@{$ID_ap}" name="attr_ap" step="1" min="0" value="0"></div>
                    <div class="sheet-td">
                        <div class="sheet-number-width sheet-text-center">
                            <input type="number" class="sheet-number-width-xs" title="@{$ID_hp}" name="attr_hp" step="1" min="0" value="0">/<input type="number" class="sheet-number-width-xs" title="@{$ID_hp|max}" name="attr_hp_max" step="1" min="0" value="0">
                        </div>
                    </div>
                    <div class="sheet-td sheet-major"><input type="number" class="sheet-number-width-sm" title="@{$ID_enc}" name="attr_enc" step="1" min="0" value="0"></div>
                    <div class="sheet-td sheet-major">
                        <select class="sheet-equipment-location sheet-text-center" title="@{$ID_location}" name="attr_location">
                            <option value="loadout" data-i18n="worn" selected>Worn</option>
                            <option value="pack" data-i18n="pack">Pack</option>
                            <option value="mount" data-i18n="transport">Transport</option>
                            <option value="camp" data-i18n="camp">Camp</option>
                            <option value="stash" data-i18n="stash">Stash</option>
                            <option value="homebase" data-i18n="homebase">Homebase</option>
                        </select>
                    </div>
                </div>
            </fieldset>
        </div>

        <!-- Ranged Weapons -->
        <div>
            <div class="sheet-flex">
                <div class="sheet-th"><div class="sheet-checkbox-width"><span class="sheet-pictos sheet-help" data-i18n-title="include_in_combat_rolls">S</span></div></div>
                <div class="sheet-th"><div class="sheet-weapon-name" data-i18n="ranged_weapon">Ranged Weapon</div></div>
                <div class="sheet-th"><div class="sheet-button-width"></div></div>
                <div class="sheet-th"><div class="sheet-weapon-damage" data-i18n="damage">Damage</div></div>
                <div class="sheet-th"><div class="sheet-checkbox-width sheet-pictos sheet-help" data-i18n-title="damage_modifier">+</div></div>
                <div class="sheet-th"><div class="sheet-weapon-size" data-i18n="force">Force</div></div>
                <div class="sheet-th"><div class="sheet-weapon-reach" data-i18n="range">Range</div></div>
                <div class="sheet-th"><div class="sheet-number-width-xs" data-i18n-title="impale_size" data-i18n="impale_size-a">IS</div></div>
                <div class="sheet-th"><div class="sheet-number-width sheet-help" data-i18n-title="ammunition" data-i18n="ammunition-a">Ammo</div></div>
                <div class="sheet-th"><div class="sheet-number-width" data-i18n="load">Load</div></div>
                <div class="sheet-th sheet-grow" data-i18n="notes">Notes</div>
                <div class="sheet-th"><div class="sheet-number-width-sm sheet-help" data-i18n-title="armor_points" data-i18n="armor_points-a">AP</div></div>
                <div class="sheet-th"><div class="sheet-number-width sheet-help" data-i18n-title="hit_points" data-i18n="hit_points-a">HP</div></div>
                <div class="sheet-th sheet-major"><div class="sheet-number-width-sm" data-i18n="enc">ENC</div></div>
                <div class="sheet-th sheet-major"><div class="sheet-equipment-location" data-i18n="location">Location</div></div>
            </div>
            <fieldset class="repeating_rangedweapon">
                <div class="sheet-flex">
                    <div class="sheet-td"><input type="checkbox" title="@{$ID_favored}" name="attr_favored" value="1"><span class="sheet-checkico">S</span></div>
                    <div class="sheet-td sheet-hover-btn">
                        <input type="text" class="sheet-weapon-name sheet-text-left" title="@{$ID_name}" name="attr_name">
                        <button type="roll" class="sheet-hover sheet-id" title="%{$ID_id}" name="roll_id" value="/w gm &{template:default} {{character=@{character_name}}} {{name=@{name}}} {{^{id}=@{id}}}">i</button>
                        <input type="hidden" name="attr_id" value="unset, please change any value in this weapon" readonly>
                    </div>
                    <div class="sheet-td"><button type="roll" class="sheet-die sheet-d8" title="%{$ID_damage}" name="roll_damage" value="@{roll_display}&{template:weapon} {{name=@{name}}} {{character=@{character_name}}} {{damage=[[@{damage}+@{damage_mod_toggle}]]}} {{force=@{force}}} {{range=@{range}}} {{impale_size=@{impale_size}}} {{notes=@{notes}}}">h</button></div>
                    <div class="sheet-td"><input type="text" class="sheet-weapon-damage" title="@{$ID_damage}" name="attr_damage"></div>
                    <div class="sheet-td"><input type="checkbox" name="attr_damage_mod_toggle" title="@{$ID_damage_mod_toggle}" value="@{damage_mod}"><span class="sheet-checkico">+</span></div>
                    <div class="sheet-td"><input type="text" class="sheet-weapon-size" title="@{$ID_force}" name="attr_force"></div>
                    <div class="sheet-td"><input type="text" class="sheet-weapon-reach" title="@{$ID_range}" name="attr_range"></div>
                    <div class="sheet-td"><input type="text" class="sheet-number-width-xs" title="@{$ID_impale_size}" name="attr_impale_size"></div>
                    <div class="sheet-td">
                        <div class="sheet-number-width sheet-text-center">
                            <input type="number" class="sheet-number-width-xs" title="@{$ID_ammo}" name="attr_ammo" step="1" min="0" value="0">/<input type="number" class="sheet-number-width-xs" title="@{$ID_ammo|max}" name="attr_ammo_max" step="1" min="0" value="0">
                        </div>
                    </div>
                    <div class="sheet-td"><input type="text" class="sheet-number-width" title="@{$ID_load}" name="attr_load"></div>
                    <div class="sheet-td sheet-grow"><input type="text" class="sheet-full-width" title="@{$ID_notes}" name="attr_notes"></div>
                    <div class="sheet-td"><input type="number" class="sheet-number-width-sm" title="@{$ID_ap}" name="attr_ap" step="1" min="0" value="0"></div>
                    <div class="sheet-td">
                        <div class="sheet-number-width sheet-text-center">
                            <input type="number" class="sheet-number-width-xs" title="@{$ID_hp}" name="attr_hp" step="1" min="0" value="0">/<input type="number" class="sheet-number-width-xs" title="@{$ID_hp|max}" name="attr_hp_max" step="1" min="0" value="0">
                        </div>
                    </div>
                    <div class="sheet-td sheet-major"><input type="number" class="sheet-number-width-sm" title="@{$ID_enc}" name="attr_enc" step="1" min="0" value="0"></div>
                    <div class="sheet-td sheet-major">
                        <select class="sheet-equipment-location sheet-text-center" title="@{$ID_location}" name="attr_location">
                            <option value="loadout" data-i18n="worn" selected>Worn</option>
                            <option value="pack" data-i18n="pack">Pack</option>
                            <option value="mount" data-i18n="transport">Transport</option>
                            <option value="camp" data-i18n="camp">Camp</option>
                            <option value="stash" data-i18n="stash">Stash</option>
                            <option value="homebase" data-i18n="homebase">Homebase</option>
                        </select>
                    </div>
                </div>
            </fieldset>
        </div>
    </div>

    <!-- Armor -->
    <div id="armor" class="sheet-section sheet-anchor-adjust-x2 sheet-creature">
        <div class="sheet-flex">
            <div class="sheet-grow"><h2 data-i18n="armor">Armor</h2></div>
            <div>
                <label class="sheet-left sheet-rmargin" data-i18n="worn_armor_enc">Worn Armor ENC</label>
                <select class="sheet-auto-width sheet-rmargin" name="attr_half_effective_armor_enc">
                    <option value="0" selected>1/2</option>
                    <option value="1">1/4</option>
                </select>
                <label class="sheet-left sheet-rmargin" data-i18n="armor_penalty">Armor Penalty</label>
                <input type="number" class="sheet-number-width-sm" title="@{armor_penalty}" name="attr_armor_penalty" value="0" readonly>
            </div>
        </div>

        <div class="sheet-table">
            <div class="sheet-tr">
                <div class="sheet-th" data-i18n="hit_location">Hit Location</div>
                <div class="sheet-th" data-i18n="type">Type</div>
                <div class="sheet-th sheet-help" data-i18n-title="armor_points" data-i18n="ap">AP</div>
                <div class="sheet-th" data-i18n="enc">ENC</div>
                <div class="sheet-th sheet-full-width" data-i18n="notes">Notes</div>
                <div class="sheet-th" data-i18n="location">Location</div>
            </div>
            <div class="sheet-tr">
                <div class="sheet-td sheet-text-center"><span name="attr_location1_name"></span></div>
                <div class="sheet-td"><input type="text" class="sheet-text-center" title="@{location1_armor_type}" name="attr_location1_armor_type" value=""></div>
                <div class="sheet-td">
                    <div class="sheet-impval sheet-number-width sheet-flex">
                        <input type="number" class="sheet-lval" title="@{location1_ap}" name="attr_location1_ap" value="0">/<input type="number" class="sheet-rval" title="@{location1_ap|max}" name="attr_location1_ap_max" value="0">
                    </div>
                </div>
                <div class="sheet-td"><input type="number" class="sheet-number-width-sm" title="@{location1_armor_enc}" step="any" name="attr_location1_armor_enc" min="0" value="0"></div>
                <div class="sheet-td sheet-full-width"><input type="text" class="sheet-text-center sheet-full-width" title="@{location1_armor_notes}" name="attr_location1_armor_notes"></div>
                <div class="sheet-td">
                    <select class="sheet-text-center sheet-auto-width" title="@{location1_armor_equipped}" name="attr_location1_armor_equipped">
                        <option value="1" data-i18n="worn" selected>Worn</option>
                        <option value="0" data-i18n="pack">Pack</option>
                        <option value="mount" data-i18n="transport">Transport</option>
                        <option value="camp" data-i18n="camp">Camp</option>
                        <option value="stash" data-i18n="stash">Stash</option>
                        <option value="homebase" data-i18n="homebase">Homebase</option>
                    </select>
                </div>
            </div>
            <input type="hidden" class="sheet-toggle" name="attr_location2to7_display" value="1">
            <div class="sheet-tr sheet-toggle">
                <div class="sheet-td sheet-text-center"><span name="attr_location2_name"></span></div>
                <div class="sheet-td"><input type="text" class="sheet-text-center" title="@{location2_armor_type}" name="attr_location2_armor_type" value=""></div>
                <div class="sheet-td">
                    <div class="sheet-impval sheet-number-width sheet-flex">
                        <input type="number" class="sheet-lval" title="@{location2_ap}" name="attr_location2_ap" value="0">/<input type="number" class="sheet-rval" title="@{location2_ap|max}" name="attr_location2_ap_max" value="0">
                    </div>
                </div>
                <div class="sheet-td"><input type="number" class="sheet-number-width-sm" title="@{location2_armor_enc}" step="any" name="attr_location2_armor_enc" min="0" value="0"></div>
                <div class="sheet-td sheet-full-width"><input type="text" class="sheet-text-center sheet-full-width" title="@{location2_armor_notes}" name="attr_location2_armor_notes"></div>
                <div class="sheet-td">
                    <select class="sheet-text-center sheet-auto-width" title="@{location2_armor_equipped}" name="attr_location2_armor_equipped">
                        <option value="1" data-i18n="worn" selected>Worn</option>
                        <option value="0" data-i18n="pack">Pack</option>
                        <option value="mount" data-i18n="transport">Transport</option>
                        <option value="camp" data-i18n="camp">Camp</option>
                        <option value="stash" data-i18n="stash">Stash</option>
                        <option value="homebase" data-i18n="homebase">Homebase</option>
                    </select>
                </div>
            </div>
            <input type="hidden" class="sheet-toggle" name="attr_location2to7_display" value="1">
            <div class="sheet-tr sheet-toggle">
                <div class="sheet-td sheet-text-center"><span name="attr_location3_name"></span></div>
                <div class="sheet-td"><input type="text" class="sheet-text-center" title="@{location3_armor_type}" name="attr_location3_armor_type" value=""></div>
                <div class="sheet-td">
                    <div class="sheet-impval sheet-number-width sheet-flex">
                        <input type="number" class="sheet-lval" title="@{location3_ap}" name="attr_location3_ap" value="0">/<input type="number" class="sheet-rval" title="@{location3_ap|max}" name="attr_location3_ap_max" value="0">
                    </div>
                </div>
                <div class="sheet-td"><input type="number" class="sheet-number-width-sm" title="@{location3_armor_enc}" step="any" name="attr_location3_armor_enc" min="0" value="0"></div>
                <div class="sheet-td sheet-full-width"><input type="text" class="sheet-text-center sheet-full-width" title="@{location3_armor_notes}" name="attr_location3_armor_notes"></div>
                <div class="sheet-td">
                    <select class="sheet-text-center sheet-auto-width" title="@{location3_armor_equipped}" name="attr_location3_armor_equipped">
                        <option value="1" data-i18n="worn" selected>Worn</option>
                        <option value="0" data-i18n="pack">Pack</option>
                        <option value="mount" data-i18n="transport">Transport</option>
                        <option value="camp" data-i18n="camp">Camp</option>
                        <option value="stash" data-i18n="stash">Stash</option>
                        <option value="homebase" data-i18n="homebase">Homebase</option>
                    </select>
                </div>
            </div>
            <input type="hidden" class="sheet-toggle" name="attr_location2to7_display" value="1">
            <div class="sheet-tr sheet-toggle">
                <div class="sheet-td sheet-text-center"><span name="attr_location4_name"></span></div>
                <div class="sheet-td"><input type="text" class="sheet-text-center" title="@{location4_armor_type}" name="attr_location4_armor_type" value=""></div>
                <div class="sheet-td">
                    <div class="sheet-impval sheet-number-width sheet-flex">
                        <input type="number" class="sheet-lval" title="@{location4_ap}" name="attr_location4_ap" value="0">/<input type="number" class="sheet-rval" title="@{location4_ap|max}" name="attr_location4_ap_max" value="0">
                    </div>
                </div>
                <div class="sheet-td"><input type="number" class="sheet-number-width-sm" title="@{location4_armor_enc}" step="any" name="attr_location4_armor_enc" min="0" value="0"></div>
                <div class="sheet-td sheet-full-width"><input type="text" class="sheet-text-center sheet-full-width" title="@{location4_armor_notes}" name="attr_location4_armor_notes"></div>
                <div class="sheet-td">
                    <select class="sheet-text-center sheet-auto-width" title="@{location4_armor_equipped}" name="attr_location4_armor_equipped">
                        <option value="1" data-i18n="worn" selected>Worn</option>
                        <option value="0" data-i18n="pack">Pack</option>
                        <option value="mount" data-i18n="transport">Transport</option>
                        <option value="camp" data-i18n="camp">Camp</option>
                        <option value="stash" data-i18n="stash">Stash</option>
                        <option value="homebase" data-i18n="homebase">Homebase</option>
                    </select>
                </div>
            </div>
            <input type="hidden" class="sheet-toggle" name="attr_location2to7_display" value="1">
            <div class="sheet-tr sheet-toggle">
                <div class="sheet-td sheet-text-center"><span name="attr_location5_name"></span></div>
                <div class="sheet-td"><input type="text" class="sheet-text-center" title="@{location5_armor_type}" name="attr_location5_armor_type" value=""></div>
                <div class="sheet-td">
                    <div class="sheet-impval sheet-number-width sheet-flex">
                        <input type="number" class="sheet-lval" title="@{location5_ap}" name="attr_location5_ap" value="0">/<input type="number" class="sheet-rval" title="@{location5_ap|max}" name="attr_location5_ap_max" value="0">
                    </div>
                </div>
                <div class="sheet-td"><input type="number" class="sheet-number-width-sm" title="@{location5_armor_enc}" step="any" name="attr_location5_armor_enc" min="0" value="0"></div>
                <div class="sheet-td sheet-full-width"><input type="text" class="sheet-text-center sheet-full-width" title="@{location5_armor_notes}" name="attr_location5_armor_notes"></div>
                <div class="sheet-td">
                    <select class="sheet-text-center sheet-auto-width" title="@{location5_armor_equipped}" name="attr_location5_armor_equipped">
                        <option value="1" data-i18n="worn" selected>Worn</option>
                        <option value="0" data-i18n="pack">Pack</option>
                        <option value="mount" data-i18n="transport">Transport</option>
                        <option value="camp" data-i18n="camp">Camp</option>
                        <option value="stash" data-i18n="stash">Stash</option>
                        <option value="homebase" data-i18n="homebase">Homebase</option>
                    </select>
                </div>
            </div>
            <input type="hidden" class="sheet-toggle" name="attr_location2to7_display" value="1">
            <div class="sheet-tr sheet-toggle">
                <div class="sheet-td sheet-text-center"><span name="attr_location6_name"></span></div>
                <div class="sheet-td"><input type="text" class="sheet-text-center" title="@{location6_armor_type}" name="attr_location6_armor_type" value=""></div>
                <div class="sheet-td">
                    <div class="sheet-impval sheet-number-width sheet-flex">
                        <input type="number" class="sheet-lval" title="@{location6_ap}" name="attr_location6_ap" value="0">/<input type="number" class="sheet-rval" title="@{location6_ap|max}" name="attr_location6_ap_max" value="0">
                    </div>
                </div>
                <div class="sheet-td"><input type="number" class="sheet-number-width-sm" title="@{location6_armor_enc}" step="any" name="attr_location6_armor_enc" min="0" value="0"></div>
                <div class="sheet-td sheet-full-width"><input type="text" class="sheet-text-center sheet-full-width" title="@{location6_armor_notes}" name="attr_location6_armor_notes"></div>
                <div class="sheet-td">
                    <select class="sheet-text-center sheet-auto-width" title="@{location6_armor_equipped}" name="attr_location6_armor_equipped">
                        <option value="1" data-i18n="worn" selected>Worn</option>
                        <option value="0" data-i18n="pack">Pack</option>
                        <option value="mount" data-i18n="transport">Transport</option>
                        <option value="camp" data-i18n="camp">Camp</option>
                        <option value="stash" data-i18n="stash">Stash</option>
                        <option value="homebase" data-i18n="homebase">Homebase</option>
                    </select>
                </div>
            </div>
            <input type="hidden" class="sheet-toggle" name="attr_location2to7_display" value="1">
            <div class="sheet-tr sheet-toggle">
                <div class="sheet-td sheet-text-center"><span name="attr_location7_name"></span></div>
                <div class="sheet-td"><input type="text" class="sheet-text-center" title="@{location7_armor_type}" name="attr_location7_armor_type" value=""></div>
                <div class="sheet-td">
                    <div class="sheet-impval sheet-number-width sheet-flex">
                        <input type="number" class="sheet-lval" title="@{location7_ap}" name="attr_location7_ap" value="0">/<input type="number" class="sheet-rval" title="@{location7_ap|max}" name="attr_location7_ap_max" value="0">
                    </div>
                </div>
                <div class="sheet-td"><input type="number" class="sheet-number-width-sm" title="@{location7_armor_enc}" step="any" name="attr_location7_armor_enc" min="0" value="0"></div>
                <div class="sheet-td sheet-full-width"><input type="text" class="sheet-text-center sheet-full-width" title="@{location7_armor_notes}" name="attr_location7_armor_notes"></div>
                <div class="sheet-td">
                    <select class="sheet-text-center sheet-auto-width" title="@{location7_armor_equipped}" name="attr_location7_armor_equipped">
                        <option value="1" data-i18n="worn" selected>Worn</option>
                        <option value="0" data-i18n="pack">Pack</option>
                        <option value="mount" data-i18n="transport">Transport</option>
                        <option value="camp" data-i18n="camp">Camp</option>
                        <option value="stash" data-i18n="stash">Stash</option>
                        <option value="homebase" data-i18n="homebase">Homebase</option>
                    </select>
                </div>
            </div>
            <input type="hidden" class="sheet-toggle" name="attr_location8_display" value="0">
            <div class="sheet-tr sheet-toggle">
                <div class="sheet-td sheet-text-center"><span name="attr_location2_name"></span></div>
                <div class="sheet-td"><input type="text" class="sheet-text-center" title="@{location2_armor_type}" name="attr_location2_armor_type" value=""></div>
                <div class="sheet-td">
                    <div class="sheet-impval sheet-number-width sheet-flex">
                        <input type="number" class="sheet-lval" title="@{location2_ap}" name="attr_location2_ap" value="0">/<input type="number" class="sheet-rval" title="@{location2_ap|max}" name="attr_location2_ap_max" value="0">
                    </div>
                </div>
                <div class="sheet-td"><input type="number" class="sheet-number-width-sm" title="@{location2_armor_enc}" step="any" name="attr_location2_armor_enc" min="0" value="0"></div>
                <div class="sheet-td sheet-full-width"><input type="text" class="sheet-text-center sheet-full-width" title="@{location2_armor_notes}" name="attr_location2_armor_notes"></div>
                <div class="sheet-td">
                    <select class="sheet-text-center sheet-auto-width" title="@{location2_armor_equipped}" name="attr_location2_armor_equipped">
                        <option value="1" data-i18n="worn" selected>Worn</option>
                        <option value="0" data-i18n="pack">Pack</option>
                        <option value="mount" data-i18n="transport">Transport</option>
                        <option value="camp" data-i18n="camp">Camp</option>
                        <option value="stash" data-i18n="stash">Stash</option>
                        <option value="homebase" data-i18n="homebase">Homebase</option>
                    </select>
                </div>
            </div>
            <input type="hidden" class="sheet-toggle" name="attr_location9_display" value="0">
            <div class="sheet-tr sheet-toggle">
                <div class="sheet-td sheet-text-center"><span name="attr_location9_name"></span></div>
                <div class="sheet-td"><input type="text" class="sheet-text-center" title="@{location9_armor_type}" name="attr_location9_armor_type" value=""></div>
                <div class="sheet-td">
                    <div class="sheet-impval sheet-number-width sheet-flex">
                        <input type="number" class="sheet-lval" title="@{location9_ap}" name="attr_location9_ap" value="0">/<input type="number" class="sheet-rval" title="@{location9_ap|max}" name="attr_location9_ap_max" value="0">
                    </div>
                </div>
                <div class="sheet-td"><input type="number" class="sheet-number-width-sm" title="@{location9_armor_enc}" step="any" name="attr_location9_armor_enc" min="0" value="0"></div>
                <div class="sheet-td sheet-full-width"><input type="text" class="sheet-text-center sheet-full-width" title="@{location9_armor_notes}" name="attr_location9_armor_notes"></div>
                <div class="sheet-td">
                    <select class="sheet-text-center sheet-auto-width" title="@{location9_armor_equipped}" name="attr_location9_armor_equipped">
                        <option value="1" data-i18n="worn" selected>Worn</option>
                        <option value="0" data-i18n="pack">Pack</option>
                        <option value="mount" data-i18n="transport">Transport</option>
                        <option value="camp" data-i18n="camp">Camp</option>
                        <option value="stash" data-i18n="stash">Stash</option>
                        <option value="homebase" data-i18n="homebase">Homebase</option>
                    </select>
                </div>
            </div>
            <input type="hidden" class="sheet-toggle" name="attr_location10_display" value="0">
            <div class="sheet-tr sheet-toggle">
                <div class="sheet-td sheet-text-center"><span name="attr_location10_name"></span></div>
                <div class="sheet-td"><input type="text" class="sheet-text-center" title="@{location10_armor_type}" name="attr_location10_armor_type" value=""></div>
                <div class="sheet-td">
                    <div class="sheet-impval sheet-number-width sheet-flex">
                        <input type="number" class="sheet-lval" title="@{location10_ap}" name="attr_location10_ap" value="0">/<input type="number" class="sheet-rval" title="@{location10_ap|max}" name="attr_location10_ap_max" value="0">
                    </div>
                </div>
                <div class="sheet-td"><input type="number" class="sheet-number-width-sm" title="@{location10_armor_enc}" step="any" name="attr_location10_armor_enc" min="0" value="0"></div>
                <div class="sheet-td sheet-full-width"><input type="text" class="sheet-text-center sheet-full-width" title="@{location10_armor_notes}" name="attr_location10_armor_notes"></div>
                <div class="sheet-td">
                    <select class="sheet-text-center sheet-auto-width" title="@{location10_armor_equipped}" name="attr_location10_armor_equipped">
                        <option value="1" data-i18n="worn" selected>Worn</option>
                        <option value="0" data-i18n="pack">Pack</option>
                        <option value="mount" data-i18n="transport">Transport</option>
                        <option value="camp" data-i18n="camp">Camp</option>
                        <option value="stash" data-i18n="stash">Stash</option>
                        <option value="homebase" data-i18n="homebase">Homebase</option>
                    </select>
                </div>
            </div>
            <input type="hidden" class="sheet-toggle" name="attr_location11_display" value="0">
            <div class="sheet-tr sheet-toggle">
                <div class="sheet-td sheet-text-center"><span name="attr_location11_name"></span></div>
                <div class="sheet-td"><input type="text" class="sheet-text-center" title="@{location11_armor_type}" name="attr_location11_armor_type" value=""></div>
                <div class="sheet-td">
                    <div class="sheet-impval sheet-number-width sheet-flex">
                        <input type="number" class="sheet-lval" title="@{location11_ap}" name="attr_location11_ap" value="0">/<input type="number" class="sheet-rval" title="@{location11_ap|max}" name="attr_location11_ap_max" value="0">
                    </div>
                </div>
                <div class="sheet-td"><input type="number" class="sheet-number-width-sm" title="@{location11_armor_enc}" step="any" name="attr_location11_armor_enc" min="0" value="0"></div>
                <div class="sheet-td sheet-full-width"><input type="text" class="sheet-text-center sheet-full-width" title="@{location11_armor_notes}" name="attr_location11_armor_notes"></div>
                <div class="sheet-td">
                    <select class="sheet-text-center sheet-auto-width" title="@{location11_armor_equipped}" name="attr_location11_armor_equipped">
                        <option value="1" data-i18n="worn" selected>Worn</option>
                        <option value="0" data-i18n="pack">Pack</option>
                        <option value="mount" data-i18n="transport">Transport</option>
                        <option value="camp" data-i18n="camp">Camp</option>
                        <option value="stash" data-i18n="stash">Stash</option>
                        <option value="homebase" data-i18n="homebase">Homebase</option>
                    </select>
                </div>
            </div>
            <input type="hidden" class="sheet-toggle" name="attr_location12_display" value="0">
            <div class="sheet-tr sheet-toggle">
                <div class="sheet-td sheet-text-center"><span name="attr_location12_name"></span></div>
                <div class="sheet-td"><input type="text" class="sheet-text-center" title="@{location12_armor_type}" name="attr_location12_armor_type" value=""></div>
                <div class="sheet-td">
                    <div class="sheet-impval sheet-number-width sheet-flex">
                        <input type="number" class="sheet-lval" title="@{location12_ap}" name="attr_location12_ap" value="0">/<input type="number" class="sheet-rval" title="@{location12_ap|max}" name="attr_location12_ap_max" value="0">
                    </div>
                </div>
                <div class="sheet-td"><input type="number" class="sheet-number-width-sm" title="@{location12_armor_enc}" step="any" name="attr_location12_armor_enc" min="0" value="0"></div>
                <div class="sheet-td sheet-full-width"><input type="text" class="sheet-text-center sheet-full-width" title="@{location12_armor_notes}" name="attr_location12_armor_notes"></div>
                <div class="sheet-td">
                    <select class="sheet-text-center sheet-auto-width" title="@{location12_armor_equipped}" name="attr_location12_armor_equipped">
                        <option value="1" data-i18n="worn" selected>Worn</option>
                        <option value="0" data-i18n="pack">Pack</option>
                        <option value="mount" data-i18n="transport">Transport</option>
                        <option value="camp" data-i18n="camp">Camp</option>
                        <option value="stash" data-i18n="stash">Stash</option>
                        <option value="homebase" data-i18n="homebase">Homebase</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Gear, ENC & Wealth -->
    <div id="gear" class="sheet-flex sheet-gap sheet-anchor-adjust-x2 sheet-creature">
        <!-- Gear -->
        <div class="sheet-section sheet-half-width">
            <h2 data-i18n="gear">Gear</h2>

            <div class="sheet-flex">
                <div class="sheet-th sheet-grow"><span data-i18n="item">Item</span></div>
                <div class="sheet-th"><div class="sheet-button-width"></div></div>
                <div class="sheet-th"><div class="sheet-number-width" data-i18n="enc">ENC</div></div>
                <div class="sheet-th"><div class="sheet-number-width" data-i18n-title="quantity" title="Quantity">#</div></div>
                <div class="sheet-th"><div class="sheet-equipment-location" data-i18n="location">Location</div></div>
                <div class="sheet-th"><div class="sheet-checkbox-width sheet-pictos" data-i18n-title="details-tooltip">E</div></div>
            </div>
            <fieldset class="repeating_equipment">
                <div class="sheet-flex">
                    <div class="sheet-td sheet-grow sheet-hover-btn">
                        <input type="text" class="sheet-full-width sheet-usrinput sheet-text-left" title="@{$ID_name}" name="attr_name">
                        <button type="roll" class="sheet-hover sheet-id" title="%{$ID_id}" name="roll_id" value="/w gm &{template:default} {{character=@{character_name}}} {{name=@{name}}} {{^{id}=@{id}}}">i</button>
                        <input type="hidden" name="attr_id" value="unset, please change any value in this item" readonly>
                    </div>
                    <div class="sheet-td"><button type="roll" class="sheet-button-width sheet-die sheet-pictos" title="%{$ID_effect}" name="roll_effect" value="@{roll_display}&{template:effect} {{name=@{name}}} {{character=@{character_name}}} {{traits=@{traits}}} {{description=@{description}}}">e</button></div>
                    <div class="sheet-td"><input type="number" class="sheet-number-width" title="@{$ID_enc}" name="attr_enc" value="0" min="0" step="any"></div>
                    <div class="sheet-td"><input type="number" class="sheet-number-width" title="@{$ID_quantity}" name="attr_quantity" value="1" min="0" step="1"></div>
                    <div class="sheet-td">
                        <select class="sheet-equipment-location sheet-text-center" title="@{$ID_location}" name="attr_location">
                            <option value="loadout" data-i18n="worn" selected>Worn</option>
                            <option value="pack" data-i18n="pack">Pack</option>
                            <option value="mount" data-i18n="transport">Transport</option>
                            <option value="camp" data-i18n="camp">Camp</option>
                            <option value="stash" data-i18n="stash">Stash</option>
                            <option value="homebase" data-i18n="homebase">Homebase</option>
                        </select>
                    </div>
                    <div class="sheet-td"><input type="checkbox" title="@{$ID_details}" name="attr_details" value="1"><span class="sheet-checkico">E</span></div>
                </div>
                <input type="hidden" class="sheet-toggle" name="attr_details" value="0">
                <div class="sheet-toggle sheet-flex sheet-gap">
                    <div>
                        <div><label class="sheet-left" data-i18n="traits">Traits</label></div>
                        <textarea class="sheet-gear-note" name="attr_traits"></textarea>
                    </div>
                    <div class="sheet-grow">
                        <div><label class="sheet-left" data-i18n="description">Description</label></div>
                        <textarea class="sheet-gear-note" name="attr_description"></textarea>
                    </div>
                </div>
            </fieldset>
        </div>

        <!-- Wealth & ENC -->
        <div class="sheet-half-width">
            <!-- Wealth -->
            <div class="sheet-section sheet-full-width sheet-creature">
                <h2 data-i18n="wealth">Wealth</h2>

                <div class="sheet-bmargin">
                    <div class="sheet-flex sheet-full-width">
                        <div class="sheet-th sheet-grow"><span data-i18n="currency">Currency</span></div>
                        <div class="sheet-th"><div class="sheet-number-width" data-i18n="value">Value</div></div>
                        <div class="sheet-th"><div class="sheet-number-width" data-i18n="enc">ENC</div></div>
                        <div class="sheet-th"><div class="sheet-number-width" data-i18n-title="quantity">#</div></div>
                        <div class="sheet-th"><div class="sheet-equipment-location" data-i18n="location">Location</div></div>
                    </div>
                    <fieldset class="repeating_currency">
                        <div class="sheet-flex">
                            <div class="sheet-td sheet-grow sheet-hover-btn">
                                <input type="text" class="sheet-full-width sheet-text-left" title="@{$ID_name}" name="attr_name">
                                <button type="roll" class="sheet-hover sheet-id" title="%{$ID_id}" name="roll_id" value="/w gm &{template:default} {{character=@{character_name}}} {{name=@{name}}} {{^{id}=@{id}}}">i</button>
                                <input type="hidden" name="attr_id" value="unset, please change any value in this currency" readonly>
                            </div>
                            <div class="sheet-td"><input type="number" class="sheet-number-width" title="@{$ID_value}" name="attr_value" value="1"></div>
                            <div class="sheet-td"><input type="number" class="sheet-number-width" title="@{$ID_enc}" name="attr_enc" value="0" min="0" step=".01"></div>
                            <div class="sheet-td"><input type="number" class="sheet-number-width" title="@{$ID_quantity}" name="attr_quantity" value="1" min="0"></div>
                            <div class="sheet-td">
                                <select class="sheet-equipment-location" title="@{$ID_location}" name="attr_location">
                                    <option value="loadout" data-i18n="worn" selected>Worn</option>
                                    <option value="pack" data-i18n="pack">Pack</option>
                                    <option value="mount" data-i18n="transport">Transport</option>
                                    <option value="camp" data-i18n="camp">Camp</option>
                                    <option value="stash" data-i18n="stash">Stash</option>
                                    <option value="homebase" data-i18n="homebase">Homebase</option>
                                </select>
                            </div>
                        </div>
                    </fieldset>
                </div>

                <div class="sheet-table">
                    <div class="sheet-tr">
                        <div class="sheet-td sheet-text-left"><label class="sheet-left" data-i18n="income">Income</label></div>
                        <div class="sheet-td sheet-full-width"><input type="text" class="sheet-full-width sheet-text-left" title="@{income}" name="attr_income" value=""></div>
                    </div>
                    <div class="sheet-tr">
                        <div class="sheet-td sheet-text-left"><label class="sheet-left" data-i18n="expenses">Expenses</label></div>
                        <div class="sheet-td sheet-full-width"><input type="text" class="sheet-full-width sheet-text-left" title="@{expenses}" name="attr_expenses" value=""></div>
                    </div>
                </div>

                <label class="sheet-left" data-i18n="other">Other</label>
                <textarea class="sheet-wealth-notes" name="attr_wealth_other"></textarea>
            </div>

            <!-- ENC -->
            <div class="sheet-section sheet-full-width sheet-creature">
                <div class="sheet-space-between sheet-gap">
                    <div><h2 data-i18n="encumbrance">Encumbrance</h2></div>
                    <div><input type='checkbox' data-i18n-title="pack_equipped" name='attr_pack_equipped' value="1" checked><span class="sheet-checkico">O</span></div>
                    <div class="sheet-grow sheet-text-right">
                        <label class="sheet-left shet-rmargin" data-i18n="average_species_siz">Average Species SIZ</label>
                        <input type="number" class="sheet-number-width-sm sheet-text-center" data-i18n-title="@{avg_species_siz}" name="attr_avg_species_siz" value="13">
                    </div>
                </div>

                <div class="sheet-table">
                    <div class="sheet-tr">
                        <div class="sheet-th" data-i18n="temporary-a">Temp</div>
                        <div class="sheet-th" data-i18n="current">Current</div>
                        <div class="sheet-th" data-i18n="carrying_load">Carrying Load</div>
                        <div class="sheet-th" data-i18n="skills">Skills</div>
                        <div class="sheet-th" data-i18n="move">Move</div>
                    </div>
                    <div class="sheet-tr">
                        <div class="sheet-td"><input type="number" step="any" class="sheet-number-width" title="@{encumbrance_temp}" name="attr_encumbrance_temp" value="0"></div>
                        <div class="sheet-td"><input type="number" step="any" class="sheet-number-width sheet-value" title="@{encumbrance_current}" name="attr_encumbrance_current" value="0" readonly></div>
                        <div class="sheet-td">
                            <select class="sheet-full-width sheet-readonly sheet-text-center" title="@{encumbrance_load}" name="attr_encumbrance_load">
                                <option value="0" data-i18n="normal" selected>Normal</option>
                                <option value="1" data-i18n="medium">Medium</option>
                                <option value="2" data-i18n="strenuous">Strenuous</option>
                                <option value="3" data-i18n="impossible">Impossible</option>
                            </select>
                        </div>
                        <div class="sheet-td">
                            <select class="sheet-full-width sheet-readonly sheet-text-center" title="@{encumbrance_skills}" name="attr_encumbrance_skills">
                                <option value="0" data-i18n="standard" selected>Standard</option>
                                <option value="1" data-i18n="1_grade_harder">1 grade harder</option>
                                <option value="2" data-i18n="2_grades_harder">2 grades harder</option>
                                <option value="3" data-i18n="impossible">Impossible</option>
                            </select>
                        </div>
                        <div class="sheet-td">
                            <select class="sheet-full-width sheet-readonly sheet-text-center" title="@{movement_rate_enc}" name="attr_movement_rate_enc">
                                <option value="+0" data-i18n="normal">Normal</option>
                                <option value="-2">-2</option>
                                <option value="*.5" data-i18n="halved">Halved</option>
                                <option value="*0" data-i18n="impossible">Impossible</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Background -->
    <div id="character-background" class="sheet-section sheet-anchor-adjust-x2 sheet-major">
        <h2 data-i18n="background">Background</h2>

        <div class="sheet-flex sheet-gap sheet-bmargin">
            <div class="sheet-half-width">
                <label class="sheet-left" data-i18n="organizations">Organizations</label>
                <textarea class="sheet-background-notes" title="@{cults_notes}" name="attr_cults_notes"></textarea>
            </div>
            <div class="sheet-half-width">
                <label class="sheet-left" data-i18n="contacts">Contacts</label>
                <textarea class="sheet-background-notes" title="@{contacts_notes}" name="attr_contacts_notes"></textarea>
            </div>
        </div>

        <div class="sheet-flex sheet-gap sheet-bmargin">
            <div class="sheet-half-width">
                <label class="sheet-left" data-i18n="community">Community</label>
                <textarea class="sheet-background-notes" title="@{community_notes}" name="attr_community_notes"></textarea>
            </div>
            <div class="sheet-half-width">
                <label class="sheet-left" data-i18n="allies">Allies</label>
                <textarea class="sheet-background-notes" title="@{allies_notes}" name="attr_allies_notes"></textarea>
            </div>
        </div>

        <div class="sheet-flex sheet-gap sheet-bmargin">
            <div class="sheet-half-width">
                <label class="sheet-left" data-i18n="family">Family</label>
                <textarea class="sheet-background-notes" title="@{family_notes}" name="attr_family_notes"></textarea>
            </div>
            <div class="sheet-half-width">
                <label class="sheet-left" data-i18n="enemies">Enemies</label>
                <textarea class="sheet-background-notes" title="@{enemies_notes}" name="attr_enemies_notes"></textarea>
            </div>
        </div>
    </div>

    <!-- Notes -->
    <div id="notes" class="sheet-section sheet-anchor-adjust-x2">
        <h2 data-i18n="notes">Notes</h2>

        <textarea class="sheet-character-notes" title="@{sheet_notes}" name="attr_sheet_notes"></textarea>
    </div>
</div>
    <div class="sheet-compact">
    compact
</div>
    <!-- Movement Details -->
<div id="movement-details" class="sheet-overlay">
    <div class="sheet-popup">
        <a class="close" href="#"></a>
        <h1 data-i18n="movement">Movement</h1>
    </div>
</div>

<!-- Fatigue Details -->
<div id="fatigue-details" class="sheet-overlay">
    <div class="sheet-popup">
        <a class="close" href="#"></a>
        <h1 data-i18n="fatigue">Fatigue</h1>

        <div class="sheet-table">
            <div class="sheet-tr">
                <div class="sheet-td sheet-text-left"><label class="sheet-left" data-i18n="skills">Skills</label></div>
                <div class="sheet-td">
                    <select class="sheet-full-width sheet-readonly sheet-text-right" name="attr_fatigue_skills">
                        <option value="0" data-i18n="standard" selected>Standard</option>
                        <option value="1" data-i18n="hard">Hard</option>
                        <option value="2" data-i18n="formidable">Formidable</option>
                        <option value="3" data-i18n="herculean">Herculean</option>
                        <option value="4" data-i18n="hopeless">Hopeless</option>
                        <option value="5" data-i18n="no_action_allowed">No Action Allowed</option>
                    </select>
                </div>
            </div>
            <div class="sheet-tr">
                <div class="sheet-td sheet-text-left"><label class="sheet-left" data-i18n="action_points">Action Points</label></div>
                <div class="sheet-td"><input type="text" class="sheet-full-width sheet-text-right" title="@{action_points_fatigue}" name="attr_action_points_fatigue" value="0" readonly></div>
            </div>
            <div class="sheet-tr">
                <div class="sheet-td sheet-text-left"><label class="sheet-left" data-i18n="initiative">Initiative</label></div>
                <div class="sheet-td"><input type="text" class="sheet-full-width sheet-text-right" title="@{initiative_bonus_fatigue}" name="attr_initiative_bonus_fatigue" value="0" readonly></div>
            </div>
            <div class="sheet-tr">
                <div class="sheet-td sheet-text-left"><label class="sheet-left" data-i18n="movement_rate">Movement Rate</label></div>
                <div class="sheet-td">
                    <select class="sheet-full-width sheet-readonly sheet-text-right" name="attr_movement_rate_fatigue">
                        <option value="+0">0</option>
                        <option value="-1">-1</option>
                        <option value="-2">-2</option>
                        <option value="*.5" i18n-data="halved">Halved</option>
                        <option value="*0" i18n-data="impossible">Impossible</option>
                    </select>
                </div>
            </div>
            <div class="sheet-tr">
                <div class="sheet-td sheet-text-left"><label class="sheet-left" data-i18n="recovery">Recovery</label></div>
                <div class="sheet-td"><input type="text" class="sheet-full-width sheet-text-right" title="@{fatigue_recovery}" name="attr_fatigue_recovery" value="-"></div>
            </div>
        </div>

        <input type="hidden" name="attr_fatigue_max" value="9">
    </div>
</div>
</div>
    
    
    

    <!-- Popup Windows -->
    <div id="help" class="sheet-overlay">
    <div class="sheet-popup">
        <a class="close" href="#"></a>
        <h1 data-i18n="help">Help</h1>
        <!-- TODO: Fill out help page -->
        <input type="text" name="attr_version" value="3.0">
    </div>
</div>
    <div id="import" class="sheet-overlay">
    <div class="sheet-popup">
        <a class="close" href="#"></a>
        <h1 data-i18n="import">Import</h1>

        <div><label class="sheet-left" data-i18n="import_data">Import Data</label></div>
        <div><textarea class="sheet-full-width" name="attr_import_json_data"></textarea></div>
        <div class="sheet-flex sheet-gap">
            <div>
                <label class="sheet-left sheet-help" title="Character to import from data">#</label>
                <input type="number" class="sheet-number-width-sm" title="@{import_character}" name="attr_import_character" value="1" min="1">
            </div>
            <div>
                <label class="sheet-checkbox">
                    <input type='checkbox' name='attr_import_type' value="major"><span>3</span>
                    <span data-i18n="import_as_player_character">Import as Player Character</span>
                </label>
            </div>
        </div>

        <button type="action" name="act_import" class="sheet-full-width sheet-btn-style" data-i18n="import">Import</button>

        <fieldset class="repeating_systemspecies">
            <input type="text" name="attr_test">
        </fieldset>

        <span style="color: red" name="attr_import_errors"></span>
    </div>
</div>
    <div id="configuration" class="sheet-overlay">
    <div class="sheet-popup">
        <a class="close" href="#"></a>
        <h1 data-i18n="configuration">Configuration</h1>

        <div class="sheet-bmargin">
            <!-- Sheet Type -->
            <input type="hidden" class="sheet-spirits-toggle" name="attr_spirits_enabled" value="1">
            <div>
                <label class="sheet-left sheet-rmargin" data-i18n="sheet_type">Sheet Type</label>
                <select data-i18n-list="sheet-type-order" title="@{type}" class="sheet-auto-width" name="attr_type">
                    <option value="battle_unit" data-i18n-list-item="battle_unit" data-i18n="battle_unit">Battle Unit</option>
                    <option value="creature" data-i18n-list-item="creature" data-i18n="creature">Creature</option>
                    <option value="pc" data-i18n-list-item="major_character" data-i18n="major_character" selected></option>
                    <option value="ship" data-i18n-list-item="ship" data-i18n="ship">Ship</option>
                    <option value="solar_system" data-i18n-list-item="star_system" data-i18n="star_system">Star System</option>
                    <option value="spirit" class="sheet-spirits" data-i18n-list-item="spirit" data-i18n="spirit">Spirit</option>
                    <option value="vehicle" data-i18n-list-item="vehicle" data-i18n="vehicle">Vehicle></option>
                </select>
            </div>

            <!-- Intellect -->
            <div class="sheet-minor">
                <label class="sheet-left sheet-rmargin" data-18n="intellect">Intellect</label>
                <select class="sheet-auto-width" name="attr_int_type">
                    <option value="int-u" data-i18n="int-u" selected>INT</option>
                    <option value="ins-u" data-i18n="ins-u">INS</option>
                </select>
            </div>

            <!-- TODO Include species move rate / custom movement in essential configurations -->
        </div>

        <!-- Campaign Settings -->
        <div class="sheet-section">
            <details>
                <summary><h2 data-i18n="campaign_settings">Campaign Settings</h2></summary>
                <div class="sheet-warnmsg">
                    <span data-i18n="settings-warning">These campaign settings are generally set by your GM and shouldn't be changed.  They are provided here for visibility, and testing.</span>
                </div>

                <!-- Setting -->
                <label class="sheet-left sheet-rmargin" data-18n="setting">Setting</label>
                <select name="attr_setting" data-i18n-list="setting-order">
                    <option value="default" data-i18n="default" selected>Default</option>
                    <option value="after_the_vampire_wars" data-i18n-list-item="after_the_vampire_wars" data-i18n="after_the_vampire_wars">After the Vampire Wars</option>
                    <option value="classic_fantasy" data-i18n-list-item="classic_fantasy" data-i18n="classic_fantasy">Classic Fantasy</option>
                    <option value="destined" data-i18n-list-item="destined" data-i18n="destined">Destined</option>
                    <option value="fioracitta" data-i18n-list-item="fioracitta" data-i18n="fioracitta">Fioracitta</option>
                    <option value="luther_arkwright" data-i18n-list-item="luther_arkwright" data-i18n="luther_arkwright">Luther Arkwright</option>
                    <option value="lyonesse" data-i18n-list-item="lyonesse" data-i18n="lyonesse">Lyonesse</option>
                    <option value="m-space" data-i18n-list-item="m-space" data-i18n="m-space">M-Space</option>
                    <option value="monster_island" data-i18n-list-item="monster_island" data-i18n="monster_island">Monster Island</option>
                    <option value="mythic_babylon" data-i18n-list-item="mythic_babylon" data-i18n="mythic_babylon">Mythic Babylon</option>
                    <option value="mythic_britain" data-i18n-list-item="mythic_britain" data-i18n="mythic_britain">Mythic Britain</option>
                    <option value="mythic_constantinople" data-i18n-list-item="mythic_constantinople" data-i18n="mythic_constantinople">Mythic Constantinople</option>
                    <option value="mythic_rome" data-i18n-list-item="mythic_rome" data-i18n="mythic_rome">Mythic Rome</option>
                    <option value="mythras_imperative" data-i18n-list-item="mythras_imperative" data-i18n="mythras_imperative">Mythras Imperative</option>
                    <option value="odd_soot" data-i18n-list-item="add_soot" data-i18n="odd_soot">Odd Soot</option>
                    <option value="perceforest" data-i18n-list-item="perceforest" data-i18n="perceforest">Perceforest</option>
                    <option value="thennla" data-i18n-list-item="thennla" data-i18n="thennla">Thennla</option>
                    <option value="worlds_united" data-i18n-list-item="worlds_united" data-i18n="worlds_united">Worlds United</option>
                </select>
                <br>

                <!-- Mechanical Systems -->
                <h3 data-i18n="mechanical_systems">Mechanical Systems</h3>
                <!-- Extended Conflict Resolution Option -->
                <label class="sheet-left sheet-rmargin" data-i18n="extended_conflict_resolution">Extended Conflict Resolution</label>
                <select name="attr_extended_conflict_enabled_option">
                    <option value="default" data-i18n="setting_default" selected>Setting Default</option>
                    <option value="1" data-i18n="enabled">Enabled</option>
                    <option value="0" data-i18n="disabled">Disabled</option>
                </select>
                <br>
                <!-- Simplified Combat Enabled Option -->
                <label class="sheet-left sheet-rmargin" data-i18n="simplified_combat">Simplified Combat</label>
                <select name="attr_simplified_combat_enabled_option">
                    <option value="default" data-i18n="setting_default" selected>Setting Default</option>
                    <option value="1" data-i18n="enabled">Enabled</option>
                    <option value="0" data-i18n="disabled">Disabled</option>
                </select>
                <br>
                <!-- Social Conflict Enabled Option -->
                <label class="sheet-left sheet-rmargin" data-i18n="social_conflict">Social Conflict</label>
                <select name="attr_social_conflict_enabled_option">
                    <option value="default" data-i18n="setting_default" selected>Setting Default</option>
                    <option value="1" data-i18n="enabled">Enabled</option>
                    <option value="0" data-i18n="disabled">Disabled</option>
                </select>
                <br>
                <!-- Spirits Enabled Option -->
                <label class="sheet-left sheet-rmargin" data-i18n="spirits">Spirits</label>
                <select name="attr_spirits_enabled_option">
                    <option value="default" data-i18n="setting_default" selected>Setting Default</option>
                    <option value="1" data-i18n="enabled">Enabled</option>
                    <option value="0" data-i18n="disabled">Disabled</option>
                </select>
                <br>

                <!-- Attributes -->
                <h3 data-i18n="attributes">Attributes</h3>
                <!-- Action Points Calc Option -->
                <label class="sheet-left sheet-rmargin" data-i18n="action_points">Action Points</label>
                <select name="attr_action_points_calc_option">
                    <option value="default" data-i18n="setting_default" selected>Setting Default</option>
                    <option value="calculate" data-i18n="calculated">Calculated</option>
                    <option value="set_2">2</option>
                    <option value="set_3">3</option>
                </select>
                <input type="hidden" name="attr_action_points_calc" value="calculate">
                <br>
                <!-- Luck Points Rank Option -->
                <label class="sheet-left sheet-rmargin" data-i18n="add_rank_to_luck">Add Rank to Luck</label>
                <select name="attr_luck_points_rank_option">
                    <option value="default" data-i18n="setting_default" selected>Setting Default</option>
                    <option value="1" data-i18n="enabled">Enabled</option>
                    <option value="0" data-i18n="disabled">Disabled</option>
                </select>
                <input type="hidden" name="attr_luck_points_rank" value="0">
                <br>
                <!-- Tenacity Option -->
                <label class="sheet-left sheet-rmargin" data-i18n="tenacity">Tenacity</label>
                <select name="attr_tenacity_enabled_option">
                    <option value="default" data-i18n="setting_default" selected>Setting Default</option>
                    <option value="1" data-i18n="enabled">Enabled</option>
                    <option value="0" data-i18n="disabled">Disabled</option>
                </select>
                <br>

                <!-- Skills -->
                <h3><span data-i18n="skills">Skills</span>/<span data-i18n="passions">Passions</span></h3>
                <label class="sheet-left sheet-rmargin" data-i18n="dependencies">Dependencies</label>
                <select name="attr_dependencies_enabled_option">
                    <option value="default" data-i18n="setting_default" selected>Setting Default</option>
                    <option value="1" data-i18n="enabled">Enabled</option>
                    <option value="0" data-i18n="disabled">Disabled</option>
                </select>
                <br>
                <!-- Herculan Modifier Option -->
                <label class="sheet-left sheet-rmargin" data-i18n="herculean_modifier">Herculean Modifier</label>
                <select name="attr_herculean_mod_option">
                    <option value="default" data-i18n="setting_default" selected>Setting Default</option>
                    <option value=".1">1/10</option>
                    <option value=".2">1/5</option>
                </select>
                <input type="hidden" name="attr_herculean_mod" value=".1">
                <br>

                <!-- Weapons -->
                <h3 data-i18n="weapons">Weapons</h3>
                <label class="sheet-left sheet-rmargin" data-i18n="reach">Reach</label>
                <select name="attr_reach_enabled_option">
                    <option value="default" data-i18n="setting_default" selected>Setting Default</option>
                    <option value="1" data-i18n="enabled">Enabled</option>
                    <option value="0" data-i18n="disabled">Disabled</option>
                </select>
                <br>
            </details>
        </div>
    </div>
</div>
</div>

<!-- Roll Templates -->
<!-- Default Roll Template -->
<!-- @{roll_display}&{template:default} {{name=@{name}}} {{roll=[[1d8]]}} -->
<rolltemplate class="sheet-rolltemplate-default">
    <div class="sheet-border {{#improvestyle}}improve{{/improvestyle}}{{#initstyle}}initiative{{/initstyle}}{{#dmgstyle}}damage{{/dmgstyle}}">
        <div class="sheet-header {{#improvestyle}}improve{{/improvestyle}}{{#initstyle}}initiative{{/initstyle}}{{#dmgstyle}}damage{{/dmgstyle}}">
            <div class="sheet-character">{{character}}</div>
            <div class="sheet-name">{{name}}</div>
        </div>
        {{#allprops() character name notes improvestyle initstyle dmgstyle}}
        <div class="sheet-listitem">
            <div class="sheet-key">{{key}}</div>
            <div class="sheet-value">{{value}}</div>
        </div>
        {{/allprops() character name notes improvestyle initstyle dmgstyle}}
        {{#notes}}
        <div class="sheet-listitem">{{notes}}</div>
        {{/notes}}
    </div>
</rolltemplate>

<!-- Hit Table Roll Template -->
<!-- @{roll_display}&{template:hit-location} {{name=@{name}}} @{name_display} {{roll=[[1d8]]}} -->
<rolltemplate class="sheet-rolltemplate-hit-location">
    <div class="sheet-border">
        <div class="sheet-header">
            <div class="sheet-character">{{character}}</div>
            <div class="sheet-name">{{name}}</div>
        </div>
        <div class="sheet-table">
            <div class="sheet-tr">
                <div class="sheet-th sheet-full-width"><span data-i18n="location">Location</span></div>
                <div class="sheet-th sheet-pictos-three sheet-help"><div class="sheet-checkbox-width" data-i18n-title="passive_block_size" title="Passive Block Size">b</div></div>
                <div class="sheet-th sheet-pictos sheet-help"><div class="sheet-checkbox-width" data-i18n-title="armor_points" title="Armor Points">U</div></div>
                <div class="sheet-th sheet-help"><div class="sheet-number-width-sm" data-i18n-title="hit_points" title="Hit Points" data-i18n="hit_points-abrv">HP</div></div>
            </div>
            {{#roll}}
            <div class="sheet-tr">
                {{#rollBetween() roll loc1_start loc1_end}}
                <div class="sheet-td sheet-full-width">{{roll}} ({{loc1_name}})</div>
                <div class="sheet-td"><div class=sheet-checkbox-width">{{loc1_block}}</div></div>
                <div class="sheet-td"><div class=sheet-checkbox-width">{{loc1_ap}}</div></div>
                <div class="sheet-td"><div class=sheet-number-width-sm">{{loc1_hp}}/{{loc1_hp_max}}</div></div>
                {{/rollBetween() roll loc1_start loc1_end}}
                {{#rollBetween() roll loc2_start loc2_end}}
                <div class="sheet-td sheet-full-width">{{roll}} ({{loc2_name}})</div>
                <div class="sheet-td"><div class=sheet-checkbox-width">{{loc2_block}}</div></div>
                <div class="sheet-td"><div class=sheet-checkbox-width">{{loc2_ap}}</div></div>
                <div class="sheet-td"><div class=sheet-number-width-sm">{{loc2_hp}}/{{loc2_hp_max}}</div></div>
                {{/rollBetween() roll loc2_start loc2_end}}
                {{#rollBetween() roll loc3_start loc3_end}}
                <div class="sheet-td sheet-full-width">{{roll}} ({{loc3_name}})</div>
                <div class="sheet-td"><div class=sheet-checkbox-width">{{loc3_block}}</div></div>
                <div class="sheet-td"><div class=sheet-checkbox-width">{{loc3_ap}}</div></div>
                <div class="sheet-td"><div class=sheet-number-width-sm">{{loc3_hp}}/{{loc3_hp_max}}</div></div>
                {{/rollBetween() roll loc3_start loc3_end}}
                {{#rollBetween() roll loc4_start loc4_end}}
                <div class="sheet-td sheet-full-width">{{roll}} ({{loc4_name}})</div>
                <div class="sheet-td"><div class=sheet-checkbox-width">{{loc4_block}}</div></div>
                <div class="sheet-td"><div class=sheet-checkbox-width">{{loc4_ap}}</div></div>
                <div class="sheet-td"><div class=sheet-number-width-sm">{{loc4_hp}}/{{loc4_hp_max}}</div></div>
                {{/rollBetween() roll loc4_start loc4_end}}
                {{#rollBetween() roll loc5_start loc5_end}}
                <div class="sheet-td sheet-full-width">{{roll}} ({{loc5_name}})</div>
                <div class="sheet-td"><div class=sheet-checkbox-width">{{loc5_block}}</div></div>
                <div class="sheet-td"><div class=sheet-checkbox-width">{{loc5_ap}}</div></div>
                <div class="sheet-td"><div class=sheet-number-width-sm">{{loc5_hp}}/{{loc5_hp_max}}</div></div>
                {{/rollBetween() roll loc5_start loc5_end}}
                {{#rollBetween() roll loc6_start loc6_end}}
                <div class="sheet-td sheet-full-width">{{roll}} ({{loc6_name}})</div>
                <div class="sheet-td"><div class=sheet-checkbox-width">{{loc6_block}}</div></div>
                <div class="sheet-td"><div class=sheet-checkbox-width">{{loc6_ap}}</div></div>
                <div class="sheet-td"><div class=sheet-number-width-sm">{{loc6_hp}}/{{loc6_hp_max}}</div></div>
                {{/rollBetween() roll loc6_start loc6_end}}
                {{#rollBetween() roll loc7_start loc7_end}}
                <div class="sheet-td sheet-full-width">{{roll}} ({{loc7_name}})</div>
                <div class="sheet-td"><div class=sheet-checkbox-width">{{loc7_block}}</div></div>
                <div class="sheet-td"><div class=sheet-checkbox-width">{{loc7_ap}}</div></div>
                <div class="sheet-td"><div class=sheet-number-width-sm">{{loc7_hp}}/{{loc7_hp_max}}</div></div>
                {{/rollBetween() roll loc7_start loc7_end}}
                {{#rollBetween() roll loc8_start loc8_end}}
                <div class="sheet-td sheet-full-width">{{roll}} ({{loc8_name}})</div>
                <div class="sheet-td"><div class=sheet-checkbox-width">{{loc8_block}}</div></div>
                <div class="sheet-td"><div class=sheet-checkbox-width">{{loc8_ap}}</div></div>
                <div class="sheet-td"><div class=sheet-number-width-sm">{{loc8_hp}}/{{loc8_hp_max}}</div></div>
                {{/rollBetween() roll loc8_start loc8_end}}
                {{#rollBetween() roll loc9_start loc9_end}}
                <div class="sheet-td sheet-full-width">{{roll}} ({{loc9_name}})</div>
                <div class="sheet-td"><div class=sheet-checkbox-width">{{loc9_block}}</div></div>
                <div class="sheet-td"><div class=sheet-checkbox-width">{{loc9_ap}}</div></div>
                <div class="sheet-td"><div class=sheet-number-width-sm">{{loc9_hp}}/{{loc9_hp_max}}</div></div>
                {{/rollBetween() roll loc9_start loc9_end}}
                {{#rollBetween() roll loc10_start loc10_end}}
                <div class="sheet-td sheet-full-width">{{roll}} ({{loc10_name}})</div>
                <div class="sheet-td"><div class=sheet-checkbox-width">{{loc10_block}}</div></div>
                <div class="sheet-td"><div class=sheet-checkbox-width">{{loc10_ap}}</div></div>
                <div class="sheet-td"><div class=sheet-number-width-sm">{{loc10_hp}}/{{loc10_hp_max}}</div></div>
                {{/rollBetween() roll loc10_start loc10_end}}
                {{#rollBetween() roll loc11_start loc11_end}}
                <div class="sheet-td sheet-full-width">{{roll}} ({{loc11_name}})</div>
                <div class="sheet-td"><div class=sheet-checkbox-width">{{loc11_block}}</div></div>
                <div class="sheet-td"><div class=sheet-checkbox-width">{{loc11_ap}}</div></div>
                <div class="sheet-td"><div class=sheet-number-width-sm">{{loc11_hp}}/{{loc11_hp_max}}</div></div>
                {{/rollBetween() roll loc11_start loc11_end}}
                {{#rollBetween() roll loc12_start loc12_end}}
                <div class="sheet-td sheet-full-width">{{roll}} ({{loc12_name}})</div>
                <div class="sheet-td"><div class=sheet-checkbox-width">{{loc12_block}}</div></div>
                <div class="sheet-td"><div class=sheet-checkbox-width">{{loc12_ap}}</div></div>
                <div class="sheet-td"><div class=sheet-number-width-sm">{{loc12_hp}}/{{loc12_hp_max}}</div></div>
                {{/rollBetween() roll loc12_start loc12_end}}
            </div>
            {{/roll}}
        </div>
    </div>
</rolltemplate>
<!-- Improvement Roll Template -->
<!-- @{roll_display}&{template:improvement} {{name=@{name}}} @{name_display} {{roll=[[1d100 + @{int}]]}} {{improvement=[[1d4+1+@{fumbled}]]}} {{skill=[[@{skill_total}]]}} -->
<rolltemplate class="sheet-rolltemplate-improvement">
    <div class="sheet-border">
        <div class="sheet-header">
            <div class="sheet-character">{{character}}</div>
            <div class="sheet-name">{{name}} {{skill}}%</div>
        </div>
        <div class="sheet-table">
            <div class="sheet-tr">
                <div class="sheet-td">{{roll}}</div>
                <div class="sheet-td">
                    {{#^rollLess() roll skill}}
                    <span data-i18n="success">Success</span>
                    {{/^rollLess() roll skill}}
                    {{#rollLess() roll skill}}
                    <span data-i18n="fail">Fail</span>
                    {{/rollLess() roll skill}}
                </div>
                <div class="sheet-td">
                    {{#^rollLess() roll skill}}
                    +{{improvement}}%
                    {{/^rollLess() roll skill}}
                    {{#rollLess() roll skill}}
                    +1%
                    {{/rollLess() roll skill}}
                </div>
            </div>
        </div>
    </div>
</rolltemplate>

<!-- Skill Roll Template -->
<!-- @{roll_display}&{template:skill} {{name=@{name}}} @{name_display} {{roll=[[1d100]]}} {{fatigue_skills=[[@{fatigue_skills}]]}} {{encumbered=[[@{encumbered}]]}} {{encumbrance_skills=[[@{encumbrance_skills}]]}} {{original=@{total}}} {{difficulty=[[@{difficulty}]]}} {{augmentation=[[@{augmentation}]]}} {{penalty=[[@{penalty}]]}} {{very_easy=[[((@{total}+@{augment})*2)+@{penalty}]]}} {{very_easy_crit=[[ceil(((@{total}*2)+@{penalty})/10)]]}} {{easy=[[ceil((@{total}+@{augment})*1.5)+@{penalty}]]}} {{easy_crit=[[ceil(((@{total}*1.5)+@{penalty})/10)]]}} {{standard=[[@{total}+@{augment}+@{penalty}]]}} {{standard_crit=[[ceil((@{total}+@{penalty})/10)]]}} {{hard=[[ceil((@{total}+@{augment})*.67)+@{penalty}]]}} {{hard_crit=[[ceil(((@{total}*.67)+@{penalty})/10)]]}} {{formidable=[[ceil((@{total}+@{augment})*.5)+@{penalty}]]}} {{formidable_crit=[[ceil(((@{total}*.5)+@{penalty})/10)]]}} {{herculean=[[ceil((@{total}+@{augment})*@{herculean_mod})+@{penalty}]]}} {{herculean_crit=[[ceil(((@{total}*@{herculean_mod})+@{penalty})/10)]]}} {{notes=@{notes}}} -->
<rolltemplate class="sheet-rolltemplate-skill">
    <div class="sheet-border">
        <div class="sheet-header">
            <div class="sheet-character">{{character}}</div>
            <div class="sheet-name">{{name}} {{original}}%</div>
        </div>

        {{#rollGreater() fatigue_skills 0}}
        {{#rollTotal() fatigue_skills 1}}<div class="sheet-hard-notice"><span data-i18n="hard">Hard</span>, <span data-i18n="due_to_fatigue">due to fatigue</span></div>{{/rollTotal() fatigue_skills 1}}
        {{#rollTotal() fatigue_skills 2}}<div class="sheet-formidable-notice"><span data-i18n="formidable">Formidable</span>,&nbsp;<span data-i18n="due_to_fatigue">due to fatigue</span></div>{{/rollTotal() fatigue_skills 2}}
        {{#rollTotal() fatigue_skills 3}}<div class="sheet-herculean-notice"><span data-i18n="herculean">Herculean</span>,&nbsp;<span data-i18n="due_to_fatigue">due to fatigue</span></div>{{/rollTotal() fatigue_skills 3}}
        {{#rollTotal() fatigue_skills 4}}<div class="sheet-hopeless-notice"><span data-i18n="hopeless">Hopeless</span>,&nbsp;<span data-i18n="due_to_fatigue">due to fatigue</span></div>{{/rollTotal() fatigue_skills 4}}
        {{#rollTotal() fatigue_skills 5}}<div class="sheet-hopeless-notice"><span data-i18n="no_action_allowed">No action allowed</span>,&nbsp;<span data-i18n="due_to_fatigue">due to fatigue</span></div>{{/rollTotal() fatigue_skills 5}}
        {{/rollGreater() fatigue_skills 0}}

        {{#rollTotal() encumbered 1}}
        {{#rollTotal() encumbrance_skills 1}}<div class="sheet-hard-notice"><span data-i18n="1_grade_harder">1 grade harder</span>,&nbsp;<span data-i18n="due_to_enc">due to ENC</span></div>{{/rollTotal() encumbrance_skills 1}}
        {{#rollTotal() encumbrance_skills 2}}<div class="sheet-formidable-notice"><span data-i18n="2_grades_harder">2 grades harder</span>,&nbsp;<span data-i18n="due_to_enc">due to ENC</span></div>{{/rollTotal() encumbrance_skills 2}}
        {{#rollTotal() encumbrance_skills 3}}<div class="sheet-hopeless-notice"><span data-i18n="impossible">Impossible</span>,&nbsp;<span data-i18n="due_to_enc">due to ENC</span></div>{{/rollTotal() encumbrance_skills 3}}
        {{/rollTotal() encumbered 1}}

        {{#ship_condition_skills}}
        {{#rollTotal() ship_condition_skills 2}}<div class="sheet-hard-notice"><span data-i18n="hard">Hard</span>,&nbsp;<span data-i18n="due_to_ship_condition">due to ship condition</span></div>{{/rollTotal() ship_condition_skills 2}}
        {{#rollTotal() ship_condition_skills 3}}<div class="sheet-formidable-notice"><span data-i18n="formidable">Formidable</span>,&nbsp;<span data-i18n="due_to_ship_condition">due to ship condition</span></div>{{/rollTotal() ship_condition_skills 3}}
        {{#rollTotal() ship_condition_skills 4}}<div class="sheet-herculean-notice"><span data-i18n="herculean">Herculean</span>,&nbsp;<span data-i18n="due_to_ship_condition">due to ship condition</span></div>{{/rollTotal() ship_condition_skills 4}}
        {{/ship_condition_skills }}

        {{#^rollTotal() augmentation 0}}
        <div class="sheet-listitem">
            <div class="sheet-key"><span data-i18n="augmentation">Augmentation</span>:</div>
            <div class="sheet-value">{{augmentation}}</div>
        </div>
        {{/^rollTotal() augmentation 0}}
        {{#^rollTotal() penalty 0}}
        <div class="sheet-listitem">
            <div class="sheet-key"><span data-i18n="101+_penalty">101+ Penalty</span>:</div>
            <div class="sheet-value">{{penalty}}</div>
        </div>
        {{/^rollTotal() penalty 0}}

        <!-- Skill Result table start -->
        <div class="sheet-table">
            <div class="sheet-tr">
                <div class="sheet-th" data-i18n="difficulty">Difficulty</div>
                <div class="sheet-th">
                    <div style="margin: 0 2px 0; padding: 0 5px 0;">
                        <div class="sheet-flex">
                            <div class="sheet-grow">%</div>
                            <div class="sheet-grow sheet-pictos sheet-help" data-i18n-title="critical">S</div>
                        </div>
                    </div>
                </div>
                <div class="sheet-th" data-i18n="result">Result</div>
            </div>


            {{#rollTotal() difficulty 0}}
            <div class="sheet-tr">
                <div class="sheet-td">
                    <div class="sheet-very-easy sheet-left" data-i18n="very_easy">Very Easy</div>
                </div>
                <div class="sheet-td">
                    <div class="sheet-very-easy">
                        <div class="sheet-flex">
                            <div class="sheet-grow">{{very_easy}}</div>
                            <div class="sheet-grow">{{very_easy_crit}}</div>
                        </div>
                    </div>
                </div>
                <div class="sheet-td">
                    <div class="sheet-very-easy">
                        <!-- 95+ Auto Fail -->
                        {{#rollGreater() roll 95}}
                        <!-- score > 100 -->
                        {{#rollGreater() very_easy_fumble 100}}
                        <!-- roll = 100 (fumble) -->
                        {{#rollTotal() roll 100}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fumble">!</span>
                        {{/rollTotal() roll 100}}
                        <!-- roll < 100 (fail) -->
                        {{#rollLess() roll 100}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollLess() roll 100}}
                        {{/rollGreater() very_easy_fumble 100}}
                        <!-- score <= 100 -->
                        {{#rollLess() very_easy_fumble 101}}
                        <!-- roll 99 to 100 (fumble) -->
                        {{#rollGreater() roll 98}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fumble">!</span>
                        {{/rollGreater() roll 98}}
                        <!-- roll < 99 (fail) -->
                        {{#rollLess() roll 99}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollLess() roll 99}}
                        {{/rollLess() very_easy_fumble 101}}
                        {{/rollGreater() roll 95}}
                        <!-- 6 to 95 Normal Logic -->
                        {{#rollBetween() roll 6 95}}
                        <!-- roll > total (fail) -->
                        {{#rollGreater() roll very_easy}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollGreater() roll very_easy}}
                        <!-- roll <= total -->
                        {{#^rollGreater() roll very_easy}}
                        <!-- roll > crit (success) -->
                        {{#rollGreater() roll very_easy_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="success">3</span>
                        {{/rollGreater() roll very_easy_crit}}
                        <!-- roll <= crit (crit) -->
                        {{#^rollGreater() roll very_easy_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="critical">S</span>
                        {{/^rollGreater() roll very_easy_crit}}
                        {{/^rollGreater() roll very_easy}}
                        {{/rollBetween() roll 6 95}}
                        <!-- 5- Auto Fail -->
                        {{#rollLess() roll 6}}
                        <!-- roll > crit (success) -->
                        {{#rollGreater() roll very_easy_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="success">3</span>
                        {{/rollGreater() roll very_easy_crit}}
                        <!-- roll <= crit (crit) -->
                        {{#^rollGreater() roll very_easy_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="critical">S</span>
                        {{/^rollGreater() roll very_easy_crit}}
                        {{/rollLess() roll 6}}
                    </div>
                </div>
            </div>

            <div class="sheet-tr">
                <div class="sheet-td">
                    <div class="sheet-easy" data-i18n="easy">Easy</div>
                </div>
                <div class="sheet-td">
                    <div class="sheet-easy">
                        <div class="sheet-flex">
                            <div class="sheet-grow">{{easy}}</div>
                            <div class="sheet-grow">{{easy_crit}}</div>
                        </div>
                    </div>
                </div>
                <div class="sheet-td">
                    <div class="sheet-easy">
                        <!-- 95+ Auto Fail -->
                        {{#rollGreater() roll 95}}
                        <!-- score > 100 -->
                        {{#rollGreater() easy_fumble 100}}
                        <!-- roll = 100 (fumble) -->
                        {{#rollTotal() roll 100}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fumble">!</span>
                        {{/rollTotal() roll 100}}
                        <!-- roll < 100 (fail) -->
                        {{#rollLess() roll 100}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollLess() roll 100}}
                        {{/rollGreater() easy_fumble 100}}
                        <!-- score <= 100 -->
                        {{#rollLess() easy_fumble 101}}
                        <!-- roll 99 to 100 (fumble) -->
                        {{#rollGreater() roll 98}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fumble">!</span>
                        {{/rollGreater() roll 98}}
                        <!-- roll < 99 (fail) -->
                        {{#rollLess() roll 99}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollLess() roll 99}}
                        {{/rollLess() easy_fumble 101}}
                        {{/rollGreater() roll 95}}
                        <!-- 6 to 95 Normal Logic -->
                        {{#rollBetween() roll 6 95}}
                        <!-- roll > total (fail) -->
                        {{#rollGreater() roll easy}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollGreater() roll easy}}
                        <!-- roll <= total -->
                        {{#^rollGreater() roll easy}}
                        <!-- roll > crit (success) -->
                        {{#rollGreater() roll easy_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="success">3</span>
                        {{/rollGreater() roll easy_crit}}
                        <!-- roll <= crit (crit) -->
                        {{#^rollGreater() roll easy_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="critical">S</span>
                        {{/^rollGreater() roll easy_crit}}
                        {{/^rollGreater() roll easy}}
                        {{/rollBetween() roll 6 95}}
                        <!-- 5- Auto Fail -->
                        {{#rollLess() roll 6}}
                        <!-- roll > crit (success) -->
                        {{#rollGreater() roll easy_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="success">3</span>
                        {{/rollGreater() roll easy_crit}}
                        <!-- roll <= crit (crit) -->
                        {{#^rollGreater() roll easy_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="critical">S</span>
                        {{/^rollGreater() roll easy_crit}}
                        {{/rollLess() roll 6}}
                    </div>
                </div>
            </div>

            <div class="sheet-tr sheet-bold">
                <div class="sheet-td">
                    <div class="sheet-standard" data-i18n="standard">Standard</div>
                </div>
                <div class="sheet-td">
                    <div class="sheet-standard">
                        <div class="sheet-flex">
                            <div class="sheet-grow">{{standard}}</div>
                            <div class="sheet-grow">{{standard_crit}}</div>
                        </div>
                    </div>
                </div>
                <div class="sheet-td">
                    <div class="sheet-standard">
                        <!-- 95+ Auto Fail -->
                        {{#rollGreater() roll 95}}
                        <!-- score > 100 -->
                        {{#rollGreater() standard_fumble 100}}
                        <!-- roll = 100 (fumble) -->
                        {{#rollTotal() roll 100}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fumble">!</span>
                        {{/rollTotal() roll 100}}
                        <!-- roll < 100 (fail) -->
                        {{#rollLess() roll 100}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollLess() roll 100}}
                        {{/rollGreater() standard_fumble 100}}
                        <!-- score <= 100 -->
                        {{#rollLess() standard_fumble 101}}
                        <!-- roll 99 to 100 (fumble) -->
                        {{#rollGreater() roll 98}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fumble">!</span>
                        {{/rollGreater() roll 98}}
                        <!-- roll < 99 (fail) -->
                        {{#rollLess() roll 99}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollLess() roll 99}}
                        {{/rollLess() standard_fumble 101}}
                        {{/rollGreater() roll 95}}
                        <!-- 6 to 95 Normal Logic -->
                        {{#rollBetween() roll 6 95}}
                        <!-- roll > total (fail) -->
                        {{#rollGreater() roll standard}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollGreater() roll standard}}
                        <!-- roll <= total -->
                        {{#^rollGreater() roll standard}}
                        <!-- roll > crit (success) -->
                        {{#rollGreater() roll standard_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="success">3</span>
                        {{/rollGreater() roll standard_crit}}
                        <!-- roll <= crit (crit) -->
                        {{#^rollGreater() roll standard_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="critical">S</span>
                        {{/^rollGreater() roll standard_crit}}
                        {{/^rollGreater() roll standard}}
                        {{/rollBetween() roll 6 95}}
                        <!-- 5- Auto Fail -->
                        {{#rollLess() roll 6}}
                        <!-- roll > crit (success) -->
                        {{#rollGreater() roll standard_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="success">3</span>
                        {{/rollGreater() roll standard_crit}}
                        <!-- roll <= crit (crit) -->
                        {{#^rollGreater() roll standard_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="critical">S</span>
                        {{/^rollGreater() roll standard_crit}}
                        {{/rollLess() roll 6}}
                    </div>
                </div>
            </div>

            <div class="sheet-tr">
                <div class="sheet-td">
                    <div class="sheet-hard" data-i18n="hard">Hard</div>
                </div>
                <div class="sheet-td">
                    <div class="sheet-hard">
                        <div class="sheet-flex">
                            <div class="sheet-grow">{{hard}}</div>
                            <div class="sheet-grow">{{hard_crit}}</div>
                        </div>
                    </div>
                </div>
                <div class="sheet-td">
                    <div class="sheet-hard">
                        <!-- 95+ Auto Fail -->
                        {{#rollGreater() roll 95}}
                        <!-- score > 100 -->
                        {{#rollGreater() hard_fumble 100}}
                        <!-- roll = 100 (fumble) -->
                        {{#rollTotal() roll 100}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fumble">!</span>
                        {{/rollTotal() roll 100}}
                        <!-- roll < 100 (fail) -->
                        {{#rollLess() roll 100}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollLess() roll 100}}
                        {{/rollGreater() hard_fumble 100}}
                        <!-- score <= 100 -->
                        {{#rollLess() hard_fumble 101}}
                        <!-- roll 99 to 100 (fumble) -->
                        {{#rollGreater() roll 98}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fumble">!</span>
                        {{/rollGreater() roll 98}}
                        <!-- roll < 99 (fail) -->
                        {{#rollLess() roll 99}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollLess() roll 99}}
                        {{/rollLess() hard_fumble 101}}
                        {{/rollGreater() roll 95}}
                        <!-- 6 to 95 Normal Logic -->
                        {{#rollBetween() roll 6 95}}
                        <!-- roll > total (fail) -->
                        {{#rollGreater() roll hard}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollGreater() roll hard}}
                        <!-- roll <= total -->
                        {{#^rollGreater() roll hard}}
                        <!-- roll > crit (success) -->
                        {{#rollGreater() roll hard_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="success">3</span>
                        {{/rollGreater() roll hard_crit}}
                        <!-- roll <= crit (crit) -->
                        {{#^rollGreater() roll hard_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="critical">S</span>
                        {{/^rollGreater() roll hard_crit}}
                        {{/^rollGreater() roll hard}}
                        {{/rollBetween() roll 6 95}}
                        <!-- 5- Auto Fail -->
                        {{#rollLess() roll 6}}
                        <!-- roll > crit (success) -->
                        {{#rollGreater() roll hard_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="success">3</span>
                        {{/rollGreater() roll hard_crit}}
                        <!-- roll <= crit (crit) -->
                        {{#^rollGreater() roll hard_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="critical">S</span>
                        {{/^rollGreater() roll hard_crit}}
                        {{/rollLess() roll 6}}
                    </div>
                </div>
            </div>

            <div class="sheet-tr">
                <div class="sheet-td">
                    <div class="sheet-formidable" data-i18n="formidable">Formidable</div>
                </div>
                <div class="sheet-td">
                    <div class="sheet-formidable">
                        <div class="sheet-flex">
                            <div class="sheet-grow">{{formidable}}</div>
                            <div class="sheet-grow">{{formidable_crit}}</div>
                        </div>
                    </div>
                </div>
                <div class="sheet-td">
                    <div class="sheet-formidable">
                        <!-- 95+ Auto Fail -->
                        {{#rollGreater() roll 95}}
                        <!-- score > 100 -->
                        {{#rollGreater() formidable_fumble 100}}
                        <!-- roll = 100 (fumble) -->
                        {{#rollTotal() roll 100}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fumble">!</span>
                        {{/rollTotal() roll 100}}
                        <!-- roll < 100 (fail) -->
                        {{#rollLess() roll 100}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollLess() roll 100}}
                        {{/rollGreater() formidable_fumble 100}}
                        <!-- score <= 100 -->
                        {{#rollLess() formidable_fumble 101}}
                        <!-- roll 99 to 100 (fumble) -->
                        {{#rollGreater() roll 98}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fumble">!</span>
                        {{/rollGreater() roll 98}}
                        <!-- roll < 99 (fail) -->
                        {{#rollLess() roll 99}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollLess() roll 99}}
                        {{/rollLess() formidable_fumble 101}}
                        {{/rollGreater() roll 95}}
                        <!-- 6 to 95 Normal Logic -->
                        {{#rollBetween() roll 6 95}}
                        <!-- roll > total (fail) -->
                        {{#rollGreater() roll formidable}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollGreater() roll formidable}}
                        <!-- roll <= total -->
                        {{#^rollGreater() roll formidable}}
                        <!-- roll > crit (success) -->
                        {{#rollGreater() roll formidable_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="success">3</span>
                        {{/rollGreater() roll formidable_crit}}
                        <!-- roll <= crit (crit) -->
                        {{#^rollGreater() roll formidable_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="critical">S</span>
                        {{/^rollGreater() roll formidable_crit}}
                        {{/^rollGreater() roll formidable}}
                        {{/rollBetween() roll 6 95}}
                        <!-- 5- Auto Fail -->
                        {{#rollLess() roll 6}}
                        <!-- roll > crit (success) -->
                        {{#rollGreater() roll formidable_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="success">3</span>
                        {{/rollGreater() roll formidable_crit}}
                        <!-- roll <= crit (crit) -->
                        {{#^rollGreater() roll formidable_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="critical">S</span>
                        {{/^rollGreater() roll formidable_crit}}
                        {{/rollLess() roll 6}}
                    </div>
                </div>
            </div>

            <div class="sheet-tr">
                <div class="sheet-td">
                    <div class="sheet-herculean" data-i18n="herculean">Herculean</div>
                </div>
                <div class="sheet-td">
                    <div class="sheet-herculean">
                        <div class="sheet-flex">
                            <div class="sheet-grow">{{herculean}}</div>
                            <div class="sheet-grow">{{herculean_crit}}</div>
                        </div>
                    </div>
                </div>
                <div class="sheet-td">
                    <div class="sheet-herculean">
                        <!-- 95+ Auto Fail -->
                        {{#rollGreater() roll 95}}
                        <!-- score > 100 -->
                        {{#rollGreater() herculean_fumble 100}}
                        <!-- roll = 100 (fumble) -->
                        {{#rollTotal() roll 100}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fumble">!</span>
                        {{/rollTotal() roll 100}}
                        <!-- roll < 100 (fail) -->
                        {{#rollLess() roll 100}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollLess() roll 100}}
                        {{/rollGreater() herculean_fumble 100}}
                        <!-- score <= 100 -->
                        {{#rollLess() herculean_fumble 101}}
                        <!-- roll 99 to 100 (fumble) -->
                        {{#rollGreater() roll 98}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fumble">!</span>
                        {{/rollGreater() roll 98}}
                        <!-- roll < 99 (fail) -->
                        {{#rollLess() roll 99}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollLess() roll 99}}
                        {{/rollLess() herculean_fumble 101}}
                        {{/rollGreater() roll 95}}
                        <!-- 6 to 95 Normal Logic -->
                        {{#rollBetween() roll 6 95}}
                        <!-- roll > total (fail) -->
                        {{#rollGreater() roll herculean}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollGreater() roll herculean}}
                        <!-- roll <= total -->
                        {{#^rollGreater() roll herculean}}
                        <!-- roll > crit (success) -->
                        {{#rollGreater() roll herculean_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="success">3</span>
                        {{/rollGreater() roll herculean_crit}}
                        <!-- roll <= crit (crit) -->
                        {{#^rollGreater() roll herculean_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="critical">S</span>
                        {{/^rollGreater() roll herculean_crit}}
                        {{/^rollGreater() roll herculean}}
                        {{/rollBetween() roll 6 95}}
                        <!-- 5- Auto Fail -->
                        {{#rollLess() roll 6}}
                        <!-- roll > crit (success) -->
                        {{#rollGreater() roll herculean_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="success">3</span>
                        {{/rollGreater() roll herculean_crit}}
                        <!-- roll <= crit (crit) -->
                        {{#^rollGreater() roll herculean_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="critical">S</span>
                        {{/^rollGreater() roll herculean_crit}}
                        {{/rollLess() roll 6}}
                    </div>
                </div>
            </div>
            {{/rollTotal() difficulty 0}}

            {{#rollTotal() difficulty 1}}
            <div class="sheet-tr">
                <div class="sheet-td">
                    <div class="sheet-very-easy" data-i18n="very_easy">Very Easy</div>
                </div>
                <div class="sheet-td">
                    <div class="sheet-very-easy">
                        <div class="sheet-flex">
                            <div class="sheet-grow">{{very_easy}}</div>
                            <div class="sheet-grow">{{very_easy_crit}}</div>
                        </div>
                    </div>
                </div>
                <div class="sheet-td">
                    <div class="sheet-very-easy">
                        <!-- 95+ Auto Fail -->
                        {{#rollGreater() roll 95}}
                        <!-- score > 100 -->
                        {{#rollGreater() very_easy_fumble 100}}
                        <!-- roll = 100 (fumble) -->
                        {{#rollTotal() roll 100}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fumble">!</span>
                        {{/rollTotal() roll 100}}
                        <!-- roll < 100 (fail) -->
                        {{#rollLess() roll 100}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollLess() roll 100}}
                        {{/rollGreater() very_easy_fumble 100}}
                        <!-- score <= 100 -->
                        {{#rollLess() very_easy_fumble 101}}
                        <!-- roll 99 to 100 (fumble) -->
                        {{#rollGreater() roll 98}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fumble">!</span>
                        {{/rollGreater() roll 98}}
                        <!-- roll < 99 (fail) -->
                        {{#rollLess() roll 99}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollLess() roll 99}}
                        {{/rollLess() very_easy_fumble 101}}
                        {{/rollGreater() roll 95}}
                        <!-- 6 to 95 Normal Logic -->
                        {{#rollBetween() roll 6 95}}
                        <!-- roll > total (fail) -->
                        {{#rollGreater() roll very_easy}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollGreater() roll very_easy}}
                        <!-- roll <= total -->
                        {{#^rollGreater() roll very_easy}}
                        <!-- roll > crit (success) -->
                        {{#rollGreater() roll very_easy_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="success">3</span>
                        {{/rollGreater() roll very_easy_crit}}
                        <!-- roll <= crit (crit) -->
                        {{#^rollGreater() roll very_easy_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="critical">S</span>
                        {{/^rollGreater() roll very_easy_crit}}
                        {{/^rollGreater() roll very_easy}}
                        {{/rollBetween() roll 6 95}}
                        <!-- 5- Auto Fail -->
                        {{#rollLess() roll 6}}
                        <!-- roll > crit (success) -->
                        {{#rollGreater() roll very_easy_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="success">3</span>
                        {{/rollGreater() roll very_easy_crit}}
                        <!-- roll <= crit (crit) -->
                        {{#^rollGreater() roll very_easy_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="critical">S</span>
                        {{/^rollGreater() roll very_easy_crit}}
                        {{/rollLess() roll 6}}
                    </div>
                </div>
            </div>
            {{/rollTotal() difficulty 1}}

            {{#rollTotal() difficulty 2}}
            <div class="sheet-tr">
                <div class="sheet-td">
                    <div class="sheet-easy" data-i18n="easy">Easy</div>
                </div>
                <div class="sheet-td">
                    <div class="sheet-easy">
                        <div class="sheet-flex">
                            <div class="sheet-grow">{{easy}}</div>
                            <div class="sheet-grow">{{easy_crit}}</div>
                        </div>
                    </div>
                </div>
                <div class="sheet-td">
                    <div class="sheet-easy">
                        <!-- 95+ Auto Fail -->
                        {{#rollGreater() roll 95}}
                        <!-- score > 100 -->
                        {{#rollGreater() easy_fumble 100}}
                        <!-- roll = 100 (fumble) -->
                        {{#rollTotal() roll 100}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fumble">!</span>
                        {{/rollTotal() roll 100}}
                        <!-- roll < 100 (fail) -->
                        {{#rollLess() roll 100}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollLess() roll 100}}
                        {{/rollGreater() easy_fumble 100}}
                        <!-- score <= 100 -->
                        {{#rollLess() easy_fumble 101}}
                        <!-- roll 99 to 100 (fumble) -->
                        {{#rollGreater() roll 98}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fumble">!</span>
                        {{/rollGreater() roll 98}}
                        <!-- roll < 99 (fail) -->
                        {{#rollLess() roll 99}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollLess() roll 99}}
                        {{/rollLess() easy_fumble 101}}
                        {{/rollGreater() roll 95}}
                        <!-- 6 to 95 Normal Logic -->
                        {{#rollBetween() roll 6 95}}
                        <!-- roll > total (fail) -->
                        {{#rollGreater() roll easy}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollGreater() roll easy}}
                        <!-- roll <= total -->
                        {{#^rollGreater() roll easy}}
                        <!-- roll > crit (success) -->
                        {{#rollGreater() roll easy_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="success">3</span>
                        {{/rollGreater() roll easy_crit}}
                        <!-- roll <= crit (crit) -->
                        {{#^rollGreater() roll easy_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="critical">S</span>
                        {{/^rollGreater() roll easy_crit}}
                        {{/^rollGreater() roll easy}}
                        {{/rollBetween() roll 6 95}}
                        <!-- 5- Auto Fail -->
                        {{#rollLess() roll 6}}
                        <!-- roll > crit (success) -->
                        {{#rollGreater() roll easy_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="success">3</span>
                        {{/rollGreater() roll easy_crit}}
                        <!-- roll <= crit (crit) -->
                        {{#^rollGreater() roll easy_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="critical">S</span>
                        {{/^rollGreater() roll easy_crit}}
                        {{/rollLess() roll 6}}
                    </div>
                </div>
            </div>
            {{/rollTotal() difficulty 2}}

            {{#rollTotal() difficulty 3}}
            <div class="sheet-tr">
                <div class="sheet-td">
                    <div class="sheet-standard" data-i18n="standard">Standard</div>
                </div>
                <div class="sheet-td">
                    <div class="sheet-standard">
                        <div class="sheet-flex">
                            <div class="sheet-grow">{{standard}}</div>
                            <div class="sheet-grow">{{standard_crit}}</div>
                        </div>
                    </div>
                </div>
                <div class="sheet-td">
                    <div class="sheet-standard">
                        <!-- 95+ Auto Fail -->
                        {{#rollGreater() roll 95}}
                        <!-- score > 100 -->
                        {{#rollGreater() standard_fumble 100}}
                        <!-- roll = 100 (fumble) -->
                        {{#rollTotal() roll 100}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fumble">!</span>
                        {{/rollTotal() roll 100}}
                        <!-- roll < 100 (fail) -->
                        {{#rollLess() roll 100}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollLess() roll 100}}
                        {{/rollGreater() standard_fumble 100}}
                        <!-- score <= 100 -->
                        {{#rollLess() standard_fumble 101}}
                        <!-- roll 99 to 100 (fumble) -->
                        {{#rollGreater() roll 98}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fumble">!</span>
                        {{/rollGreater() roll 98}}
                        <!-- roll < 99 (fail) -->
                        {{#rollLess() roll 99}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollLess() roll 99}}
                        {{/rollLess() standard_fumble 101}}
                        {{/rollGreater() roll 95}}
                        <!-- 6 to 95 Normal Logic -->
                        {{#rollBetween() roll 6 95}}
                        <!-- roll > total (fail) -->
                        {{#rollGreater() roll standard}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollGreater() roll standard}}
                        <!-- roll <= total -->
                        {{#^rollGreater() roll standard}}
                        <!-- roll > crit (success) -->
                        {{#rollGreater() roll standard_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="success">3</span>
                        {{/rollGreater() roll standard_crit}}
                        <!-- roll <= crit (crit) -->
                        {{#^rollGreater() roll standard_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="critical">S</span>
                        {{/^rollGreater() roll standard_crit}}
                        {{/^rollGreater() roll standard}}
                        {{/rollBetween() roll 6 95}}
                        <!-- 5- Auto Fail -->
                        {{#rollLess() roll 6}}
                        <!-- roll > crit (success) -->
                        {{#rollGreater() roll standard_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="success">3</span>
                        {{/rollGreater() roll standard_crit}}
                        <!-- roll <= crit (crit) -->
                        {{#^rollGreater() roll standard_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="critical">S</span>
                        {{/^rollGreater() roll standard_crit}}
                        {{/rollLess() roll 6}}
                    </div>
                </div>
            </div>
            {{/rollTotal() difficulty 3}}

            {{#rollTotal() difficulty 4}}
            <div class="sheet-tr">
                <div class="sheet-td">
                    <div class="sheet-hard" data-i18n="hard">Hard</div>
                </div>
                <div class="sheet-td">
                    <div class="sheet-hard">
                        <div class="sheet-flex">
                            <div class="sheet-grow">{{hard}}</div>
                            <div class="sheet-grow">{{hard_crit}}</div>
                        </div>
                    </div>
                </div>
                <div class="sheet-td">
                    <div class="sheet-hard">
                        <!-- 95+ Auto Fail -->
                        {{#rollGreater() roll 95}}
                        <!-- score > 100 -->
                        {{#rollGreater() hard_fumble 100}}
                        <!-- roll = 100 (fumble) -->
                        {{#rollTotal() roll 100}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fumble">!</span>
                        {{/rollTotal() roll 100}}
                        <!-- roll < 100 (fail) -->
                        {{#rollLess() roll 100}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollLess() roll 100}}
                        {{/rollGreater() hard_fumble 100}}
                        <!-- score <= 100 -->
                        {{#rollLess() hard_fumble 101}}
                        <!-- roll 99 to 100 (fumble) -->
                        {{#rollGreater() roll 98}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fumble">!</span>
                        {{/rollGreater() roll 98}}
                        <!-- roll < 99 (fail) -->
                        {{#rollLess() roll 99}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollLess() roll 99}}
                        {{/rollLess() hard_fumble 101}}
                        {{/rollGreater() roll 95}}
                        <!-- 6 to 95 Normal Logic -->
                        {{#rollBetween() roll 6 95}}
                        <!-- roll > total (fail) -->
                        {{#rollGreater() roll hard}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollGreater() roll hard}}
                        <!-- roll <= total -->
                        {{#^rollGreater() roll hard}}
                        <!-- roll > crit (success) -->
                        {{#rollGreater() roll hard_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="success">3</span>
                        {{/rollGreater() roll hard_crit}}
                        <!-- roll <= crit (crit) -->
                        {{#^rollGreater() roll hard_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="critical">S</span>
                        {{/^rollGreater() roll hard_crit}}
                        {{/^rollGreater() roll hard}}
                        {{/rollBetween() roll 6 95}}
                        <!-- 5- Auto Fail -->
                        {{#rollLess() roll 6}}
                        <!-- roll > crit (success) -->
                        {{#rollGreater() roll hard_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="success">3</span>
                        {{/rollGreater() roll hard_crit}}
                        <!-- roll <= crit (crit) -->
                        {{#^rollGreater() roll hard_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="critical">S</span>
                        {{/^rollGreater() roll hard_crit}}
                        {{/rollLess() roll 6}}
                    </div>
                </div>
            </div>
            {{/rollTotal() difficulty 4}}

            {{#rollTotal() difficulty 5}}
            <div class="sheet-tr">
                <div class="sheet-td">
                    <div class="sheet-formidable" data-i18n="formidable">Formidable</div>
                </div>
                <div class="sheet-td">
                    <div class="sheet-formidable">
                        <div class="sheet-flex">
                            <div class="sheet-grow">{{formidable}}</div>
                            <div class="sheet-grow">{{formidable_crit}}</div>
                        </div>
                    </div>
                </div>
                <div class="sheet-td">
                    <div class="sheet-formidable">
                        <!-- 95+ Auto Fail -->
                        {{#rollGreater() roll 95}}
                        <!-- score > 100 -->
                        {{#rollGreater() formidable_fumble 100}}
                        <!-- roll = 100 (fumble) -->
                        {{#rollTotal() roll 100}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fumble">!</span>
                        {{/rollTotal() roll 100}}
                        <!-- roll < 100 (fail) -->
                        {{#rollLess() roll 100}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollLess() roll 100}}
                        {{/rollGreater() formidable_fumble 100}}
                        <!-- score <= 100 -->
                        {{#rollLess() formidable_fumble 101}}
                        <!-- roll 99 to 100 (fumble) -->
                        {{#rollGreater() roll 98}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fumble">!</span>
                        {{/rollGreater() roll 98}}
                        <!-- roll < 99 (fail) -->
                        {{#rollLess() roll 99}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollLess() roll 99}}
                        {{/rollLess() formidable_fumble 101}}
                        {{/rollGreater() roll 95}}
                        <!-- 6 to 95 Normal Logic -->
                        {{#rollBetween() roll 6 95}}
                        <!-- roll > total (fail) -->
                        {{#rollGreater() roll formidable}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollGreater() roll formidable}}
                        <!-- roll <= total -->
                        {{#^rollGreater() roll formidable}}
                        <!-- roll > crit (success) -->
                        {{#rollGreater() roll formidable_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="success">3</span>
                        {{/rollGreater() roll formidable_crit}}
                        <!-- roll <= crit (crit) -->
                        {{#^rollGreater() roll formidable_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="critical">S</span>
                        {{/^rollGreater() roll formidable_crit}}
                        {{/^rollGreater() roll formidable}}
                        {{/rollBetween() roll 6 95}}
                        <!-- 5- Auto Fail -->
                        {{#rollLess() roll 6}}
                        <!-- roll > crit (success) -->
                        {{#rollGreater() roll formidable_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="success">3</span>
                        {{/rollGreater() roll formidable_crit}}
                        <!-- roll <= crit (crit) -->
                        {{#^rollGreater() roll formidable_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="critical">S</span>
                        {{/^rollGreater() roll formidable_crit}}
                        {{/rollLess() roll 6}}
                    </div>
                </div>
            </div>
            {{/rollTotal() difficulty 5}}

            {{#rollTotal() difficulty 6}}
            <div class="sheet-tr">
                <div class="sheet-td">
                    <div class="sheet-herculean" data-i18n="herculean">Herculean</div>
                </div>
                <div class="sheet-td">
                    <div class="sheet-herculean">
                        <div class="sheet-flex">
                            <div class="sheet-grow">{{herculean}}</div>
                            <div class="sheet-grow">{{herculean_crit}}</div>
                        </div>
                    </div>
                </div>
                <div class="sheet-td">
                    <div class="sheet-herculean">
                        <!-- 95+ Auto Fail -->
                        {{#rollGreater() roll 95}}
                        <!-- score > 100 -->
                        {{#rollGreater() herculean_fumble 100}}
                        <!-- roll = 100 (fumble) -->
                        {{#rollTotal() roll 100}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fumble">!</span>
                        {{/rollTotal() roll 100}}
                        <!-- roll < 100 (fail) -->
                        {{#rollLess() roll 100}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollLess() roll 100}}
                        {{/rollGreater() herculean_fumble 100}}
                        <!-- score <= 100 -->
                        {{#rollLess() herculean_fumble 101}}
                        <!-- roll 99 to 100 (fumble) -->
                        {{#rollGreater() roll 98}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fumble">!</span>
                        {{/rollGreater() roll 98}}
                        <!-- roll < 99 (fail) -->
                        {{#rollLess() roll 99}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollLess() roll 99}}
                        {{/rollLess() herculean_fumble 101}}
                        {{/rollGreater() roll 95}}
                        <!-- 6 to 95 Normal Logic -->
                        {{#rollBetween() roll 6 95}}
                        <!-- roll > total (fail) -->
                        {{#rollGreater() roll herculean}}
                        {{roll}} <span class="sheet-result" data-i18n-title="fail">&ast;</span>
                        {{/rollGreater() roll herculean}}
                        <!-- roll <= total -->
                        {{#^rollGreater() roll herculean}}
                        <!-- roll > crit (success) -->
                        {{#rollGreater() roll herculean_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="success">3</span>
                        {{/rollGreater() roll herculean_crit}}
                        <!-- roll <= crit (crit) -->
                        {{#^rollGreater() roll herculean_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="critical">S</span>
                        {{/^rollGreater() roll herculean_crit}}
                        {{/^rollGreater() roll herculean}}
                        {{/rollBetween() roll 6 95}}
                        <!-- 5- Auto Fail -->
                        {{#rollLess() roll 6}}
                        <!-- roll > crit (success) -->
                        {{#rollGreater() roll herculean_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="success">3</span>
                        {{/rollGreater() roll herculean_crit}}
                        <!-- roll <= crit (crit) -->
                        {{#^rollGreater() roll herculean_crit}}
                        {{roll}} <span class="sheet-result" data-i18n-title="critical">S</span>
                        {{/^rollGreater() roll herculean_crit}}
                        {{/rollLess() roll 6}}
                    </div>
                </div>
            </div>
            {{/rollTotal() difficulty 6}}
            <!-- Skill result table end -->
        </div>

        {{#notes}}
        <div class="sheet-listitem">{{notes}}</div>
        {{/notes}}

        {{#combatstyle}}
        <div class="sheet-listitem">
            <div class="sheet-key"><span data-i18n-title="special_effects" data-i18n="special_effects">Special Effects</span>:</div>
            <div class="sheet-value">[Choose](~{{character_id}}|special_effects)</div>
        </div>
        <div class="sheet-listitem">
            <div class="sheet-key"><span data-i18n="hit_location">Hit Location</span>:</div>
            <div class="sheet-value">[Low](~target|hit_location_low) [Standard](~target|hit_location) [High](~target|hit_location_high)</div>
        </div>
        {{#weapon_buttons}}
        <div class="sheet-listitem">
            <div class="sheet-key"><span data-i18n="weapon">Weapon</span>:</div>
            <div class="sheet-value">{{weapon_buttons}}</div>
        </div>
        {{/weapon_buttons}}
        {{/combatstyle}}

        {{#spiritcombat}}
        <div class="sheet-listitem">
            <div class="sheet-key"><span data-i18n-title="special_effects" data-i18n="special_effects">Special Effects</span>:</div>
            <div class="sheet-value">[Choose](~{{character_id}}|special_effects)</div>
        </div>
        <div class="sheet-listitem">
            <div class="sheet-key"><span data-i18n="damage">Damage</span>:</div>
            <div class="sheet-value">[Spirit Damage](~{{character_id}}|spirit_damage)</div>
        </div>
        {{/spiritcombat}}

        {{#socialoffense}}
        <div class="sheet-listitem">
            <div class="sheet-key"><span data-i18n-title="special_effects" data-i18n="special_effects">Special Effects</span>:</div>
            <div class="sheet-value">[Choose](~{{character_id}}|special_effects)</div>
        </div>
        <div class="sheet-listitem">
            <div class="sheet-key"><span data-i18n="hit_location">Hit Location</span>:</div>
            <div class="sheet-value">[Resolution Pool](~{{character_id}}|resolution_pool)</div>
        </div>
        <div class="sheet-listitem">
            <div class="sheet-key"><span data-i18n="damage">Damage</span>:</div>
            <div class="sheet-value">[Social Damage](~{{character_id}}|social_damage)</div>
        </div>
        {{/socialoffense}}

        {{#socialdefense}}
        <div class="sheet-listitem">
            <div class="sheet-key"><span data-i18n-title="special_effects" data-i18n="special_effects">Special Effects</span>:</div>
            <div class="sheet-value">[Choose](~{{character_id}}|special_effects)</div>
        </div>
        {{/socialdefense}}
    </div>
</rolltemplate>



<!-- Improvement Roll Template -->
<!-- @{roll_display}&{template:weapon} {{name=@{name}}} {{character=@{character_name}}} {{damage=[[@{damage}+@{damage_mod_toggle}]]}} {{size=@{size}}} {{reach=@{reach}}} {{force=@{force}}} {{range=@{range}}} {{impale_size=@{impale_size}}} {{notes=@{notes}}} -->
<rolltemplate class="sheet-rolltemplate-weapon">
    <div class="sheet-border">
        <div class="sheet-header">
            <div class="sheet-character">{{character}}</div>
            <div class="sheet-name">{{name}}</div>
        </div>
        <div class="sheet-table">
            <div class="sheet-tr">
                <div class="sheet-th"><span data-i18n="damage">Damage</span></div>
                {{#size}}
                <div class="sheet-th"><span data-i18n="size">Size</span></div>
                {{/size}}
                {{#force}}
                <div class="sheet-th"><span data-i18n="force">Force</span></div>
                {{/force}}
                {{#reach}}
                <div class="sheet-th"><span data-i18n="reach">Reach</span></div>
                {{/reach}}
                {{#range}}
                <div class="sheet-th"><span data-i18n="range">Range</span></div>
                {{/range}}
                {{#impale_size}}
                <div data-i18n-title="impale_size" class="sheet-th sheet-help"><span data-i18n="impale_size-abrv">IS</span></div>
                {{/impale_size}}
            </div>
            <div class="sheet-tr">
                <div class="sheet-td sheet-bold">{{damage}}</div>
                {{#size}}
                <div class="sheet-td">{{size}}</div>
                {{/size}}
                {{#force}}
                <div class="sheet-td">{{force}}</div>
                {{/force}}
                {{#reach}}
                <div class="sheet-td">{{reach}}</div>
                {{/reach}}
                {{#range}}
                <div class="sheet-td">{{range}}</div>
                {{/range}}
                {{#impale_size}}
                <div class="sheet-td">{{impale_size}}</div>
                {{/impale_size}}
            </div>
        </div>
    </div>
</rolltemplate><script type="text/worker">
const debug=1

/* TODO changing sheet type sets hit table rolls */

/* Campaign Options */
const campaignSettings = ["action_points_calc", "dependencies_enabled", "extended_conflict_enabled", "herculean_mod", "luck_points_rank", "magic_points_enabled", "prana_points_enabled", "power_points_enabled", "reach_enabled", "simplified_combat_enabled", "social_conflict_enabled", "spirits_enabled", "tenacity_enabled"];
const campaginSettingDefaults = {
    "default": {
        "action_points_calc": "calculate",
        "dependencies_enabled": 0,
        "extended_conflict_enabled": 0,
        "herculean_mod": ".1",
        "luck_points_rank": 0,
        "magic_points_enabled": 1,
        "prana_points_enabled": 0,
        "power_points_enabled": 0,
        "reach_enabled": 1,
        "simplified_combat_enabled": 0,
        "spirits_enabled": 1,
        "social_conflict_enabled": 1,
        "tenacity_enabled": 0
    },
    "after_the_vampire_wars": {},
    "classic_fantasy": {
        "luck_points_rank": 1
    },
    "destined": {
        "magic_points_enabled": 0,
        "power_points_enabled": 1,
        "spirits_enabled": 0
    },
    "fioracitta": {},
    "luther_arkwright": {
        "dependencies_enabled": 1,
        "magic_points_enabled": 0,
        "prana_points_enabled": 1,
        "spirits_enabled": 0,
        "tenacity_enabled": 1,
    },
    "lyonesse": {},
    "m-space": {
        "action_points_calc": "set_2",
        "extended_conflict_enabled": 1,
        "herculean_mod": ".2",
        "magic_points_enabled": 0,
        "power_points_enabled": 1,
        "reach_enabled": 0,
        "spirits_enabled": 0
    },
    "monster_island": {},
    "mythic_babylon": {},
    "mythic_britain": {},
    "mythic_constantinople": {},
    "mythras_imperative": {
        "action_points_calc": "set_2",
        "herculean_mod": ".2",
        "reach_enabled": 0,
        "spirits_enabled": 0
    },
    "mythic_rome": {
        "spirits_enabled": 0
    },
    "odd_soot": {
        "action_points_calc": "set_2",
        "extended_conflict_enabled": 1,
        "herculean_mod": ".2",
        "reach_enabled": 0,
        "spirits_enabled": 0
    },
    "perceforest": {
    },
    "thennla": {},
    "worlds_united": {
        "magic_points_enabled": 0,
        "tenacity_enabled": 1,
        "spirits_enabled": 0
    }
}
/**
 * Will either return the campaignSettingOption if overridden, otherwise will get the setting default value
 * @param campaignSetting the variable name of the campaign setting
 * @param campaignSettingOption the value of the campaign setting option variable
 * @param setting the selected campaign setting
 * @returns {*} object of new calculated attributes
 */
function calcCampaignSetting(campaignSetting, campaignSettingOption, setting) {
    if (campaignSettingOption === 'default') {
        if ((setting in campaginSettingDefaults) && (campaignSetting in campaginSettingDefaults[setting])) {
            return {[`${campaignSetting}`]: campaginSettingDefaults[setting][campaignSetting]};
        } else {
            return {[`${campaignSetting}`]: campaginSettingDefaults['default'][campaignSetting]};
        }
    } else {
        return {[`${campaignSetting}`]: campaignSettingOption};
    }
}
/* Trigger setting change */
on(`change:setting`, function(event) {
    /* Get an array of option values to get */
    const campaignSettingOptions = campaignSettings.map(function(campaignSetting){
        return `${campaignSetting}_option`;
    })
    getAttrs(campaignSettingOptions, function(v) {
        let newAttrs = {};
        campaignSettings.forEach(campaignSetting => { /* Gather all setting values per new setting */
            newAttrs = {...newAttrs,
                ...calcCampaignSetting(campaignSetting, v[`${campaignSetting}_option`], event.newValue)
            }
        });
        setAttrs(newAttrs);
    });
});
/* Trigger for all the individual campaign setting option values */
campaignSettings.forEach(campaignSetting => {
    on(`change:${campaignSetting}_option`, function(event) {
        getAttrs(['setting'], function(v) {
            setAttrs(calcCampaignSetting(`${campaignSetting}`, event.newValue, v['setting']));
        });
    });
});

/* Option Bar Action Buttons */
on('clicked:reset-augmentation', function(event) {
    setAttrs({set_augmentation: 0});
});
on('clicked:reset-penalty', function(event) {
    setAttrs({set_penalty: 0});
});

/* Utility Functions */
const damageSteps = ['1d2','1d4','1d6','1d8','1d10','2d6','1d8+1d6','2d8','1d10+1d8','2d10','2d10+1d2','2d10+1d4',
    '2d10+1d6','2d10+1d8','3d10','3d10+1d2','3d10+1d4']
function damageTable(step) {
    if (step < 0) {
        return damageSteps[0];
    } else if (step > 16) {
        return damageSteps[16];
    } else {
        return damageSteps[step];
    }
}
const damageStepsReverse = {'1d2': 0, '1d4': 1, '1d6': 2, '1d8': 3, '1d10': 4, '2d6': 5, '1d8+1d6': 6, '2d8': 7,
    '1d10+1d8': 8, '2d10': 9, '2d10+1d2': 10, '2d10+1d4': 11, '2d10+1d6': 12, '2d10+1d8': 13, '3d10': 14,
    '3d10+1d2': 15, '3d10+1d4': 16
}
function damageTableReverse(value) {
    if (!(value in damageStepsReverse) && value.startsWith('-')) {
        return 0;
    } else if (!(value in damageStepsReverse) && !value.startsWith('-')) {
        return 22;
    } else {
        return damageStepsReverse[value];
    }
}

/* Type Specific Scripts */
/* Characteristics */
const characteristicAttrs = ['str', 'con', 'siz', 'dex', 'int', 'pow', 'cha'];
characteristicAttrs.forEach(char => {
    on(`change:${char}_base change:${char}`, function(event) {
        if (event.sourceType === "sheetworker") {return;}

        let repeatingIds = {}
        getSectionIDs("repeating_meleeweapon", function(meleeWeaponIds) {
            repeatingIds['meleeWeaponIds'] = meleeWeaponIds;
            getSectionIDs("repeating_rangedweapon", function(rangedWeaponIds) {
                repeatingIds['rangedWeaponIds'] = rangedWeaponIds;
                getSectionIDs("repeating_equipment", function(gearIds) {
                    repeatingIds['gearIds'] = gearIds;
                    getSectionIDs("repeating_currency", function(currencyIds) {
                        repeatingIds['currencyIds'] = currencyIds;
                        getAttrs([`${char}_base`, `${char}_temp`, `${char}_pool`, `${char}`].concat(characteristicAttrs,
                            encGetAttrs(repeatingIds), actionPointGetAttrs, confidenceGetAttrs, damageModGetAttrs, expModGetAttrs,
                            healingRateGetAttrs, initGetAttrs, luckPointsGetAttrs, magicPointsGetAttrs, tenacityGetAttrs, hpGetAttrs,
                            moveRateGetAttrs, spiritIntensityGetAttrs, composureGetAttrs, integrityGetAttrs, resolveGetAttrs,
                            spiritDamageGetAttrs, socialDamageGetAttrs), function(v) {
                            let newAttrs = {};
                            const baseCharVal = parseInt(v[`${char}_base`]) || 0;
                            const tempCharVal = parseInt(v[`${char}_temp`]) || 0;
                            const currCharVal = parseInt(v[`${char}`]) || 0;
                            const currPoolVal = parseInt(v[`${char}_pool`]) || 0;

                            if (event.sourceAttribute === `${char}`) {
                                newAttrs[`${char}_temp`] = currCharVal - baseCharVal;
                                const diffVal = newAttrs[`${char}_temp`] - tempCharVal;
                                newAttrs[`${char}_pool`] = currPoolVal + diffVal;
                            } else if (event.sourceAttribute === `${char}_base`) {
                                newAttrs[`${char}`] = baseCharVal + tempCharVal;
                                const diffVal = newAttrs[`${char}`] - currCharVal;
                                newAttrs[`${char}_pool`] = currPoolVal + diffVal;
                                v[`${char}`] = baseCharVal + tempCharVal; /* override the old value from getAttr, so we can base other calculations on the new value */
                            }

                            /* TODO calc allstdskills & proskills & combat styles */

                            let newEncAttrs = calcEncAndArmorPenalty(repeatingIds, v);
                            /* Update v with new values need for attribute calculations */
                            v = {...v, ...newEncAttrs};
                            setAttrs({
                                ...newAttrs,
                                ...newEncAttrs,
                                ...calcActionPoints(v, event.sourceAttribute),
                                ...calcConfidence(v),
                                ...calcDamageMod(v),
                                ...calcExpMod(v),
                                ...calcHealingRate(v),
                                ...calcInitiativeBonus(v),
                                ...calcLuckPoints(v, event.sourceAttribute),
                                ...calcMagicPoints(v, event.sourceAttribute),
                                ...calcMoveRate(v),
                                ...calcSpiritIntensity(v),
                                ...calcTenacity(v, event.sourceAttribute),
                                ...calcAllHP(v),
                                ...calcComposure(v),
                                ...calcIntegrity(v),
                                ...calcResolve(v)
                                /* No need for teh social and spirit damage here since it would have been done via skills */
                            });
                        });
                    });
                });
            });
        });
    });
});

/* Action Points */
const actionPointGetAttrs = ['dex', 'int', 'pow', 'action_points_other', 'action_points_temp', 'action_points_calc', 'action_points', 'action_points_max', 'fatigue', 'attribute_mode']
function calcActionPoints(v, sourceAttribute) {
    let newAttrs = {};
    const int = parseInt(v['int']) || 0;
    const action_points_other = parseInt(v['action_points_other']) || 0;
    const action_points_temp = parseInt(v['action_points_temp']) || 0;
    const action_points_max = parseInt(v['action_points_max']) || 0;
    const action_points = parseInt(v['action_points']) || 0;
    const fatigueMod = parseInt(fatigueTable[v['fatigue']]['action_points']) || 0;

    if (v['action_points_calc'] === "set_2") {
        newAttrs['action_points_base'] = 2 + action_points_other;
    } else if (v['action_points_calc'] === "set_3") {
        newAttrs['action_points_base'] = 3 + action_points_other;
    } else {
        if (v['attribute_mode'] === 'physical') {
            const dex = parseInt(v['dex']) || 0;
            newAttrs['action_points_base'] = Math.ceil((int + dex) / 12) + action_points_other + fatigueMod;
        } else if (v['attribute_mode'] === 'spiritual') {
            const pow = parseInt(v['pow']) || 0;
            newAttrs['action_points_base'] = Math.ceil((int + pow) / 12) + action_points_other; /* I assume fatigue doesn't affect spirit */
        } else {
            newAttrs['action_points_base'] = 3 + fatigueMod;
        }
    }

    let diffVal;
    if (sourceAttribute === 'action_points_max') {
        newAttrs['action_points_temp'] = action_points_max - newAttrs['action_points_base'];
        diffVal = newAttrs['action_points_temp'] - action_points_temp;
    } else {
        newAttrs['action_points_max'] = newAttrs['action_points_base'] + action_points_temp;
        diffVal = newAttrs['action_points_max'] - action_points_max;
    }

    newAttrs['action_points'] = action_points + diffVal;
    return newAttrs;
}
on('change:action_points_other change:action_points_max', function(event) {
    if (event.sourceType === "sheetworker") {return;}
    getAttrs(actionPointGetAttrs, function(v) {
        setAttrs(calcActionPoints(v, event.sourceAttribute));
    });
});
on('change:action_points_calc', function(event) {
    /* Don't exit on sheetworker cause humans will modify the option not the setting itself */
    getAttrs(actionPointGetAttrs, function(v) {
        setAttrs({
            ...calcActionPoints(v, event.sourceAttribute)
        });
    });
});

/* Confidence */
const confidenceGetAttrs = ['confidence_other', 'confidence_base', 'confidence', 'willpower']
function calcConfidence(v) {
    let newAttrs = {};
    const confidenceOther = parseInt(v['confidence_other']) || 0;
    const confidenceBase = parseInt(v['confidence_base']) || 0;
    const confidence = parseInt(v['confidence']) || 0;
    const willpower = parseInt(v['willpower']) || 0;
    newAttrs['confidence_base'] = Math.floor(willpower/20) + confidenceOther;
    const diffVal = newAttrs['confidence_base'] - confidenceBase;
    newAttrs['confidence'] = confidence + diffVal;

    return newAttrs;
}
on('change:confidence_other', function(event) {
    if (event.sourceType === "sheetworker") {return;}
    getAttrs(confidenceGetAttrs, function(v) {
        setAttrs(calcConfidence(v));
    });
});

/* Social Damage */
const socialDamageGetAttrs = ['social_offense_id', 'social_offense_total', 'social_damage_other', 'social_damage_base', 'social_damage'];
/**
 * Calculate the social damage value
 * @param v attrs needed for calc; socialDamageGetAttrs
 * @returns {}
 */
function calcSocialDamage(v) {
    let newAttrs = {};
    let socialOffenseSkill = parseInt(v['social_offense_total']) || 0;
    const socialOffenseOther = parseInt(v['social_offense_other']) || 0;
    const newSocialDamageStep = Math.ceil(socialOffenseSkill/20) + socialOffenseOther - 1;
    newAttrs['social_damage_base'] = damageTable(newSocialDamageStep);
    const socialDamageBaseStep = damageTableReverse(v['social_damage_base']);
    const socialDamageStep = damageTableReverse(v['social_damage']);
    const diffVal = socialDamageStep - socialDamageBaseStep;
    newAttrs['social_damage'] = damageTable(newSocialDamageStep + diffVal);

    return newAttrs;
}
on('change:social_damage_other', function(event) {
    if (event.sourceType === "sheetworker") {return;}
    getAttrs(socialDamageGetAttrs, function(v) {
        setAttrs(calcSocialDamage(v));
    });
});

/* Spirit Damage */
const spiritDamageGetAttrs = ['spirit_combat_skill_id', 'spirit_combat_skill_total', 'spirit_damage_other', 'spirit_damage_base', 'spirit_damage'];
/**
 * Calculate the spirt damage value
 * @param v attrs needed for calc; spiritDamageGetAttrs
 * @returns {}
 */
function calcSpiritDamage(v) {
    let newAttrs = {};
    let spiritCombatSkill = parseInt(v['spirit_combat_skill_total']) || 0;
    if (v['spirit_combat_skill_id'] === 'willpower') {
        spiritCombatSkill = Math.ceil(spiritCombatSkill/2);
    }
    const spiritDamageOther = parseInt(v['spirit_damage_other']) || 0;
    const newSpiritDamageStep = Math.ceil(spiritCombatSkill/20) + spiritDamageOther - 1;
    newAttrs['spirit_damage_base'] = damageTable(newSpiritDamageStep);
    const spiritDamageBaseStep = damageTableReverse(v['spirit_damage_base']);
    const spiritDamageStep = damageTableReverse(v['spirit_damage']);
    const diffVal = spiritDamageStep - spiritDamageBaseStep;
    newAttrs['spirit_damage'] = damageTable(newSpiritDamageStep + diffVal);

    return newAttrs;
}
on('change:spirit_damage_other', function(event) {
    if (event.sourceType === "sheetworker") {return;}
    getAttrs(spiritDamageGetAttrs, function(v) {
        setAttrs(calcSpiritDamage(v));
    });
});

/* Damage Modifier */
const damageModGetAttrs = ['str', 'siz', 'con', 'pow', 'damage_mod_calc', 'damage_mod_base', 'damage_mod_other', 'damage_mod'];
const damageModSteps = ['-1d8','-1d6','-1d4','-1d2','0','1d2','1d4','1d6','1d8','1d10','1d12','2d6','1d8+1d6','2d8',
    '1d10+1d8','2d10','2d10+1d2','2d10+1d4','2d10+1d6','2d10+1d8','3d10','3d10+1d2','3d10+1d4']
function damageModTable(step) {
    if (step < 0) {
        return damageModSteps[0];
    } else if (step > 22) {
        return damageModSteps[22];
    } else {
        return damageModSteps[step];
    }
}
const damageModStepsReverse = {'-1d8': 0, '-1d6': 1, '-1d4': 2, '-1d2': 3, '0': 4, '1d2': 5, '1d4': 6, '1d6': 7,
    '1d8': 8, '1d10': 9, '1d12': 10, '2d6': 11, '1d8+1d6': 12, '2d8': 13, '1d10+1d8': 14, '2d10': 15, '2d10+1d2': 16,
    '2d10+1d4': 17, '2d10+1d6': 18, '2d10+1d8': 19, '3d10': 20, '3d10+1d2': 21, '3d10+1d4': 22
}
function damageModTableReverse(value) {
    if (!(value in damageModStepsReverse) && value.startsWith('-')) {
        return 0;
    } else if (!(value in damageModStepsReverse) && !value.startsWith('-')) {
        return 22;
    } else {
        return damageModStepsReverse[value];
    }
}
/**
 * Calculate the damage modifier
 * @param v attrs needed for calc; damageModGetAttrs
 * @returns {}
 */
function calcDamageMod(v) {
    let damage_mod_table_value;
    const str = parseInt(v['str']) || 0;
    const siz = parseInt(v['siz']) || 0;
    const damageModOther = parseInt(v['damage_mod_other']) || 0;
    if (v['damage_mod_calc'] === '1') {
        const pow = parseInt(v['pow']) || 0;
        damage_mod_table_value = str + siz + pow;
    } else if (v['damage_mod_calc'] === '2') {
        const con = parseInt(v['con']) || 0;
        damage_mod_table_value = str + siz + con;
    } else {
        damage_mod_table_value = str + siz;
    }

    const base_damage_mod_step = Math.ceil(damage_mod_table_value / 5) - 1 + damageModOther;
    const currentDamageModBaseStep = damageModTableReverse(v['damage_mod_base']);
    const currentDamageModStep = damageModTableReverse(v['damage_mod']);
    const diffVal = currentDamageModStep - currentDamageModBaseStep;

    return {
        damage_mod_base: damageModTable(base_damage_mod_step),
        damage_mod: damageModTable(base_damage_mod_step + diffVal)
    };
}
on('change:damage_mod_other change:damage_mod_calc', function(event) {
    if (event.sourceType === "sheetworker") {return;}
    getAttrs(damageModGetAttrs, function(v) {
        setAttrs(calcDamageMod(v));
    });
});

/* Experience Modifier */
const expModGetAttrs = ['cha', 'int', 'experience_mod_calc', 'experience_mod_other', 'experience_mod_base', 'experience_mod'];
/**
 * Calculate Experience Modifier
 * @param v attributes needed for calc, expModGetAttrs
 * @returns {}
 */
function calcExpMod(v) {
    let newAttrs = {};
    const expModOther = parseInt(v['experience_mod_other']) || 0;
    const expModBase = parseInt(v['experience_mod_base']) || 0;
    const expMod = parseInt(v['experience_mod']) || 0;
    if(v['experience_mod_calc'] === '1') {
        const int = parseInt(v['int']) || 0;
        newAttrs['experience_mod_base'] = Math.ceil(int/6)-2 + expModOther;
    } else {
        const cha = parseInt(v['cha']) || 0;
        newAttrs['experience_mod_base'] = Math.ceil(cha/6)-2 + expModOther;
    }
    const diffVal = newAttrs['experience_mod_base'] - expModBase;
    newAttrs['experience_mod'] = expMod + diffVal;

    return newAttrs;
}
on('change:experience_mod_other change:experience_mod_calc', function(event) {
    if (event.sourceType === "sheetworker") {return;}
    getAttrs(expModGetAttrs, function(v) {
        setAttrs(calcExpMod(v));
    });
});

/* Experience Modifier */
const healingRateGetAttrs = ['con', 'pow', 'healing_rate_calc', 'healing_rate_other', 'healing_rate_base', 'healing_rate', 'healing_rate_double'];
/**
 * Calculate Healing Rate
 * @param v attributes needed for calc, healingRateGetAttrs
 * @returns {}
 */
function calcHealingRate(v) {
    let base_multiplier;
    let newAttrs = {};
    const con = parseInt(v['con']) || 0;
    const healingRateOther = parseInt(v['healing_rate_other']) || 0;
    const healingRateBase = parseInt(v['healing_rate_base']) || 0;
    const healingRate = parseInt(v['healing_rate']) || 0;
    if (v['healing_rate_double'] === '1') {
        base_multiplier = 2;
    } else {
        base_multiplier = 1;
    }

    if (v['healing_rate_calc'] === '1') {
        const pow = parseInt(v['pow']) || 0;
        newAttrs['healing_rate_base'] = (Math.ceil(Math.ceil(con+(pow/2))/6) * base_multiplier)+healingRateOther;
    } else {
        newAttrs['healing_rate_base'] = (Math.ceil(con/6) * base_multiplier)+healingRateOther;
    }
    const diffVal = newAttrs['healing_rate_base'] - healingRateBase;
    newAttrs['healing_rate'] = healingRate + diffVal;

    return newAttrs;
}
on('change:healing_rate_other change:healing_rate_calc change:healing_rate_double', function(event) {
    if (event.sourceType === "sheetworker") {return;}
    getAttrs(healingRateGetAttrs, function(v) {
        setAttrs(calcHealingRate(v));
    });
});

/* Initiative */
const initGetAttrs=['int', 'dex', 'cha', 'initiative_bonus_other', 'initiative_bonus_base', 'initiative_bonus',
    'armor_penalty', 'fatigue', 'athletics_total', 'initiative_add_one_tenth_athletics', 'attribute_mode']
/**
 * Calculate Initiative Bonus
 * @param v attrs needed for calculation, initGetAttrs
 * @returns {}
 */
function calcInitiativeBonus(v) {
    let newAttrs = {};
    const int = parseInt(v['int']) || 0;
    const initOther = parseInt(v['initiative_bonus_other']) || 0;
    const initBase = parseInt(v['initiative_bonus_base']) || 0;
    const init = parseInt(v['initiative_bonus']) || 0;
    const fatiguePenalty = parseInt(fatigueTable[v['fatigue']]['initiative']) || 0;
    if (v['attribute_mode'] === 'physical') {
        const dex = parseInt(v['dex']) || 0;
        const armor_penalty = parseInt(v['armor_penalty']) || 0;
        let athletics_bonus = 0;
        if (v['initiative_add_one_tenth_athletics'] === '1') {
            const athletics = parseInt(v['athletics_total']) || 0;
            athletics_bonus = Math.ceil(athletics/10);
        }
        newAttrs['initiative_bonus_base'] = Math.ceil((int + dex) / 2) + initOther + athletics_bonus + fatiguePenalty + armor_penalty;
    } else { /* Social and spirit initiative are the same */
        const cha = parseInt(v['cha']) || 0;
        newAttrs['initiative_bonus_base'] = Math.ceil((int + cha) / 2) + initOther;
    }

    const diffVal = newAttrs['initiative_bonus_base'] - initBase;
    newAttrs['initiative_bonus'] = init + diffVal;

    return newAttrs;
}
on('change:initiative_bonus_other change:initiative_add_one_tenth_athletics', function(event) {
    if (event.sourceType === "sheetworker") {return;}
    getAttrs(initGetAttrs, function(v) {
        setAttrs(calcInitiativeBonus(v));
    });
});

/* Luck Points */
const luckPointsGetAttrs=['pow', 'cha', 'luck_points_calc', 'luck_points_other', 'luck_points_temp', 'luck_points_rank', 'rank', 'luck_points', 'luck_points_max']
/**
 * Calculate Luck Points
 * @param v attrs needed for calculation, luckPointsGetAttrs
 * @param sourceAttribute the attr the triggered the change
 * @returns {}
 */
function calcLuckPoints(v, sourceAttribute) {
    let newAttrs = {};
    const pow = parseInt(v['pow']) || 0;
    const rank = parseInt(v['rank']) || 0;
    const luckPointsRank = parseInt(v['luck_points_rank']) || 0;
    const luckPointsOther = parseInt(v['luck_points_other']) || 0;
    const luckPointsTemp = parseInt(v['luck_points_temp']) || 0;
    const luckPointsMax = parseInt(v['luck_points_max']) || 0;
    const luckPointsCurr = parseInt(v['luck_points']) || 0;
    if (v['luck_points_calc'] === '1') {
        const cha = parseInt(v['cha']) || 0;
        newAttrs['luck_points_base'] = Math.ceil(Math.ceil(cha+(pow/2))/6) + luckPointsOther + (luckPointsRank * rank);
    } else {
        newAttrs['luck_points_base'] = Math.ceil(pow/6) + luckPointsOther + (luckPointsRank * rank);
    }

    let diffVal;
    if (sourceAttribute === 'luck_points_max') {
        newAttrs['luck_points_temp'] = luckPointsMax - newAttrs['luck_points_base'];
        diffVal = newAttrs['luck_points_temp'] - luckPointsTemp;
    } else {
        newAttrs['luck_points_max'] = newAttrs['luck_points_base'] + luckPointsTemp;
        diffVal = newAttrs['luck_points_max'] - luckPointsMax;
    }

    newAttrs['luck_points'] = luckPointsCurr + diffVal;
    return newAttrs;
}
on('change:luck_points_other change:luck_points_max change:luck_points_calc change:rank', function(event) {
    if (event.sourceType === "sheetworker") {return;}
    getAttrs(luckPointsGetAttrs, function(v) {
        setAttrs(calcLuckPoints(v, event.sourceAttribute));
    });
});
on('change:luck_points_rank', function(event) {
    /* Don't exit on sheetworker cause humans will modify the option not the setting itself */
    getAttrs(luckPointsGetAttrs, function(v) {
        setAttrs(calcLuckPoints(v, event.sourceAttribute));
    });
});

/* Magic Points */
const magicPointsGetAttrs = ['pow', 'magic_points_other', 'magic_points_temp', 'magic_points', 'magic_points_max'];
/**
 * Calculate Magic points
 * @param v attrs needed for calculation, magicPointsGetAttrs
 * @param sourceAttribute the attr the triggered the change
 * @returns {}
 */
function calcMagicPoints(v, sourceAttribute) {
    let newAttrs = {};
    const pow = parseInt(v['pow']) || 0;
    const magicPointsOther = parseInt(v['magic_points_other']) || 0;
    const magicPointsTemp = parseInt(v['magic_points_temp']) || 0;
    const magicPointsCurr = parseInt(v['magic_points']) || 0;
    const magicPointsMax = parseInt(v['magic_points_max']) || 0;
    newAttrs['magic_points_base'] = pow + magicPointsOther;

    let diffVal;
    if (sourceAttribute === 'magic_points_max') {
        newAttrs['magic_points_temp'] = magicPointsMax - newAttrs['magic_points_base'];
        diffVal = newAttrs['magic_points_temp'] - magicPointsTemp;
    } else {
        newAttrs['magic_points_max'] = newAttrs['magic_points_base'] + magicPointsTemp;
        diffVal = newAttrs['magic_points_max'] - magicPointsMax;
    }

    newAttrs['magic_points'] = magicPointsCurr + diffVal;
    return newAttrs;
}
on('change:magic_points_other change:magic_points_max', function(event) {
    if (event.sourceType === "sheetworker") {return;}
    getAttrs(magicPointsGetAttrs, function(v) {
        setAttrs(calcMagicPoints(v, event.sourceAttribute));
    });
});

/* Movement Rate */
const moveRateGetAttrs = ['movement_rate_species', 'movement_rate_other', 'movement_rate', 'movement_rate_base', 'fatigue', 'encumbrance_load'];
/**
 *
 * @param value
 * @param modifier
 * @returns {number|*}
 */
function applyMovementMod(value, modifier) {
    if (modifier === '-1') {
        return value - 1;
    } else if (modifier === '-2') {
        return value - 2;
    } else if (modifier === '*.5') {
        return Math.ceil(value / 2);
    } else if (modifier === '*0') {
        return 0;
    } else {
        return value;
    }
}
/**
 * Calculate movement rate and other movement derived values
 * @param v attrs needed for calculation, moveRateGetAttrs
 * @returns {}
 */
function calcMoveRate(v) {
    let newAttrs = {};
    const moveRateSpecies = parseInt(v['movement_rate_species']) || 0;
    const moveRateOther = parseInt(v['movement_rate_other']) || 0;
    const moveRateBase = parseInt(v['movement_rate_base']) || 0;
    const moveRate = parseInt(v['movement_rate']) || 0;
    const core_value = moveRateSpecies + moveRateOther;
    const moveAfterFatigue = applyMovementMod(core_value, fatigueTable[v['fatigue']]['movement']);
    newAttrs['movement_rate_base'] = applyMovementMod(moveAfterFatigue, loadTable[v['encumbrance_load']]['movement']);

    const diffVal = newAttrs['movement_rate_base'] - moveRateBase;
    newAttrs['movement_rate'] = moveRate + diffVal;

    /* TODO calculate advance movement */

    return newAttrs;
}
on('change:movement_rate_species change:movement_rate_other', function(event) {
    if (event.sourceType === "sheetworker") {return;}
    getAttrs(moveRateGetAttrs, function(v) {
        setAttrs(calcMoveRate(v));
    });
});

/* Spirit Intensity */
const spiritIntensityGetAttrs = ['pow']
function calcSpiritIntensity(v) {
    const pow = parseInt(v['pow']) || 0;
    return {'spirit_intensity': Math.floor(pow/6)};
}

/* Tenacity Points */
const tenacityGetAttrs = ['pow', 'tenacity_other', 'tenacity_temp', 'tenacity', 'tenacity_max', 'tenacity_dependencies', 'apply_dependencies_penalty'];
/**
 * Calculate Tenacity points
 * @param v attrs needed for calculation, tenacityPointsGetAttrs
 * @param sourceAttribute the attr the triggered the change
 * @returns {}
 */
function calcTenacity(v, sourceAttribute) {
    let newAttrs = {};
    const pow = parseInt(v['pow']) || 0;
    const tenacityOther = parseInt(v['tenacity_other']) || 0;
    const tenacityTemp = parseInt(v['tenacity_temp']) || 0;
    const tenacityCurr = parseInt(v['tenacity']) || 0;
    const tenacityMax = parseInt(v['tenacity_max']) || 0;
    let tenacityDeps = 0;
    if (v['apply_dependencies_penalty'] === '1') {
        tenacityDeps = parseInt(v['tenacity_dependencies']) || 0;
    }
    newAttrs['tenacity_base'] = pow + tenacityOther + tenacityDeps;

    let diffVal;
    if (sourceAttribute === 'tenacity_max') {
        newAttrs['tenacity_temp'] = tenacityMax - newAttrs['tenacity_base'];
        diffVal = newAttrs['tenacity_temp'] - tenacityTemp;
    } else {
        newAttrs['tenacity_max'] = newAttrs['tenacity_base'] + tenacityTemp;
        diffVal = newAttrs['tenacity_max'] - tenacityMax;
    }

    newAttrs['tenacity'] = tenacityCurr + diffVal;
    return newAttrs;
}
on('change:tenacity_other change:tenacity_max change:apply_dependencies_penalty', function(event) {
    if (event.sourceType === "sheetworker") {return;}
    getAttrs(tenacityGetAttrs, function(v) {
        setAttrs(calcTenacity(v, event.sourceAttribute));
    });
});

/* Hit Locations */
const hitLocationTable = {
    custom1: {
        location2to7_display: 0, location8_display: 0, location9_display: 0, location10_display: 0, location11_display: 0, location12_display: 0
    },
    custom7: {
        location2to7_display: 1, location8_display: 0, location9_display: 0, location10_display: 0, location11_display: 0, location12_display: 0
    },
    custom8: {
        location2to7_display: 1, location8_display: 1, location9_display: 0, location10_display: 0, location11_display: 0, location12_display: 0
    },
    custom9: {
        location2to7_display: 1, location8_display: 1, location9_display: 1, location10_display: 0, location11_display: 0, location12_display: 0
    },
    custom10: {
        location2to7_display: 1, location8_display: 1, location9_display: 1, location10_display: 1, location11_display: 0, location12_display: 0
    },
    custom11: {
        location2to7_display: 1, location8_display: 1, location9_display: 1, location10_display: 1, location11_display: 1, location12_display: 0
    },
    custom: {
        location2to7_display: 1, location8_display: 1, location9_display: 1, location10_display: 1, location11_display: 1, location12_display: 1
    },
    rabble: {
        location1_table_start: 1, location1_table_end: 20, location1_name: getTranslationByKey('hit_points'), location1_hp_max_base_mod: 0,
        location2_table_start: 0, location2_table_end: 0, location2_name: " ", location2_hp_max_base_mod: '-',
        location3_table_start: 0, location3_table_end: 0, location3_name: " ", location3_hp_max_base_mod: '-',
        location4_table_start: 0, location4_table_end: 0, location4_name: " ", location4_hp_max_base_mod: '-',
        location5_table_start: 0, location5_table_end: 0, location5_name: " ", location5_hp_max_base_mod: '-',
        location6_table_start: 0, location6_table_end: 0, location6_name: " ", location6_hp_max_base_mod: '-',
        location7_table_start: 0, location7_table_end: 0, location7_name: " ", location7_hp_max_base_mod: '-',
        location8_table_start: 0, location8_table_end: 0, location8_name: " ", location8_hp_max_base_mod: '-',
        location9_table_start: 0, location9_table_end: 0, location9_name: " ", location9_hp_max_base_mod: '-',
        location10_table_start: 0, location10_table_end: 0, location10_name: " ", location10_hp_max_base_mod: '-',
        location11_table_start: 0, location11_table_end: 0, location11_name: " ", location11_hp_max_base_mod: '-',
        location12_table_start: 0, location12_table_end: 0, location12_name: " ", location12_hp_max_base_mod: '-',
        location2to7_display: 0, location8_display: 0, location9_display: 0, location10_display: 0, location11_display: 0, location12_display: 0
    },
    simplified: {
        location1_table_start: 1, location1_table_end: 20, location1_name: getTranslationByKey('hit_points'), location1_hp_max_base_mod: 0,
        location2_table_start: 0, location2_table_end: 0, location2_name: " ", location2_hp_max_base_mod: '-',
        location3_table_start: 0, location3_table_end: 0, location3_name: " ", location3_hp_max_base_mod: '-',
        location4_table_start: 0, location4_table_end: 0, location4_name: " ", location4_hp_max_base_mod: '-',
        location5_table_start: 0, location5_table_end: 0, location5_name: " ", location5_hp_max_base_mod: '-',
        location6_table_start: 0, location6_table_end: 0, location6_name: " ", location6_hp_max_base_mod: '-',
        location7_table_start: 0, location7_table_end: 0, location7_name: " ", location7_hp_max_base_mod: '-',
        location8_table_start: 0, location8_table_end: 0, location8_name: " ", location8_hp_max_base_mod: '-',
        location9_table_start: 0, location9_table_end: 0, location9_name: " ", location9_hp_max_base_mod: '-',
        location10_table_start: 0, location10_table_end: 0, location10_name: " ", location10_hp_max_base_mod: '-',
        location11_table_start: 0, location11_table_end: 0, location11_name: " ", location11_hp_max_base_mod: '-',
        location12_table_start: 0, location12_table_end: 0, location12_name: " ", location12_hp_max_base_mod: '-',
        location2to7_display: 0, location8_display: 0, location9_display: 0, location10_display: 0, location11_display: 0, location12_display: 0
    },
    arachnid: {
        location1_table_start: 1, location1_table_end: 2, location1_name: getTranslationByKey('rear_right_leg'), location1_hp_max_base_mod: -1,
        location2_table_start: 3, location2_table_end: 4, location2_name: getTranslationByKey('rear_left_leg'), location2_hp_max_base_mod: -1,
        location3_table_start: 5, location3_table_end: 6, location3_name: getTranslationByKey('mid_right_leg'), location3_hp_max_base_mod: -1,
        location4_table_start: 7, location4_table_end: 8, location4_name: getTranslationByKey('mid_left_leg'), location4_hp_max_base_mod: -1,
        location5_table_start: 9, location5_table_end: 10, location5_name: getTranslationByKey('fore_right_leg'), location5_hp_max_base_mod: -1,
        location6_table_start: 11, location6_table_end: 12, location6_name: getTranslationByKey('fore_left_leg'), location6_hp_max_base_mod: -1,
        location7_table_start: 13, location7_table_end: 14, location7_name: getTranslationByKey('abdomen'), location7_hp_max_base_mod: 2,
        location8_table_start: 15, location8_table_end: 16, location8_name: getTranslationByKey('front_right_leg'), location8_hp_max_base_mod: -1,
        location9_table_start: 17, location9_table_end: 18, location9_name: getTranslationByKey('front_left_leg'), location9_hp_max_base_mod: -1,
        location10_table_start: 19, location10_table_end: 20, location10_name: getTranslationByKey('cephalothorax'), location10_hp_max_base_mod: 1,
        location11_table_start: 0, location11_table_end: 0, location11_name: "", location11_hp_max_base_mod: '-',
        location12_table_start: 0, location12_table_end: 0, location12_name: "", location12_hp_max_base_mod: '-',
        location2to7_display: 1, location8_display: 1, location9_display: 1, location10_display: 1, location11_display: 0, location12_display: 0
    },
    humanoid: {
        location1_table_start: 1, location1_table_end: 3, location1_name: getTranslationByKey('right_leg'), location1_hp_max_base_mod: 0,
        location2_table_start: 4, location2_table_end: 6, location2_name: getTranslationByKey('left_leg'), location2_hp_max_base_mod: 0,
        location3_table_start: 7, location3_table_end: 9, location3_name: getTranslationByKey('abdomen'), location3_hp_max_base_mod: 1,
        location4_table_start: 10, location4_table_end: 12, location4_name: getTranslationByKey('chest'), location4_hp_max_base_mod: 2,
        location5_table_start: 13, location5_table_end: 15, location5_name: getTranslationByKey('right_arm'), location5_hp_max_base_mod: -1,
        location6_table_start: 16, location6_table_end: 18, location6_name: getTranslationByKey('left_arm'), location6_hp_max_base_mod: -1,
        location7_table_start: 19, location7_table_end: 20, location7_name: getTranslationByKey('head'), location7_hp_max_base_mod: 0,
        location8_table_start: 0, location8_table_end: 0, location8_name: " ", location8_hp_max_base_mod: '-',
        location9_table_start: 0, location9_table_end: 0, location9_name: " ", location9_hp_max_base_mod: '-',
        location10_table_start: 0, location10_table_end: 0, location10_name: " ", location10_hp_max_base_mod: '-',
        location11_table_start: 0, location11_table_end: 0, location11_name: " ", location11_hp_max_base_mod: '-',
        location12_table_start: 0, location12_table_end: 0, location12_name: " ", location12_hp_max_base_mod: '-',
        location2to7_display: 1, location8_display: 0, location9_display: 0, location10_display: 0, location11_display: 0, location12_display: 0
    },
    centaurid: {
        location1_table_start: 1, location1_table_end: 3, location1_name: getTranslationByKey('rear_right_leg'), location1_hp_max_base_mod: 0,
        location2_table_start: 4, location2_table_end: 6, location2_name: getTranslationByKey('rear_left_leg'), location2_hp_max_base_mod: 0,
        location3_table_start: 7, location3_table_end: 8, location3_name: getTranslationByKey('hindquarters'), location3_hp_max_base_mod: 1,
        location4_table_start: 9, location4_table_end: 10, location4_name: getTranslationByKey('forequarters'), location4_hp_max_base_mod: 2,
        location5_table_start: 11, location5_table_end: 12, location5_name: getTranslationByKey('front_right_leg'), location5_hp_max_base_mod: 0,
        location6_table_start: 13, location6_table_end: 14, location6_name: getTranslationByKey('front_left_leg'), location6_hp_max_base_mod: 0,
        location7_table_start: 15, location7_table_end: 16, location7_name: getTranslationByKey('chest'), location7_hp_max_base_mod: -1,
        location8_table_start: 17, location8_table_end: 17, location8_name: getTranslationByKey('right_arm'), location8_hp_max_base_mod: -4,
        location9_table_start: 18, location9_table_end: 18, location9_name: getTranslationByKey('left_arm'), location9_hp_max_base_mod: -4,
        location10_table_start: 19, location10_table_end: 20, location10_name: getTranslationByKey('head'), location10_hp_max_base_mod: -3,
        location11_table_start: 0, location11_table_end: 0, location11_name: " ", location11_hp_max_base_mod: '-',
        location12_table_start: 0, location12_table_end: 0, location12_name: " ", location12_hp_max_base_mod: '-',
        location2to7_display: 1, location8_display: 1, location9_display: 1, location10_display: 1, location11_display: 0, location12_display: 0
    },
    decapoda: {
        location1_table_start: 1, location1_table_end: 1, location1_name: getTranslationByKey('rear_right_leg'), location1_hp_max_base_mod: -1,
        location2_table_start: 2, location2_table_end: 2, location2_name: getTranslationByKey('rear_left_leg'), location2_hp_max_base_mod: -1,
        location3_table_start: 3, location3_table_end: 3, location3_name: getTranslationByKey('mid_right_leg'), location3_hp_max_base_mod: -1,
        location4_table_start: 4, location4_table_end: 4, location4_name: getTranslationByKey('mid_left_leg'), location4_hp_max_base_mod: -1,
        location5_table_start: 5, location5_table_end: 5, location5_name: getTranslationByKey('fore_right_leg'), location5_hp_max_base_mod: -1,
        location6_table_start: 6, location6_table_end: 6, location6_name: getTranslationByKey('fore_left_leg'), location6_hp_max_base_mod: -1,
        location7_table_start: 7, location7_table_end: 7, location7_name: getTranslationByKey('front_right_leg'), location7_hp_max_base_mod: -1,
        location8_table_start: 8, location8_table_end: 8, location8_name: getTranslationByKey('front_left_leg'), location8_hp_max_base_mod: -1,
        location9_table_start: 9, location9_table_end: 10, location9_name: getTranslationByKey('abdomen'), location9_hp_max_base_mod: 1,
        location10_table_start: 11, location10_table_end: 16, location10_name: getTranslationByKey('cephalothorax'), location10_hp_max_base_mod: 2,
        location11_table_start: 17, location11_table_end: 18, location11_name: getTranslationByKey('right_pincer'), location11_hp_max_base_mod: 2,
        location12_table_start: 19, location12_table_end: 20, location12_name: getTranslationByKey('left_pincer'), location12_hp_max_base_mod: 0,
        location2to7_display: 1, location8_display: 1, location9_display: 1, location10_display: 1, location11_display: 1, location12_display: 1
    },
    decapodiform: {
        location1_table_start: 1, location1_table_end: 1, location1_name: getTranslationByKey('tentacle_1'), location1_hp_max_base_mod: -1,
        location2_table_start: 2, location2_table_end: 2, location2_name: getTranslationByKey('tentacle_2'), location2_hp_max_base_mod: -1,
        location3_table_start: 3, location3_table_end: 3, location3_name: getTranslationByKey('tentacle_3'), location3_hp_max_base_mod: -1,
        location4_table_start: 4, location4_table_end: 4, location4_name: getTranslationByKey('tentacle_4'), location4_hp_max_base_mod: -1,
        location5_table_start: 5, location5_table_end: 5, location5_name: getTranslationByKey('tentacle_5'), location5_hp_max_base_mod: -1,
        location6_table_start: 6, location6_table_end: 6, location6_name: getTranslationByKey('tentacle_6'), location6_hp_max_base_mod: -1,
        location7_table_start: 7, location7_table_end: 7, location7_name: getTranslationByKey('tentacle_7'), location7_hp_max_base_mod: -1,
        location8_table_start: 8, location8_table_end: 8, location8_name: getTranslationByKey('tentacle_8'), location8_hp_max_base_mod: -1,
        location9_table_start: 9, location9_table_end: 11, location9_name: getTranslationByKey('long_tentacle_1'), location9_hp_max_base_mod: 0,
        location10_table_start: 12, location10_table_end: 14, location10_name: getTranslationByKey('long_tentacle_2'), location10_hp_max_base_mod: 0,
        location11_table_start: 15, location11_table_end: 17, location11_name: getTranslationByKey('body'), location11_hp_max_base_mod: 2,
        location12_table_start: 18, location12_table_end: 20, location12_name: getTranslationByKey('head'), location12_hp_max_base_mod: 1,
        location2to7_display: 1, location8_display: 1, location9_display: 1, location10_display: 1, location11_display: 1, location12_display: 1
    },
    dorsal_finned_aquatic: {
        location1_table_start: 1, location1_table_end: 3, location1_name: getTranslationByKey('tail'), location1_hp_max_base_mod: 0,
        location2_table_start: 4, location2_table_end: 6, location2_name: getTranslationByKey('dorsal_fin'), location2_hp_max_base_mod: -1,
        location3_table_start: 7, location3_table_end: 10, location3_name: getTranslationByKey('hindquarters'), location3_hp_max_base_mod: 1,
        location4_table_start: 11, location4_table_end: 14, location4_name: getTranslationByKey('forequarters'), location4_hp_max_base_mod: 2,
        location5_table_start: 15, location5_table_end: 16, location5_name: getTranslationByKey('right_fin'), location5_hp_max_base_mod: -1,
        location6_table_start: 17, location6_table_end: 18, location6_name: getTranslationByKey('left_fin'), location6_hp_max_base_mod: -1,
        location7_table_start: 19, location7_table_end: 20, location7_name: getTranslationByKey('head'), location7_hp_max_base_mod: 0,
        location8_table_start: 0, location8_table_end: 0, location8_name: " ", location8_hp_max_base_mod: '-',
        location9_table_start: 0, location9_table_end: 0, location9_name: " ", location9_hp_max_base_mod: '-',
        location10_table_start: 0, location10_table_end: 0, location10_name: " ", location10_hp_max_base_mod: '-',
        location11_table_start: 0, location11_table_end: 0, location11_name: " ", location11_hp_max_base_mod: '-',
        location12_table_start: 0, location12_table_end: 0, location12_name: " ", location12_hp_max_base_mod: '-',
        location2to7_display: 1, location8_display: 0, location9_display: 0, location10_display: 0, location11_display: 0, location12_display: 0
    },
    draconic: {
        location1_table_start: 1, location1_table_end: 2, location1_name: getTranslationByKey('tail'), location1_hp_max_base_mod: 0,
        location2_table_start: 3, location2_table_end: 4, location2_name: getTranslationByKey('rear_right_leg'), location2_hp_max_base_mod: 0,
        location3_table_start: 5, location3_table_end: 6, location3_name: getTranslationByKey('rear_left_leg'), location3_hp_max_base_mod: 0,
        location4_table_start: 7, location4_table_end: 8, location4_name: getTranslationByKey('hindquarters'), location4_hp_max_base_mod: 1,
        location5_table_start: 9, location5_table_end: 10, location5_name: getTranslationByKey('right_wing'), location5_hp_max_base_mod: -1,
        location6_table_start: 11, location6_table_end: 12, location6_name: getTranslationByKey('left_wing'), location6_hp_max_base_mod: -1,
        location7_table_start: 13, location7_table_end: 14, location7_name: getTranslationByKey('forequarters'), location7_hp_max_base_mod: 2,
        location8_table_start: 15, location8_table_end: 16, location8_name: getTranslationByKey('front_right_leg'), location8_hp_max_base_mod: 0,
        location9_table_start: 17, location9_table_end: 18, location9_name: getTranslationByKey('front_left_leg'), location9_hp_max_base_mod: 0,
        location10_table_start: 19, location10_table_end: 20, location10_name: getTranslationByKey('head'), location10_hp_max_base_mod: 0,
        location11_table_start: 0, location11_table_end: 0, location11_name: " ", location11_hp_max_base_mod: '-',
        location12_table_start: 0, location12_table_end: 0, location12_name: " ", location12_hp_max_base_mod: '-',
        location2to7_display: 1, location8_display: 1, location9_display: 1, location10_display: 1, location11_display: 0, location12_display: 0
    },
    insect: {
        location1_table_start: 1, location1_table_end: 1, location1_name: getTranslationByKey('right_rear_leg'), location1_hp_max_base_mod: -1,
        location2_table_start: 2, location2_table_end: 2, location2_name: getTranslationByKey('left_rear_leg'), location2_hp_max_base_mod: -1,
        location3_table_start: 3, location3_table_end: 3, location3_name: getTranslationByKey('mid_right_leg'), location3_hp_max_base_mod: -1,
        location4_table_start: 4, location4_table_end: 4, location4_name: getTranslationByKey('mid_left_leg'), location4_hp_max_base_mod: -1,
        location5_table_start: 5, location5_table_end: 9, location5_name: getTranslationByKey('abdomen'), location5_hp_max_base_mod: 1,
        location6_table_start: 10, location6_table_end: 13, location6_name: getTranslationByKey('thorax'), location6_hp_max_base_mod: 2,
        location7_table_start: 14, location7_table_end: 14, location7_name: getTranslationByKey('front_right_leg'), location7_hp_max_base_mod: -1,
        location8_table_start: 15, location8_table_end: 15, location8_name: getTranslationByKey('front_left_leg'), location8_hp_max_base_mod: -1,
        location9_table_start: 16, location9_table_end: 20, location9_name: getTranslationByKey('head'), location9_hp_max_base_mod: 0,
        location10_table_start: 0, location10_table_end: 0, location10_name: " ", location10_hp_max_base_mod: '-',
        location11_table_start: 0, location11_table_end: 0, location11_name: " ", location11_hp_max_base_mod: '-',
        location12_table_start: 0, location12_table_end: 0, location12_name: " ", location12_hp_max_base_mod: '-',
        location2to7_display: 1, location8_display: 1, location9_display: 1, location10_display: 0, location11_display: 0, location12_display: 0
    },
    octopodiform: {
        location1_table_start: 1, location1_table_end: 2, location1_name: getTranslationByKey('tentacle_1'), location1_hp_max_base_mod: 0,
        location2_table_start: 3, location2_table_end: 4, location2_name: getTranslationByKey('tentacle_2'), location2_hp_max_base_mod: 0,
        location3_table_start: 5, location3_table_end: 6, location3_name: getTranslationByKey('tentacle_3'), location3_hp_max_base_mod: 0,
        location4_table_start: 7, location4_table_end: 8, location4_name: getTranslationByKey('tentacle_4'), location4_hp_max_base_mod: 0,
        location5_table_start: 9, location5_table_end: 10, location5_name: getTranslationByKey('tentacle_5'), location5_hp_max_base_mod: 0,
        location6_table_start: 11, location6_table_end: 12, location6_name: getTranslationByKey('tentacle_6'), location6_hp_max_base_mod: 0,
        location7_table_start: 13, location7_table_end: 14, location7_name: getTranslationByKey('tentacle_7'), location7_hp_max_base_mod: 0,
        location8_table_start: 15, location8_table_end: 16, location8_name: getTranslationByKey('tentacle_8'), location8_hp_max_base_mod: 0,
        location9_table_start: 17, location9_table_end: 18, location9_name: getTranslationByKey('body'), location9_hp_max_base_mod: 1,
        location10_table_start: 19, location10_table_end: 20, location10_name: getTranslationByKey('head'), location10_hp_max_base_mod: 2,
        location11_table_start: 0, location11_table_end: 0, location11_name: " ", location11_hp_max_base_mod: '-',
        location12_table_start: 0, location12_table_end: 0, location12_name: " ", location12_hp_max_base_mod: '-',
        location2to7_display: 1, location8_display: 1, location9_display: 1, location10_display: 1, location11_display: 0, location12_display: 0
    },
    pachyderm: {
        location1_table_start: 1, location1_table_end: 2, location1_name: getTranslationByKey('rear_right_leg'), location1_hp_max_base_mod: 0,
        location2_table_start: 3, location2_table_end: 4, location2_name: getTranslationByKey('rear_left_leg'), location2_hp_max_base_mod: 0,
        location3_table_start: 5, location3_table_end: 8, location3_name: getTranslationByKey('hindquarters'), location3_hp_max_base_mod: 1,
        location4_table_start: 9, location4_table_end: 12, location4_name: getTranslationByKey('forequarters'), location4_hp_max_base_mod: 2,
        location5_table_start: 13, location5_table_end: 14, location5_name: getTranslationByKey('front_right_leg'), location5_hp_max_base_mod: 0,
        location6_table_start: 15, location6_table_end: 16, location6_name: getTranslationByKey('front_left_leg'), location6_hp_max_base_mod: 0,
        location7_table_start: 17, location7_table_end: 17, location7_name: getTranslationByKey('trunk'), location7_hp_max_base_mod: -1,
        location8_table_start: 18, location8_table_end: 20, location8_name: getTranslationByKey('head'), location8_hp_max_base_mod: 0,
        location9_table_start: 0, location9_table_end: 0, location9_name: " ", location9_hp_max_base_mod: '-',
        location10_table_start: 0, location10_table_end: 0, location10_name: " ", location10_hp_max_base_mod: '-',
        location11_table_start: 0, location11_table_end: 0, location11_name: " ", location11_hp_max_base_mod: '-',
        location12_table_start: 0, location12_table_end: 0, location12_name: " ", location12_hp_max_base_mod: '-',
        location2to7_display: 1, location8_display: 1, location9_display: 0, location10_display: 0, location11_display: 0, location12_display: 0
    },
    quadruped: {
        location1_table_start: 1, location1_table_end: 2, location1_name: getTranslationByKey('rear_right_leg'), location1_hp_max_base_mod: 0,
        location2_table_start: 3, location2_table_end: 4, location2_name: getTranslationByKey('rear_left_leg'), location2_hp_max_base_mod: 0,
        location3_table_start: 5, location3_table_end: 7, location3_name: getTranslationByKey('hindquarters'), location3_hp_max_base_mod: 1,
        location4_table_start: 8, location4_table_end: 10, location4_name: getTranslationByKey('forequarters'), location4_hp_max_base_mod: 2,
        location5_table_start: 11, location5_table_end: 13, location5_name: getTranslationByKey('front_right_leg'), location5_hp_max_base_mod: 0,
        location6_table_start: 14, location6_table_end: 16, location6_name: getTranslationByKey('front_left_leg'), location6_hp_max_base_mod: 0,
        location7_table_start: 17, location7_table_end: 20, location7_name: getTranslationByKey('head'), location7_hp_max_base_mod: 0,
        location8_table_start: 0, location8_table_end: 0, location8_name: " ", location8_hp_max_base_mod: '-',
        location9_table_start: 0, location9_table_end: 0, location9_name: " ", location9_hp_max_base_mod: '-',
        location10_table_start: 0, location10_table_end: 0, location10_name: " ", location10_hp_max_base_mod: '-',
        location11_table_start: 0, location11_table_end: 0, location11_name: " ", location11_hp_max_base_mod: '-',
        location12_table_start: 0, location12_table_end: 0, location12_name: " ", location12_hp_max_base_mod: '-',
        location2to7_display: 1, location8_display: 0, location9_display: 0, location10_display: 0, location11_display: 0, location12_display: 0
    },
    serpentine: {
        location1_table_start: 1, location1_table_end: 3, location1_name: getTranslationByKey('tail_tip'), location1_hp_max_base_mod: 0,
        location2_table_start: 4, location2_table_end: 5, location2_name: getTranslationByKey('mid_end-length'), location2_hp_max_base_mod: 0,
        location3_table_start: 6, location3_table_end: 7, location3_name: getTranslationByKey('fore_end-length'), location3_hp_max_base_mod: 0,
        location4_table_start: 8, location4_table_end: 9, location4_name: getTranslationByKey('rear_mid-length'), location4_hp_max_base_mod: 1,
        location5_table_start: 10, location5_table_end: 12, location5_name: getTranslationByKey('mid_mid-length'), location5_hp_max_base_mod: 1,
        location6_table_start: 13, location6_table_end: 14, location6_name: getTranslationByKey('fore_mid-length'), location6_hp_max_base_mod: 1,
        location7_table_start: 15, location7_table_end: 16, location7_name: getTranslationByKey('rear_fore-length'), location7_hp_max_base_mod: 0,
        location8_table_start: 17, location8_table_end: 18, location8_name: getTranslationByKey('mid_fore-length'), location8_hp_max_base_mod: 0,
        location9_table_start: 19, location9_table_end: 20, location9_name: getTranslationByKey('head'), location9_hp_max_base_mod: 0,
        location10_table_start: 0, location10_table_end: 0, location10_name: " ", location10_hp_max_base_mod: '-',
        location11_table_start: 0, location11_table_end: 0, location11_name: " ", location11_hp_max_base_mod: '-',
        location12_table_start: 0, location12_table_end: 0, location12_name: " ", location12_hp_max_base_mod: '-',
        location2to7_display: 1, location8_display: 1, location9_display: 1, location10_display: 0, location11_display: 0, location12_display: 0
    },
    tailed_arachnid: {
        location1_table_start: 1, location1_table_end: 2, location1_name: getTranslationByKey('tail'), location1_hp_max_base_mod: 0,
        location2_table_start: 3, location2_table_end: 3, location2_name: getTranslationByKey('rear_right_leg'), location2_hp_max_base_mod: -1,
        location3_table_start: 4, location3_table_end: 4, location3_name: getTranslationByKey('rear_left_leg'), location3_hp_max_base_mod: -1,
        location4_table_start: 5, location4_table_end: 5, location4_name: getTranslationByKey('mid_right_leg'), location4_hp_max_base_mod: -1,
        location5_table_start: 6, location5_table_end: 6, location5_name: getTranslationByKey('mid_left_leg'), location5_hp_max_base_mod: -1,
        location6_table_start: 7, location6_table_end: 7, location6_name: getTranslationByKey('fore_right_leg'), location6_hp_max_base_mod: -1,
        location7_table_start: 8, location7_table_end: 8, location7_name: getTranslationByKey('fore_left_leg'), location7_hp_max_base_mod: -1,
        location8_table_start: 9, location8_table_end: 12, location8_name: getTranslationByKey('thorax'), location8_hp_max_base_mod: 1,
        location9_table_start: 13, location9_table_end: 15, location9_name: getTranslationByKey('right_pincer'), location9_hp_max_base_mod: 0,
        location10_table_start: 16, location10_table_end: 18, location10_name: getTranslationByKey('left_pincer'), location10_hp_max_base_mod: 0,
        location11_table_start: 19, location11_table_end: 20, location11_name: getTranslationByKey('cephalothorax'), location11_hp_max_base_mod: 2,
        location12_table_start: 0, location12_table_end: 0, location12_name: " ", location12_hp_max_base_mod: '-',
        location2to7_display: 1, location8_display: 1, location9_display: 1, location10_display: 1, location11_display: 1, location12_display: 0
    },
    tailed_biped: {
        location1_table_start: 1, location1_table_end: 3, location1_name: getTranslationByKey('tail'), location1_hp_max_base_mod: 0,
        location2_table_start: 4, location2_table_end: 5, location2_name: getTranslationByKey('right_leg'), location2_hp_max_base_mod: 0,
        location3_table_start: 6, location3_table_end: 7, location3_name: getTranslationByKey('left_leg'), location3_hp_max_base_mod: 0,
        location4_table_start: 8, location4_table_end: 10, location4_name: getTranslationByKey('abdomen'), location4_hp_max_base_mod: 1,
        location5_table_start: 11, location5_table_end: 14, location5_name: getTranslationByKey('chest'), location5_hp_max_base_mod: 2,
        location6_table_start: 15, location6_table_end: 16, location6_name: getTranslationByKey('right_arm'), location6_hp_max_base_mod: -1,
        location7_table_start: 17, location7_table_end: 18, location7_name: getTranslationByKey('left_arm'), location7_hp_max_base_mod: -1,
        location8_table_start: 19, location8_table_end: 20, location8_name: getTranslationByKey('head'), location8_hp_max_base_mod: 0,
        location9_table_start: 0, location9_table_end: 0, location9_name: " ", location9_hp_max_base_mod: '-',
        location10_table_start: 0, location10_table_end: 0, location10_name: " ", location10_hp_max_base_mod: '-',
        location11_table_start: 0, location11_table_end: 0, location11_name: " ", location11_hp_max_base_mod: '-',
        location12_table_start: 0, location12_table_end: 0, location12_name: " ", location12_hp_max_base_mod: '-',
        location2to7_display: 1, location8_display: 1, location9_display: 0, location10_display: 0, location11_display: 0, location12_display: 0
    },
    tailed_quadruped: {
        location1_table_start: 1, location1_table_end: 3, location1_name: getTranslationByKey('tail'), location1_hp_max_base_mod: 0,
        location2_table_start: 4, location2_table_end: 5, location2_name: getTranslationByKey('rear_right_leg'), location2_hp_max_base_mod: 0,
        location3_table_start: 6, location3_table_end: 7, location3_name: getTranslationByKey('rear_left_leg'), location3_hp_max_base_mod: 0,
        location4_table_start: 8, location4_table_end: 10, location4_name: getTranslationByKey('hindquarters'), location4_hp_max_base_mod: 1,
        location5_table_start: 11, location5_table_end: 14, location5_name: getTranslationByKey('forequarters'), location5_hp_max_base_mod: 2,
        location6_table_start: 15, location6_table_end: 16, location6_name: getTranslationByKey('front_right_leg'), location6_hp_max_base_mod: -1,
        location7_table_start: 17, location7_table_end: 18, location7_name: getTranslationByKey('front_left_leg'), location7_hp_max_base_mod: -1,
        location8_table_start: 19, location8_table_end: 20, location8_name: getTranslationByKey('head'), location8_hp_max_base_mod: 0,
        location9_table_start: 0, location9_table_end: 0, location9_name: " ", location9_hp_max_base_mod: '-',
        location10_table_start: 0, location10_table_end: 0, location10_name: " ", location10_hp_max_base_mod: '-',
        location11_table_start: 0, location11_table_end: 0, location11_name: " ", location11_hp_max_base_mod: '-',
        location12_table_start: 0, location12_table_end: 0, location12_name: " ", location12_hp_max_base_mod: '-',
        location2to7_display: 1, location8_display: 1, location9_display: 0, location10_display: 0, location11_display: 0, location12_display: 0
    },
    winged_biped: {
        location1_table_start: 1, location1_table_end: 3, location1_name: getTranslationByKey('right_leg'), location1_hp_max_base_mod: 0,
        location2_table_start: 4, location2_table_end: 6, location2_name: getTranslationByKey('left_leg'), location2_hp_max_base_mod: 0,
        location3_table_start: 7, location3_table_end: 9, location3_name: getTranslationByKey('abdomen'), location3_hp_max_base_mod: 1,
        location4_table_start: 10, location4_table_end: 10, location4_name: getTranslationByKey('chest'), location4_hp_max_base_mod: 2,
        location5_table_start: 11, location5_table_end: 12, location5_name: getTranslationByKey('right_wing'), location5_hp_max_base_mod: 0,
        location6_table_start: 13, location6_table_end: 14, location6_name: getTranslationByKey('left_wing'), location6_hp_max_base_mod: 0,
        location7_table_start: 15, location7_table_end: 16, location7_name: getTranslationByKey('right_arm'), location7_hp_max_base_mod: -1,
        location8_table_start: 17, location8_table_end: 18, location8_name: getTranslationByKey('left_arm'), location8_hp_max_base_mod: -1,
        location9_table_start: 19, location9_table_end: 20, location9_name: getTranslationByKey('head'), location9_hp_max_base_mod: 0,
        location10_table_start: 0, location10_table_end: 0, location10_name: " ", location10_hp_max_base_mod: '-',
        location11_table_start: 0, location11_table_end: 0, location11_name: " ", location11_hp_max_base_mod: '-',
        location12_table_start: 0, location12_table_end: 0, location12_name: " ", location12_hp_max_base_mod: '-',
        location2to7_display: 1, location8_display: 1, location9_display: 1, location10_display: 0, location11_display: 0, location12_display: 0
    },
    winged_insect: {
        location1_table_start: 1, location1_table_end: 1, location1_name: getTranslationByKey('rear_right_leg'), location1_hp_max_base_mod: -1,
        location2_table_start: 2, location2_table_end: 2, location2_name: getTranslationByKey('rear_left_leg'), location2_hp_max_base_mod: -1,
        location3_table_start: 3, location3_table_end: 4, location3_name: getTranslationByKey('metathorax'), location3_hp_max_base_mod: 1,
        location4_table_start: 5, location4_table_end: 5, location4_name: getTranslationByKey('mid_right_leg'), location4_hp_max_base_mod: -1,
        location5_table_start: 6, location5_table_end: 6, location5_name: getTranslationByKey('mid_left_leg'), location5_hp_max_base_mod: -1,
        location6_table_start: 7, location6_table_end: 10, location6_name: getTranslationByKey('prothorax'), location6_hp_max_base_mod: 2,
        location7_table_start: 11, location7_table_end: 12, location7_name: getTranslationByKey('right_wing'), location7_hp_max_base_mod: -1,
        location8_table_start: 13, location8_table_end: 14, location8_name: getTranslationByKey('left_wing'), location8_hp_max_base_mod: -1,
        location9_table_start: 15, location9_table_end: 16, location9_name: getTranslationByKey('front_right_leg'), location9_hp_max_base_mod: -1,
        location10_table_start: 17, location10_table_end: 18, location10_name: getTranslationByKey('front_left_leg'), location10_hp_max_base_mod: -1,
        location11_table_start: 19, location11_table_end: 20, location11_name: getTranslationByKey('head'), location11_hp_max_base_mod: 0,
        location12_table_start: 0, location12_table_end: 0, location12_name: " ", location12_hp_max_base_mod: '-',
        location1to7_display: 1, location8_display: 1, location9_display: 1, location10_display: 1, location11_display: 1, location12_display: 0
    },
    winged_quadruped: {
        location1_table_start: 1, location1_table_end: 2, location1_name: getTranslationByKey('rear_right_leg'), location1_hp_max_base_mod: 0,
        location2_table_start: 3, location2_table_end: 4, location2_name: getTranslationByKey('rear_left_leg'), location2_hp_max_base_mod: 0,
        location3_table_start: 5, location3_table_end: 7, location3_name: getTranslationByKey('hindquarters'), location3_hp_max_base_mod: 1,
        location4_table_start: 8, location4_table_end: 10, location4_name: getTranslationByKey('forequarters'), location4_hp_max_base_mod: 2,
        location5_table_start: 11, location5_table_end: 12, location5_name: getTranslationByKey('right_wing'), location5_hp_max_base_mod: -1,
        location6_table_start: 13, location6_table_end: 14, location6_name: getTranslationByKey('left_wing'), location6_hp_max_base_mod: -1,
        location7_table_start: 15, location7_table_end: 16, location7_name: getTranslationByKey('front_right_leg'), location7_hp_max_base_mod: 0,
        location8_table_start: 17, location8_table_end: 18, location8_name: getTranslationByKey('front_left_leg'), location8_hp_max_base_mod: 0,
        location9_table_start: 19, location9_table_end: 20, location9_name: getTranslationByKey('head'), location9_hp_max_base_mod: 0,
        location10_table_start: 0, location10_table_end: 0, location10_name: " ", location10_hp_max_base_mod: '-',
        location11_table_start: 0, location11_table_end: 0, location11_name: " ", location11_hp_max_base_mod: '-',
        location12_table_start: 0, location12_table_end: 0, location12_name: " ", location12_hp_max_base_mod: '-',
        location2to7_display: 1, location8_display: 1, location9_display: 1, location10_display: 0, location11_display: 0, location12_display: 0
    }
}
const hpGetAttrs = ['siz', 'con', 'str', 'pow', 'hp_calc', 'simplified_combat_enabled', 
    `location1_hp_max_base_mod`, `location1_hp_max_other`, `location1_hp`, `location1_hp_max`,
    `location2_hp_max_base_mod`, `location2_hp_max_other`, `location2_hp`, `location2_hp_max`,
    `location3_hp_max_base_mod`, `location3_hp_max_other`, `location3_hp`, `location3_hp_max`,
    `location4_hp_max_base_mod`, `location4_hp_max_other`, `location4_hp`, `location4_hp_max`,
    `location5_hp_max_base_mod`, `location5_hp_max_other`, `location5_hp`, `location5_hp_max`,
    `location6_hp_max_base_mod`, `location6_hp_max_other`, `location6_hp`, `location6_hp_max`,
    `location7_hp_max_base_mod`, `location7_hp_max_other`, `location7_hp`, `location7_hp_max`,
    `location8_hp_max_base_mod`, `location8_hp_max_other`, `location8_hp`, `location8_hp_max`,
    `location9_hp_max_base_mod`, `location9_hp_max_other`, `location9_hp`, `location9_hp_max`,
    `location10_hp_max_base_mod`, `location10_hp_max_other`, `location10_hp`, `location10_hp_max`,
    `location11_hp_max_base_mod`, `location11_hp_max_other`, `location11_hp`, `location11_hp_max`,
    `location12_hp_max_base_mod`, `location12_hp_max_other`, `location12_hp`, `location12_hp_max`
]
/**
 * Find and return the root HP value which will need further modification per location
 * @param v attrs needed, ['siz', 'con', 'pow', 'str', 'simplified_combat_enabled', 'hp_calc']
 * @returns {number}
 */
function calcRootHP(v) {
    let denominator = 5;
    const siz = parseInt(v['siz']) || 0;
    const con = parseInt(v['con']) || 0;
    if (v['simplified_combat_enabled'] === '1') {
        denominator = 2;
    }

    if (v['hp_calc'] === '1') {
        const pow = parseInt(v['pow']) || 0;
        return Math.ceil((con + siz + pow)/denominator);
    } else if (v['hp_calc'] === '2') {
        const str = parseInt(v['str']) || 0;
        return Math.ceil((con + siz + str)/denominator);
    } else {
        return Math.ceil((con + siz)/denominator);
    }
}
/**
 *
 * @param num the location to calculate
 * @param v attrs needed, ['siz', 'con', 'str', 'pow', `location${num}_hp_max_base_mod`, `location${num}_hp_max_other`, `location${num}_hp`, `location${num}_hp_max`, 'hp_calc', 'simplified_combat_enabled']
 */
function calcLocationHP(num, v) {
    const rootHP = calcRootHP(v);
    const hpBaseMod = parseInt(v[`location${num}_hp_max_base_mod`]) || 0;
    const hpOther = parseInt(v[`location${num}_hp_max_other`]) || 0;
    const hpCurr = parseInt(v[`location${num}_hp`]) || 0;
    const hpMaxCurr = parseInt(v[`location${num}_hp_max`]) || 0;
    const newMax = rootHP + hpBaseMod + hpOther;
    const diff = hpCurr - hpMaxCurr;
    return {[`location${num}_hp`]: newMax + diff, [`location${num}_hp_max`]: newMax};
}
/**
 * Calc HP for all locations
 * @param v attrs neede, hpGetAttrs
 */
function calcAllHP(v) {
    return {
        ...calcLocationHP('1', v),
        ...calcLocationHP('2', v),
        ...calcLocationHP('3', v),
        ...calcLocationHP('4', v),
        ...calcLocationHP('5', v),
        ...calcLocationHP('6', v),
        ...calcLocationHP('7', v),
        ...calcLocationHP('8', v),
        ...calcLocationHP('9', v),
        ...calcLocationHP('10', v),
        ...calcLocationHP('11', v),
        ...calcLocationHP('12', v)
    }
}
/* Locational Hit Points */
['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'].forEach(num => {
    on(`change:location${num}_hp_max_base_mod change:location${num}_hp_max_other`, function(event) {
        if (event.sourceType === "sheetworker") {return;}
        getAttrs(['siz', 'con', 'str', 'pow', `location${num}_hp_max_base_mod`, `location${num}_hp_max_other`,
            `location${num}_hp`, `location${num}_hp_max`, 'hp_calc', 'simplified_combat_enabled'], function(v) {
            if (debug) {console.log(`Setting attrs for location ${num} hp trigger`);}
            setAttrs( calcLocationHP(num, v) );
        });
    });
});
on(`change:hit_locations change:simplified_combat_enabled`, function(event) {
    /* don't prevent sheet workers cause they will set simplified_combat_enabled */
    getAttrs(['hit_locations'].concat(hpGetAttrs), function(v) {
        let newAttrs = hitLocationTable[v['hit_locations']];
        /* When simplified combat enabled we set hit locations to the special hidden simplified value */
        if (v['simplified_combat_enabled'] === '1') {
            newAttrs = hitLocationTable['simplified'];
        }
        /* merge the newAttrs with the ones we acquired to calculation all HP again */
        v = {...v, ...newAttrs}
        setAttrs({
            ...newAttrs,
            ...calcAllHP(v)
        });
    });
});
on('change:hp_calc', function(event) {
    if (event.sourceType === "sheetworker") {return;}
    getAttrs(hpGetAttrs, function(v) {
        setAttrs({...calcAllHP(v)});
    });
});

/* Composure */
const composureGetAttrs = ['composure', 'composure_other', 'composure_max', 'pow']
function calcComposure(v) {
    const pow = parseInt(v['pow']) || 0;
    console.log(`${v['composure']}, ${v['composure_other']}, ${v['composure_max']}`);
    const composureOther = parseInt(v['composure_other']) || 0;
    const composureMax = parseInt(v['composure_max']) || 0;
    const composureCurr = parseInt(v['composure']) || 0;
    const newMax = Math.ceil(pow/3) + composureOther;
    const diff = composureCurr - composureMax;
    console.log(composureOther + " " + composureMax + " " + composureCurr + " " + newMax + " " + diff);
    return {['composure']: newMax + diff, composure_max: newMax};
}
on('change:composure_other', function(event) {
    if (event.sourceType === "sheetworker") {return;}
    getAttrs(composureGetAttrs, function(v) {
        setAttrs(calcComposure(v));
    });
});

/* Integrity */
const integrityGetAttrs = ['integrity', 'integrity_other', 'integrity_max', 'cha']
function calcIntegrity(v) {
    let newAttrs = {};
    const cha = parseInt(v['cha']) || 0;
    const integrityOther = parseInt(v['integrity_other']) || 0;
    const integrityMax = parseInt(v['integrity_max']) || 0;
    const integrityCurr = parseInt(v['integrity']) || 0;
    newAttrs['integrity_max'] = Math.ceil(cha/3) + integrityOther;
    const diffVal = newAttrs['integrity_max'] - integrityMax;
    newAttrs['integrity'] = integrityCurr + diffVal;
    return newAttrs;
}
on('change:integrity_other', function(event) {
    if (event.sourceType === "sheetworker") {return;}
    getAttrs(integrityGetAttrs, function(v) {
        setAttrs(calcIntegrity(v));
    });
});

/* Resolve */
const resolveGetAttrs = ['resolve', 'resolve_other', 'resolve_max', 'int']
function calcResolve(v) {
    let newAttrs = {};
    const int = parseInt(v['int']) || 0;
    const resolveOther = parseInt(v['resolve_other']) || 0;
    const resolveMax = parseInt(v['resolve_max']) || 0;
    const resolveCurr = parseInt(v['resolve']) || 0;
    newAttrs['resolve_max'] = Math.ceil(int/3) + resolveOther;
    const diffVal = newAttrs['resolve_max'] - resolveMax;
    newAttrs['resolve'] = resolveCurr + diffVal;
    return newAttrs;
}
on('change:resolve_other', function(event) {
    if (event.sourceType === "sheetworker") {return;}
    getAttrs(resolveGetAttrs, function(v) {
        setAttrs(calcResolve(v));
    });
});

/* Attribute Mode */
on('change:attribute_mode', function(event) {
    if (event.sourceType === "sheetworker") {return;}
    getAttrs(actionPointGetAttrs.concat(initGetAttrs), function(v) {
        setAttrs({
            ...calcActionPoints(v, event.sourceAttribute),
            ...calcInitiativeBonus(v),
        });
    });
});

/* Fatigue */
const fatigueTable = {
    /* fresh */ '9': { "skills": '0', "action_points": '0', "initiative": '0', "movement": "+0", "recovery": "-"},
    /* winded */ '8': { "skills": '1', "action_points": '0', "initiative": '0', "movement": '-1', "recovery": .25},
    /* tired */ '7': { "skills": '1', "action_points": '0', "initiative": '0', "movement": '-1', "recovery": 3},
    /* wearied */ '6': { "skills": '2', "action_points": '0', "initiative": '-2', "movement": '-2', "recovery": 6},
    /* exhausted */ '5': { "skills": '2', "action_points": '-1', "initiative": '-4', "movement": '*.5', "recovery": 12},
    /* debilitated */ '4': { "skills": '3', "action_points": '-2', "initiative": '-6', "movement": '*.5', "recovery": 18},
    /* incapacitated */ '3': { "skills": '3', "action_points": '-3', "initiative": '-8', "movement": '*0', "recovery": 24},
    /* semi-conscious */ '2': { "skills": '4', "action_points": '-99', "initiative": '-99', "movement": '*0', "recovery": 36},
    /* comatose */ '1': { "skills": '5', "action_points": '-99', "initiative": '-99', "movement": '*0', "recovery": 48},
    /* dead */ '0': { "skills": '5', "action_points": '-99', "initiative": '-99', "movement": '*0', "recovery": '-'}
};
/**
 * Calculated the fatigue recovery time
 * @param v attributes needed for calc, ['fatigue', 'healing_rate']
 * @returns {} with fatigue_recovery
 */
function calcFatigueRecovery(v) {
    let recoveryString = '';
    const healing_rate = parseInt(v['healing_rate']) || 2;
    if (fatigueTable[v['fatigue']]['recovery'] !== '-') {
        let recovery = parseFloat((fatigueTable[v['fatigue']]['recovery'] / healing_rate));

        /* Get the minutes portion */
        let recoveryFraction = recovery % 1;
        let recoveryMinutes = Math.round(recoveryFraction * 60);
        /* Get the hours portion */
        let recoveryHours = Math.floor(recovery);

        if (recoveryHours !== 0) {
            let hourUnit = getTranslationByKey('hours-l');
            if (recoveryHours === 1) {
                hourUnit = getTranslationByKey('hour-l');
            }
            recoveryString = recoveryHours + ' ' + hourUnit;
        }

        if (recoveryMinutes !== 0) {
            let minUnit = getTranslationByKey('minutes-l');
            if (recoveryMinutes === 1) {
                minUnit = getTranslationByKey('minute-l');
            }

            if (recoveryString === '') {
                recoveryString = recoveryMinutes + ' ' + minUnit;
            } else {
                recoveryString = recoveryString + " " + recoveryMinutes + ' ' + minUnit;
            }
        }
        return {fatigue_recovery: recoveryString};
    } else {
        return {fatigue_recovery: fatigueTable[v['fatigue']]['recovery']};
    }
}
/**
 * Sets the fatigue modifier values and recovery rate
 * @param v character attributes needed for calculation, ['fatigue', 'healing_rate']
 * @returns {*&{initiative_bonus_fatigue: *, movement_rate_fatigue: *, fatigue_skills: *, action_points_fatigue: *}}
 */
function calcFatigue(v) {
    return {
        fatigue_skills: fatigueTable[v['fatigue']]['skills'],
        action_points_fatigue: fatigueTable[v['fatigue']]['action_points'],
        initiative_bonus_fatigue: fatigueTable[v['fatigue']]['initiative'],
        movement_rate_fatigue: fatigueTable[v['fatigue']]['movement'],
        ...calcFatigueRecovery(v)
    };
}
on('change:fatigue', function(event) {
    if (event.sourceType === "sheetworker") {return;}

    getAttrs(['fatigue', 'healing_rate'].concat(actionPointGetAttrs, initGetAttrs, moveRateGetAttrs), function(v) {
        setAttrs({
            ...calcFatigue(v),
            ...calcActionPoints(v),
            ...calcInitiativeBonus(v),
            ...calcMoveRate(v)
        });
    });
});

/* Weapons */
/* When a favored weapon is selected it is added to the weapons_buttons attr which is how we add it to combat rolls */
on("change:repeating_meleeweapon:favored change:repeating_rangedweapon:favored change:_reporder:meleeweapon change:_reporder:rangedweapon remove:repeating_meleeweapon remove:repeating_rangedweapon", function(event) {
    if (event.sourceType === "sheetworker") {return;}
    getSectionIDs("repeating_meleeweapon", function(meleeIds) {
        getSectionIDs("repeating_rangedweapon", function(rangedIds) {
            let meleeGetAttrs = [];
            meleeIds.forEach(id => {
                meleeGetAttrs.push(`repeating_meleeweapon_${id}_name`, `repeating_meleeweapon_${id}_favored`)
            });

            let rangedGetAttrs = [];
            rangedIds.forEach(id => {
                rangedGetAttrs.push(`repeating_rangedweapon_${id}_name`, `repeating_rangedweapon_${id}_favored`)
            });

            getAttrs(meleeGetAttrs.concat(rangedGetAttrs), function(v) {
                let weaponButtons = ""
                meleeIds.forEach(id => {
                    if (v[`repeating_meleeweapon_${id}_favored`] === '1') {
                        const name = v[`repeating_meleeweapon_${id}_name`];
                        weaponButtons = weaponButtons + ` [${name}](~@{character_name}|repeating_meleeweapon_${id}_damage)`;
                    }
                });
                rangedIds.forEach(id => {
                    if (v[`repeating_rangedweapon_${id}_favored`] === '1') {
                        const name = v[`repeating_rangedweapon_${id}_name`];
                        weaponButtons = weaponButtons + ` [${name}](~@{character_name}|repeating_rangedweapon_${id}_damage)`;
                    }
                });
                setAttrs({weapon_buttons: weaponButtons});
            });
        });
    });
});

/* Skills */
/* Standard Skills */
const stdSkillChars = {
    /* standard skill chrs */
    'athletics': ['str', 'dex'],
    'brawn': ['str', 'siz'],
    'boating': ['str', 'con'],
    'conceal': ['dex', 'pow'],
    'customs': ['int', 'int'],
    'dance': ['dex', 'cha'],
    'deceit': ['int', 'cha'],
    'drive': ['dex', 'pow'],
    'endurance': ['con', 'con'],
    'evade': ['dex', 'dex'],
    'first_aid': ['dex', 'int'],
    'home_parallel': ['int', 'int'],
    'influence': ['cha', 'cha'],
    'insight': ['int', 'pow'],
    'locale': ['int', 'int'],
    'native_tongue': ['int', 'cha'],
    'perception': ['int', 'pow'],
    'ride': ['dex', 'pow'],
    'sing': ['pow', 'cha'],
    'spectral_combat': ['pow', 'cha'],
    'status': [0, 0],
    'stealth': ['dex', 'int'],
    'superstition': ['21-int', 'pow'],
    'swim': ['str', 'con'],
    'unarmed': ['str', 'dex'],
    'willpower': ['pow', 'pow']
}
const stdSkillIds = Object.keys(stdSkillChars);
function calcStdSkill(skillId, v, sourceAttribute) {
    let newAttrs = {};
    const int = parseInt(v['int']) || 0;
    v['21-int'] = 21 - int;
    const char1 = parseInt(v[stdSkillChars[`${skillId}`][0]]) || 0;
    const char2 = parseInt(v[stdSkillChars[`${skillId}`][1]]) || 0;

    if (sourceAttribute === skillId) {
        const skill = parseInt(v[`${skillId}`]) || 0;
        newAttrs[`${skillId}_other`] = skill - char1 - char2;
    } else {
        const skillOther = parseInt(v[`${skillId}_other`]) || 0;
        newAttrs[`${skillId}`] = char1 + char2 + skillOther;
        /* for spirit and social skills we set the new value in v so those calcs may use the new value */
        v[`${skillId}`] = newAttrs[`${skillId}`];
    }

    let newSpiritDamageAttrs = {};
    if (v['spirit_combat_skill_id'] === skillId) {
        newAttrs['spirit_combat_skill_name'] =  getTranslationByKey(skillId);
        newAttrs['spirit_combat_skill_total'] = v[`${skillId}`];
        newAttrs['spirit_combat_skill_notes'] = v[`${skillId}_notes`];

        newSpiritDamageAttrs = calcSpiritDamage({...v, ...newAttrs});
    }

    let newSocialDamageAttrs = {};
    if (v['social_offense_id'] === skillId) {
        newAttrs['social_offense_name'] =  getTranslationByKey(skillId);
        newAttrs['social_offense_total'] = v[`${skillId}`];
        newAttrs['social_offense_notes'] = v[`${skillId}_notes`];

        newSocialDamageAttrs = calcSocialDamage({...v, ...newAttrs});
    }

    if (v['social_defense_id'] === skillId) {
        newAttrs['social_defense_name'] =  getTranslationByKey(skillId);
        newAttrs['social_defense_total'] = v[`${skillId}`];
        newAttrs['social_defense_notes'] = v[`${skillId}_notes`];
    }

    return {
        ...newAttrs,
        ...newSpiritDamageAttrs,
        ...newSocialDamageAttrs
    }
}
stdSkillIds.forEach(skillId => {
    on(`change:${skillId} change:${skillId}_notes`, function(event) {
        if (event.sourceType === "sheetworker") {return;}

        getAttrs([`${skillId}`, `${skillId}_other`, `${skillId}_notes`, 'social_defense_id'].concat(characteristicAttrs,
            initGetAttrs, moveRateGetAttrs, spiritDamageGetAttrs, socialDamageGetAttrs), function(v) {
            setAttrs(calcStdSkill(`${skillId}`, v, event.sourceAttribute));
        });
    });
});
/* Standard Skill Action Buttons */
stdSkillIds.forEach(skillId => {
    on(`clicked:${skillId}-augment`, function(event) {
        getAttrs([`${skillId}`], function(v) {
            const skillValue = parseInt(v[`${skillId}`]) || 0;
            const augmentValue = Math.ceil(skillValue / 5);

            setAttrs({
                augmentation: "@{set_augmentation}",
                set_augmentation: augmentValue
            });
        });
    });
    on(`clicked:${skillId}-set-social-offense`, function(event) {
        getAttrs([`${skillId}`, `${skillId}_notes`].concat(socialDamageGetAttrs), function(v) {
            const newAttrs = {
                social_offense_id: skillId,
                social_offense_name: getTranslationByKey(skillId),
                social_offense_total: v[skillId],
                social_offense_notes: v[`${skillId}_notes`]
            };

            setAttrs({
                ...newAttrs,
                ...calcSocialDamage({...v, ...newAttrs})
            });
        });
    });
    on(`clicked:${skillId}-set-social-defense`, function(event) {
        getAttrs([`${skillId}`, `${skillId}_notes`], function(v) {
            const newAttrs = {
                social_defense_id: skillId,
                social_defense_name: getTranslationByKey(skillId),
                social_defense_total: v[skillId],
                social_defense_notes: v[`${skillId}_notes`]
            };

            setAttrs(newAttrs);
        });
    });
});
on(`clicked:willpower-set-spirit-combat`, function(event) {
    getAttrs(['willpower', 'willpower_notes'].concat(spiritDamageGetAttrs), function(v) {
        const newAttrs = {
            spirit_combat_skill_id: 'willpower',
            spirit_combat_skill_name: getTranslationByKey('willpower'),
            spirit_combat_skill_total: v['willpower'],
            spirit_combat_skill_notes: v['willpower_notes']
        };

        setAttrs({
            ...newAttrs,
            ...calcSpiritDamage({...v, ...newAttrs})
        });
    });
});

/* Professional Skills, Combat Styles & Passions */
/**
 * Will read the base char value selected for a skill and parse it into a value
 * @param charOption the char value still in autocalc format for historical compatibility
 * @param v the got attributes needed, characteristicAttrs
 * @returns {number|number|number}
 */
function parseBaseChar(charOption, v) {
    if (charOption === '@{str}') {
        return parseInt(v['str']) || 0;
    } else if (charOption === '@{con}') {
        return parseInt(v['con']) || 0;
    } else if (charOption === '@{siz}') {
        return parseInt(v['siz']) || 0;
    } else if (charOption === '@{dex}') {
        return parseInt(v['dex']) || 0;
    } else if (charOption === '@{int}') {
        return parseInt(v['int']) || 0;
    } else if (charOption === '@{pow}') {
        return parseInt(v['pow']) || 0;
    } else if (charOption === '@{cha}') {
        return parseInt(v['cha']) || 0;
    } else {
        return 0;
    }
}
function calcProSkill(skillId, v, sourceAttribute) {
    let newAttrs = {};
    /* If a str or dex skill then it is affected by encumbrance */
    if (v['${skillId}_char1'] === '@{str}' || v['${skillId}_char1'] === '@{dex}' ||
    v['${skillId}_char2'] === '@{str}' || v['${skillId}_char2'] === '@{dex}') {
        newAttrs[`${skillId}_encumbered`] = 1;
    } else {
        newAttrs[`${skillId}_encumbered`] = 0;
    }
    const char1 = parseBaseChar(v[`${skillId}_char1`], v);
    const char2 = parseBaseChar(v[`${skillId}_char2`], v);
    if (sourceAttribute === `${skillId}_total`) {
        const skill = parseInt(v[`${skillId}_total`]) || 0;
        newAttrs[`${skillId}_other`] = skill - char1 - char2;
    } else {
        const skillOther = parseInt(v[`${skillId}_other`]) || 0;
        newAttrs[`${skillId}_total`] = char1 + char2 + skillOther;
        /* for spirit and social skills we set the new value in v so those calcs may use the new value */
        v[`${skillId}_total`] = newAttrs[`${skillId}_total`];
    }

    let newSpiritDamageAttrs = {};
    /* We loose case as we copy skillIds into the spirit/social associated fields, so we need to normalize the checks */
    if (v['spirit_combat_skill_id'].toLowerCase() === skillId.toLowerCase()) {
        newAttrs['spirit_combat_skill_name'] = v[`${skillId}_name`];
        newAttrs['spirit_combat_skill_total'] = v[`${skillId}_total`];
        newAttrs['spirit_combat_skill_notes'] = v[`${skillId}_notes`];

        newSpiritDamageAttrs = calcSpiritDamage({...v, ...newAttrs});
    }

    let newSocialDamageAttrs = {};
    if (v['social_offense_id'].toLowerCase() === skillId.toLowerCase()) {
        newAttrs['social_offense_name'] =  v[`${skillId}_name`];
        newAttrs['social_offense_total'] = v[`${skillId}_total`];
        newAttrs['social_offense_notes'] = v[`${skillId}_notes`];

        newSocialDamageAttrs = calcSocialDamage({...v, ...newAttrs});
    }

    if (v['social_defense_id'].toLowerCase() === skillId.toLowerCase()) {
        newAttrs['social_defense_name'] =  v[`${skillId}_name`];
        newAttrs['social_defense_total'] = v[`${skillId}_total`];
        newAttrs['social_defense_notes'] = v[`${skillId}_notes`];
    }

    return {
        ...newAttrs,
        ...newSpiritDamageAttrs,
        ...newSocialDamageAttrs
    }
}
on('change:repeating_professionalskill:total change:repeating_professionalskill:notes change:repeating_professionalskill:name change:repeating_professionalskill:char1 change:repeating_professionalskill:char2 change:repeating_combatstyle:total change:repeating_combatstyle:notes change:repeating_combatstyle:name change:repeating_combatstyle:char1 change:repeating_combatstyle:char2', function(event) {
    if (event.sourceType === "sheetworker") {return;}
    const type = event.sourceAttribute.split('_')[1];
    const id = event.sourceAttribute.split('_')[2];
    getAttrs([`repeating_${type}_${id}_total`, `repeating_${type}_${id}_other`, `repeating_${type}_${id}_notes`, `repeating_${type}_${id}_name`,
        `repeating_${type}_${id}_char1`, `repeating_${type}_${id}_char2`,  'social_defense_id'].concat(
            characteristicAttrs, spiritDamageGetAttrs, socialDamageGetAttrs), function(v) {
        setAttrs(calcProSkill(`repeating_${type}_${id}`, v, event.sourceAttribute));
    });
});
function calcPassion(skillId, v) {
    let newAttrs = {};
    let newSpiritDamageAttrs = {};
    /* We loose case as we copy skillIds into the spirit/social associated fields, so we need to normalize the checks */
    if (v['spirit_combat_skill_id'].toLowerCase() === skillId.toLowerCase()) {
        newAttrs['spirit_combat_skill_name'] = v[`${skillId}_name`];
        newAttrs['spirit_combat_skill_total'] = v[`${skillId}_total`];
        newAttrs['spirit_combat_skill_notes'] = v[`${skillId}_notes`];

        newSpiritDamageAttrs = calcSpiritDamage({...v, ...newAttrs});
    }

    let newSocialDamageAttrs = {};
    if (v['social_offense_id'].toLowerCase() === skillId.toLowerCase()) {
        newAttrs['social_offense_name'] =  v[`${skillId}_name`];
        newAttrs['social_offense_total'] = v[`${skillId}_total`];
        newAttrs['social_offense_notes'] = v[`${skillId}_notes`];

        newSocialDamageAttrs = calcSocialDamage({...v, ...newAttrs});
    }

    if (v['social_defense_id'].toLowerCase() === skillId.toLowerCase()) {
        newAttrs['social_defense_name'] =  v[`${skillId}_name`];
        newAttrs['social_defense_total'] = v[`${skillId}_total`];
        newAttrs['social_defense_notes'] = v[`${skillId}_notes`];
    }

    return {
        ...newAttrs,
        ...newSpiritDamageAttrs,
        ...newSocialDamageAttrs
    }
}
on('change:repeating_passion:total change:repeating_passion:notes change:repeating_passion:name', function(event) {
    if (event.sourceType === "sheetworker") {return;}
    const id = event.sourceAttribute.split('_')[2];
    getAttrs([`repeating_passion_${id}_total`, `repeating_passion_${id}_notes`, `repeating_passion_${id}_name`,
        'social_defense_id'].concat(spiritDamageGetAttrs, socialDamageGetAttrs), function(v) {
        setAttrs(calcPassion(`repeating_passion_${id}`, v));
    });
});
on('clicked:repeating_combatstyle:augment clicked:repeating_professionalskill:augment clicked:repeating_passion:augment clicked:repeating_dependency:augment clicked:repeating_peculiarity:augment', function(event) {
    const type = event.sourceAttribute.split('_')[1];
    const id = event.sourceAttribute.split('_')[2];
    getAttrs([`repeating_${type}_${id}_total`], function(v) {
        const skillValue = parseInt(v[`repeating_${type}_${id}_total`]) || 0;
        const augmentValue = Math.ceil(skillValue / 5);

        setAttrs({
            augmentation: "@{set_augmentation}",
            set_augmentation: augmentValue
        });
    });
});
on('clicked:repeating_professionalskill:set-social-offense clicked:repeating_passion:set-social-offense', function(event) {
    const type = event.sourceAttribute.split('_')[1];
    const id = event.sourceAttribute.split('_')[2];
    getAttrs([`repeating_${type}_${id}_name`, `repeating_${type}_${id}_total`, `repeating_${type}_${id}_notes`].concat(socialDamageGetAttrs), function(v) {
        const newAttrs = {
            social_offense_id: `repeating_${type}_${id}`,
            social_offense_name: v[`repeating_${type}_${id}_name`],
            social_offense_total: v[`repeating_${type}_${id}_total`],
            social_offense_notes: v[`repeating_${type}_${id}_notes`],
        };

        setAttrs({
            ...newAttrs,
            ...calcSocialDamage({...v, ...newAttrs})
        });
    });
});
on('clicked:repeating_professionalskill:set-social-defense clicked:repeating_passion:set-social-defense', function(event) {
    const type = event.sourceAttribute.split('_')[1];
    const id = event.sourceAttribute.split('_')[2];
    getAttrs([`repeating_${type}_${id}_name`, `repeating_${type}_${id}_total`, `repeating_${type}_${id}_notes`], function(v) {
        const newAttrs = {
            social_defense_id: `repeating_${type}_${id}`,
            social_defense_name: v[`repeating_${type}_${id}_name`],
            social_defense_total: v[`repeating_${type}_${id}_total`],
            social_defense_notes: v[`repeating_${type}_${id}_notes`]
        };

        setAttrs(newAttrs);
    });
});
on(`clicked:repeating_professionalskill:set-spirit-combat clicked:repeating_passion:set-spirit-combat`, function(event) {
    const type = event.sourceAttribute.split('_')[1];
    const id = event.sourceAttribute.split('_')[2];
    getAttrs([`repeating_${type}_${id}_name`, `repeating_${type}_${id}_total`,
        `repeating_${type}_${id}_notes`].concat(spiritDamageGetAttrs), function(v) {
        const newAttrs = {
            spirit_combat_skill_id: `repeating_${type}_${id}`,
            spirit_combat_skill_name: v[`repeating_${type}_${id}_name`],
            spirit_combat_skill_total: v[`repeating_${type}_${id}_total`],
            spirit_combat_skill_notes: v[`repeating_${type}_${id}_notes`]
        };

        setAttrs({
            ...newAttrs,
            ...calcSpiritDamage({...v, ...newAttrs})
        });
    });
});

/* Dependency Penalty to Tenacity */
on(`change:repeating_dependency:total remove:repeating_dependency`, function(event) {
    getSectionIDs("repeating_dependency", function(dependencyIds) {
        let fetchAttrs = [];
        dependencyIds.forEach(id => {
            fetchAttrs.push(`repeating_dependency_${id}_total`);
        });
        getAttrs(fetchAttrs.concat(tenacityGetAttrs), function(v) {
            let newAttrs = {tenacity_dependencies: 0};
            dependencyIds.forEach(id => {
                const depTotal = parseInt(v[`repeating_dependency_${id}_total`]) || 0;
                const depPenalty = Math.floor(depTotal/20);
                newAttrs['tenacity_dependencies'] = newAttrs['tenacity_dependencies'] - depPenalty;
            });
            setAttrs({
                ...newAttrs,
                ...calcTenacity({...v, ...newAttrs}, event.sourceAttribute)
            });
        });
    });
});




/* Encumbrance */
const loadTable = {
    /* Normal */ '0': {"skills": '0', "movement": '+0'},
    /* Burdened */ '1': {"skills": '1', "movement": '-2'},
    /* Overloaded */ '2': {"skills": '2', "movement": '*.5'},
    /* Max */ '3': {"skills": '3', "movement": '*0'}
}
/**
 * Will return an object of all the attrs needed to perform enc calculations along with the repeating IDs of equipment
 * repeatingIds object containing the repeatingIds of meleeweapon rangedweapon equipment and currency
 * return []
 */
function encGetAttrs(repeatingIds) {
    let repeatingGetAttrs = [];
    repeatingIds['meleeWeaponIds'].forEach(meleeWeaponId => {
        repeatingGetAttrs.push(`repeating_meleeweapon_${meleeWeaponId}_enc`, `repeating_meleeweapon_${meleeWeaponId}_location`);
    });
    repeatingIds['rangedWeaponIds'].forEach(rangedWeaponId => {
        repeatingGetAttrs.push(`repeating_rangedweapon_${rangedWeaponId}_enc`, `repeating_rangedweapon_${rangedWeaponId}_location`);
    });
    repeatingIds['gearIds'].forEach(gearId => {
        repeatingGetAttrs.push(`repeating_equipment_${gearId}_enc`, `repeating_equipment_${gearId}_quantity`, `repeating_equipment_${gearId}_location`);
    });
    repeatingIds['currencyIds'].forEach(currencyId => {
        repeatingGetAttrs.push(`repeating_currency_${currencyId}_enc`, `repeating_currency_${currencyId}_quantity`, `repeating_currency_${currencyId}_location`);
    });

    return ['str', 'pack_equipped', 'half_effective_armor_enc', 'avg_species_siz', 'encumbrance_temp',
        'location1_armor_enc', 'location1_armor_equipped',
        'location2_armor_enc', 'location2_armor_equipped',
        'location3_armor_enc', 'location3_armor_equipped',
        'location4_armor_enc', 'location4_armor_equipped',
        'location5_armor_enc', 'location5_armor_equipped',
        'location6_armor_enc', 'location6_armor_equipped',
        'location7_armor_enc', 'location7_armor_equipped',
        'location8_armor_enc', 'location8_armor_equipped',
        'location9_armor_enc', 'location9_armor_equipped',
        'location10_armor_enc', 'location10_armor_equipped',
        'location11_armor_enc', 'location11_armor_equipped',
        'location12_armor_enc', 'location12_armor_equipped'].concat(repeatingGetAttrs);
}
function calcEncAndArmorPenalty(repeatingIds, v) {
    let newAttrs = {};

    /* Calculate Armor Enc */
    let wornArmorEnc = 0;
    let packArmorEnc = 0;
    let effectiveWornArmorEnc;
    ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'].forEach(location => {
        const locationEnc = parseFloat(v[`location${location}_armor_enc`]) || 0;
        if (v[`location${location}_armor_equipped`] === '1') {
            wornArmorEnc = wornArmorEnc + locationEnc;
        } else if (v[`location${location}_armor_equipped`] === '0') {
            packArmorEnc = packArmorEnc + locationEnc;
        }
    });
    if (v['half_effective_armor_enc'] === '1') {
        effectiveWornArmorEnc = Math.ceil(wornArmorEnc/4);
    } else {
        effectiveWornArmorEnc = Math.ceil(wornArmorEnc/2);
    }
    newAttrs['armor_penalty'] = 0 - Math.ceil(wornArmorEnc/5);
    let wornEnc = effectiveWornArmorEnc;
    let packEnc = packArmorEnc;

    /* Add up all the rest of the ENC */
    repeatingIds['meleeWeaponIds'].forEach(meleeWeaponId => {
        const weaponEnc = parseFloat(v[`repeating_meleeweapon_${meleeWeaponId}_enc`]) || 0;
        if (v[`repeating_meleeweapon_${meleeWeaponId}_location`] === 'loadout') {
            wornEnc = wornEnc + weaponEnc;
        } else if (v[`repeating_meleeweapon_${meleeWeaponId}_location`] === 'pack') {
            packEnc = packEnc + weaponEnc;
        }
    });
    repeatingIds['rangedWeaponIds'].forEach(rangedWeaponId => {
        const weaponEnc = parseFloat(v[`repeating_rangedweapon_${rangedWeaponId}_enc`]) || 0;
        if (v[`repeating_rangedweapon_${rangedWeaponId}_location`] === 'loadout') {
            wornEnc = wornEnc + weaponEnc;
        } else if (v[`repeating_rangedweapon_${rangedWeaponId}_location`] === 'pack') {
            packEnc = packEnc + weaponEnc;
        }
    });
    repeatingIds['gearIds'].forEach(gearId => {
        const gearEnc = parseFloat(v[`repeating_equipment_${gearId}_enc`]) || 0;
        const gearQty = parseInt(v[`repeating_equipment_${gearId}_quantity`]) || 0;
        if (v[`repeating_equipment_${gearId}_location`] === 'loadout') {
            wornEnc = wornEnc + (gearEnc * gearQty);
        } else if (v[`repeating_equipment_${gearId}_location`] === 'pack') {
            packEnc = packEnc + (gearEnc * gearQty);
        }
    });
    repeatingIds['currencyIds'].forEach(currencyId => {
        const currencyEnc = parseFloat(v[`repeating_currency_${currencyId}_enc`]) || 0;
        const currencyQty = parseInt(v[`repeating_currency_${currencyId}_quantity`]) || 0;
        if (v[`repeating_currency_${currencyId}_location`] === 'loadout') {
            wornEnc = wornEnc + (currencyEnc * currencyQty);
        } else if (v[`repeating_currency_${currencyId}_location`] === 'pack') {
            packEnc = packEnc + (currencyEnc * currencyQty);
        }
    });

    /* Find the total enc to apply for effect with avg species siz factored in */
    let enc = 0;
    const avgSpeciesSiz = parseInt(v['avg_species_siz']) || 0;
    const encTemp = parseInt(v['encumbrance_temp']) || 0;
    if (v['pack_equipped'] === '1') {
        enc = Math.ceil((wornEnc + packEnc + encTemp) * (avgSpeciesSiz/13));
    } else {
        enc = Math.ceil((wornEnc + encTemp) * (avgSpeciesSiz/13));
    }
    newAttrs['encumbrance_current'] = enc.toFixed(2);

    /* Set load and related effects */
    const str = parseInt(v['str']) || 0;
    if (enc >= (str * 4)) {
        newAttrs['encumbrance_load'] = '3';
        newAttrs['encumbrance_skills'] = loadTable['3']['skills'];
        newAttrs['movement_rate_enc'] = loadTable['3']['movement'];
    } else if (enc > (str * 3)) {
        newAttrs['encumbrance_load'] = '2';
        newAttrs['encumbrance_skills'] = loadTable['2']['skills'];
        newAttrs['movement_rate_enc'] = loadTable['2']['movement'];
    } else if (enc > (str * 2)) {
        newAttrs['encumbrance_load'] = '1';
        newAttrs['encumbrance_skills'] = loadTable['1']['skills'];
        newAttrs['movement_rate_enc'] = loadTable['1']['movement'];
    } else {
        newAttrs['encumbrance_load'] = '0';
        newAttrs['encumbrance_skills'] = loadTable['0']['skills'];
        newAttrs['movement_rate_enc'] = loadTable['0']['movement'];
    }

    return newAttrs;
}
on("change:location1_armor_enc change:location1_armor_equipped change:location2_armor_enc change:location2_armor_equipped change:location3_armor_enc change:location3_armor_equipped change:location4_armor_enc change:location4_armor_equipped change:location5_armor_enc change:location5_armor_equipped change:location6_armor_enc change:location6_armor_equipped change:location7_armor_enc change:location7_armor_equipped change:location8_armor_enc change:location8_armor_equipped change:location9_armor_enc change:location9_armor_equipped change:location10_armor_enc change:location10_armor_equipped change:location11_armor_enc change:location11_armor_equipped change:location12_armor_enc change:location12_armor_equipped change:half_effective_armor_enc change:pack_equipped change:avg_species_siz change:encumbrance_temp change:repeating_meleeweapon:enc change:repeating_meleeweapon:location change:repeating_rangedweapon:enc change:repeating_rangedweapon:location change:repeating_equipment:enc change:repeating_equipment:location change:repeating_equipment:quantity change:repeating_currency:enc change:repeating_currency:location change:repeating_currency:quantity remove:repeating_meleeweapon remove:repeating_rangedweapon remove:repeating_equipment remove:repeating_currency", function(event) {
    if (event.sourceType === "sheetworker") {return;}

    let repeatingIds = {}
    getSectionIDs("repeating_meleeweapon", function(meleeWeaponIds) {
        repeatingIds['meleeWeaponIds'] = meleeWeaponIds;
        getSectionIDs("repeating_rangedweapon", function(rangedWeaponIds) {
            repeatingIds['rangedWeaponIds'] = rangedWeaponIds;
            getSectionIDs("repeating_equipment", function(gearIds) {
                repeatingIds['gearIds'] = gearIds;
                getSectionIDs("repeating_currency", function(currencyIds) {
                    repeatingIds['currencyIds'] = currencyIds;
                    getAttrs(encGetAttrs(repeatingIds).concat(initGetAttrs, moveRateGetAttrs), function(v) {
                        let newAttrs = calcEncAndArmorPenalty(repeatingIds, v);
                        /* Update v with new values need for attribute calculations */
                        v = {...v, ...newAttrs};
                        setAttrs({
                            ...newAttrs,
                            ...calcInitiativeBonus(v),
                            ...calcMoveRate(v)
                        });
                    });
                });
            });
        });
    });
});

/* Repeating IDs */
on("change:repeating_combatstyle change:repeating_professionalskill change:repeating_passion change:repeating_dependency change:repeating_peculiarity change:repeating_meleeweapon change:repeating_rangedweapon change:repeating_equipment change:repeating_currency change:repeating_ability change:repeating_superpowerlimit", function(event) {
    if (event.sourceType === "sheetworker") {return;}
    const type = event.sourceAttribute.split('_')[1];
    const id = event.sourceAttribute.split('_')[2];

    /* seems we can get change that aren't for a particular item this checks to ensure we have an id to parse */
    if (id.startsWith("-")) {
        setAttrs({[`repeating_${type}_${id}_id`]: `repeating_${type}_${id}`});
    }
});

/* Character Import */
const cultRankMap = {
    'common': 1,
    'lay member': 1,
    'follower': 1,
    'dedicated': 2,
    'initiate': 2,
    'spirit worshipper': 2,
    'proven': 3,
    'acolyte': 3,
    'shaman': 3,
    'overseer': 4,
    'priest': 4,
    'high shaman': 4,
    'leader': 5,
    'high priest': 5,
    'spirit lord': 5
};
/**
 * Imports JSON data from the Mythras Encounter Generator or other sources which use the same data format
 */
on("clicked:import", function() {
    getAttrs(['import_json_data', 'import_character', 'import_type', 'simplified_combat_enabled', 'luck_points_rank', 'action_points_calc'], function(v) {
        console.log(v['action_points_calc']);
        try {
            const jsonData = JSON.parse(v['import_json_data']);
            const import_character = parseInt(v['import_character']);
            /* Check if the requested import character is out of range */
            if (import_character > jsonData.length) {
                setAttrs({
                    import_errors: "Error: The import data contains " + jsonData.length + " character(s) but you requested number " + import_character + "."
                });
                return;
            }
            const characterData = jsonData[parseInt(v['import_character']) - 1];

            /* We assume defaults and fill in what the import doesn't provide */
            let newAttrs = {
                rank: 0,
                str_base: 0, str_temp: 0, str: 0,
                con_base: 0, con_temp: 0, con: 0,
                siz_base: 0, siz_temp: 0, siz: 0,
                dex_base: 0, dex_temp: 0, dex: 0,
                int_base: 0, int_temp: 0, int: 0,
                pow_base: 0, pow_temp: 0, pow: 0,
                cha_base: 0, cha_temp: 0, cha: 0,
                characteristics_details: 0,
                action_points_other: 0, action_points_temp: 0, action_points_calc: v['action_points_calc'], action_points: 2, action_points_max: 2,
                damage_mod_calc: '0', damage_mod_other: 0, damage_mod_temp: 0,
                experience_mod_calc: '0', experience_mod_other: 0, experience_mod_temp: 0,
                healing_rate_calc: '0', healing_rate_other: 0, healing_rate_temp: 0, healing_rate_double: '0',
                initiative_bonus_other: 0, initiative_bonus_temp: 0, initiative_add_one_tenth_athletics: '0',
                luck_points_calc: '0', luck_points_other: 0, luck_points_temp: 0, luck_points_rank: v['luck_points_rank'], luck_points: 2, luck_points_max2: 2,
                magic_points_other: 0, magic_points_temp: 0, magic_points: 11, magic_points_max: 11,
                prana_points_other: 0, prana_points_temp: 0, prana_points: 11, prana_points_max: 11,
                power_points_other: 0, power_points_temp: 0, power_points: 11, power_points_max: 11,
                movement_rate_temp: 0, movement_rate_other: 0, movement_rate_species: 6,
                armor_penalty: 0, fatigue: '9', encumbrance_load: '0'
            };

            /* Import Info */
            if (debug) {console.log('Importing Info');}
            newAttrs['character_name'] = characterData['name'];

            if (characterData["cults"]) {
                if (characterData["cults"][0] !== []) {
                    if (characterData["cults"][0]) {
                        let cults = "";
                        for (let i=0; i < characterData["cults"].length; i++) {
                            cults = cults + " * " + characterData["cults"][i] + "\r\n";
                        }
                        newAttrs['cult_notes'] = cults;
                    }
                }
            }

            if (characterData["cult_rank"] && v['luck_points_rank'] === '1') {
                if (characterData["cult_rank"].toLowerCase() in cultRankMap) {
                    newAttrs['rank'] = cultRankMap[characterData["cult_rank"].toLowerCase()];
                }
            }

            if (characterData["notes"]) {
                newAttrs['sheet_notes'] = characterData["notes"];
            }

            /* Import Characteristics */
            if (debug) {
                console.log("Importing Characteristics");
            }
            characterData["stats"].forEach(stat => {
                const charKey = Object.keys(stat)[0];
                const char = charKey.toLowerCase();
                newAttrs[`${char}_base`] = stat[charKey];
                newAttrs[`${char}`] = stat[charKey];
            });

            if (debug) {
                console.log("Determining Import Sheet type");
            }
            /* Detect Sheet Character Type, Species, and name */
            if (v['import_type'] === 'major') {
                newAttrs['type'] = 'pc';
            } else {
                /* Elementals have str and dex but no siz and con, so we determine spirit by str and dex only */
                if (newAttrs['str_base'] === 0 && newAttrs['dex_base'] === 0) {
                    newAttrs['type'] = 'spirit';
                } else {
                    newAttrs['type'] = 'creature';
                }
            }

            /* Import Attributes */
            if (debug) {console.log("Importing attributes");}
            if (characterData["attributes"]["movement"]) {
                const moveInt = parseInt(characterData["attributes"]["movement"]);
                if (Number.isInteger(moveInt) && moveInt > 0) {
                    newAttrs['movement_rate_species'] = moveInt;
                    newAttrs['movement_rate_base'] = moveInt;
                    newAttrs['movement_rate'] = moveInt;
                    /* TODO calculate advanced movement */
                } else {
                    newAttrs['custom_movement_enabled'] = '1';
                    newAttrs['custom_movement'] = characterData["attributes"]["movement"];
                }
            }

            if (characterData["attributes"]["strike_rank"].includes("-")) {
                /* if a penalty is present set the modifier for initiative later */
                const armorPenalty = parseInt(characterData["attributes"]["strike_rank"].split("-")[1].replace(')','')) || 0;
                newAttrs['armor_penalty'] = -armorPenalty;
            }

            /* Import Hit Locations */
            console.log("Importing Hit Locations");
            /* Import Hit Locations */
            if (v['simplified_combat_enabled'] === '1') {
                newAttrs['hit_locations'] = "simplified";
                newAttrs = {...newAttrs, ...hitLocationTable['simplified']};
                newAttrs = {...newAttrs, ...calcLocationHP('1', newAttrs)};
                let apTotal = 0;
                characterData["hit_locations"].forEach(location => {
                    let locationAP = location['ap'];
                    apTotal = apTotal + locationAP;
                });
                /* Get the average ap value as a rough conversion to simplified combat */
                newAttrs['location1_ap'] = Math.round(apTotal / characterData["hit_locations"].length);
            } else {
                /* Determine number of hit locations and set custom form to proper amount */
                if (characterData["hit_locations"].length === 12) {
                    newAttrs['hit_locations'] = "custom";
                } else {
                    newAttrs['hit_locations'] = "custom" + characterData["hit_locations"].length;
                }
                newAttrs = {...newAttrs, ...hitLocationTable[newAttrs['hit_locations']]};

                const rootHp = calcRootHP(newAttrs);

                for (let i=0; i < characterData["hit_locations"].length; i++) {
                    let location = i + 1;

                    let table = characterData["hit_locations"][i]["range"].split("-");
                    newAttrs[`location${location}_table_start`] = parseInt(table[0]);
                    if (!table[1]) {
                        newAttrs[`location${location}_table_end`] = parseInt(table[0]);
                    } else {
                        newAttrs[`location${location}_table_end`] = parseInt(table[1]);
                    }

                    newAttrs[`location${location}_name`] = characterData["hit_locations"][i]["name"];

                    let locationAP = characterData["hit_locations"][i]['ap'];
                    newAttrs[`location${location}_ap`] = locationAP;
                    newAttrs[`location${location}_ap_max`] = locationAP;
                    const newLocHP = parseInt(characterData["hit_locations"][i]["hp"]);
                    newAttrs[`location${location}_hp_max_base_mod`] = newLocHP - rootHp;
                    newAttrs[`location${location}_hp_max_other`] = 0;
                    newAttrs[`location${location}_hp_max`] = newLocHP;
                    newAttrs[`location${location}_hp`] = newLocHP;
                    newAttrs[`location${location}_hp`] = newLocHP;
                }
            }

            /* TODO Import weapons & combat style */

            /* Import Notes TODO import misc features as notes*/


            /* Clear the import data */
            newAttrs['import_json_data'] = '';
            newAttrs['import_errors'] = '';

            setAttrs({
                ...newAttrs,
                ...calcActionPoints(newAttrs),
                ...calcDamageMod(newAttrs),
                ...calcExpMod(newAttrs),
                ...calcHealingRate(newAttrs),
                ...calcInitiativeBonus(newAttrs),
                ...calcLuckPoints(newAttrs),
                ...calcMagicPoints(newAttrs),
                ...calcPowerPoints(newAttrs),
                ...calcPranaPoints(newAttrs),
                ...calcTenacity(newAttrs),
                ...calcAllHP(newAttrs)
            });
        } catch (error) {
            setAttrs({import_errors: error});
        }
    });
});

/* Character Versioning */
/**
 * Make the changes needs to get a character sheet updated from 2.7 to 3.0
 */
function upgradeCharacter3Dot0() {
    if (debug) {console.log("Upgrading character to 3.0");}
    let charGetAttrs = [];
    characteristicAttrs.forEach(char => { charGetAttrs.push(`${char}`, `${char}_temp`); });
    getAttrs(charGetAttrs.concat(hpGetAttrs,
        ['spirit', 'action_points_other', 'action_points_add_one', 'notes', "location2_display", "income_day", "income_month", "income_season", "income_year"]), function(v) {
        let newAttrs = {'version': '3.0'};

        /* If a spirit set the attribute mode to spiritual and sheet type to spirit */
        if (v['spirit'] === '1') {
            newAttrs['attribute_mode'] = 'spiritual'; /* init and ap will already be spirit calc so no need to force it */
            newAttrs['type'] ='spirit';
        }

        /* Convert Characteristics base values */
        characteristicAttrs.forEach(char => {
            const charCurr = parseInt(v[`${char}`]) || 0;
            const charTemp = parseInt(v[`${char}_temp`]) || 0;
            newAttrs[`${char}_base`] = charCurr - charTemp;
        });

        /* Convert action_points_add_one to just +1 in other */
        if (v['action_points_add_one'] === '1') {
            const actionPointsOther = parseInt(v['action_points_other']) || 0;
            newAttrs['action_points_other'] = actionPointsOther + 1;
        }

        /* Convert Hit Locations Display*/
        if (v['location2_display'] === '1') {
            newAttrs['location2to7_display'] === '1';
        }
        /* Convert HP for simplified combat */
        let newHpAttrs = {}
        if (v['simplified_combat_enabled'] === '1') {
            newHpAttrs = {
                ...hitLocationTable['simplified'],
                ...calcLocationHP('1', {...v, ...hitLocationTable['simplified']})
            };
        }

        /* TODO combat style traits moved into notes */

        /* TODO remove augment and penalty form the skill/passion totals */

        /* TODO merge languages into professional skill */

        /* TODO merge magic skills into professional skills with tags */

        /* Convert income */
        let newIncome = "";
        const incomeDay = parseFloat(v['income_day']) || 0;
        const incomeMonth = parseFloat(v['income_month']) || 0;
        const incomeSeason = parseFloat(v['income_season']) || 0;
        const incomeYear = parseFloat(v['income_year']) || 0;
        if (v['income_day']) {newIncome = newIncome + getTranslationByKey('day') + ':' + incomeDay.toFixed(2) + ' ';}
        if (v['income_month']) {newIncome = newIncome + getTranslationByKey('month') + ':' + incomeMonth.toFixed(2) + ' ';}
        if (v['income_season']) {newIncome = newIncome + getTranslationByKey('season') + ':' + incomeSeason.toFixed(2) + ' ';}
        if (v['income_year']) {newIncome = newIncome + getTranslationByKey('year') + ':' + incomeYear.toFixed(2);}
        newAttrs['income'] = newIncome;

        /* Convert Notes */
        if (v['notes']) {
            newAttrs['sheet_notes'] = v['notes'];
        }

        /* Delete json import data due to size and not needing it anymore, v3 does this for us after import */
        newAttrs['encounter_generator_json'] = '';

        setAttrs({
            ...newAttrs,
            ...newHpAttrs
        });
    });
}


/* Versioning */
/**
 * Compares current sheet version to latest and performs necessary changes to bring the sheet up to date
 * @param type the sheet type attribute
 * @param version the sheet version already parse to a float or 0 if not a valid float
 */
function versioning(type, version) {
    const latestVersion = '3.0';
    if (debug) {console.log(`Current sheet version = ${version}`);}
    version = parseFloat(version) || 0;
    /* Eval sheet version and run upgrade functions as needed, note we have dropped functions of old versions */
    if(version === 0) {
        if (debug) {console.log(`Current version invalid, setting to ${latestVersion}`);}
        setAttrs({['version']: latestVersion});
    } else if (version < 3.0) {
        if (type === 'pc') {upgradeCharacter3Dot0();}
        versioning(type, '3.0');
    }
}

/**
 * Sets a number of attributes containing translations for prompts which normally can't use the i18n systems
 * @returns {} an object of translation attributes
 */
function setTranslationAttrs() {
    setAttrs(
        {}
    );
}

/* On Open Triggers */
on("sheet:opened", function() {
    getAttrs(['type', 'version'], function(v) {
        versioning(v['type'], v['version']);
    });
    setTranslationAttrs();
});
</script>