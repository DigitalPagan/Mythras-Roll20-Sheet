<input class="sheet-typetoggle" type="hidden" name="attr_type" value="pc"><input class="sheet-setting-control" type="hidden" name="attr_setting" value="default"><input class="sheet-compact-control" type="hidden" name="attr_compact" value="0"><div class="sheet-wrapper"><div class="sheet-option-bar"><div class="sheet-space-between sheet-gap"><div class="sheet-flex sheet-gap"><div><input data-i18n-title="whisper_rolls_to_gm" type="checkbox" name="attr_roll_display" value="/w gm" checked><span class="sheet-checkico">q</span></div><div class="sheet-flex sheet-gap"><label class="sheet-left sheet-large-screen" data-i18n="difficulty">Difficulty</label><label class="sheet-left sheet-small-screen" data-i18n-title="difficulty" data-i18n="difficulty-abrv">Diff</label><select class="sheet-auto-width sheet-undrln sheet-text-center sheet-inverted" name="attr_difficulty"><option value="0" data-i18n="verbose" selected>verbose</option><option value="1" data-i18n="very_easy">Very Easy</option><option value="2" data-i18n="easy">Easy</option><option value="3" data-i18n="standard">Standard</option><option value="4" data-i18n="hard">Hard</option><option value="5" data-i18n="formidable">Formidable</option><option value="6" data-i18n="herculean">Herculean</option></select></div><div class="sheet-flex sheet-gap"><label class="sheet-left sheet-large-screen" data-i18n="augmentation">Augmentation</label><label class="sheet-left sheet-small-screen" data-i18n-title="augmentation" data-i18n="augmentation-abrv">Aug</label><select class="sheet-auto-width sheet-undrln sheet-text-center sheet-inverted" title="@{augmentation}" name="attr_augmentation"><option value="@{set_augmentation}" data-i18n="set" selected>Set</option><option value="?{Augmentation|0}" data-i18n="prompt">Prompt</option></select><input type="hidden" class="sheet-set-toggle" name="attr_augmentation" value="@{set_augmentation}"><input type="number" class="sheet-number-width-sm sheet-undrln sheet-toggle" name="attr_set_augmentation" value="0"></div><div class="sheet-flex sheet-gap"><label class="sheet-left sheet-large-screen" data-i18n="101+_penalty">101+ Penalty</label><label class="sheet-left sheet-small-screen" data-i18n-title="101+_penalty">101+</label><select class="sheet-auto-width sheet-undrln sheet-text-center sheet-inverted" title="@{penalty}" name="attr_penalty"><option value="@{set_penalty}" data-i18n="set" selected>Set</option><option value="?{101+ Penalty|0}" data-i18n="prompt">Prompt</option></select><input type="hidden" class="sheet-set-toggle" name="attr_penalty" value="@{set_penalty}"><input type="number" class="sheet-number-width-sm sheet-undrln sheet-toggle" name="attr_set_penalty" value="0"></div></div><div class="sheet-flex sheet-gap"><div><input type="checkbox" data-i18n-title="compact_mode" name="attr_compact" value="1"><span class="sheet-checkico">J</span></div><a class="sheet-pictos" data-i18n-title="show_help_popup" href="#help">?</a><a class="sheet-pictos" data-i18n-title="show_import_popup" href="#import">~</a><a class="sheet-pictos" data-i18n-title="show_configuration_popup" href="#configuration">y</a></div></div><div class="sheet-detailed"><div class="sheet-flex sheet-gap"><a href="#core">Core</a> - <a href="#abilities">Abilities</a> - <a href="#other">other</a></div></div></div><div class="sheet-character"><div class="sheet-detailed"><div class="sheet-flex sheet-gap"><div class="sheet-section sheet-grow"><div class="sheet-flex sheet-gap"><div class="sheet-grow"><input type="text" class="sheet-full-width" title="@{character_name}" name="attr_character_name"><label data-i18n="name">Name</label></div><div class="sheet-grow"><input type="text" class="sheet-full-width" title="@{species}" name="attr_species"><span class="sheet-setting-option sheet-not-cf"><label data-i18n="species">Species</label></span><span class="sheet-setting-option sheet-cf"><label data-i18n="race">Race</label></span></div><div class="sheet-grow"><input type="text" class="sheet-full-width" title="@{culture}" name="attr_culture"><label data-i18n="culture">Culture</label></div><div class="sheet-grow"><input type="text" class="sheet-full-width" title="@{career}" name="attr_career"><span class="sheet-setting-option sheet-not-cf"><label data-i18n="career">Career</label></span><span class="sheet-setting-option sheet-cf"><label data-i18n="class">Class</label></span></div><div class="sheet-setting-option sheet-cf sheet-info-rank"><input type="number" class="sheet-full-width" title="@{rank}" name="attr_rank" value="0"><label data-i18n="rank">Rank</label></div></div><div class="sheet-flex sheet-gap"><div class="sheet-grow"><input type="text" class="sheet-full-width" title="@{homeland}" name="attr_homeland"><label data-i18n="homeland">Homeland</label></div><div class="sheet-grow"><input type="text" class="sheet-full-width" title="@{social_class}" name="attr_social_class"><label data-i18n="social_class">Name</label></div><div class="sheet-info-age"><input type="number" class="sheet-full-width" title="@{age}" name="attr_age" value="0"><label data-i18n="age">Age</label></div><div class="sheet-info-gender"><input type="text" class="sheet-full-width" title="@{gender}" name="attr_gender"><label data-i18n="gender">Gender</label></div><div class="sheet-info-frame"><input type="text" class="sheet-full-width" title="@{frame}" name="attr_frame"><label data-i18n="frame">Gender</label></div><div class="sheet-info-height"><input type="number" style="padding-right: 25px" class="sheet-full-width" title="@{height}" name="attr_height" value="178"><span class="sheet-input-unit" data-i18n="centimetres-abrv">cm</span><label data-i18n="height-bugfix">Height</label></div><div class="sheet-info-weight"><input type="number" style="padding-right: 20px" class="sheet-full-width" title="@{weight}" name="attr_weight" value="88"><span class="sheet-input-unit" data-i18n="kilograms-abrv">kg</span><label data-i18n="weight">Weight</label></div><div class="sheet-setting-option sheet-os sheet-info-the-soot"><input type="number" class="sheet-full-width" title="@{the_soot}" name="attr_the_soot" value="0"><label data-i18n="the_soot">The Soot</label></div></div></div><div class="sheet-logo"><div><img class="sheet-setting-option sheet-default sheet-atvw sheet-cf sheet-destined sheet-fioracitta sheet-la sheet-lyonesse sheet-mi sheet-mba sheet-mb sheet-mc sheet-mr sheet-imperative sheet-perceforest sheet-thennla sheet-wu" src="https://i.imgur.com/EzQDmms.png" alt="Mythras"><img class="sheet-setting-option sheet-ms" src="https://i.imgur.com/5uPy3QU.jpg" alt="M-Space"><img class="sheet-setting-option sheet-os" src="https://i.imgur.com/35dOQix.jpg" alt="Odd Soot"></div><div class="sheet-flex sheet-gap"><label class="sheet-left" data-i18n="experience_rolls">Experience Rolls</label><input type="number" class="sheet-grow" title="@{experience_rolls}" name="attr_experience_rolls" value="0"></div></div></div><div class="sheet-flex sheet-gap"><div class="sheet-section"><div class="sheet-space-between"><h2 data-i18n="characteristics">Characteristics</h2><div><input type="checkbox" data-i18n-title="show_base_values" name="attr_characteristics_details" value="1" checked><span class="sheet-checkico">E</span></div></div><input class="sheet-deep-toggle" type="hidden" name="attr_characteristics_details" value="1"><div class="sheet-table"><div class="sheet-tr"><div class="sheet-th"></div><div class="sheet-th sheet-toggle" data-i18n="base">Base</div><div class="sheet-th" data-i18n-title="temporary" data-i18n="temporary-abrv">Temp</div><div class="sheet-th" data-i18n-title="current" data-i18n="current-abrv">Curr</div></div><div class="sheet-tr sheet-creature"><div class="sheet-td sheet-char-label"><label class="sheet-left" data-i18n="str-u">STR</label></div><div class="sheet-td sheet-toggle"><input type="number" class="sheet-dullval sheet-number-width" title="@{str_base}" name="attr_str_base" value="11"></div><div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{str_temp}" name="attr_str_temp" value="0"></div><div class="sheet-td"><input type="number" class="sheet-impval sheet-number-width" title="@{str}" name="attr_str" value="11" readonly></div></div><div class="sheet-tr sheet-creature"><div class="sheet-td sheet-char-label"><label class="sheet-left" data-i18n="con-u">CON</label></div><div class="sheet-td sheet-toggle"><input type="number" class="sheet-dullval sheet-number-width" title="@{con_base}" name="attr_con_base" value="11"></div><div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{con_temp}" name="attr_con_temp" value="0"></div><div class="sheet-td"><input type="number" class="sheet-impval sheet-number-width" title="@{con}" name="attr_con" value="11" readonly></div></div><div class="sheet-tr sheet-creature"><div class="sheet-td sheet-char-label"><label class="sheet-left" data-i18n="siz-u">SIZ</label></div><div class="sheet-td sheet-toggle"><input type="number" class="sheet-dullval sheet-number-width" title="@{siz_base}" name="attr_siz_base" value="13"></div><div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{siz_temp}" name="attr_siz_temp" value="0"></div><div class="sheet-td"><input type="number" class="sheet-impval sheet-number-width" title="@{siz}" name="attr_siz" value="13" readonly></div></div><div class="sheet-tr sheet-creature"><div class="sheet-td sheet-char-label"><label class="sheet-left" data-i18n="dex-u">DEX</label></div><div class="sheet-td sheet-toggle"><input type="number" class="sheet-dullval sheet-number-width" title="@{dex_base}" name="attr_dex_base" value="11"></div><div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{dex_temp}" name="attr_dex_temp" value="0"></div><div class="sheet-td"><input type="number" class="sheet-impval sheet-number-width" title="@{dex}" name="attr_dex" value="11" readonly></div></div><div class="sheet-tr"><div class="sheet-td sheet-char-label"><label class="sheet-left"><span name="attr_int_type" data-i18n-dynamic>INT</span></label></div><div class="sheet-td sheet-toggle"><input type="number" class="sheet-dullval sheet-number-width" title="@{int_base}" name="attr_int_base" value="13"></div><div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{int_temp}" name="attr_int_temp" value="0"></div><div class="sheet-td"><input type="number" class="sheet-impval sheet-number-width" title="@{int}" name="attr_int" value="13" readonly></div></div><div class="sheet-tr"><div class="sheet-td sheet-char-label"><label class="sheet-left" data-i18n="pow-u">POW</label></div><div class="sheet-td sheet-toggle"><input type="number" class="sheet-dullval sheet-number-width" title="@{pow_base}" name="attr_pow_base" value="11"></div><div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{pow_temp}" name="attr_pow_temp" value="0"></div><div class="sheet-td"><input type="number" class="sheet-impval sheet-number-width" title="@{pow}" name="attr_pow" value="11" readonly></div></div><div class="sheet-tr"><div class="sheet-td sheet-char-label"><label class="sheet-left" data-i18n="cha-u">CHA</label></div><div class="sheet-td sheet-toggle"><input type="number" class="sheet-dullval sheet-number-width" title="@{cha_base}" name="attr_cha_base" value="11"></div><div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{cha_temp}" name="attr_cha_temp" value="0"></div><div class="sheet-td"><input type="number" class="sheet-impval sheet-number-width" title="@{cha}" name="attr_cha" value="11" readonly></div></div></div></div><div class="sheet-section"><div class="sheet-space-between"><h2 data-i18n="attributes">Attributes</h2><a class="sheet-pictos" data-i18n-title="show_attributes_popup" href="#attribute-configuration">y</a></div><div class="sheet-flex"><div class="sheet-th sheet-grow" data-i18n="attribute">Attribute</div><div class="sheet-th"><div class="sheet-number-width" data-i18n-title="temporary" data-i18n="temporary-abrv">Temp</div></div><div class="sheet-th"><div class="sheet-number-width" data-i18n-title="current" data-i18n="current-abrv">Curr</div></div></div><div data-i18n-list="attribute-order"><div data-i18n-list-item="action_points" class="sheet-flex sheet-hl sheet-creature"><div class="sheet-td sheet-grow sheet-text-left"><label class="sheet-left" data-i18n="action_points">Action Points</label></div><div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{action_points_temp}" name="attr_action_points_temp" value="0"></div><div class="sheet-td"><div class="sheet-impval sheet-number-width"><input type="number" class="sheet-lval" title="@{action_points}" name="attr_action_points" value="2">/<input type="number" class="sheet-rval" title="@{action_points|max}" name="attr_action_points_max" value="2" readonly></div></div></div><div data-i18n-list-item="damage_modifier" class="sheet-flex sheet-hl sheet-creature"><div class="sheet-td sheet-grow sheet-text-left"><label class="sheet-left" data-i18n-title="damage_modifier" data-i18n="damage_modifier-abrv">Damage Mod</label></div><div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{damage_mod_temp}" name="attr_damage_mod_temp" value="0"></div><div class="sheet-td"><input type="text" class="sheet-impval sheet-number-width" title="@{damage_mod}" name="attr_damage_mod" value="0" readonly></div></div><div data-i18n-list-item="experience_modifier" class="sheet-flex sheet-hl sheet-major"><div class="sheet-td sheet-grow sheet-text-left"><label class="sheet-left" data-i18n-title="experience_modifier" data-i18n="experience-abrv_modifier">Exp Modifier</label></div><div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{experience_mod_temp}" name="attr_experience_mod_temp" value="0"></div><div class="sheet-td"><input type="number" class="sheet-impval sheet-number-width" title="@{experience_mod}" name="attr_experience_mod" value="0" readonly></div></div><div data-i18n-list-item="healing_rate" class="sheet-flex sheet-hl sheet-creature"><div class="sheet-td sheet-grow sheet-text-left"><label class="sheet-left" data-i18n="healing_rate">Healing Rate</label></div><div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{healing_rate_temp}" name="attr_healing_rate_temp" value="2"></div><div class="sheet-td"><input type="number" class="sheet-impval sheet-number-width" title="@{healing_rate}" name="attr_healing_rate" value="2" readonly></div></div><div data-i18n-list-item="initiative" class="sheet-flex sheet-hl sheet-creature"><div class="sheet-td sheet-grow sheet-text-left"><button type="roll" class="sheet-label-left" title="%{initiative}" name="roll_initiative" value="@{roll_display}&{template:default} {{yellow=1}} {{character=@{character_name}}} {{name=^{initiative}}} {{^{roll}=[[@{init_dice} + @{initiative_bonus} &{tracker}]]}}" data-i18n="initiative">Initiative</button></div><div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{initiative_bonus_temp}" name="attr_initiative_bonus_temp" value="0"></div><div class="sheet-td"><input type="number" class="sheet-impval sheet-number-width" title="@{initiative_bonus}" name="attr_initiative_bonus" value="12" readonly></div></div><div data-i18n-list-item="luck_points" class="sheet-flex sheet-hl sheet-major"><div class="sheet-td sheet-grow sheet-text-left"><label class="sheet-left" data-i18n="luck_points">Luck Points</label></div><div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{luck_points_temp}" name="attr_luck_points_temp" value="0"></div><div class="sheet-td"><div class="sheet-impval sheet-number-width"><input type="number" class="sheet-lval" title="@{luck_points}" name="attr_luck_points" value="2">/<input type="number" class="sheet-rval" title="@{luck_points|max}" name="attr_luck_points_max" value="2" readonly></div></div></div><div data-i18n-list-item="magic_points" class="sheet-flex sheet-hl"><div class="sheet-td sheet-grow sheet-text-left"><label class="sheet-left" data-i18n="magic_points">Magic Points</label></div><div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{magic_points_temp}" name="attr_magic_points_temp" value="0"></div><div class="sheet-td"><div class="sheet-impval sheet-number-width"><input type="number" class="sheet-lval" title="@{magic_points}" name="attr_magic_points" value="11">/<input type="number" class="sheet-rval" title="@{magic_points|max}" name="attr_magic_points_max" value="11" readonly></div></div></div><div data-i18n-list-item="movement" class="sheet-hl"><input type="hidden" class="sheet-wide-toggle" name="attr_custom_movement_enabled" value="0"><div class="sheet-flex sheet-anti-toggle"><div class="sheet-td sheet-grow sheet-text-left"><a class="sheet-label-left" data-i18n-title="show_movement_popup" data-i18n="movement" href="#movement-details">Movement</a></div><div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{movement_rate_temp}" name="attr_movement_rate_temp" value="0"></div><div class="sheet-td"><input type="number" class="sheet-impval sheet-number-width" title="@{movement_rate}" name="attr_movement_rate" value="6" readonly></div></div><div class="sheet-flex sheet-toggle sheet-full-width"><div class="sheet-td sheet-grow sheet-text-left"><label class="sheet-left" data-i18n="movement">Movement</label></div><div class="sheet-td sheet-custom-movement"><input type="text" class="sheet-full-width sheet-text-right" title="@{custom_movement}" name="attr_custom_movement"></div></div></div><input type="hidden" class="sheet-toggle" name="attr_tenacity_enabled" value="0"><div data-i18n-list-item="tenacity" class="sheet-flex sheet-hl sheet-toggle"><div class="sheet-td sheet-grow sheet-text-left"><label class="sheet-left" data-i18n="tenacity">Tenacity</label></div><div class="sheet-td"><input type="number" class="sheet-dullval sheet-number-width" title="@{tenacity_temp}" name="attr_tenacity_temp" value="0"></div><div class="sheet-td"><div class="sheet-impval sheet-number-width"><input type="number" class="sheet-lval" title="@{tenacity}" name="attr_tenacity" value="11">/<input type="number" class="sheet-rval" title="@{tenacity|max}" name="attr_tenacity_max" value="11" readonly></div></div></div></div></div><div class="sheet-section"><div class="sheet-space-between"><h2 data-i18n="hit_locations">Hit Locations</h2><a class="sheet-pictos" data-i18n-title="show_hit_locations_popup" href="#hit-locations-configuration">y</a></div><div class="sheet-table"><div class="sheet-tr"><div class="sheet-th">d20</div><div class="sheet-th" data-i18n="hit_location">Hit Location</div><div class="sheet-th sheet-help sheet-pictos-three" data-i18n-title="passive_block_size">b</div><div class="sheet-th sheet-help" data-i18n-title="armor_points" data-i18n="armor_points-abrv">AP</div><div class="sheet-th sheet-help" data-i18n-title="hit_points" data-i18n="hit_points-abrv">HP</div><div class="sheet-th sheet-minor" data-i18n="enc">ENC</div></div><div class="sheet-tr"><div class="sheet-td"><input type="number" class="sheet-number-width-xs" title="@{location1_table_start}" name="attr_location1_table_start" value="0">-<input type="number" class="sheet-number-width-xs" title="@{location1_table_end}" name="attr_location1_table_end" value="0"></div><div class="sheet-td"><input type="text" class="sheet-location-name sheet-text-center" title="@{location1_name}" name="attr_location1_name" value></div><div class="sheet-td"><input type="text" class="sheet-number-width-xs" title="@{location1_block}" name="attr_location1_block" value></div><div class="sheet-td"><input type="number" class="sheet-number-width-sm sheet-impval" title="@{location1_ap}" name="attr_location1_ap" step="1" min="0" value="0"></div><div class="sheet-td"><div class="sheet-impval sheet-number-width"><input type="number" class="sheet-lval" title="@{location1_hp}" name="attr_location1_hp" value="5">/<input type="number" class="sheet-rval" title="@{location1_hp|max}" name="attr_location1_hp_max" value="5" readonly></div></div><div class="sheet-td sheet-minor"><input type="number" class="sheet-number-width-sm" title="@{location1_armor_enc}" name="attr_location1_armor_enc" step="1" min="0" value="0"></div></div></div></div><div class="sheet-section sheet-flex-column sheet-grow"><h2 data-i18n="conditions">Conditions</h2><div class="sheet-bmargin sheet-creature"><div class="sheet-flex"><div><a class="sheet-label-left" data-i18n-title="show_fatigue_popup" data-i18n="fatigue" href="#fatigue-details">Fatigue</a></div><div class="sheet-grow"><select class="sheet-full-width sheet-text-right" title="@{fatigue}" name="attr_fatigue"><option value="9" data-i18n="fresh" selected>Fresh</option><option value="8" data-i18n="winded">Winded</option><option value="7" data-i18n="tired">Tired</option><option value="6" data-i18n="wearied">Wearied</option><option value="5" data-i18n="exhausted">Exhausted</option><option value="4" data-i18n="debilitated">Debilitated</option><option value="3" data-i18n="incapacitated">Incapacitated</option><option value="2" data-i18n="semi-conscious">Semi-Conscious</option><option value="1" data-i18n="comatose">Comatose</option><option value="0" data-i18n="dead">Dead</option></select></div></div><div class="sheet-flex sheet-major"><div><label class="sheet-left" data-i18n="load">Load</label></div><div class="sheet-grow"><select class="sheet-full-width sheet-text-right sheet-readonly" title="@{encumbrance_load}" name="attr_encumbrance_load"><option value="0" data-i18n="normal" selected>Normal</option><option value="1" data-i18n="medium">Medium</option><option value="2" data-i18n="strenuous">Strenuous</option><option value="3" data-i18n="impossible">Impossible</option></select></div></div></div><div class="sheet-grow"><textarea style="height: 100%" name="attr_conditions"></textarea></div></div></div></div><div class="sheet-compact"> Compact </div><div id="attribute-configuration" class="sheet-overlay"><div class="sheet-popup"><a class="close" href="#">×</a><h1 data-i18n="attributes">Attributes</h1><div data-i18n-list="attribute-order" class="sheet-table"><div class="sheet-tr"><div class="sheet-th" data-i18n="attribute">Attribute</div><div class="sheet-th sheet-full-width"><div data-i18n="special">Special</div></div><div class="sheet-th"><div data-i18n="other">Other</div></div><div class="sheet-th"><div data-i18n="base">Base</div></div></div><div data-i18n-list-item="action_points" class="sheet-tr sheet-creature"><div class="sheet-td"><label class="sheet-left" data-i18n="action_points">Action Points</label></div><div class="sheet-td sheet-full-width"></div><div class="sheet-td"><input type="number" class="sheet-number-width" title="@{action_points_other}" name="attr_action_points_other" value="0"></div><div class="sheet-td"><input type="number" class="sheet-number-width" title="@{action_points_base}" name="attr_action_points_base" value="2"></div></div><div data-i18n-list-item="damage_modifier" class="sheet-tr sheet-creature"><div class="sheet-td"><label class="sheet-left" data-i18n="damage_modifier-abrv">Damage Mod</label></div><div class="sheet-td sheet-full-width"><div class="sheet-flex"><div><span data-i18n="calculate_with">Calculate with</span>:</div><div class="sheet-grow"><select class="sheet-full-width sheet-text-center" name="attr_damage_mod_calc"><option data-i18n="str+siz" value="0" selected>STR+SIZ</option><option data-i18n="str+siz+pow" value="1">STR+SIZ+POW</option><option data-i18n="str+siz+con" value="2">STR+SIZ+CON</option></select></div></div></div><div class="sheet-td"><input type="number" class="sheet-number-width" title="@{damage_mod_other}" name="attr_damage_mod_other" value="0"></div><div class="sheet-td"><input type="text" class="sheet-number-width" title="@{damage_mod_base}" name="attr_damage_mod_base" value="0"></div></div><div data-i18n-list-item="damage_modifier" class="sheet-tr sheet-major"><div class="sheet-td"><label class="sheet-left" data-i18n="experience-abrv_modifier">Exp Modifier</label></div><div class="sheet-td sheet-full-width"><div class="sheet-flex"><div><span data-i18n="calculate_with">Calculate with</span>:</div><div class="sheet-grow"><select class="sheet-full-width sheet-text-center" name="attr_experience_mod_calc"><option data-i18n="cha-u" value="0" selected>CHA</option><option data-i18n="int-u" value="1">INT</option></select></div></div></div><div class="sheet-td"><input type="number" class="sheet-number-width" title="@{experience_mod_other}" name="attr_experience_mod_other" value="0"></div><div class="sheet-td"><input type="text" class="sheet-number-width" title="@{experience_mod_base}" name="attr_experience_mod_base" value="0"></div></div><div data-i18n-list-item="healing_rate" class="sheet-tr sheet-creature"><div style="vertical-align: top" class="sheet-td"><label class="sheet-left" data-i18n="healing_rate">Healing Rate</label></div><div style="vertical-align: top" class="sheet-td sheet-full-width sheet-text-left"><div class="sheet-flex"><div><span data-i18n="calculate_with">Calculate with</span>:</div><div class="sheet-grow"><select class="sheet-full-width sheet-text-center" name="attr_healing_rate_calc"><option data-i18n="con-u" value="0" selected>CON</option><option data-i18n="con+1/2_pow" value="1">CON + 1/2 POW</option></select></div></div><div><label class="sheet-checkbox"><input type="checkbox" name="attr_healing_rate_double" value="1"><span>3</span><span data-i18n="double_base_healing_rate">Double Base healing Rate</span></label></div></div><div style="vertical-align: top" class="sheet-td"><input type="number" class="sheet-number-width" title="@{healing_rate_other}" name="attr_healing_rate_other" value="0"></div><div style="vertical-align: top" class="sheet-td"><input type="text" class="sheet-number-width" title="@{healing_rate_base}" name="attr_healing_rate_base" value="2"></div></div></div></div></div><div id="hit-locations-configuration" class="sheet-overlay"><div class="sheet-popup"><a class="close" href="#">×</a><h1 data-i18n="hit_locations">Hit Loctions</h1></div></div><div id="movement-details" class="sheet-overlay"><div class="sheet-popup"><a class="close" href="#">×</a><h1 data-i18n="movement">Movement</h1></div></div><div id="fatigue-details" class="sheet-overlay"><div class="sheet-popup"><a class="close" href="#">×</a><h1 data-i18n="fatigue">Fatigue</h1><div class="sheet-table"><div class="sheet-tr"><div class="sheet-td sheet-text-left"><label class="sheet-left" data-i18n="skills">Skills</label></div><div class="sheet-td"><select class="sheet-full-width sheet-readonly sheet-text-right" name="attr_fatigue_skills"><option value="0" data-i18n="standard" selected>Standard</option><option value="1" data-i18n="hard">Hard</option><option value="2" data-i18n="formidable">Formidable</option><option value="3" data-i18n="herculean">Herculean</option><option value="4" data-i18n="hopeless">Hopeless</option><option value="5" data-i18n="no_action_allowed">No Action Allowed</option></select></div></div><div class="sheet-tr"><div class="sheet-td sheet-text-left"><label class="sheet-left" data-i18n="action_points">Action Points</label></div><div class="sheet-td"><input type="text" class="sheet-full-width sheet-text-right" title="@{action_points_fatigue}" name="attr_action_points_fatigue" value="0" readonly></div></div><div class="sheet-tr"><div class="sheet-td sheet-text-left"><label class="sheet-left" data-i18n="initiative">Initiative</label></div><div class="sheet-td"><input type="text" class="sheet-full-width sheet-text-right" title="@{initiative_bonus_fatigue}" name="attr_initiative_bonus_fatigue" value="0" readonly></div></div><div class="sheet-tr"><div class="sheet-td sheet-text-left"><label class="sheet-left" data-i18n="movement_rate">Movement Rate</label></div><div class="sheet-td"><select class="sheet-full-width sheet-readonly sheet-text-right" name="attr_movement_rate_fatigue"><option value="+0">0</option><option value="-1">-1</option><option value="-2">-2</option><option value="*.5" i18n-data="halved">Halved</option><option value="*0" i18n-data="impossible">Impossible</option></select></div></div><div class="sheet-tr"><div class="sheet-td sheet-text-left"><label class="sheet-left" data-i18n="recovery">Recovery</label></div><div class="sheet-td"><input type="text" class="sheet-full-width sheet-text-right" title="@{fatigue_recovery}" name="attr_fatigue_recovery" value="-"></div></div></div><input type="hidden" name="attr_fatigue_max" value="9"></div></div></div><div id="help" class="sheet-overlay"><div class="sheet-popup"><a class="close" href="#">×</a><h1 data-i18n="help">Help</h1><input type="text" name="attr_version" value="3.0"></div></div><div id="import" class="sheet-overlay"><div class="sheet-popup"><a class="close" href="#">×</a><h1 data-i18n="import">Import</h1><div><label class="sheet-left" data-i18n="import_data">Import Data</label></div><div><textarea class="sheet-full-width" name="attr_import_json_data"></textarea></div><div class="sheet-flex sheet-gap"><div><label class="sheet-left sheet-help" title="Character to import from data">#</label><input type="number" class="sheet-number-width-sm" title="@{import_character}" name="attr_import_character" value="1" min="1"></div><div><label class="sheet-checkbox"><input type="checkbox" name="attr_import_type" value="major"><span>3</span><span data-i18n="import_as_player_character">Import as Player Character</span></label></div></div><button type="action" name="act_import" class="sheet-full-width sheet-btn-style" data-i18n="import">Import</button><fieldset class="repeating_systemspecies"><input type="text" name="attr_test"></fieldset><span style="color: red" name="attr_import_errors"></span></div></div><div id="configuration" class="sheet-overlay"><div class="sheet-popup"><a class="close" href="#">×</a><h1 data-i18n="configuration">Configuration</h1><div class="sheet-bmargin"><label class="sheet-left sheet-rmargin" data-i18n="sheet_type">Sheet Type</label><select data-i18n-list="sheet-type-order" title="@{type}" class="sheet-undrln sheet-auto-width" name="attr_type"><option value="battle_unit" data-i18n-list-item="battle_unit" data-i18n="battle_unit">Battle Unit</option><option value="creature" data-i18n-list-item="creature" data-i18n="creature">Creature</option><option value="pc" data-i18n-list-item="player_character" data-i18n="player_character" selected>Player Character</option><option value="ship" data-i18n-list-item="ship" data-i18n="ship">Ship</option><option value="solar_system" data-i18n-list-item="star_system" data-i18n="star_system">Star System</option><option value="spirit" data-i18n-list-item="spirit" data-i18n="spirit">Spirit</option><option value="vehicle" data-i18n-list-item="vehicle" data-i18n="vehicle">Vehicle</option></select><br><div class="sheet-minor"><label class="sheet-left sheet-rmargin" data-18n="intellect">Intellect</label><select class="sheet-auto-width" name="attr_int_type"><option value="int-u" data-i18n="int-u" selected>INT</option><option value="ins-u" data-i18n="ins-u">INS</option></select></div><div class="sheet-creature"><label class="sheet-left sheet-rmargin" data-18n="form">Form</label><select class="sheet-undrln sheet-auto-width" title="@{hit_locations}" name="attr_hit_locations" data-i18n-list="hit-location-order"><option value="custom1" data-i18n="custom(1_location)" data-i18n-list-item="custom(1_location)">Custom(1 Location)</option><option value="custom7" data-i18n="custom(7_locations)" data-i18n-list-item="custom(7_locations)" selected>Custom(7 Locations)</option><option value="custom8" data-i18n="custom(8_locations)" data-i18n-list-item="custom(8_locations)">Custom(8 Locations)</option><option value="custom9" data-i18n="custom(9_locations)" data-i18n-list-item="custom(9_locations)">Custom(9 Locations)</option><option value="custom10" data-i18n="custom(10_locations)" data-i18n-list-item="custom(10_locations)">Custom(10 Locations)</option><option value="custom11" data-i18n="custom(11_locations)" data-i18n-list-item="custom(11_locations)">Custom(11 Locations)</option><option value="custom" data-i18n="custom(12_locations)" data-i18n-list-item="custom(12_locations)">Custom(12 Locations)</option><option value="rabble" data-i18n="rabble/underling" data-i18n-list-item="rabble">Rabble/Underling</option><option class="sheet-hidden" value="simplified" data-i18n="simplified_combat">Simplified Combat</option><option data-i18n-list-item="spacer" disabled>──────────</option><option value="arachnid" data-i18n="arachnid" data-i18n-list-item="arachnid">Arachnid</option><option value="humanoid" data-i18n="biped" data-i18n-list-item="biped">Biped</option><option value="centaurid" data-i18n="centaurid" data-i18n-list-item="centaurid">Centaurid</option><option value="decapoda" data-i18n="decapoda" data-i18n-list-item="decapoda">Decapoda</option><option value="decapodiform" data-i18n="decapodiform" data-i18n-list-item="decapodiform">Decapodiform</option><option value="dorsal_finned_aquatic" data-i18n="dorsal_finned_aquatic" data-i18n-list-item="dorsal_finned_aquatic">Dorsal Finned Aquatic</option><option value="draconic" data-i18n="draconic" data-i18n-list-item="draconic">Draconic</option><option value="insect" data-i18n="insect" data-i18n-list-item="insect">Insect</option><option value="octopodiform" data-i18n="octopodiform" data-i18n-list-item="octopodiform">Octopodiform</option><option value="pachyderm" data-i18n="pachyderm" data-i18n-list-item="pachyderm">Pachyderm</option><option value="quadruped" data-i18n="quadruped" data-i18n-list-item="quadruped">Quadruped</option><option value="serpentine" data-i18n="serpentine" data-i18n-list-item="serpentine">Serpentine</option><option value="tailed_arachnid" data-i18n="tailed_arachnid" data-i18n-list-item="tailed_arachnid">Tailed Arachnid</option><option value="tailed_biped" data-i18n="tailed_biped" data-i18n-list-item="tailed_biped">Tailed Biped</option><option value="tailed_quadruped" data-i18n="tailed_quadruped" data-i18n-list-item="tailed_quadruped">Tailed Quadruped</option><option value="winged_biped" data-i18n="winged_biped" data-i18n-list-item="winged_biped">Winged Biped</option><option value="winged_insect" data-i18n="winged_insect" data-i18n-list-item="winged_insect">Winged Insect</option><option value="winged_quadruped" data-i18n="winged_quadruped" data-i18n-list-item="winged_quadruped">Winged Quadruped</option></select></div><div class="sheet-major"><label class="sheet-left sheet-rmargin" data-18n="avg-species-siz">Average Species SIZ</label><input type="number" class="sheet-number-width-sm sheet-undrln" title="@{avg_species_siz}" name="attr_avg_species_siz" value="13"></div></div><div class="sheet-section"><details><summary><h2 data-i18n="campaign_settings">Campaign Settings</h2></summary><div class="sheet-warnmsg"><span data-i18n="settings-warning">These campaign settings are generally set by your GM and shouldn't be changed. They are provided here for visibility, and testing.</span></div><label class="sheet-left sheet-rmargin" data-18n="setting">Setting</label><select name="attr_setting" data-i18n-list="setting-order"><option value="default" data-i18n="default" selected>Default</option><option value="after_the_vampire_wars" data-i18n-list-item="after_the_vampire_wars" data-i18n="after_the_vampire_wars">After the Vampire Wars</option><option value="classic_fantasy" data-i18n-list-item="classic_fantasy" data-i18n="classic_fantasy">Classic Fantasy</option><option value="destined" data-i18n-list-item="destined" data-i18n="destined">Destined</option><option value="fioracitta" data-i18n-list-item="fioracitta" data-i18n="fioracitta">Fioracitta</option><option value="luther_arkwright" data-i18n-list-item="luther_arkwright" data-i18n="luther_arkwright">Luther Arkwright</option><option value="lyonesse" data-i18n-list-item="lyonesse" data-i18n="lyonesse">Lyonesse</option><option value="m-space" data-i18n-list-item="m-space" data-i18n="m-space">M-Space</option><option value="monster_island" data-i18n-list-item="monster_island" data-i18n="monster_island">Monster Island</option><option value="mythic_babylon" data-i18n-list-item="mythic_babylon" data-i18n="mythic_babylon">Mythic Babylon</option><option value="mythic_britain" data-i18n-list-item="mythic_britain" data-i18n="mythic_britain">Mythic Britain</option><option value="mythic_constantinople" data-i18n-list-item="mythic_constantinople" data-i18n="mythic_constantinople">Mythic Constantinople</option><option value="mythic_rome" data-i18n-list-item="mythic_rome" data-i18n="mythic_rome">Mythic Rome</option><option value="mythras_imperative" data-i18n-list-item="mythras_imperative" data-i18n="mythras_imperative">Mythras Imperative</option><option value="odd_soot" data-i18n-list-item="add_soot" data-i18n="odd_soot">Odd Soot</option><option value="perceforest" data-i18n-list-item="perceforest" data-i18n="perceforest">Perceforest</option><option value="thennla" data-i18n-list-item="thennla" data-i18n="thennla">Thennla</option><option value="worlds_united" data-i18n-list-item="worlds_united" data-i18n="worlds_united">Worlds United</option></select><br><h3 data-i18n="mechanical_systems">Mechanical Systems</h3><label class="sheet-left sheet-rmargin" data-i18n="extended_conflict_resolution">Extended Conflict Resolution</label><select name="attr_extended_conflict_enabled_option"><option value="default" data-i18n="setting_default" selected>Setting Default</option><option value="1" data-i18n="enabled">Enabled</option><option value="0" data-i18n="disabled">Disabled</option></select><br><h3 data-i18n="attributes">Attributes</h3><label class="sheet-left sheet-rmargin" data-i18n="action_points">Action Points</label><select name="attr_action_points_calc_option"><option value="default" data-i18n="setting_default" selected>Setting Default</option><option value="calculate" data-i18n="calculated">Calculated</option><option value="set_2">2</option><option value="set_3">3</option></select><input type="hidden" name="attr_action_points_calc" value="calculate"><br><label class="sheet-left sheet-rmargin" data-i18n="tenacity">Tenacity</label><select name="attr_tenacity_enabled_option"><option value="default" data-i18n="setting_default" selected>Setting Default</option><option value="1" data-i18n="enabled">Enabled</option><option value="0" data-i18n="disabled">Disabled</option></select><br></details></div></div></div></div><script type="text/worker">const debug=1
const campaignSettings=["action_points_calc","extended_conflict_enabled","tenacity_enabled"]
const campaginSettingDefaults={"default":{"action_points_calc":"calculate","extended_conflict_enabled":0,"tenacity_enabled":0},"luther_arkwright":{"tenacity_enabled":1},"m-space":{"action_points_calc":"set_2","extended_conflict_enabled":1},"mythras_imperative":{"action_points_calc":"set_2"},"odd_soot":{"action_points_calc":"set_2","extended_conflict_enabled":1},"worlds_united":{"tenacity_enabled":1}}
function calcCampaignSetting(campaignSetting,campaignSettingOption,setting){if(campaignSettingOption==='default'){if((setting in campaginSettingDefaults)&&(campaignSetting in campaginSettingDefaults[setting])){return{[`${campaignSetting}`]:campaginSettingDefaults[setting][campaignSetting]};}else{return{[`${campaignSetting}`]:campaginSettingDefaults['default'][campaignSetting]};}}else{return{[`${campaignSetting}`]:campaignSettingOption};}}
on(`change:setting`,function(event){const campaignSettingOptions=campaignSettings.map(function(campaignSetting){return`${campaignSetting}_option`;})
getAttrs(campaignSettingOptions,function(v){let newAttrs={};campaignSettings.forEach(campaignSetting=>{newAttrs={...newAttrs,...calcCampaignSetting(campaignSetting,v[`${campaignSetting}_option`],event.newValue)}});setAttrs(newAttrs);});});campaignSettings.forEach(campaignSetting=>{on(`change:${campaignSetting}_option`,function(event){getAttrs(['setting'],function(v){setAttrs(calcCampaignSetting(`${campaignSetting}`,event.newValue,v['setting']));});});});function damageTable(step,damage_mod=false){const stepAbs=Math.abs(step);const die_steps=[0,'1d2','1d4','1d6','1d8'];const d10s=Math.floor(stepAbs/5);const damageModd10s=Math.floor((stepAbs-1)/5);const notd10s=stepAbs%5;const notDamageModd10s=(stepAbs-1)%5;let mod;if(damage_mod){if(stepAbs<=5){mod=(d10s?`${d10s}d10`:'')+(d10s&&notd10s?'+':'')+(notd10s?die_steps[notd10s]:(d10s?'':0));}else if(stepAbs===6){mod='1d12';}else if(stepAbs===7){mod='2d6';}else if(stepAbs===8){mod='1d8+1d6';}else if(stepAbs===9){mod='2d8';}else if(stepAbs===10){mod='1d10+1d8';}else{mod=(damageModd10s?`${damageModd10s}d10`:'')+(damageModd10s&&notDamageModd10s?'+':'')+(notDamageModd10s?die_steps[notDamageModd10s]:(damageModd10s?'':0));}}else{if(stepAbs===6){mod='2d6';}else if(stepAbs===7){mod='1d8+1d6';}else if(stepAbs===8){mod='2d8';}else if(stepAbs===9){mod='1d10+1d8';}else{mod=(d10s?`${d10s}d10`:'')+(d10s&&notd10s?'+':'')+(notd10s?die_steps[notd10s]:(d10s?'':0));}}
if(step>=0){return mod;}else{return'-'+mod;}}
const characteristicAttrs=['str','con','siz','dex','int','pow','cha'];characteristicAttrs.forEach(char=>{on(`change:${char}_base change:${char}_temp`,function(event){if(event.sourceType==="sheetworker"){return;}
let newAttrs={}
getAttrs([`${char}_base`,`${char}_temp`].concat(characteristicAttrs,actionPointGetAttrs,damageModGetAttrs,expModGetAttrs,healingRateGetAttrs),function(v){const baseCharVal=parseInt(v[`${char}_base`])||0;const tempCharVal=parseInt(v[`${char}_temp`])||0;newAttrs[`${char}`]=baseCharVal+tempCharVal;v[`${char}`]=baseCharVal+tempCharVal;setAttrs({...newAttrs,...calcActionPoints(v),...calcDamageMod(v),...calcExpMod(v),...calcHealingRate(v)});});});});const actionPointGetAttrs=['dex','int','action_points_other','action_points_temp','action_points_calc','action_points','action_points_max','fatigue']
function calcActionPoints(v){let base_value;const dex=parseInt(v['dex'])||0;const int=parseInt(v['int'])||0;const action_points_other=parseInt(v['action_points_other'])||0;const action_points_temp=parseInt(v['action_points_temp'])||0;const action_points_max=parseInt(v['action_points_max'])||0;const action_points=parseInt(v['action_points'])||0;const fatigueMod=parseInt(fatigueTable[v['fatigue']]['action_points'])||0;if(v['action_points_calc']==="set_2"){base_value=2+action_points_other;}else if(v['action_points_calc']==="set_3"){base_value=3+action_points_other;}else{base_value=Math.ceil((int+dex)/12)+action_points_other;}
let new_action_points_max=base_value+action_points_temp+fatigueMod;if(new_action_points_max<0){new_action_points_max=0;}
const diff_action_points_max=new_action_points_max-action_points_max;return{action_points_base:base_value,action_points_max:new_action_points_max,action_points:action_points+diff_action_points_max};}
on('change:action_points_other change:action_points_temp',function(event){if(event.sourceType==="sheetworker"){return;}
getAttrs(actionPointGetAttrs,function(v){setAttrs(calcActionPoints(v));});});on('change:action_points_calc',function(event){getAttrs(actionPointGetAttrs,function(v){setAttrs(calcActionPoints(v));});});const damageModGetAttrs=['str','siz','con','pow','damage_mod_calc','damage_mod_other','damage_mod_temp'];function calcDamageMod(v){let damage_mod_table_value;const str=parseInt(v['str'])||0;const siz=parseInt(v['siz'])||0;const damageModOther=parseInt(v['damage_mod_other'])||0;const damageModTemp=parseInt(v['damage_mod_temp'])||0;if(v['damage_mod_calc']==='1'){const pow=parseInt(v['pow'])||0;damage_mod_table_value=str+siz+pow;}else if(v['damage_mod_calc']==='2'){const con=parseInt(v['con'])||0;damage_mod_table_value=str+siz+con;}else{damage_mod_table_value=str+siz;}
const base_damage_mod_step=Math.ceil(damage_mod_table_value/5)-5+damageModOther;return{damage_mod_base:damageTable(base_damage_mod_step,true),damage_mod:damageTable(base_damage_mod_step+damageModTemp,true)};}
on('change:damage_mod_other change:damage_mod_temp change:damage_mod_calc',function(event){if(event.sourceType==="sheetworker"){return;}
getAttrs(damageModGetAttrs,function(v){setAttrs(calcDamageMod(v));});});const expModGetAttrs=['cha','int','experience_mod_calc','experience_mod_other','experience_mod_temp'];function calcExpMod(v){let base_value;const expModOther=parseInt(v['experience_mod_other'])||0;const expModTemp=parseInt(v['experience_mod_temp'])||0;if(v['experience_mod_calc']==='1'){const int=parseInt(v['int'])||0;base_value=Math.ceil(int/6)-2+expModOther;}else{const cha=parseInt(v['cha'])||0;base_value=Math.ceil(cha/6)-2+expModOther;}
return{experience_mod_base:base_value,experience_mod:base_value+expModTemp};}
on('change:experience_mod_other change:experience_mod_temp change:experience_mod_calc',function(event){if(event.sourceType==="sheetworker"){return;}
getAttrs(expModGetAttrs,function(v){setAttrs(calcExpMod(v));});});const healingRateGetAttrs=['con','pow','healing_rate_calc','healing_rate_other','healing_rate_temp','healing_rate_double'];function calcHealingRate(v){let base_multiplier;let base_value;const con=parseInt(v['con'])||0;const healingRateOther=parseInt(v['healing_rate_other'])||0;const healingRateTemp=parseInt(v['healing_rate_temp'])||0;if(v['healing_rate_double']==='1'){base_multiplier=2;}else{base_multiplier=1;}
if(v['healing_rate_calc']==='1'){const pow=parseInt(v['pow'])||0;base_value=(Math.ceil(Math.ceil(con+(pow/2))/6)*base_multiplier)+healingRateOther;}else{base_value=(Math.ceil(con/6)*base_multiplier)+healingRateOther;}
return{healing_rate_base:base_value,healing_rate:base_value+healingRateTemp};}
on('change:healing_rate_other change:healing_rate_temp change:healing_rate_calc change:healing_rate_double',function(event){if(event.sourceType==="sheetworker"){return;}
getAttrs(healingRateGetAttrs,function(v){setAttrs(calcHealingRate(v));});});const fatigueTable={'9':{"skills":'0',"action_points":'0',"initiative":'0',"movement":"+0","recovery":"-"},'8':{"skills":'1',"action_points":'0',"initiative":'0',"movement":'-1',"recovery":.25},'7':{"skills":'1',"action_points":'0',"initiative":'0',"movement":'-1',"recovery":3},'6':{"skills":'2',"action_points":'0',"initiative":'-2',"movement":'-2',"recovery":6},'5':{"skills":'2',"action_points":'-1',"initiative":'-4',"movement":'*.5',"recovery":12},'4':{"skills":'3',"action_points":'-2',"initiative":'-6',"movement":'*.5',"recovery":18},'3':{"skills":'3',"action_points":'-3',"initiative":'-8',"movement":'*0',"recovery":24},'2':{"skills":'4',"action_points":'-99',"initiative":'-99',"movement":'*0',"recovery":36},'1':{"skills":'5',"action_points":'-99',"initiative":'-99',"movement":'*0',"recovery":48},'0':{"skills":'5',"action_points":'-99',"initiative":'-99',"movement":'*0',"recovery":'-'}};function calcFatigueRecovery(v){let recoveryString='';const healing_rate=parseInt(v['healing_rate'])||2;if(fatigueTable[v['fatigue']]['recovery']!=='-'){let recovery=parseFloat((fatigueTable[v['fatigue']]['recovery']/healing_rate));let recoveryFraction=recovery%1;let recoveryMinutes=Math.round(recoveryFraction*60);let recoveryHours=Math.floor(recovery);if(recoveryHours!==0){let hourUnit=getTranslationByKey('hours-l');if(recoveryHours===1){hourUnit=getTranslationByKey('hour-l');}
recoveryString=recoveryHours+' '+hourUnit;}
if(recoveryMinutes!==0){let minUnit=getTranslationByKey('minutes-l');if(recoveryMinutes===1){minUnit=getTranslationByKey('minute-l');}
if(recoveryString===''){recoveryString=recoveryMinutes+' '+minUnit;}else{recoveryString=recoveryString+" "+recoveryMinutes+' '+minUnit;}}
return{fatigue_recovery:recoveryString};}else{return{fatigue_recovery:fatigueTable[v['fatigue']]['recovery']};}}
function calcFatigue(v){return{fatigue_skills:fatigueTable[v['fatigue']]['skills'],action_points_fatigue:fatigueTable[v['fatigue']]['action_points'],initiative_bonus_fatigue:fatigueTable[v['fatigue']]['initiative'],movement_rate_fatigue:fatigueTable[v['fatigue']]['movement'],...calcFatigueRecovery(v)};}
on('change:fatigue',function(event){if(event.sourceType==="sheetworker"){return;}
getAttrs(['fatigue','healing_rate'].concat(actionPointGetAttrs),function(v){setAttrs({...calcFatigue(v),...calcActionPoints(v)});});});function getImportName(importName,importType){if(importName.includes('(')){if(importType==='major'){return importName.split('(')[0].replace(/[()]/g,'').trim();}else{let[start,...end]=importName.split('(');end=end.join("(");return end.replace(/[()]/g,'').trim();}}else{return importName.replace(/[()]/g,'').trim();}}
on("clicked:import",function(){getAttrs(['import_json_data','import_character','import_type','simplified_combat_enabled','luck_points_rank','action_points_calc'],function(v){console.log(v['action_points_calc']);try{const jsonData=JSON.parse(v['import_json_data']);const import_character=parseInt(v['import_character']);if(import_character>jsonData.length){setAttrs({import_errors:"Error: The import data contains "+jsonData.length+" character(s) but you requested number "+import_character+"."});return;}
const characterData=jsonData[parseInt(v['import_character'])-1];let calc_armor_penalty=false;let newAttrs={rank:0,str_base:0,str:0,con_base:0,con:0,siz_base:0,siz:0,dex_base:0,dex:0,int_base:0,int:0,pow_base:0,pow:0,cha_base:0,cha:0,characteristics_details:0,action_points_other:0,action_points_temp:0,action_points_calc:v['action_points_calc'],action_points:2,action_points_max:2,damage_mod_calc:'0',damage_mod_other:0,damage_mod_temp:0,experience_mod_calc:'0',experience_mod_other:0,experience_mod_temp:0,healing_rate_calc:'0',healing_rate_other:0,healing_rate_temp:0,healing_rate_double:'0',fatigue:'9'};if(debug){console.log('Importing Info');}
if(debug){console.log("Importing Characteristics");}
characterData["stats"].forEach(stat=>{const charKey=Object.keys(stat)[0];const char=charKey.toLowerCase();newAttrs[`${char}_base`]=stat[charKey];newAttrs[`${char}`]=stat[charKey];});if(debug){console.log("Determining Import Sheet type");}
if(v['import_type']==='major'){newAttrs['type']='pc';}else{if(newAttrs['str_base']===0&&newAttrs['dex_base']===0){newAttrs['type']='spirit';}else{newAttrs['type']='creature';}}
newAttrs['character_name']=getImportName(characterData['name'],v['import_type']);newAttrs['import_json_data']='';setAttrs({...newAttrs,...calcActionPoints(newAttrs),...calcDamageMod(newAttrs),...calcExpMod(newAttrs),...calcHealingRate(newAttrs)});}catch(error){setAttrs({import_errors:error});}});});function upgradeCharacter3Dot0(){if(debug){console.log("Upgrading character to 3.0");}
let charGetAttrs=[];characteristicAttrs.forEach(char=>{charGetAttrs.push(`${char}`,`${char}_temp`);});getAttrs(charGetAttrs.concat(['action_points_other','action_points_add_one']),function(v){let newAttrs={'version':'3.0'};characteristicAttrs.forEach(char=>{const charCurr=parseInt(v[`${char}`])||0;const charTemp=parseInt(v[`${char}_temp`])||0;newAttrs[`${char}_base`]=charCurr-charTemp;});if(v['action_points_add_one']==='1'){const actionPointsOther=parseInt(v['action_points_other'])||0;newAttrs['action_points_other']=actionPointsOther+1;}
newAttrs['encounter_generator_json']='';setAttrs(newAttrs);});}
function versioning(type,version){const latestVersion='3.0';if(debug){console.log(`Current sheet version = ${version}`);}
version=parseFloat(version)||0;if(version===0){if(debug){console.log(`Current version invalid, setting to ${latestVersion}`);}
setAttrs({['version']:latestVersion});}else if(version<3.0){if(type==='pc'){upgradeCharacter3Dot0();}
versioning(type,'3.0');}}
function setTranslationAttrs(){setAttrs({});}
on("sheet:opened",function(){getAttrs(['type','version'],function(v){versioning(v['type'],v['version']);});setTranslationAttrs();});</script>